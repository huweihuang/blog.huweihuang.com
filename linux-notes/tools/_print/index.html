<!doctype html>
<html lang="zh-cn" class="no-js">
  <head>
    <meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="generator" content="Hugo 0.101.0" />
<link rel="canonical" type="text/html" href="https://blog.huweihuang.com/linux-notes/tools/">
<link rel="alternate" type="application/rss&#43;xml" href="https://blog.huweihuang.com/linux-notes/tools/index.xml">
<meta name="robots" content="noindex, nofollow">


<link rel="shortcut icon" href="/favicons/favicon.ico" >
<link rel="apple-touch-icon" href="/favicons/apple-touch-icon-180x180.png" sizes="180x180">
<link rel="icon" type="image/png" href="/favicons/favicon-16x16.png" sizes="16x16">
<link rel="icon" type="image/png" href="/favicons/favicon-32x32.png" sizes="32x32">
<link rel="icon" type="image/png" href="/favicons/android-36x36.png" sizes="36x36">
<link rel="icon" type="image/png" href="/favicons/android-48x48.png" sizes="48x48">
<link rel="icon" type="image/png" href="/favicons/android-72x72.png" sizes="72x72">
<link rel="icon" type="image/png" href="/favicons/android-96x96.png" sizes="96x96">
<link rel="icon" type="image/png" href="/favicons/android-144x144.png" sizes="144x144">
<link rel="icon" type="image/png" href="/favicons/android-192x192.png" sizes="192x192">

<title>运维工具 | 胡伟煌</title>
<meta name="description" content="">
<meta property="og:title" content="运维工具" />
<meta property="og:description" content="Kubernetes学习笔记" />
<meta property="og:type" content="website" />
<meta property="og:url" content="https://blog.huweihuang.com/linux-notes/tools/" /><meta property="og:site_name" content="胡伟煌" />

<meta itemprop="name" content="运维工具">
<meta itemprop="description" content="Kubernetes学习笔记"><meta name="twitter:card" content="summary"/>
<meta name="twitter:title" content="运维工具"/>
<meta name="twitter:description" content="Kubernetes学习笔记"/>




<link rel="preload" href="/scss/main.min.79e3930541ca05b5395c14b2a313b798fad1dc69f9a14aefa57b62eaa9f65f14.css" as="style">
<link href="/scss/main.min.79e3930541ca05b5395c14b2a313b798fad1dc69f9a14aefa57b62eaa9f65f14.css" rel="stylesheet" integrity="">

<script
  src="https://code.jquery.com/jquery-3.6.0.min.js"
  integrity="sha384-vtXRMe3mGCbOeY7l30aIg8H9p3GdeSe4IFlP6G8JMa7o7lXvnz3GFKzPxzJdPfGK"
  crossorigin="anonymous"></script>
<script
  src="https://unpkg.com/lunr@2.3.9/lunr.min.js"
  integrity="sha384-203J0SNzyqHby3iU6hzvzltrWi/M41wOP5Gu+BiJMz5nwKykbkUx8Kp7iti0Lpli"
  crossorigin="anonymous"></script>
<link rel="stylesheet" href="/css/prism.css"/>

<script type="application/javascript">
var doNotTrack = false;
if (!doNotTrack) {
	window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)};ga.l=+new Date;
	ga('create', 'UA-114718458-1', 'auto');
	
	ga('send', 'pageview');
}
</script>
<script async src='https://www.google-analytics.com/analytics.js'></script>

  </head>
  <body class="td-section">
    <header>
      
<nav class="js-navbar-scroll navbar navbar-expand navbar-dark flex-column flex-md-row td-navbar">
        <a class="navbar-brand" href="/">
		<span class="navbar-logo"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 32 32" width="64" height="64"><path d="M15.9.476a2.14 2.14.0 00-.823.218L3.932 6.01c-.582.277-1.005.804-1.15 1.432L.054 19.373c-.13.56-.025 1.147.3 1.627q.057.087.12.168l7.7 9.574c.407.5 1.018.787 1.662.784h12.35c.646.001 1.258-.3 1.664-.793l7.696-9.576c.404-.5.555-1.16.4-1.786L29.2 7.43c-.145-.628-.57-1.155-1.15-1.432L16.923.695A2.14 2.14.0 0015.89.476z" fill="#326ce5"/><path d="M16.002 4.542c-.384.027-.675.356-.655.74v.188c.018.213.05.424.092.633a6.22 6.22.0 01.066 1.21c-.038.133-.114.253-.218.345l-.015.282c-.405.034-.807.096-1.203.186-1.666.376-3.183 1.24-4.354 2.485l-.24-.17c-.132.04-.274.025-.395-.04a6.22 6.22.0 01-.897-.81 5.55 5.55.0 00-.437-.465l-.148-.118c-.132-.106-.294-.167-.463-.175a.64.64.0 00-.531.236c-.226.317-.152.756.164.983l.138.11a5.55 5.55.0 00.552.323c.354.197.688.428.998.7a.74.74.0 01.133.384l.218.2c-1.177 1.766-1.66 3.905-1.358 6.006l-.28.08c-.073.116-.17.215-.286.288a6.22 6.22.0 01-1.194.197 5.57 5.57.0 00-.64.05l-.177.04h-.02a.67.67.0 00-.387 1.132.67.67.0 00.684.165h.013l.18-.02c.203-.06.403-.134.598-.218.375-.15.764-.265 1.162-.34.138.008.27.055.382.135l.3-.05c.65 2.017 2.016 3.726 3.84 4.803l-.122.255c.056.117.077.247.06.376-.165.382-.367.748-.603 1.092a5.58 5.58.0 00-.358.533l-.085.18a.67.67.0 00.65 1.001.67.67.0 00.553-.432l.083-.17c.076-.2.14-.404.192-.61.177-.437.273-.906.515-1.196a.54.54.0 01.286-.14l.15-.273a8.62 8.62.0 006.146.015l.133.255c.136.02.258.095.34.205.188.358.34.733.456 1.12a5.57 5.57.0 00.194.611l.083.17a.67.67.0 001.187.131.67.67.0 00.016-.701l-.087-.18a5.55 5.55.0 00-.358-.531c-.23-.332-.428-.686-.6-1.057a.52.52.0 01.068-.4 2.29 2.29.0 01-.111-.269c1.82-1.085 3.18-2.8 3.823-4.82l.284.05c.102-.093.236-.142.373-.138.397.076.786.2 1.162.34.195.09.395.166.598.23.048.013.118.024.172.037h.013a.67.67.0 00.841-.851.67.67.0 00-.544-.446l-.194-.046a5.57 5.57.0 00-.64-.05c-.404-.026-.804-.092-1.194-.197-.12-.067-.22-.167-.288-.288l-.27-.08a8.65 8.65.0 00-1.386-5.993l.236-.218c-.01-.137.035-.273.124-.378.307-.264.64-.497.99-.696a5.57 5.57.0 00.552-.323l.146-.118a.67.67.0 00-.133-1.202.67.67.0 00-.696.161l-.148.118a5.57 5.57.0 00-.437.465c-.264.302-.556.577-.873.823a.74.74.0 01-.404.044l-.253.18c-1.46-1.53-3.427-2.48-5.535-2.67.0-.1-.013-.25-.015-.297-.113-.078-.192-.197-.218-.332a6.23 6.23.0 01.076-1.207c.043-.21.073-.42.092-.633v-.2c.02-.384-.27-.713-.655-.74zm-.834 5.166-.2 3.493h-.015c-.01.216-.137.4-.332.504s-.426.073-.6-.054l-2.865-2.03a6.86 6.86.0 013.303-1.799c.234-.05.47-.088.707-.114zm1.668.0c1.505.187 2.906.863 3.99 1.924l-2.838 2.017c-.175.14-.415.168-.618.072s-.333-.3-.336-.524zm-6.72 3.227 2.62 2.338v.015c.163.142.234.363.186.574s-.21.378-.417.435v.01l-3.362.967a6.86 6.86.0 01.974-4.34zm11.753.0c.796 1.295 1.148 2.814 1.002 4.327l-3.367-.97v-.013c-.21-.057-.37-.224-.417-.435s.023-.43.186-.574l2.6-2.327zm-6.404 2.52h1.072l.655.832-.238 1.04-.963.463-.965-.463-.227-1.04zm3.434 2.838c.045-.005.1-.005.135.0l3.467.585c-.5 1.44-1.487 2.67-2.775 3.493l-1.34-3.244a.59.59.0 01.509-.819zm-5.823.015c.196.003.377.104.484.268s.124.37.047.55v.013l-1.332 3.218C11 21.54 10.032 20.325 9.517 18.9l3.437-.583c.038-.004.077-.004.116.0zm2.904 1.4a.59.59.0 01.537.308h.013l1.694 3.057-.677.2c-1.246.285-2.547.218-3.758-.194l1.7-3.057c.103-.18.293-.29.5-.295z" fill="#fff" stroke="#fff" stroke-width=".055"/></svg></span><span class="font-weight-bold">胡伟煌</span>
	</a>
	<div class="td-navbar-nav-scroll ml-md-auto" id="main_navbar">
		<ul class="navbar-nav mt-2 mt-lg-0">
			
			
			<li class="nav-item mr-4 mb-2 mb-lg-0">
				
				
				
				
				
				
				
				
				<a class="nav-link" href="/kubernetes-notes/" ><span>Kubernetes学习笔记</span></a>
			</li>
			
			<li class="nav-item mr-4 mb-2 mb-lg-0">
				
				
				
				
				
				
				
				
				<a class="nav-link" href="/k8s-source-code-analysis/" ><span>Kubernetes源码分析</span></a>
			</li>
			
			<li class="nav-item mr-4 mb-2 mb-lg-0">
				
				
				
				
				
				
				
				
				<a class="nav-link" href="/golang-notes/" ><span>Golang学习笔记</span></a>
			</li>
			
			<li class="nav-item mr-4 mb-2 mb-lg-0">
				
				
				
				
				
				
				
				
				<a class="nav-link active" href="/linux-notes/" ><span class="active">Linux学习笔记</span></a>
			</li>
			
			<li class="nav-item mr-4 mb-2 mb-lg-0">
				
				
				
				
				
				
				
				
				<a class="nav-link" href="/about/" ><span>About</span></a>
			</li>
			
			
			
		</ul>
	</div>
	<div class="navbar-nav d-none d-lg-block"><input
  type="search"
  class="form-control td-search-input"
  placeholder="&#xf002; 站内搜索…"
  aria-label="站内搜索…"
  autocomplete="off"
  
  data-offline-search-index-json-src="/offline-search-index.38854d29857e33c4dafab935db358526.json"
  data-offline-search-base-href="/"
  data-offline-search-max-results="10"
>
</div>
</nav>

    </header>
    <div class="container-fluid td-outer">
      <div class="td-main">
        <div class="row flex-xl-nowrap">
          <main class="col-12 col-md-9 col-xl-8 pl-md-5" role="main">
            




<div class="td-content">
<div class="pageinfo pageinfo-primary d-print-none">
<p>
这是本节的多页打印视图。
<a href="#" onclick="print();return false;">点击此处打印</a>.
</p><p>
<a href="/linux-notes/tools/">返回本页常规视图</a>.
</p>
</div>



<h1 class="title">运维工具</h1>





    <ul>
    
  
  
  
  

  
    
    
	
<li>1: <a href="#pg-19e331c309cc44664359cc5ff58f47ff">ansible的使用</a></li>


    
  
    
    
	
<li>2: <a href="#pg-65763f1b371a58100a39fc1333ba1541">ceph-fuse的使用</a></li>


    
  
    
    
	
<li>3: <a href="#pg-96144427fb37ef08b231fd81e3a8f3fe">confd的使用</a></li>


    
  
    
    
	
<li>4: <a href="#pg-5531ca3712df8e070f36d75562fd0f0e">NFS的使用</a></li>


    
  
    
    
	
<li>5: <a href="#pg-9b6e7b7fc8e7add51ad7e8a79a48edd8">ssh tips</a></li>


    
  
    
    
	
<li>6: <a href="#pg-2fced7315a2daf4cf08293398519ee28">Supervisor的使用</a></li>


    
  

    </ul>


<div class="content">
      
</div>
</div>


  
  
  
  

  
  

  
    
    
	
    

<div class="td-content" style="">
    
	<h1 id="pg-19e331c309cc44664359cc5ff58f47ff">1 - ansible的使用</h1>
    
	<h1 id="1-安装">1. 安装</h1>
<p>以centos为例。</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>yum install -y ansible
</span></span></code></pre></div><h1 id="2-配置">2. 配置</h1>
<p>默认配置目录在<code>/etc/ansible/</code>，主要有以下两个配置：</p>
<ul>
<li>ansible.cfg：ansible的配置文件</li>
<li>hosts：配置ansible所连接的机器IP信息</li>
</ul>
<h2 id="2-1-ansible-cfg">2.1. ansible.cfg</h2>
<h2 id="2-2-hosts">2.2. hosts</h2>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span><span style="color:#8f5902;font-style:italic"># This is the default ansible &#39;hosts&#39; file.</span>
</span></span><span style="display:flex;"><span><span style="color:#8f5902;font-style:italic">#</span>
</span></span><span style="display:flex;"><span><span style="color:#8f5902;font-style:italic"># It should live in /etc/ansible/hosts</span>
</span></span><span style="display:flex;"><span><span style="color:#8f5902;font-style:italic">#</span>
</span></span><span style="display:flex;"><span><span style="color:#8f5902;font-style:italic">#   - Comments begin with the &#39;#&#39; character</span>
</span></span><span style="display:flex;"><span><span style="color:#8f5902;font-style:italic">#   - Blank lines are ignored</span>
</span></span><span style="display:flex;"><span><span style="color:#8f5902;font-style:italic">#   - Groups of hosts are delimited by [header] elements</span>
</span></span><span style="display:flex;"><span><span style="color:#8f5902;font-style:italic">#   - You can enter hostnames or ip addresses</span>
</span></span><span style="display:flex;"><span><span style="color:#8f5902;font-style:italic">#   - A hostname/ip can be a member of multiple groups</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#8f5902;font-style:italic"># Ex 1: Ungrouped hosts, specify before any group headers.</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#8f5902;font-style:italic"># green.example.com</span>
</span></span><span style="display:flex;"><span><span style="color:#8f5902;font-style:italic"># blue.example.com</span>
</span></span><span style="display:flex;"><span><span style="color:#8f5902;font-style:italic"># 192.168.100.1</span>
</span></span><span style="display:flex;"><span><span style="color:#8f5902;font-style:italic"># 192.168.100.10</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#8f5902;font-style:italic"># Ex 2: A collection of hosts belonging to the &#39;webservers&#39; group</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#8f5902;font-style:italic"># [webservers]</span>
</span></span><span style="display:flex;"><span><span style="color:#8f5902;font-style:italic"># alpha.example.org</span>
</span></span><span style="display:flex;"><span><span style="color:#8f5902;font-style:italic"># beta.example.org</span>
</span></span><span style="display:flex;"><span><span style="color:#8f5902;font-style:italic"># 192.168.1.100</span>
</span></span><span style="display:flex;"><span><span style="color:#8f5902;font-style:italic"># 192.168.1.110</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#8f5902;font-style:italic"># If you have multiple hosts following a pattern you can specify</span>
</span></span><span style="display:flex;"><span><span style="color:#8f5902;font-style:italic"># them like this:</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#8f5902;font-style:italic"># www[001:006].example.com</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#8f5902;font-style:italic"># Ex 3: A collection of database servers in the &#39;dbservers&#39; group</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#8f5902;font-style:italic"># [dbservers]</span>
</span></span><span style="display:flex;"><span><span style="color:#8f5902;font-style:italic">#</span>
</span></span><span style="display:flex;"><span><span style="color:#8f5902;font-style:italic"># db01.intranet.mydomain.net</span>
</span></span><span style="display:flex;"><span><span style="color:#8f5902;font-style:italic"># db02.intranet.mydomain.net</span>
</span></span><span style="display:flex;"><span><span style="color:#8f5902;font-style:italic"># 10.25.1.56</span>
</span></span><span style="display:flex;"><span><span style="color:#8f5902;font-style:italic"># 10.25.1.57</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#8f5902;font-style:italic"># Here&#39;s another example of host ranges, this time there are no</span>
</span></span><span style="display:flex;"><span><span style="color:#8f5902;font-style:italic"># leading 0s:</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#8f5902;font-style:italic"># db-[99:101]-node.example.com</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#ce5c00;font-weight:bold">[</span>k8s<span style="color:#ce5c00;font-weight:bold">]</span>
</span></span><span style="display:flex;"><span>192.168.201.52
</span></span><span style="display:flex;"><span>192.168.201.53
</span></span><span style="display:flex;"><span>192.168.201.54
</span></span><span style="display:flex;"><span>192.168.201.55
</span></span><span style="display:flex;"><span>192.168.201.56
</span></span><span style="display:flex;"><span>192.168.201.57
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#8f5902;font-style:italic"># password setting</span>
</span></span><span style="display:flex;"><span><span style="color:#ce5c00;font-weight:bold">[</span>all:vars<span style="color:#ce5c00;font-weight:bold">]</span>
</span></span><span style="display:flex;"><span><span style="color:#000">ansible_connection</span><span style="color:#ce5c00;font-weight:bold">=</span>ssh
</span></span><span style="display:flex;"><span><span style="color:#000">ansible_ssh_user</span><span style="color:#ce5c00;font-weight:bold">=</span>root
</span></span><span style="display:flex;"><span><span style="color:#000">ansible_ssh_pass</span><span style="color:#ce5c00;font-weight:bold">=</span>xxx
</span></span></code></pre></div><h1 id="3-ansible的命令">3. ansible的命令</h1>
<p>命令格式为：ansible <host-pattern> [options]</p>
<ul>
<li><code>host-pattern</code>：即hosts文件中配置的集群名称</li>
<li><code>options</code>：命令操作符</li>
</ul>
<p>例如：ansible k8s -a 'uname -r'</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span><span style="color:#ce5c00;font-weight:bold">[</span>root@k8s-master ansible<span style="color:#ce5c00;font-weight:bold">]</span><span style="color:#8f5902;font-style:italic"># ansible k8s -a &#39;uname -r&#39;</span>
</span></span><span style="display:flex;"><span>172.16.201.56 <span style="color:#000;font-weight:bold">|</span> SUCCESS <span style="color:#000;font-weight:bold">|</span> <span style="color:#000">rc</span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#0000cf;font-weight:bold">0</span> &gt;&gt;
</span></span><span style="display:flex;"><span>4.16.11-1.el7.elrepo.x86_64
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>172.16.201.55 <span style="color:#000;font-weight:bold">|</span> SUCCESS <span style="color:#000;font-weight:bold">|</span> <span style="color:#000">rc</span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#0000cf;font-weight:bold">0</span> &gt;&gt;
</span></span><span style="display:flex;"><span>4.16.11-1.el7.elrepo.x86_64
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>172.16.201.54 <span style="color:#000;font-weight:bold">|</span> SUCCESS <span style="color:#000;font-weight:bold">|</span> <span style="color:#000">rc</span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#0000cf;font-weight:bold">0</span> &gt;&gt;
</span></span><span style="display:flex;"><span>4.16.11-1.el7.elrepo.x86_64
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>172.16.201.53 <span style="color:#000;font-weight:bold">|</span> SUCCESS <span style="color:#000;font-weight:bold">|</span> <span style="color:#000">rc</span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#0000cf;font-weight:bold">0</span> &gt;&gt;
</span></span><span style="display:flex;"><span>4.16.11-1.el7.elrepo.x86_64
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>172.16.201.52 <span style="color:#000;font-weight:bold">|</span> SUCCESS <span style="color:#000;font-weight:bold">|</span> <span style="color:#000">rc</span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#0000cf;font-weight:bold">0</span> &gt;&gt;
</span></span><span style="display:flex;"><span>4.16.11-1.el7.elrepo.x86_64
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>172.16.201.57 <span style="color:#000;font-weight:bold">|</span> SUCCESS <span style="color:#000;font-weight:bold">|</span> <span style="color:#000">rc</span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#0000cf;font-weight:bold">0</span> &gt;&gt;
</span></span><span style="display:flex;"><span>4.16.11-1.el7.elrepo.x86_64
</span></span></code></pre></div><p>具体的命令信息：</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>Usage: ansible &lt;host-pattern&gt; <span style="color:#ce5c00;font-weight:bold">[</span>options<span style="color:#ce5c00;font-weight:bold">]</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>Define and run a single task <span style="color:#4e9a06">&#39;playbook&#39;</span> against a <span style="color:#204a87">set</span> of hosts
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>Options:
</span></span><span style="display:flex;"><span>  -a MODULE_ARGS, --args<span style="color:#ce5c00;font-weight:bold">=</span>MODULE_ARGS
</span></span><span style="display:flex;"><span>                        module arguments
</span></span><span style="display:flex;"><span>  --ask-vault-pass      ask <span style="color:#204a87;font-weight:bold">for</span> vault password
</span></span><span style="display:flex;"><span>  -B SECONDS, --background<span style="color:#ce5c00;font-weight:bold">=</span>SECONDS
</span></span><span style="display:flex;"><span>                        run asynchronously, failing after X seconds
</span></span><span style="display:flex;"><span>                        <span style="color:#ce5c00;font-weight:bold">(</span><span style="color:#000">default</span><span style="color:#ce5c00;font-weight:bold">=</span>N/A<span style="color:#ce5c00;font-weight:bold">)</span>
</span></span><span style="display:flex;"><span>  -C, --check           don<span style="color:#4e9a06">&#39;t make any changes; instead, try to predict some
</span></span></span><span style="display:flex;"><span><span style="color:#4e9a06">                        of the changes that may occur
</span></span></span><span style="display:flex;"><span><span style="color:#4e9a06">  -D, --diff            when changing (small) files and templates, show the
</span></span></span><span style="display:flex;"><span><span style="color:#4e9a06">                        differences in those files; works great with --check
</span></span></span><span style="display:flex;"><span><span style="color:#4e9a06">  -e EXTRA_VARS, --extra-vars=EXTRA_VARS
</span></span></span><span style="display:flex;"><span><span style="color:#4e9a06">                        set additional variables as key=value or YAML/JSON, if
</span></span></span><span style="display:flex;"><span><span style="color:#4e9a06">                        filename prepend with @
</span></span></span><span style="display:flex;"><span><span style="color:#4e9a06">  -f FORKS, --forks=FORKS
</span></span></span><span style="display:flex;"><span><span style="color:#4e9a06">                        specify number of parallel processes to use
</span></span></span><span style="display:flex;"><span><span style="color:#4e9a06">                        (default=5)
</span></span></span><span style="display:flex;"><span><span style="color:#4e9a06">  -h, --help            show this help message and exit
</span></span></span><span style="display:flex;"><span><span style="color:#4e9a06">  -i INVENTORY, --inventory=INVENTORY, --inventory-file=INVENTORY
</span></span></span><span style="display:flex;"><span><span style="color:#4e9a06">                        specify inventory host path or comma separated host
</span></span></span><span style="display:flex;"><span><span style="color:#4e9a06">                        list. --inventory-file is deprecated
</span></span></span><span style="display:flex;"><span><span style="color:#4e9a06">  -l SUBSET, --limit=SUBSET
</span></span></span><span style="display:flex;"><span><span style="color:#4e9a06">                        further limit selected hosts to an additional pattern
</span></span></span><span style="display:flex;"><span><span style="color:#4e9a06">  --list-hosts          outputs a list of matching hosts; does not execute
</span></span></span><span style="display:flex;"><span><span style="color:#4e9a06">                        anything else
</span></span></span><span style="display:flex;"><span><span style="color:#4e9a06">  -m MODULE_NAME, --module-name=MODULE_NAME
</span></span></span><span style="display:flex;"><span><span style="color:#4e9a06">                        module name to execute (default=command)
</span></span></span><span style="display:flex;"><span><span style="color:#4e9a06">  -M MODULE_PATH, --module-path=MODULE_PATH
</span></span></span><span style="display:flex;"><span><span style="color:#4e9a06">                        prepend colon-separated path(s) to module library
</span></span></span><span style="display:flex;"><span><span style="color:#4e9a06">                        (default=[u&#39;</span>/root/.ansible/plugins/modules<span style="color:#4e9a06">&#39;,
</span></span></span><span style="display:flex;"><span><span style="color:#4e9a06">                        u&#39;</span>/usr/share/ansible/plugins/modules<span style="color:#4e9a06">&#39;])
</span></span></span><span style="display:flex;"><span><span style="color:#4e9a06">  -o, --one-line        condense output
</span></span></span><span style="display:flex;"><span><span style="color:#4e9a06">  --playbook-dir=BASEDIR
</span></span></span><span style="display:flex;"><span><span style="color:#4e9a06">                        Since this tool does not use playbooks, use this as a
</span></span></span><span style="display:flex;"><span><span style="color:#4e9a06">                        subsitute playbook directory.This sets the relative
</span></span></span><span style="display:flex;"><span><span style="color:#4e9a06">                        path for many features including roles/ group_vars/
</span></span></span><span style="display:flex;"><span><span style="color:#4e9a06">                        etc.
</span></span></span><span style="display:flex;"><span><span style="color:#4e9a06">  -P POLL_INTERVAL, --poll=POLL_INTERVAL
</span></span></span><span style="display:flex;"><span><span style="color:#4e9a06">                        set the poll interval if using -B (default=15)
</span></span></span><span style="display:flex;"><span><span style="color:#4e9a06">  --syntax-check        perform a syntax check on the playbook, but do not
</span></span></span><span style="display:flex;"><span><span style="color:#4e9a06">                        execute it
</span></span></span><span style="display:flex;"><span><span style="color:#4e9a06">  -t TREE, --tree=TREE  log output to this directory
</span></span></span><span style="display:flex;"><span><span style="color:#4e9a06">  --vault-id=VAULT_IDS  the vault identity to use
</span></span></span><span style="display:flex;"><span><span style="color:#4e9a06">  --vault-password-file=VAULT_PASSWORD_FILES
</span></span></span><span style="display:flex;"><span><span style="color:#4e9a06">                        vault password file
</span></span></span><span style="display:flex;"><span><span style="color:#4e9a06">  -v, --verbose         verbose mode (-vvv for more, -vvvv to enable
</span></span></span><span style="display:flex;"><span><span style="color:#4e9a06">                        connection debugging)
</span></span></span><span style="display:flex;"><span><span style="color:#4e9a06">  --version             show program&#39;</span>s version number and <span style="color:#204a87">exit</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  Connection Options:
</span></span><span style="display:flex;"><span>    control as whom and how to connect to hosts
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    -k, --ask-pass      ask <span style="color:#204a87;font-weight:bold">for</span> connection password
</span></span><span style="display:flex;"><span>    --private-key<span style="color:#ce5c00;font-weight:bold">=</span>PRIVATE_KEY_FILE, --key-file<span style="color:#ce5c00;font-weight:bold">=</span>PRIVATE_KEY_FILE
</span></span><span style="display:flex;"><span>                        use this file to authenticate the connection
</span></span><span style="display:flex;"><span>    -u REMOTE_USER, --user<span style="color:#ce5c00;font-weight:bold">=</span>REMOTE_USER
</span></span><span style="display:flex;"><span>                        connect as this user <span style="color:#ce5c00;font-weight:bold">(</span><span style="color:#000">default</span><span style="color:#ce5c00;font-weight:bold">=</span>None<span style="color:#ce5c00;font-weight:bold">)</span>
</span></span><span style="display:flex;"><span>    -c CONNECTION, --connection<span style="color:#ce5c00;font-weight:bold">=</span>CONNECTION
</span></span><span style="display:flex;"><span>                        connection <span style="color:#204a87">type</span> to use <span style="color:#ce5c00;font-weight:bold">(</span><span style="color:#000">default</span><span style="color:#ce5c00;font-weight:bold">=</span>smart<span style="color:#ce5c00;font-weight:bold">)</span>
</span></span><span style="display:flex;"><span>    -T TIMEOUT, --timeout<span style="color:#ce5c00;font-weight:bold">=</span>TIMEOUT
</span></span><span style="display:flex;"><span>                        override the connection timeout in seconds
</span></span><span style="display:flex;"><span>                        <span style="color:#ce5c00;font-weight:bold">(</span><span style="color:#000">default</span><span style="color:#ce5c00;font-weight:bold">=</span>10<span style="color:#ce5c00;font-weight:bold">)</span>
</span></span><span style="display:flex;"><span>    --ssh-common-args<span style="color:#ce5c00;font-weight:bold">=</span>SSH_COMMON_ARGS
</span></span><span style="display:flex;"><span>                        specify common arguments to pass to sftp/scp/ssh <span style="color:#ce5c00;font-weight:bold">(</span>e.g.
</span></span><span style="display:flex;"><span>                        ProxyCommand<span style="color:#ce5c00;font-weight:bold">)</span>
</span></span><span style="display:flex;"><span>    --sftp-extra-args<span style="color:#ce5c00;font-weight:bold">=</span>SFTP_EXTRA_ARGS
</span></span><span style="display:flex;"><span>                        specify extra arguments to pass to sftp only <span style="color:#ce5c00;font-weight:bold">(</span>e.g. -f,
</span></span><span style="display:flex;"><span>                        -l<span style="color:#ce5c00;font-weight:bold">)</span>
</span></span><span style="display:flex;"><span>    --scp-extra-args<span style="color:#ce5c00;font-weight:bold">=</span>SCP_EXTRA_ARGS
</span></span><span style="display:flex;"><span>                        specify extra arguments to pass to scp only <span style="color:#ce5c00;font-weight:bold">(</span>e.g. -l<span style="color:#ce5c00;font-weight:bold">)</span>
</span></span><span style="display:flex;"><span>    --ssh-extra-args<span style="color:#ce5c00;font-weight:bold">=</span>SSH_EXTRA_ARGS
</span></span><span style="display:flex;"><span>                        specify extra arguments to pass to ssh only <span style="color:#ce5c00;font-weight:bold">(</span>e.g. -R<span style="color:#ce5c00;font-weight:bold">)</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  Privilege Escalation Options:
</span></span><span style="display:flex;"><span>    control how and which user you become as on target hosts
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    -s, --sudo          run operations with sudo <span style="color:#ce5c00;font-weight:bold">(</span>nopasswd<span style="color:#ce5c00;font-weight:bold">)</span> <span style="color:#ce5c00;font-weight:bold">(</span>deprecated, use
</span></span><span style="display:flex;"><span>                        become<span style="color:#ce5c00;font-weight:bold">)</span>
</span></span><span style="display:flex;"><span>    -U SUDO_USER, --sudo-user<span style="color:#ce5c00;font-weight:bold">=</span>SUDO_USER
</span></span><span style="display:flex;"><span>                        desired sudo user <span style="color:#ce5c00;font-weight:bold">(</span><span style="color:#000">default</span><span style="color:#ce5c00;font-weight:bold">=</span>root<span style="color:#ce5c00;font-weight:bold">)</span> <span style="color:#ce5c00;font-weight:bold">(</span>deprecated, use
</span></span><span style="display:flex;"><span>                        become<span style="color:#ce5c00;font-weight:bold">)</span>
</span></span><span style="display:flex;"><span>    -S, --su            run operations with su <span style="color:#ce5c00;font-weight:bold">(</span>deprecated, use become<span style="color:#ce5c00;font-weight:bold">)</span>
</span></span><span style="display:flex;"><span>    -R SU_USER, --su-user<span style="color:#ce5c00;font-weight:bold">=</span>SU_USER
</span></span><span style="display:flex;"><span>                        run operations with su as this user <span style="color:#ce5c00;font-weight:bold">(</span><span style="color:#000">default</span><span style="color:#ce5c00;font-weight:bold">=</span>None<span style="color:#ce5c00;font-weight:bold">)</span>
</span></span><span style="display:flex;"><span>                        <span style="color:#ce5c00;font-weight:bold">(</span>deprecated, use become<span style="color:#ce5c00;font-weight:bold">)</span>
</span></span><span style="display:flex;"><span>    -b, --become        run operations with become <span style="color:#ce5c00;font-weight:bold">(</span>does not imply password
</span></span><span style="display:flex;"><span>                        prompting<span style="color:#ce5c00;font-weight:bold">)</span>
</span></span><span style="display:flex;"><span>    --become-method<span style="color:#ce5c00;font-weight:bold">=</span>BECOME_METHOD
</span></span><span style="display:flex;"><span>                        privilege escalation method to use <span style="color:#ce5c00;font-weight:bold">(</span><span style="color:#000">default</span><span style="color:#ce5c00;font-weight:bold">=</span>sudo<span style="color:#ce5c00;font-weight:bold">)</span>,
</span></span><span style="display:flex;"><span>                        valid choices: <span style="color:#ce5c00;font-weight:bold">[</span> sudo <span style="color:#000;font-weight:bold">|</span> su <span style="color:#000;font-weight:bold">|</span> pbrun <span style="color:#000;font-weight:bold">|</span> pfexec <span style="color:#000;font-weight:bold">|</span> doas <span style="color:#000;font-weight:bold">|</span>
</span></span><span style="display:flex;"><span>                        dzdo <span style="color:#000;font-weight:bold">|</span> ksu <span style="color:#000;font-weight:bold">|</span> runas <span style="color:#000;font-weight:bold">|</span> pmrun <span style="color:#000;font-weight:bold">|</span> <span style="color:#204a87">enable</span> <span style="color:#ce5c00;font-weight:bold">]</span>
</span></span><span style="display:flex;"><span>    --become-user<span style="color:#ce5c00;font-weight:bold">=</span>BECOME_USER
</span></span><span style="display:flex;"><span>                        run operations as this user <span style="color:#ce5c00;font-weight:bold">(</span><span style="color:#000">default</span><span style="color:#ce5c00;font-weight:bold">=</span>root<span style="color:#ce5c00;font-weight:bold">)</span>
</span></span><span style="display:flex;"><span>    --ask-sudo-pass     ask <span style="color:#204a87;font-weight:bold">for</span> sudo password <span style="color:#ce5c00;font-weight:bold">(</span>deprecated, use become<span style="color:#ce5c00;font-weight:bold">)</span>
</span></span><span style="display:flex;"><span>    --ask-su-pass       ask <span style="color:#204a87;font-weight:bold">for</span> su password <span style="color:#ce5c00;font-weight:bold">(</span>deprecated, use become<span style="color:#ce5c00;font-weight:bold">)</span>
</span></span><span style="display:flex;"><span>    -K, --ask-become-pass
</span></span><span style="display:flex;"><span>                        ask <span style="color:#204a87;font-weight:bold">for</span> privilege escalation password
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>Some modules <span style="color:#204a87;font-weight:bold">do</span> not make sense in Ad-Hoc <span style="color:#ce5c00;font-weight:bold">(</span>include, meta, etc<span style="color:#ce5c00;font-weight:bold">)</span>
</span></span></code></pre></div><h1 id="4-ansible-playbook">4. ansible-playbook</h1>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>Usage: ansible-playbook <span style="color:#ce5c00;font-weight:bold">[</span>options<span style="color:#ce5c00;font-weight:bold">]</span> playbook.yml <span style="color:#ce5c00;font-weight:bold">[</span>playbook2 ...<span style="color:#ce5c00;font-weight:bold">]</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>Runs Ansible playbooks, executing the defined tasks on the targeted hosts.
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>Options:
</span></span><span style="display:flex;"><span>  --ask-vault-pass      ask <span style="color:#204a87;font-weight:bold">for</span> vault password
</span></span><span style="display:flex;"><span>  -C, --check           don<span style="color:#4e9a06">&#39;t make any changes; instead, try to predict some
</span></span></span><span style="display:flex;"><span><span style="color:#4e9a06">                        of the changes that may occur
</span></span></span><span style="display:flex;"><span><span style="color:#4e9a06">  -D, --diff            when changing (small) files and templates, show the
</span></span></span><span style="display:flex;"><span><span style="color:#4e9a06">                        differences in those files; works great with --check
</span></span></span><span style="display:flex;"><span><span style="color:#4e9a06">  -e EXTRA_VARS, --extra-vars=EXTRA_VARS
</span></span></span><span style="display:flex;"><span><span style="color:#4e9a06">                        set additional variables as key=value or YAML/JSON, if
</span></span></span><span style="display:flex;"><span><span style="color:#4e9a06">                        filename prepend with @
</span></span></span><span style="display:flex;"><span><span style="color:#4e9a06">  --flush-cache         clear the fact cache for every host in inventory
</span></span></span><span style="display:flex;"><span><span style="color:#4e9a06">  --force-handlers      run handlers even if a task fails
</span></span></span><span style="display:flex;"><span><span style="color:#4e9a06">  -f FORKS, --forks=FORKS
</span></span></span><span style="display:flex;"><span><span style="color:#4e9a06">                        specify number of parallel processes to use
</span></span></span><span style="display:flex;"><span><span style="color:#4e9a06">                        (default=5)
</span></span></span><span style="display:flex;"><span><span style="color:#4e9a06">  -h, --help            show this help message and exit
</span></span></span><span style="display:flex;"><span><span style="color:#4e9a06">  -i INVENTORY, --inventory=INVENTORY, --inventory-file=INVENTORY
</span></span></span><span style="display:flex;"><span><span style="color:#4e9a06">                        specify inventory host path or comma separated host
</span></span></span><span style="display:flex;"><span><span style="color:#4e9a06">                        list. --inventory-file is deprecated
</span></span></span><span style="display:flex;"><span><span style="color:#4e9a06">  -l SUBSET, --limit=SUBSET
</span></span></span><span style="display:flex;"><span><span style="color:#4e9a06">                        further limit selected hosts to an additional pattern
</span></span></span><span style="display:flex;"><span><span style="color:#4e9a06">  --list-hosts          outputs a list of matching hosts; does not execute
</span></span></span><span style="display:flex;"><span><span style="color:#4e9a06">                        anything else
</span></span></span><span style="display:flex;"><span><span style="color:#4e9a06">  --list-tags           list all available tags
</span></span></span><span style="display:flex;"><span><span style="color:#4e9a06">  --list-tasks          list all tasks that would be executed
</span></span></span><span style="display:flex;"><span><span style="color:#4e9a06">  -M MODULE_PATH, --module-path=MODULE_PATH
</span></span></span><span style="display:flex;"><span><span style="color:#4e9a06">                        prepend colon-separated path(s) to module library
</span></span></span><span style="display:flex;"><span><span style="color:#4e9a06">                        (default=[u&#39;</span>/root/.ansible/plugins/modules<span style="color:#4e9a06">&#39;,
</span></span></span><span style="display:flex;"><span><span style="color:#4e9a06">                        u&#39;</span>/usr/share/ansible/plugins/modules<span style="color:#4e9a06">&#39;])
</span></span></span><span style="display:flex;"><span><span style="color:#4e9a06">  --skip-tags=SKIP_TAGS
</span></span></span><span style="display:flex;"><span><span style="color:#4e9a06">                        only run plays and tasks whose tags do not match these
</span></span></span><span style="display:flex;"><span><span style="color:#4e9a06">                        values
</span></span></span><span style="display:flex;"><span><span style="color:#4e9a06">  --start-at-task=START_AT_TASK
</span></span></span><span style="display:flex;"><span><span style="color:#4e9a06">                        start the playbook at the task matching this name
</span></span></span><span style="display:flex;"><span><span style="color:#4e9a06">  --step                one-step-at-a-time: confirm each task before running
</span></span></span><span style="display:flex;"><span><span style="color:#4e9a06">  --syntax-check        perform a syntax check on the playbook, but do not
</span></span></span><span style="display:flex;"><span><span style="color:#4e9a06">                        execute it
</span></span></span><span style="display:flex;"><span><span style="color:#4e9a06">  -t TAGS, --tags=TAGS  only run plays and tasks tagged with these values
</span></span></span><span style="display:flex;"><span><span style="color:#4e9a06">  --vault-id=VAULT_IDS  the vault identity to use
</span></span></span><span style="display:flex;"><span><span style="color:#4e9a06">  --vault-password-file=VAULT_PASSWORD_FILES
</span></span></span><span style="display:flex;"><span><span style="color:#4e9a06">                        vault password file
</span></span></span><span style="display:flex;"><span><span style="color:#4e9a06">  -v, --verbose         verbose mode (-vvv for more, -vvvv to enable
</span></span></span><span style="display:flex;"><span><span style="color:#4e9a06">                        connection debugging)
</span></span></span><span style="display:flex;"><span><span style="color:#4e9a06">  --version             show program&#39;</span>s version number and <span style="color:#204a87">exit</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  Connection Options:
</span></span><span style="display:flex;"><span>    control as whom and how to connect to hosts
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    -k, --ask-pass      ask <span style="color:#204a87;font-weight:bold">for</span> connection password
</span></span><span style="display:flex;"><span>    --private-key<span style="color:#ce5c00;font-weight:bold">=</span>PRIVATE_KEY_FILE, --key-file<span style="color:#ce5c00;font-weight:bold">=</span>PRIVATE_KEY_FILE
</span></span><span style="display:flex;"><span>                        use this file to authenticate the connection
</span></span><span style="display:flex;"><span>    -u REMOTE_USER, --user<span style="color:#ce5c00;font-weight:bold">=</span>REMOTE_USER
</span></span><span style="display:flex;"><span>                        connect as this user <span style="color:#ce5c00;font-weight:bold">(</span><span style="color:#000">default</span><span style="color:#ce5c00;font-weight:bold">=</span>None<span style="color:#ce5c00;font-weight:bold">)</span>
</span></span><span style="display:flex;"><span>    -c CONNECTION, --connection<span style="color:#ce5c00;font-weight:bold">=</span>CONNECTION
</span></span><span style="display:flex;"><span>                        connection <span style="color:#204a87">type</span> to use <span style="color:#ce5c00;font-weight:bold">(</span><span style="color:#000">default</span><span style="color:#ce5c00;font-weight:bold">=</span>smart<span style="color:#ce5c00;font-weight:bold">)</span>
</span></span><span style="display:flex;"><span>    -T TIMEOUT, --timeout<span style="color:#ce5c00;font-weight:bold">=</span>TIMEOUT
</span></span><span style="display:flex;"><span>                        override the connection timeout in seconds
</span></span><span style="display:flex;"><span>                        <span style="color:#ce5c00;font-weight:bold">(</span><span style="color:#000">default</span><span style="color:#ce5c00;font-weight:bold">=</span>10<span style="color:#ce5c00;font-weight:bold">)</span>
</span></span><span style="display:flex;"><span>    --ssh-common-args<span style="color:#ce5c00;font-weight:bold">=</span>SSH_COMMON_ARGS
</span></span><span style="display:flex;"><span>                        specify common arguments to pass to sftp/scp/ssh <span style="color:#ce5c00;font-weight:bold">(</span>e.g.
</span></span><span style="display:flex;"><span>                        ProxyCommand<span style="color:#ce5c00;font-weight:bold">)</span>
</span></span><span style="display:flex;"><span>    --sftp-extra-args<span style="color:#ce5c00;font-weight:bold">=</span>SFTP_EXTRA_ARGS
</span></span><span style="display:flex;"><span>                        specify extra arguments to pass to sftp only <span style="color:#ce5c00;font-weight:bold">(</span>e.g. -f,
</span></span><span style="display:flex;"><span>                        -l<span style="color:#ce5c00;font-weight:bold">)</span>
</span></span><span style="display:flex;"><span>    --scp-extra-args<span style="color:#ce5c00;font-weight:bold">=</span>SCP_EXTRA_ARGS
</span></span><span style="display:flex;"><span>                        specify extra arguments to pass to scp only <span style="color:#ce5c00;font-weight:bold">(</span>e.g. -l<span style="color:#ce5c00;font-weight:bold">)</span>
</span></span><span style="display:flex;"><span>    --ssh-extra-args<span style="color:#ce5c00;font-weight:bold">=</span>SSH_EXTRA_ARGS
</span></span><span style="display:flex;"><span>                        specify extra arguments to pass to ssh only <span style="color:#ce5c00;font-weight:bold">(</span>e.g. -R<span style="color:#ce5c00;font-weight:bold">)</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  Privilege Escalation Options:
</span></span><span style="display:flex;"><span>    control how and which user you become as on target hosts
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    -s, --sudo          run operations with sudo <span style="color:#ce5c00;font-weight:bold">(</span>nopasswd<span style="color:#ce5c00;font-weight:bold">)</span> <span style="color:#ce5c00;font-weight:bold">(</span>deprecated, use
</span></span><span style="display:flex;"><span>                        become<span style="color:#ce5c00;font-weight:bold">)</span>
</span></span><span style="display:flex;"><span>    -U SUDO_USER, --sudo-user<span style="color:#ce5c00;font-weight:bold">=</span>SUDO_USER
</span></span><span style="display:flex;"><span>                        desired sudo user <span style="color:#ce5c00;font-weight:bold">(</span><span style="color:#000">default</span><span style="color:#ce5c00;font-weight:bold">=</span>root<span style="color:#ce5c00;font-weight:bold">)</span> <span style="color:#ce5c00;font-weight:bold">(</span>deprecated, use
</span></span><span style="display:flex;"><span>                        become<span style="color:#ce5c00;font-weight:bold">)</span>
</span></span><span style="display:flex;"><span>    -S, --su            run operations with su <span style="color:#ce5c00;font-weight:bold">(</span>deprecated, use become<span style="color:#ce5c00;font-weight:bold">)</span>
</span></span><span style="display:flex;"><span>    -R SU_USER, --su-user<span style="color:#ce5c00;font-weight:bold">=</span>SU_USER
</span></span><span style="display:flex;"><span>                        run operations with su as this user <span style="color:#ce5c00;font-weight:bold">(</span><span style="color:#000">default</span><span style="color:#ce5c00;font-weight:bold">=</span>None<span style="color:#ce5c00;font-weight:bold">)</span>
</span></span><span style="display:flex;"><span>                        <span style="color:#ce5c00;font-weight:bold">(</span>deprecated, use become<span style="color:#ce5c00;font-weight:bold">)</span>
</span></span><span style="display:flex;"><span>    -b, --become        run operations with become <span style="color:#ce5c00;font-weight:bold">(</span>does not imply password
</span></span><span style="display:flex;"><span>                        prompting<span style="color:#ce5c00;font-weight:bold">)</span>
</span></span><span style="display:flex;"><span>    --become-method<span style="color:#ce5c00;font-weight:bold">=</span>BECOME_METHOD
</span></span><span style="display:flex;"><span>                        privilege escalation method to use <span style="color:#ce5c00;font-weight:bold">(</span><span style="color:#000">default</span><span style="color:#ce5c00;font-weight:bold">=</span>sudo<span style="color:#ce5c00;font-weight:bold">)</span>,
</span></span><span style="display:flex;"><span>                        valid choices: <span style="color:#ce5c00;font-weight:bold">[</span> sudo <span style="color:#000;font-weight:bold">|</span> su <span style="color:#000;font-weight:bold">|</span> pbrun <span style="color:#000;font-weight:bold">|</span> pfexec <span style="color:#000;font-weight:bold">|</span> doas <span style="color:#000;font-weight:bold">|</span>
</span></span><span style="display:flex;"><span>                        dzdo <span style="color:#000;font-weight:bold">|</span> ksu <span style="color:#000;font-weight:bold">|</span> runas <span style="color:#000;font-weight:bold">|</span> pmrun <span style="color:#000;font-weight:bold">|</span> <span style="color:#204a87">enable</span> <span style="color:#ce5c00;font-weight:bold">]</span>
</span></span><span style="display:flex;"><span>    --become-user<span style="color:#ce5c00;font-weight:bold">=</span>BECOME_USER
</span></span><span style="display:flex;"><span>                        run operations as this user <span style="color:#ce5c00;font-weight:bold">(</span><span style="color:#000">default</span><span style="color:#ce5c00;font-weight:bold">=</span>root<span style="color:#ce5c00;font-weight:bold">)</span>
</span></span><span style="display:flex;"><span>    --ask-sudo-pass     ask <span style="color:#204a87;font-weight:bold">for</span> sudo password <span style="color:#ce5c00;font-weight:bold">(</span>deprecated, use become<span style="color:#ce5c00;font-weight:bold">)</span>
</span></span><span style="display:flex;"><span>    --ask-su-pass       ask <span style="color:#204a87;font-weight:bold">for</span> su password <span style="color:#ce5c00;font-weight:bold">(</span>deprecated, use become<span style="color:#ce5c00;font-weight:bold">)</span>
</span></span><span style="display:flex;"><span>    -K, --ask-become-pass
</span></span><span style="display:flex;"><span>                        ask <span style="color:#204a87;font-weight:bold">for</span> privilege escalation password
</span></span></code></pre></div>
</div>



    
	
  
    
    
	
    

<div class="td-content" style="page-break-before: always">
    
	<h1 id="pg-65763f1b371a58100a39fc1333ba1541">2 - ceph-fuse的使用</h1>
    
	<h1 id="1-安装ceph-fuse">1. 安装ceph-fuse</h1>
<pre tabindex="0"><code>yum install -y ceph-fuse
</code></pre><p>如果安装失败，先执行以下命令，再执行上述安装命令</p>
<pre tabindex="0"><code>yum -y install epel-release


rpm -Uhv http://download.ceph.com/rpm-jewel/el7/noarch/ceph-release-1-1.el7.noarch.rpm
</code></pre><h1 id="2-配置客户端访问的key">2. 配置客户端访问的key</h1>
<p>mkdir /etc/ceph/
vi /etc/ceph/ceph.client.admin.keyring</p>
<pre tabindex="0"><code>[client.admin]
key = xxxxxxxxxxxxxxxxxxxxxxxxxxxxxx==
</code></pre><h1 id="3-ceph-fuse-挂载">3. ceph-fuse 挂载</h1>
<pre tabindex="0"><code>ceph-fuse -m &lt;mons_IP1&gt;:6789,&lt;mons_IP2&gt;:6789,&lt;mons_IP3&gt;:6789 -r &lt;ceph集群中的目录&gt; &lt;宿主机目录&gt; -o nonempty
</code></pre><p>例如：</p>
<pre tabindex="0"><code># ceph-fuse -m 192.168.18.3:6789,192.168.18.4:6789,192.168.18.5:6789 -r /pvc-volumes /root/cephfsdir -o nonempty
2019-03-27 17:58:04.435985 7fc61b67cec0 -1 did not load config file, using default settings.
ceph-fuse[18051]: starting ceph client
2019-03-27 17:58:04.469144 7fc61b67cec0 -1 init, newargv = 0x55cecaba81c0 newargc=13
ceph-fuse[18051]: starting fuse
</code></pre><h1 id="4-查看是否挂载成功">4. 查看是否挂载成功</h1>
<pre tabindex="0"><code># df -h
Filesystem Size Used Avail Use% Mounted on
...
ceph-fuse 1.6T  8.8G  1.6T   1% /root/cephfsdir
</code></pre><h1 id="5-ceph-fuse命令说明">5. ceph-fuse命令说明</h1>
<pre tabindex="0"><code># ceph-fuse --help
2019-03-27 18:01:16.421376 7fae11998ec0 -1 did not load config file, using default settings.
usage: ceph-fuse [-m mon-ip-addr:mon-port] &lt;mount point&gt; [OPTIONS]
  --client_mountpoint/-r &lt;root_directory&gt;
                    use root_directory as the mounted root, rather than the full Ceph tree.

usage: ceph-fuse mountpoint [options]

general options:
    -o opt,[opt...]        mount options
    -h   --help            print help
    -V   --version         print version

FUSE options:
    -d   -o debug          enable debug output (implies -f)
    -f                     foreground operation
    -s                     disable multi-threaded operation

  --conf/-c FILE    read configuration from the given configuration file
  --id/-i ID        set ID portion of my name
  --name/-n TYPE.ID set name
  --cluster NAME    set cluster name (default: ceph)
  --setuser USER    set uid to user or uid (and gid to user&#39;s gid)
  --setgroup GROUP  set gid to group or gid
  --version         show version and quit
</code></pre>
</div>



    
	
  
    
    
	
    

<div class="td-content" style="page-break-before: always">
    
	<h1 id="pg-96144427fb37ef08b231fd81e3a8f3fe">3 - confd的使用</h1>
    
	<blockquote>
<p>confd的源码参考：https://github.com/kelseyhightower/confd</p>
</blockquote>
<h1 id="1-confd的部署">1. confd的部署</h1>
<p>以下Linux系统为例。</p>
<p>下载<code>confd</code>的二进制文件，下载地址为：https://github.com/kelseyhightower/confd/releases。例如：</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span><span style="color:#8f5902;font-style:italic"># Download the binary</span>
</span></span><span style="display:flex;"><span>wget https://github.com/kelseyhightower/confd/releases/download/v0.16.0/confd-0.16.0-linux-amd64
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#8f5902;font-style:italic"># 重命名二进制文件，并移动到PATH的目录下</span>
</span></span><span style="display:flex;"><span>mv confd-0.16.0-linux-amd64 /usr/local/bin/confd
</span></span><span style="display:flex;"><span>chmod +x /usr/local/bin/confd
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#8f5902;font-style:italic"># 验证是否安装成功</span>
</span></span><span style="display:flex;"><span>confd --help
</span></span></code></pre></div><h1 id="2-confd的配置">2. confd的配置</h1>
<p><code>Confd</code>通过读取后端存储的配置信息来动态更新对应的配置文件，对应的后端存储可以是<code>etcd</code>，<code>redis</code>等，其中etcd的v3版本对应的存储后端为<code>etcdv3</code>。</p>
<h2 id="2-1-confd-toml">2.1. confd.toml</h2>
<p><code>confd.toml</code>为confd服务本身的配置文件，主要记录了使用的存储后端、协议、confdir等参数。</p>
<p><strong>示例：</strong></p>
<ul>
<li>存储后端<code>etcdv3</code>：</li>
</ul>
<pre tabindex="0"><code>backend = &#34;etcdv3&#34;
confdir = &#34;/etc/confd&#34;
log-level = &#34;debug&#34;
interval = 5
nodes = [
  &#34;http://192.168.10.4:12379&#34;,
]
scheme = &#34;http&#34;
watch = true
</code></pre><p>其中<code>watch</code>参数表示实时监听后端存储的变化，如有变化则更新confd管理的配置。</p>
<ul>
<li>存储后端为<code>redis</code></li>
</ul>
<pre tabindex="0"><code>backend = &#34;redis&#34;
confdir = &#34;/etc/confd&#34;
log-level = &#34;debug&#34;
interval = 1  # 间隔 1 秒同步一次配置文件
nodes = [
  &#34;127.0.0.1:6379&#34;,
]
scheme = &#34;http&#34;
client_key = &#34;123456&#34;  # redis的密码，不是 password 参数
#watch = true
</code></pre><p>如果没有启动<code>watch</code>参数，则会依据<code>interval</code>参数定期去redis存储后端拿取数据，并比较与当前配置数据是否有变化（主要比较<code>md5</code>值），如果有变化则更新配置，没有变化则定期再去拿取数据，以此循环。</p>
<p>如果启动了<code>watch</code>参数，则修改redis存储数据的同时，还要执行<code>publish</code>的操作，促使<code>confd</code>去触发比较配置并更新配置的操作。</p>
<p>publish的命令格式如下:</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>publish __keyspace@0__:<span style="color:#ce5c00;font-weight:bold">{</span>prefix<span style="color:#ce5c00;font-weight:bold">}</span>/<span style="color:#ce5c00;font-weight:bold">{</span>key<span style="color:#ce5c00;font-weight:bold">}</span> set<span style="color:#ce5c00;font-weight:bold">(</span>or del<span style="color:#ce5c00;font-weight:bold">)</span>
</span></span></code></pre></div><h2 id="2-2-创建confdir">2.2. 创建confdir</h2>
<p>confdir底下包含两个目录:</p>
<ul>
<li><code>conf.d</code>:confd的配置文件，主要包含配置的生成逻辑，例如模板源，后端存储对应的keys，命令执行等。</li>
<li><code>templates</code>:配置模板Template，即基于不同组件的配置，修改为符合 <a href="http://golang.org/pkg/text/template/#pkg-overview">Golang text templates</a>的模板文件。</li>
</ul>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>sudo mkdir -p /etc/confd/<span style="color:#ce5c00;font-weight:bold">{</span>conf.d,templates<span style="color:#ce5c00;font-weight:bold">}</span>
</span></span></code></pre></div><h3 id="2-2-1-template-resources">2.2.1. Template Resources</h3>
<p>模板源配置文件是<code>TOML</code>格式的文件，主要包含配置的生成逻辑，例如模板源，后端存储对应的keys，命令执行等。默认目录在<code>/etc/confd/conf.d</code>。</p>
<p>参数说明：</p>
<p><strong>必要参数</strong></p>
<ul>
<li><code>dest</code> (string) - The target file.</li>
<li><code>keys</code> (array of strings) - An array of keys.</li>
<li><code>src</code> (string) - The relative path of a <a href="https://github.com/kelseyhightower/confd/blob/master/docs/templates.md">configuration template</a>.</li>
</ul>
<p><strong>可选参数</strong></p>
<ul>
<li><code>gid</code> (int) - The gid that should own the file. Defaults to the effective gid.</li>
<li><code>mode</code> (string) - The permission mode of the file.</li>
<li><code>uid</code> (int) - The uid that should own the file. Defaults to the effective uid.</li>
<li><code>reload_cmd</code> (string) - The command to reload config.</li>
<li><code>check_cmd</code> (string) - The command to check config. Use <code>{{src}}</code> to reference the rendered source template.</li>
<li><code>prefix</code> (string) - The string to prefix to keys.</li>
</ul>
<p><strong>例子</strong></p>
<p>例如：<code>/etc/confd/conf.d/myapp-nginx.toml</code></p>
<pre tabindex="0"><code>[template]
prefix = &#34;/myapp&#34;
src = &#34;nginx.tmpl&#34;
dest = &#34;/tmp/myapp.conf&#34;
owner = &#34;nginx&#34;
mode = &#34;0644&#34;
keys = [
  &#34;/services/web&#34;
]
check_cmd = &#34;/usr/sbin/nginx -t -c {{.src}}&#34;
reload_cmd = &#34;/usr/sbin/service nginx reload&#34;
</code></pre><h3 id="2-2-2-template">2.2.2. Template</h3>
<p><code>Template</code>定义了单一应用配置的模板，默认存储在<code>/etc/confd/templates</code>目录下，模板文件符合Go的<a href="http://golang.org/pkg/text/template/"><code>text/template</code></a>格式。</p>
<p>模板文件常用函数有<code>base</code>，<code>get</code>，<code>gets</code>，<code>lsdir</code>，<code>json</code>等。具体可参考https://github.com/kelseyhightower/confd/blob/master/docs/templates.md。</p>
<p>例子：</p>
<p><code>/etc/confd/templates/nginx.tmpl</code></p>
<pre tabindex="0"><code>{{range $dir := lsdir &#34;/services/web&#34;}}
upstream {{base $dir}} {
    {{$custdir := printf &#34;/services/web/%s/*&#34; $dir}}{{range gets $custdir}}
    server {{$data := json .Value}}{{$data.IP}}:80;
    {{end}}
}

server {
    server_name {{base $dir}}.example.com;
    location / {
        proxy_pass {{base $dir}};
    }
}
{{end}}
</code></pre><h1 id="3-创建后端存储的配置数据">3. 创建后端存储的配置数据</h1>
<p>以<code>etcdv3</code>存储为例，在etcd中创建以下数据。</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>etcdctl --endpoints<span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#000">$endpoints</span> put /services/web/cust1/2 <span style="color:#4e9a06">&#39;{&#34;IP&#34;: &#34;10.0.0.2&#34;}&#39;</span>
</span></span><span style="display:flex;"><span>etcdctl --endpoints<span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#000">$endpoints</span> put /services/web/cust2/2 <span style="color:#4e9a06">&#39;{&#34;IP&#34;: &#34;10.0.0.4&#34;}&#39;</span>
</span></span><span style="display:flex;"><span>etcdctl --endpoints<span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#000">$endpoints</span> put /services/web/cust2/1 <span style="color:#4e9a06">&#39;{&#34;IP&#34;: &#34;10.0.0.3&#34;}&#39;</span>
</span></span><span style="display:flex;"><span>etcdctl --endpoints<span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#000">$endpoints</span> put /services/web/cust1/1 <span style="color:#4e9a06">&#39;{&#34;IP&#34;: &#34;10.0.0.1&#34;}&#39;</span>
</span></span></code></pre></div><h1 id="4-启动confd的服务">4. 启动confd的服务</h1>
<p>confd支持以<code>daemon</code>或者<code>onetime</code>两种模式运行，当以<code>daemon</code>模式运行时，confd会监听后端存储的配置变化，并根据配置模板动态生成目标配置文件。</p>
<p>confd可以使用<code>-config-file</code>参数来指定confd的配置文件，而将其他参数写在配置文件中。</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>/usr/local/bin/confd -config-file /etc/confd/conf/confd.toml
</span></span></code></pre></div><p>如果以<code>daemon</code>模式运行，在命令后面添加<code>&amp;</code>符号，例如：</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>confd -watch -backend etcdv3 -node http://172.16.5.4:12379 <span style="color:#000;font-weight:bold">&amp;</span>
</span></span></code></pre></div><p>以下以<code>onetime</code>模式运行为例。其中对应的后端存储类型是<code>etcdv3</code>。</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span><span style="color:#8f5902;font-style:italic"># 执行命令</span>
</span></span><span style="display:flex;"><span>confd -onetime -backend etcdv3 -node http://172.16.5.4:12379
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#8f5902;font-style:italic"># output</span>
</span></span><span style="display:flex;"><span>2018-05-11T18:04:59+08:00 k8s-dbg-master-1 confd<span style="color:#ce5c00;font-weight:bold">[</span>35808<span style="color:#ce5c00;font-weight:bold">]</span>: INFO Backend <span style="color:#204a87">set</span> to etcdv3
</span></span><span style="display:flex;"><span>2018-05-11T18:04:59+08:00 k8s-dbg-master-1 confd<span style="color:#ce5c00;font-weight:bold">[</span>35808<span style="color:#ce5c00;font-weight:bold">]</span>: INFO Starting confd
</span></span><span style="display:flex;"><span>2018-05-11T18:04:59+08:00 k8s-dbg-master-1 confd<span style="color:#ce5c00;font-weight:bold">[</span>35808<span style="color:#ce5c00;font-weight:bold">]</span>: INFO Backend source<span style="color:#ce5c00;font-weight:bold">(</span>s<span style="color:#ce5c00;font-weight:bold">)</span> <span style="color:#204a87">set</span> to http://172.16.5.4:12379
</span></span><span style="display:flex;"><span>2018-05-11T18:04:59+08:00 k8s-dbg-master-1 confd<span style="color:#ce5c00;font-weight:bold">[</span>35808<span style="color:#ce5c00;font-weight:bold">]</span>: INFO /root/myapp/twemproxy/conf/twemproxy.conf has md5sum 6f0f43abede612c75cb840a4840fbea3 should be 32f48664266e3fd6b56ee73a314ee272
</span></span><span style="display:flex;"><span>2018-05-11T18:04:59+08:00 k8s-dbg-master-1 confd<span style="color:#ce5c00;font-weight:bold">[</span>35808<span style="color:#ce5c00;font-weight:bold">]</span>: INFO Target config /root/myapp/twemproxy/conf/twemproxy.conf out of sync
</span></span><span style="display:flex;"><span>2018-05-11T18:04:59+08:00 k8s-dbg-master-1 confd<span style="color:#ce5c00;font-weight:bold">[</span>35808<span style="color:#ce5c00;font-weight:bold">]</span>: INFO Target config /root/myapp/twemproxy/conf/twemproxy.conf has been updated
</span></span></code></pre></div><h1 id="5-查看生成的配置文件">5. 查看生成的配置文件</h1>
<p>在<code>/etc/confd/conf.d/myapp-nginx.toml</code>中定义的配置文件的生成路径为<code>/tmp/myapp.conf</code>。</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span><span style="color:#ce5c00;font-weight:bold">[</span>root@k8s-dbg-master-1 dest<span style="color:#ce5c00;font-weight:bold">]</span><span style="color:#8f5902;font-style:italic"># cat myapp.conf</span>
</span></span><span style="display:flex;"><span>upstream cust1 <span style="color:#ce5c00;font-weight:bold">{</span>
</span></span><span style="display:flex;"><span>    server 10.0.0.1:80<span style="color:#000;font-weight:bold">;</span>
</span></span><span style="display:flex;"><span>    server 10.0.0.2:80<span style="color:#000;font-weight:bold">;</span>
</span></span><span style="display:flex;"><span><span style="color:#ce5c00;font-weight:bold">}</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>server <span style="color:#ce5c00;font-weight:bold">{</span>
</span></span><span style="display:flex;"><span>    server_name cust1.example.com<span style="color:#000;font-weight:bold">;</span>
</span></span><span style="display:flex;"><span>    location / <span style="color:#ce5c00;font-weight:bold">{</span>
</span></span><span style="display:flex;"><span>        proxy_pass cust1<span style="color:#000;font-weight:bold">;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#ce5c00;font-weight:bold">}</span>
</span></span><span style="display:flex;"><span><span style="color:#ce5c00;font-weight:bold">}</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>upstream cust2 <span style="color:#ce5c00;font-weight:bold">{</span>
</span></span><span style="display:flex;"><span>    server 10.0.0.3:80<span style="color:#000;font-weight:bold">;</span>
</span></span><span style="display:flex;"><span>    server 10.0.0.4:80<span style="color:#000;font-weight:bold">;</span>
</span></span><span style="display:flex;"><span><span style="color:#ce5c00;font-weight:bold">}</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>server <span style="color:#ce5c00;font-weight:bold">{</span>
</span></span><span style="display:flex;"><span>    server_name cust2.example.com<span style="color:#000;font-weight:bold">;</span>
</span></span><span style="display:flex;"><span>    location / <span style="color:#ce5c00;font-weight:bold">{</span>
</span></span><span style="display:flex;"><span>        proxy_pass cust2<span style="color:#000;font-weight:bold">;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#ce5c00;font-weight:bold">}</span>
</span></span><span style="display:flex;"><span><span style="color:#ce5c00;font-weight:bold">}</span>
</span></span></code></pre></div><h1 id="6-confd动态更新twemproxy">6. confd动态更新twemproxy</h1>
<h2 id="6-1-twemproxy-toml">6.1. twemproxy.toml</h2>
<p>confd的模板源文件配置：/etc/confd/conf.d/twemproxy.toml</p>
<pre tabindex="0"><code>[template]
src = &#34;twemproxy.tmpl&#34;
dest = &#34;/root/myapp/twemproxy/conf/twemproxy.conf&#34;
keys = [
  &#34;/twemproxy/pool&#34;
]
check_cmd = &#34;/usr/local/bin/nutcracker -t -c /root/myapp/twemproxy/conf/twemproxy.conf&#34;
reload_cmd = &#34;bash /root/myapp/twemproxy/reload.sh&#34;
</code></pre><h2 id="6-2-twemproxy-tmpl">6.2. twemproxy.tmpl</h2>
<p>模板文件：/etc/confd/templates/twemproxy.tmpl</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-yaml" data-lang="yaml"><span style="display:flex;"><span><span style="color:#204a87;font-weight:bold">global</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">  </span><span style="color:#204a87;font-weight:bold">worker_processes</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#0000cf;font-weight:bold">4</span><span style="color:#f8f8f8;text-decoration:underline">         </span><span style="color:#8f5902;font-style:italic"># 并发进程数, 如果为0, 这 fallback 回原来的单进程模型(不支持 config reload!)</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">  </span><span style="color:#204a87;font-weight:bold">user</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">nobody               </span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#8f5902;font-style:italic"># worker 进程的用户, 默认 nobody. 只要主进程是 root 用户启动才生效.</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">  </span><span style="color:#204a87;font-weight:bold">group</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">nobody              </span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#8f5902;font-style:italic"># worker 进程的用户组</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">  </span><span style="color:#204a87;font-weight:bold">worker_shutdown_timeout</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#0000cf;font-weight:bold">30</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#8f5902;font-style:italic"># 单位为秒. 用于 reload 过程中在改时间段之后强制退出旧的 worker 进程.</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline"></span><span style="color:#204a87;font-weight:bold">pools</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span>{{<span style="color:#000">range gets &#34;/twemproxy/pool/*&#34;}}</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">  </span>{{<span style="color:#204a87;font-weight:bold">base .Key}}</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span>{{<span style="color:#000">$pool := json .Value}}</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">    </span><span style="color:#204a87;font-weight:bold">listen</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span>{{<span style="color:#000">$pool.ListenAddr.IP}}:{{$pool.ListenAddr.Port}}</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">    </span><span style="color:#204a87;font-weight:bold">hash</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">fnv1a_64</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#8f5902;font-style:italic"># 选择实例的 hash 规则</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">    </span><span style="color:#204a87;font-weight:bold">distribution</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">ketama</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">    </span><span style="color:#204a87;font-weight:bold">auto_eject_hosts</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#204a87;font-weight:bold">true</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#8f5902;font-style:italic"># server 有问题是否剔除</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">    </span><span style="color:#204a87;font-weight:bold">redis</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#204a87;font-weight:bold">true</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#8f5902;font-style:italic"># 是否为 Redis 协议</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">    </span>{{<span style="color:#204a87;font-weight:bold">if $pool.Password}}redis_auth</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span>{{<span style="color:#000">$pool.Password}}{{end}}</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">    </span><span style="color:#204a87;font-weight:bold">server_retry_timeout</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#0000cf;font-weight:bold">5000</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#8f5902;font-style:italic"># 被剔除多长时间后会重试</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">    </span><span style="color:#204a87;font-weight:bold">server_connections: 25 # NOTE</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">server 连接池的大小, 默认为 1, 建议调整</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">    </span><span style="color:#204a87;font-weight:bold">server_failure_limit</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#0000cf;font-weight:bold">5</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#8f5902;font-style:italic"># 失败多少次后暂时剔除</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">    </span><span style="color:#204a87;font-weight:bold">timeout</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#0000cf;font-weight:bold">1000</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#8f5902;font-style:italic"># Server 超时时间, 1 sec</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">    </span><span style="color:#204a87;font-weight:bold">backlog</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#0000cf;font-weight:bold">1024</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#8f5902;font-style:italic"># 连接队列大小</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">    </span><span style="color:#204a87;font-weight:bold">preconnect</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#204a87;font-weight:bold">true</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#8f5902;font-style:italic"># 预连接大小</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">    </span><span style="color:#000">servers:{{range $server := $pool.Servers}}</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">     </span>- {{<span style="color:#000">$server.IP}}:{{$server.Port}}:1 {{if $server.Master}}master{{end}}</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">    </span>{{<span style="color:#000">end}}</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline"></span>{{<span style="color:#000">end}}</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span></code></pre></div><h2 id="6-3-etcd中的配置格式">6.3. etcd中的配置格式</h2>
<p><code>etcd</code>中的配置通过一个map来定义为完整的配置内容。其中<code>key</code>是<code>twemproxy</code>中<code>pool</code>的名称，<code>value</code>是<code>pool</code>的所有内容。</p>
<p>配置对应go结构体如下：</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-go" data-lang="go"><span style="display:flex;"><span><span style="color:#204a87;font-weight:bold">type</span> <span style="color:#000">Pool</span> <span style="color:#204a87;font-weight:bold">struct</span><span style="color:#000;font-weight:bold">{</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000">ListenAddr</span>  <span style="color:#000">ListenAddr</span> <span style="color:#4e9a06">`json:&#34;ListenAddr,omitempty&#34;`</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000">Servers</span> <span style="color:#000;font-weight:bold">[]</span><span style="color:#000">Server</span> <span style="color:#4e9a06">`json:&#34;Servers,omitempty&#34;`</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000">Password</span> <span style="color:#204a87;font-weight:bold">string</span> <span style="color:#4e9a06">`json:&#34;Password,omitempty&#34;`</span>
</span></span><span style="display:flex;"><span><span style="color:#000;font-weight:bold">}</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#204a87;font-weight:bold">type</span> <span style="color:#000">ListenAddr</span> <span style="color:#204a87;font-weight:bold">struct</span> <span style="color:#000;font-weight:bold">{</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000">IP</span> <span style="color:#204a87;font-weight:bold">string</span> <span style="color:#4e9a06">`json:&#34;IP,omitempty&#34;`</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000">Port</span> <span style="color:#204a87;font-weight:bold">string</span> <span style="color:#4e9a06">`json:&#34;Port,omitempty&#34;`</span>
</span></span><span style="display:flex;"><span><span style="color:#000;font-weight:bold">}</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#204a87;font-weight:bold">type</span> <span style="color:#000">Server</span> <span style="color:#204a87;font-weight:bold">struct</span> <span style="color:#000;font-weight:bold">{</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000">IP</span> <span style="color:#204a87;font-weight:bold">string</span> <span style="color:#4e9a06">`json:&#34;IP,omitempty&#34;`</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000">Port</span> <span style="color:#204a87;font-weight:bold">string</span> <span style="color:#4e9a06">`json:&#34;Port,omitempty&#34;`</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000">Master</span> <span style="color:#204a87;font-weight:bold">bool</span> <span style="color:#4e9a06">`json:&#34;Master,omitempty&#34;`</span>
</span></span><span style="display:flex;"><span><span style="color:#000;font-weight:bold">}</span>
</span></span></code></pre></div><p>配置对应<code>JSON</code>格式如下：</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-Json" data-lang="Json"><span style="display:flex;"><span><span style="color:#000;font-weight:bold">{</span>
</span></span><span style="display:flex;"><span>    <span style="color:#204a87;font-weight:bold">&#34;ListenAddr&#34;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#000;font-weight:bold">{</span>
</span></span><span style="display:flex;"><span>        <span style="color:#204a87;font-weight:bold">&#34;IP&#34;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#4e9a06">&#34;192.168.5.7&#34;</span><span style="color:#000;font-weight:bold">,</span>
</span></span><span style="display:flex;"><span>        <span style="color:#204a87;font-weight:bold">&#34;Port&#34;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#4e9a06">&#34;22225&#34;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000;font-weight:bold">},</span>
</span></span><span style="display:flex;"><span>    <span style="color:#204a87;font-weight:bold">&#34;Servers&#34;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#000;font-weight:bold">[</span>
</span></span><span style="display:flex;"><span>        <span style="color:#000;font-weight:bold">{</span>
</span></span><span style="display:flex;"><span>            <span style="color:#204a87;font-weight:bold">&#34;IP&#34;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#4e9a06">&#34;10.233.116.168&#34;</span><span style="color:#000;font-weight:bold">,</span>
</span></span><span style="display:flex;"><span>            <span style="color:#204a87;font-weight:bold">&#34;Port&#34;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#4e9a06">&#34;6379&#34;</span><span style="color:#000;font-weight:bold">,</span>
</span></span><span style="display:flex;"><span>            <span style="color:#204a87;font-weight:bold">&#34;Master&#34;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#204a87;font-weight:bold">true</span>
</span></span><span style="display:flex;"><span>        <span style="color:#000;font-weight:bold">},</span>
</span></span><span style="display:flex;"><span>        <span style="color:#000;font-weight:bold">{</span>
</span></span><span style="display:flex;"><span>            <span style="color:#204a87;font-weight:bold">&#34;IP&#34;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#4e9a06">&#34;10.233.110.207&#34;</span><span style="color:#000;font-weight:bold">,</span>
</span></span><span style="display:flex;"><span>            <span style="color:#204a87;font-weight:bold">&#34;Port&#34;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#4e9a06">&#34;6379&#34;</span><span style="color:#000;font-weight:bold">,</span>
</span></span><span style="display:flex;"><span>            <span style="color:#204a87;font-weight:bold">&#34;Master&#34;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#204a87;font-weight:bold">false</span>
</span></span><span style="display:flex;"><span>        <span style="color:#000;font-weight:bold">}</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000;font-weight:bold">],</span>
</span></span><span style="display:flex;"><span>    <span style="color:#204a87;font-weight:bold">&#34;Password&#34;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#4e9a06">&#34;987654&#34;</span>
</span></span><span style="display:flex;"><span><span style="color:#000;font-weight:bold">}</span>
</span></span></code></pre></div><h2 id="6-4-生成-twemproxy-配置文件">6.4. 生成<code>twemproxy</code>配置文件</h2>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>global:
</span></span><span style="display:flex;"><span>  worker_processes: <span style="color:#0000cf;font-weight:bold">4</span>         <span style="color:#8f5902;font-style:italic"># 并发进程数, 如果为0, 这 fallback 回原来的单进程模型(不支持 config reload!)</span>
</span></span><span style="display:flex;"><span>  user: nobody                <span style="color:#8f5902;font-style:italic"># worker 进程的用户, 默认 nobody. 只要主进程是 root 用户启动才生效.</span>
</span></span><span style="display:flex;"><span>  group: nobody               <span style="color:#8f5902;font-style:italic"># worker 进程的用户组</span>
</span></span><span style="display:flex;"><span>  worker_shutdown_timeout: <span style="color:#0000cf;font-weight:bold">30</span> <span style="color:#8f5902;font-style:italic"># 单位为秒. 用于 reload 过程中在改时间段之后强制退出旧的 worker 进程.</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>pools:
</span></span><span style="display:flex;"><span>  redis1:
</span></span><span style="display:flex;"><span>    listen: 192.168.5.7:22223
</span></span><span style="display:flex;"><span>    hash: fnv1a_64 <span style="color:#8f5902;font-style:italic"># 选择实例的 hash 规则</span>
</span></span><span style="display:flex;"><span>    distribution: ketama
</span></span><span style="display:flex;"><span>    auto_eject_hosts: <span style="color:#204a87">true</span> <span style="color:#8f5902;font-style:italic"># server 有问题是否剔除</span>
</span></span><span style="display:flex;"><span>    redis: <span style="color:#204a87">true</span> <span style="color:#8f5902;font-style:italic"># 是否为 Redis 协议</span>
</span></span><span style="display:flex;"><span>    redis_auth: <span style="color:#0000cf;font-weight:bold">987654</span>
</span></span><span style="display:flex;"><span>    server_retry_timeout: <span style="color:#0000cf;font-weight:bold">5000</span> <span style="color:#8f5902;font-style:italic"># 被剔除多长时间后会重试</span>
</span></span><span style="display:flex;"><span>    server_connections: <span style="color:#0000cf;font-weight:bold">25</span> <span style="color:#8f5902;font-style:italic"># NOTE: server 连接池的大小, 默认为 1, 建议调整</span>
</span></span><span style="display:flex;"><span>    server_failure_limit: <span style="color:#0000cf;font-weight:bold">5</span> <span style="color:#8f5902;font-style:italic"># 失败多少次后暂时剔除</span>
</span></span><span style="display:flex;"><span>    timeout: <span style="color:#0000cf;font-weight:bold">1000</span> <span style="color:#8f5902;font-style:italic"># Server 超时时间, 1 sec</span>
</span></span><span style="display:flex;"><span>    backlog: <span style="color:#0000cf;font-weight:bold">1024</span> <span style="color:#8f5902;font-style:italic"># 连接队列大小</span>
</span></span><span style="display:flex;"><span>    preconnect: <span style="color:#204a87">true</span> <span style="color:#8f5902;font-style:italic"># 预连接大小</span>
</span></span><span style="display:flex;"><span>    servers:
</span></span><span style="display:flex;"><span>     - 10.233.116.169:6379:1
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  redis2:
</span></span><span style="display:flex;"><span>    listen: 192.168.5.7:22224
</span></span><span style="display:flex;"><span>    hash: fnv1a_64 <span style="color:#8f5902;font-style:italic"># 选择实例的 hash 规则</span>
</span></span><span style="display:flex;"><span>    distribution: ketama
</span></span><span style="display:flex;"><span>    auto_eject_hosts: <span style="color:#204a87">true</span> <span style="color:#8f5902;font-style:italic"># server 有问题是否剔除</span>
</span></span><span style="display:flex;"><span>    redis: <span style="color:#204a87">true</span> <span style="color:#8f5902;font-style:italic"># 是否为 Redis 协议</span>
</span></span><span style="display:flex;"><span>    redis_auth: <span style="color:#0000cf;font-weight:bold">987654</span>
</span></span><span style="display:flex;"><span>    server_retry_timeout: <span style="color:#0000cf;font-weight:bold">5000</span> <span style="color:#8f5902;font-style:italic"># 被剔除多长时间后会重试</span>
</span></span><span style="display:flex;"><span>    server_connections: <span style="color:#0000cf;font-weight:bold">25</span> <span style="color:#8f5902;font-style:italic"># NOTE: server 连接池的大小, 默认为 1, 建议调整</span>
</span></span><span style="display:flex;"><span>    server_failure_limit: <span style="color:#0000cf;font-weight:bold">5</span> <span style="color:#8f5902;font-style:italic"># 失败多少次后暂时剔除</span>
</span></span><span style="display:flex;"><span>    timeout: <span style="color:#0000cf;font-weight:bold">1000</span> <span style="color:#8f5902;font-style:italic"># Server 超时时间, 1 sec</span>
</span></span><span style="display:flex;"><span>    backlog: <span style="color:#0000cf;font-weight:bold">1024</span> <span style="color:#8f5902;font-style:italic"># 连接队列大小</span>
</span></span><span style="display:flex;"><span>    preconnect: <span style="color:#204a87">true</span> <span style="color:#8f5902;font-style:italic"># 预连接大小</span>
</span></span><span style="display:flex;"><span>    servers:
</span></span><span style="display:flex;"><span>     - 10.233.110.223:6379:1 master
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>     - 10.233.111.21:6379:1
</span></span></code></pre></div><h1 id="7-confd的命令">7. confd的命令</h1>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>$ confd --help
</span></span><span style="display:flex;"><span>Usage of confd:
</span></span><span style="display:flex;"><span>  -app-id string
</span></span><span style="display:flex;"><span>    	Vault app-id to use with the app-id backend <span style="color:#ce5c00;font-weight:bold">(</span>only used with -backend<span style="color:#ce5c00;font-weight:bold">=</span>vault and auth-type<span style="color:#ce5c00;font-weight:bold">=</span>app-id<span style="color:#ce5c00;font-weight:bold">)</span>
</span></span><span style="display:flex;"><span>  -auth-token string
</span></span><span style="display:flex;"><span>    	Auth bearer token to use
</span></span><span style="display:flex;"><span>  -auth-type string
</span></span><span style="display:flex;"><span>    	Vault auth backend <span style="color:#204a87">type</span> to use <span style="color:#ce5c00;font-weight:bold">(</span>only used with -backend<span style="color:#ce5c00;font-weight:bold">=</span>vault<span style="color:#ce5c00;font-weight:bold">)</span>
</span></span><span style="display:flex;"><span>  -backend string
</span></span><span style="display:flex;"><span>    	backend to use <span style="color:#ce5c00;font-weight:bold">(</span>default <span style="color:#4e9a06">&#34;etcd&#34;</span><span style="color:#ce5c00;font-weight:bold">)</span>
</span></span><span style="display:flex;"><span>  -basic-auth
</span></span><span style="display:flex;"><span>    	Use Basic Auth to authenticate <span style="color:#ce5c00;font-weight:bold">(</span>only used with -backend<span style="color:#ce5c00;font-weight:bold">=</span>consul and -backend<span style="color:#ce5c00;font-weight:bold">=</span>etcd<span style="color:#ce5c00;font-weight:bold">)</span>
</span></span><span style="display:flex;"><span>  -client-ca-keys string
</span></span><span style="display:flex;"><span>    	client ca keys
</span></span><span style="display:flex;"><span>  -client-cert string
</span></span><span style="display:flex;"><span>    	the client cert
</span></span><span style="display:flex;"><span>  -client-key string
</span></span><span style="display:flex;"><span>    	the client key
</span></span><span style="display:flex;"><span>  -confdir string
</span></span><span style="display:flex;"><span>    	confd conf directory <span style="color:#ce5c00;font-weight:bold">(</span>default <span style="color:#4e9a06">&#34;/etc/confd&#34;</span><span style="color:#ce5c00;font-weight:bold">)</span>
</span></span><span style="display:flex;"><span>  -config-file string
</span></span><span style="display:flex;"><span>    	the confd config file <span style="color:#ce5c00;font-weight:bold">(</span>default <span style="color:#4e9a06">&#34;/etc/confd/confd.toml&#34;</span><span style="color:#ce5c00;font-weight:bold">)</span>
</span></span><span style="display:flex;"><span>  -file value
</span></span><span style="display:flex;"><span>    	the YAML file to watch <span style="color:#204a87;font-weight:bold">for</span> changes <span style="color:#ce5c00;font-weight:bold">(</span>only used with -backend<span style="color:#ce5c00;font-weight:bold">=</span>file<span style="color:#ce5c00;font-weight:bold">)</span>
</span></span><span style="display:flex;"><span>  -filter string
</span></span><span style="display:flex;"><span>    	files filter <span style="color:#ce5c00;font-weight:bold">(</span>only used with -backend<span style="color:#ce5c00;font-weight:bold">=</span>file<span style="color:#ce5c00;font-weight:bold">)</span> <span style="color:#ce5c00;font-weight:bold">(</span>default <span style="color:#4e9a06">&#34;*&#34;</span><span style="color:#ce5c00;font-weight:bold">)</span>
</span></span><span style="display:flex;"><span>  -interval int
</span></span><span style="display:flex;"><span>    	backend polling interval <span style="color:#ce5c00;font-weight:bold">(</span>default 600<span style="color:#ce5c00;font-weight:bold">)</span>
</span></span><span style="display:flex;"><span>  -keep-stage-file
</span></span><span style="display:flex;"><span>    	keep staged files
</span></span><span style="display:flex;"><span>  -log-level string
</span></span><span style="display:flex;"><span>    	level which confd should log messages
</span></span><span style="display:flex;"><span>  -node value
</span></span><span style="display:flex;"><span>    	list of backend nodes
</span></span><span style="display:flex;"><span>  -noop
</span></span><span style="display:flex;"><span>    	only show pending changes
</span></span><span style="display:flex;"><span>  -onetime
</span></span><span style="display:flex;"><span>    	run once and <span style="color:#204a87">exit</span>
</span></span><span style="display:flex;"><span>  -password string
</span></span><span style="display:flex;"><span>    	the password to authenticate with <span style="color:#ce5c00;font-weight:bold">(</span>only used with vault and etcd backends<span style="color:#ce5c00;font-weight:bold">)</span>
</span></span><span style="display:flex;"><span>  -path string
</span></span><span style="display:flex;"><span>    	Vault mount path of the auth method <span style="color:#ce5c00;font-weight:bold">(</span>only used with -backend<span style="color:#ce5c00;font-weight:bold">=</span>vault<span style="color:#ce5c00;font-weight:bold">)</span>
</span></span><span style="display:flex;"><span>  -prefix string
</span></span><span style="display:flex;"><span>    	key path prefix
</span></span><span style="display:flex;"><span>  -role-id string
</span></span><span style="display:flex;"><span>    	Vault role-id to use with the AppRole, Kubernetes backends <span style="color:#ce5c00;font-weight:bold">(</span>only used with -backend<span style="color:#ce5c00;font-weight:bold">=</span>vault and either auth-type<span style="color:#ce5c00;font-weight:bold">=</span>app-role or auth-type<span style="color:#ce5c00;font-weight:bold">=</span>kubernetes<span style="color:#ce5c00;font-weight:bold">)</span>
</span></span><span style="display:flex;"><span>  -scheme string
</span></span><span style="display:flex;"><span>    	the backend URI scheme <span style="color:#204a87;font-weight:bold">for</span> nodes retrieved from DNS SRV records <span style="color:#ce5c00;font-weight:bold">(</span>http or https<span style="color:#ce5c00;font-weight:bold">)</span> <span style="color:#ce5c00;font-weight:bold">(</span>default <span style="color:#4e9a06">&#34;http&#34;</span><span style="color:#ce5c00;font-weight:bold">)</span>
</span></span><span style="display:flex;"><span>  -secret-id string
</span></span><span style="display:flex;"><span>    	Vault secret-id to use with the AppRole backend <span style="color:#ce5c00;font-weight:bold">(</span>only used with -backend<span style="color:#ce5c00;font-weight:bold">=</span>vault and auth-type<span style="color:#ce5c00;font-weight:bold">=</span>app-role<span style="color:#ce5c00;font-weight:bold">)</span>
</span></span><span style="display:flex;"><span>  -secret-keyring string
</span></span><span style="display:flex;"><span>    	path to armored PGP secret keyring <span style="color:#ce5c00;font-weight:bold">(</span><span style="color:#204a87;font-weight:bold">for</span> use with crypt functions<span style="color:#ce5c00;font-weight:bold">)</span>
</span></span><span style="display:flex;"><span>  -separator string
</span></span><span style="display:flex;"><span>    	the separator to replace <span style="color:#4e9a06">&#39;/&#39;</span> with when looking up keys in the backend, prefixed <span style="color:#4e9a06">&#39;/&#39;</span> will also be removed <span style="color:#ce5c00;font-weight:bold">(</span>only used with -backend<span style="color:#ce5c00;font-weight:bold">=</span>redis<span style="color:#ce5c00;font-weight:bold">)</span>
</span></span><span style="display:flex;"><span>  -srv-domain string
</span></span><span style="display:flex;"><span>    	the name of the resource record
</span></span><span style="display:flex;"><span>  -srv-record string
</span></span><span style="display:flex;"><span>    	the SRV record to search <span style="color:#204a87;font-weight:bold">for</span> backends nodes. Example: _etcd-client._tcp.example.com
</span></span><span style="display:flex;"><span>  -sync-only
</span></span><span style="display:flex;"><span>    	sync without check_cmd and reload_cmd
</span></span><span style="display:flex;"><span>  -table string
</span></span><span style="display:flex;"><span>    	the name of the DynamoDB table <span style="color:#ce5c00;font-weight:bold">(</span>only used with -backend<span style="color:#ce5c00;font-weight:bold">=</span>dynamodb<span style="color:#ce5c00;font-weight:bold">)</span>
</span></span><span style="display:flex;"><span>  -user-id string
</span></span><span style="display:flex;"><span>    	Vault user-id to use with the app-id backend <span style="color:#ce5c00;font-weight:bold">(</span>only used with -backend<span style="color:#ce5c00;font-weight:bold">=</span>value and auth-type<span style="color:#ce5c00;font-weight:bold">=</span>app-id<span style="color:#ce5c00;font-weight:bold">)</span>
</span></span><span style="display:flex;"><span>  -username string
</span></span><span style="display:flex;"><span>    	the username to authenticate as <span style="color:#ce5c00;font-weight:bold">(</span>only used with vault and etcd backends<span style="color:#ce5c00;font-weight:bold">)</span>
</span></span><span style="display:flex;"><span>  -version
</span></span><span style="display:flex;"><span>    	print version and <span style="color:#204a87">exit</span>
</span></span><span style="display:flex;"><span>  -watch
</span></span><span style="display:flex;"><span>    	<span style="color:#204a87">enable</span> watch support
</span></span></code></pre></div><p>参考文章：</p>
<p><a href="https://github.com/kelseyhightower/confd/blob/master/docs/installation.md">https://github.com/kelseyhightower/confd/blob/master/docs/installation.md</a></p>
<p><a href="https://github.com/kelseyhightower/confd/blob/master/docs/quick-start-guide.md">https://github.com/kelseyhightower/confd/blob/master/docs/quick-start-guide.md</a></p>
<p><a href="https://github.com/kelseyhightower/confd/blob/master/docs/template-resources.md">https://github.com/kelseyhightower/confd/blob/master/docs/template-resources.md</a></p>
<p><a href="https://github.com/kelseyhightower/confd/blob/master/docs/templates.md">https://github.com/kelseyhightower/confd/blob/master/docs/templates.md</a></p>

</div>



    
	
  
    
    
	
    

<div class="td-content" style="page-break-before: always">
    
	<h1 id="pg-5531ca3712df8e070f36d75562fd0f0e">4 - NFS的使用</h1>
    
	<h1 id="1-nfs简介">1. NFS简介</h1>
<p>NFS，是Network File System的简写，即网络文件系统。网络文件系统是FreeBSD支持的文件系统中的一种，也被称为NFS. NFS允许一个系统在网络上与他人共享目录和文件。
通过使用NFS，用户和程序可以像访问本地文件一样访问远端系统上的文件。</p>
<h1 id="2-nfs的安装与配置">2. NFS的安装与配置</h1>
<h2 id="2-1-服务端">2.1 服务端</h2>
<p>NFS需要安装nfs-utils、rpcbind两个包。</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span><span style="color:#8f5902;font-style:italic">#可以先检查下本地是否已经安装，如果安装则无需重复安装包</span>
</span></span><span style="display:flex;"><span><span style="color:#ce5c00;font-weight:bold">[</span>root@k8s-dbg-master-1 build<span style="color:#ce5c00;font-weight:bold">]</span><span style="color:#8f5902;font-style:italic"># rpm -qa|grep rpcbind</span>
</span></span><span style="display:flex;"><span>rpcbind-0.2.0-42.el7.x86_64
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#ce5c00;font-weight:bold">[</span>root@k8s-dbg-master-1 build<span style="color:#ce5c00;font-weight:bold">]</span><span style="color:#8f5902;font-style:italic"># rpm -qa|grep nfs</span>
</span></span><span style="display:flex;"><span>libnfsidmap-0.25-17.el7.x86_64
</span></span><span style="display:flex;"><span>nfs-utils-1.3.0-0.48.el7_4.x86_64
</span></span></code></pre></div><h3 id="2-1-1-安装nfs-utils-rpcbind两个包">2.1.1. 安装nfs-utils、rpcbind两个包</h3>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span><span style="color:#8f5902;font-style:italic">#centos系统</span>
</span></span><span style="display:flex;"><span>yum -y install nfs-utils rpcbind
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#8f5902;font-style:italic">#Ubuntu系统</span>
</span></span><span style="display:flex;"><span><span style="color:#8f5902;font-style:italic">#服务端</span>
</span></span><span style="display:flex;"><span>apt-get install nfs-kernel-server
</span></span><span style="display:flex;"><span><span style="color:#8f5902;font-style:italic">#客户端</span>
</span></span><span style="display:flex;"><span>apt-get install nfs-common
</span></span></code></pre></div><h3 id="2-1-2-创建共享目录">2.1.2. 创建共享目录</h3>
<p>服务端共享目录：<code>/data/nfs-storage/</code></p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>mkdir /data/nfs-storage/
</span></span></code></pre></div><h3 id="2-1-3-nfs共享目录文件配置">2.1.3. NFS共享目录文件配置</h3>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>vi /etc/exports 
</span></span><span style="display:flex;"><span><span style="color:#8f5902;font-style:italic">#添加以下信息</span>
</span></span><span style="display:flex;"><span>/data/nfs-storage *<span style="color:#ce5c00;font-weight:bold">(</span>rw,insecure,sync,no_subtree_check,no_root_squash<span style="color:#ce5c00;font-weight:bold">)</span>
</span></span></code></pre></div><p>以上配置分为三个部分：</p>
<ul>
<li>第一部分就是本地要共享出去的目录。</li>
<li>第二部分为允许访问的主机（可以是一个IP也可以是一个IP段），<code>*</code>代表允许所有的网段访问。</li>
<li>第三部分小括号里面的，为一些权限选项。</li>
</ul>
<p><strong>权限说明</strong></p>
<ul>
<li>rw ：读写；</li>
<li>ro ：只读；</li>
<li>sync ：同步模式，内存中数据时时写入磁盘；</li>
<li>async ：不同步，把内存中数据定期写入磁盘中；</li>
<li>secure ：nfs通过1024以下的安全TCP/IP端口发送</li>
<li>insecure ：nfs通过1024以上的端口发送</li>
<li>no_root_squash ：加上这个选项后，root用户就会对共享的目录拥有至高的权限控制，就像是对本机的目录操作一样。不安全，不建议使用；</li>
<li>root_squash ：和上面的选项对应，root用户对共享目录的权限不高，只有普通用户的权限，即限制了root；</li>
<li>subtree_check ：如果共享/usr/bin之类的子目录时，强制nfs检查父目录的权限（默认）</li>
<li>no_subtree_check ：和上面相对，不检查父目录权限</li>
<li>all_squash ：不管使用NFS的用户是谁，他的身份都会被限定成为一个指定的普通用户身份；</li>
<li>anonuid/anongid ：要和root_squash 以及 all_squash一同使用，用于指定使用NFS的用户限定后的uid和gid，前提是本机的/etc/passwd中存在这个uid和gid。</li>
</ul>
<h3 id="2-1-4-启动nfs服务">2.1.4. 启动NFS服务</h3>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span><span style="color:#8f5902;font-style:italic">#先启动rpcbind</span>
</span></span><span style="display:flex;"><span>service rpcbind start
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#8f5902;font-style:italic">#后启动nfs</span>
</span></span><span style="display:flex;"><span>service nfs start
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#8f5902;font-style:italic">#可以设置开机启动</span>
</span></span><span style="display:flex;"><span>chkconfig rpcbind on
</span></span><span style="display:flex;"><span>chkconfig nfs on
</span></span></code></pre></div><h3 id="2-1-5-服务端验证">2.1.5. 服务端验证</h3>
<p>通过<code>showmount -e</code>命令如果正常显示共享目录，表示安装正常。</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span><span style="color:#ce5c00;font-weight:bold">[</span>root@k8s-dbg-master-1 build<span style="color:#ce5c00;font-weight:bold">]</span><span style="color:#8f5902;font-style:italic"># showmount -e</span>
</span></span><span style="display:flex;"><span>Export list <span style="color:#204a87;font-weight:bold">for</span> k8s-dbg-master-1:
</span></span><span style="display:flex;"><span>/data/nfs-storage *
</span></span></code></pre></div><h2 id="2-2-客户端">2.2 客户端</h2>
<h3 id="2-2-1-安装nfs-utils的包">2.2.1. 安装nfs-utils的包</h3>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>yum install nfs-utils.x86_64  -y
</span></span></code></pre></div><h3 id="2-2-2-创建挂载点">2.2.2. 创建挂载点</h3>
<p>客户端挂载目录：<code>/mnt/store</code></p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>mkdir /mnt/store
</span></span></code></pre></div><h3 id="2-2-3-查看nfs服务器的共享">2.2.3. 查看NFS服务器的共享</h3>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>root@k8s-dbg-node-5:~# showmount -e 172.16.5.4
</span></span><span style="display:flex;"><span>Export list <span style="color:#204a87;font-weight:bold">for</span> 172.16.5.4:
</span></span><span style="display:flex;"><span>/data/nfs-storage *
</span></span></code></pre></div><h3 id="2-2-4-挂载">2.2.4. 挂载</h3>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>mount -t nfs &lt;NFS_SERVER_IP&gt;:&lt;NFS_SERVER_SHARED_DIR&gt; &lt;NFS_CLIENT_MOUNT_DIR&gt;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#8f5902;font-style:italic">#例如：</span>
</span></span><span style="display:flex;"><span>mount -t nfs 172.16.5.4:/data/nfs-storage /mnt/store
</span></span></code></pre></div><h3 id="2-2-5-验证挂载信息">2.2.5. 验证挂载信息</h3>
<p>使用<code>mount</code>命令</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>root@k8s-dbg-node-5:~# mount <span style="color:#000;font-weight:bold">|</span>grep /mnt/store
</span></span><span style="display:flex;"><span>172.16.5.4:/data/nfs-storage/k8s-storage/ssd on /mnt/store <span style="color:#204a87">type</span> nfs4 <span style="color:#ce5c00;font-weight:bold">(</span>rw,relatime,vers<span style="color:#ce5c00;font-weight:bold">=</span>4.0,rsize<span style="color:#ce5c00;font-weight:bold">=</span>1048576,wsize<span style="color:#ce5c00;font-weight:bold">=</span>1048576,namlen<span style="color:#ce5c00;font-weight:bold">=</span>255,hard,proto<span style="color:#ce5c00;font-weight:bold">=</span>tcp,port<span style="color:#ce5c00;font-weight:bold">=</span>0,timeo<span style="color:#ce5c00;font-weight:bold">=</span>600,retrans<span style="color:#ce5c00;font-weight:bold">=</span>2,sec<span style="color:#ce5c00;font-weight:bold">=</span>sys,clientaddr<span style="color:#ce5c00;font-weight:bold">=</span>172.16.200.24,local_lock<span style="color:#ce5c00;font-weight:bold">=</span>none,addr<span style="color:#ce5c00;font-weight:bold">=</span>172.16.5.4<span style="color:#ce5c00;font-weight:bold">)</span>
</span></span></code></pre></div><p>使用<code>df -h</code>命令</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>root@k8s-dbg-node-5:~# df -h<span style="color:#000;font-weight:bold">|</span>grep nfs
</span></span><span style="display:flex;"><span>172.16.5.4:/data/nfs-storage                                                                                             40G   25G   13G  67% /mnt/store
</span></span></code></pre></div><p>创建文件测试</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span><span style="color:#8f5902;font-style:italic">#进入客户端的挂载目录，创建文件</span>
</span></span><span style="display:flex;"><span><span style="color:#204a87">cd</span> /mnt/store
</span></span><span style="display:flex;"><span>touch test.txt
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#8f5902;font-style:italic">#进入服务端的共享目录，查看客户端创建的文件是否同步</span>
</span></span><span style="display:flex;"><span><span style="color:#204a87">cd</span> /data/nfs-storage 
</span></span><span style="display:flex;"><span>ls
</span></span></code></pre></div>
</div>



    
	
  
    
    
	
    

<div class="td-content" style="page-break-before: always">
    
	<h1 id="pg-9b6e7b7fc8e7add51ad7e8a79a48edd8">5 - ssh tips</h1>
    
	<h1 id="1-ssh-scp免密码">1. ssh/scp免密码</h1>
<p>A服务器地址：10.8.216.25，下面简称A</p>
<p>B服务器地址：10.8.216.26，下面简称B</p>
<p>实现A登录B免密码。</p>
<h2 id="1-1-在a生成密钥对">1.1. 在A生成密钥对</h2>
<p>无密码方式：</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>ssh-keygen -t rsa -P 
</span></span></code></pre></div><p>自定义密码参数：</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>ssh-keygen -C &lt;comment&gt; -f &lt;keyfile&gt; -t rsa -P <span style="color:#4e9a06">&#34;&lt;passphrase&gt;&#34;</span>
</span></span></code></pre></div><p>执行上述命令，一路回车，会在当前登录用户的home目录下的.ssh目录下生成id_rsa和id_rsa.pub两个文件，分别代表密钥对的私钥和公钥，如下图所示：</p>
<p><img src="https://img-blog.csdn.net/20170916200144505?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvaHV3aF8=/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast" alt=""></p>
<h2 id="1-2-拷贝a的公钥-id-rsa-pub-到b">1.2. 拷贝A的公钥（id_rsa.pub）到B</h2>
<p>这里拷贝到B的root用户home目录下为例：</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>scp /root/.ssh/id_rsa.pub root@10.8.216.26:/root
</span></span></code></pre></div><h2 id="1-3-登录b">1.3. 登录B</h2>
<p>拷贝A的id_rsa.pub内容到.ssh目录下的authorized_keys文件中</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span><span style="color:#204a87">cd</span> /root
</span></span><span style="display:flex;"><span>cat id_rsa.pub &gt;&gt; .ssh/authorized_keys
</span></span></code></pre></div><p>如图：</p>
<p><img src="https://img-blog.csdn.net/20170916200919602?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvaHV3aF8=/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast" alt=""></p>
<h2 id="1-4-登录或拷贝">1.4. 登录或拷贝</h2>
<p>此时在A中用SSH登录B或向B拷贝文件，将不需要密码</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>ssh root@10.8.216.26
</span></span><span style="display:flex;"><span>scp abc.txt root@10.8.216.26:/root
</span></span></code></pre></div><h1 id="2-配置跳板机快速登录">2. 配置跳板机快速登录</h1>
<h2 id="2-1-配置ssh-config文件">2.1. 配置ssh config文件</h2>
<p>ssh config 路径：~/.ssh/config</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>AddKeysToAgent yes
</span></span><span style="display:flex;"><span>ServerAliveInterval <span style="color:#0000cf;font-weight:bold">3</span>
</span></span><span style="display:flex;"><span>Host jump
</span></span><span style="display:flex;"><span>        HostName <span style="color:#ce5c00;font-weight:bold">{</span>jump_ip<span style="color:#ce5c00;font-weight:bold">}</span>
</span></span><span style="display:flex;"><span>        Port    <span style="color:#ce5c00;font-weight:bold">{</span>port<span style="color:#ce5c00;font-weight:bold">}</span>
</span></span><span style="display:flex;"><span>        User    <span style="color:#ce5c00;font-weight:bold">{</span>username<span style="color:#ce5c00;font-weight:bold">}</span>
</span></span><span style="display:flex;"><span>        forwardagent yes
</span></span><span style="display:flex;"><span>        identityfile ~/.ssh/id_rsa
</span></span><span style="display:flex;"><span>Host *.gw
</span></span><span style="display:flex;"><span>        user <span style="color:#ce5c00;font-weight:bold">{</span>username<span style="color:#ce5c00;font-weight:bold">}</span>
</span></span><span style="display:flex;"><span>        port <span style="color:#ce5c00;font-weight:bold">{</span>port<span style="color:#ce5c00;font-weight:bold">}</span>
</span></span><span style="display:flex;"><span>        proxycommand ssh -W <span style="color:#204a87;font-weight:bold">$(</span><span style="color:#204a87">echo</span> %h <span style="color:#000;font-weight:bold">|</span> sed -e <span style="color:#4e9a06">&#34;s/.gw</span>$<span style="color:#4e9a06">//&#34;</span><span style="color:#204a87;font-weight:bold">)</span>:%p jump
</span></span><span style="display:flex;"><span>Host bj*
</span></span><span style="display:flex;"><span>        User    <span style="color:#ce5c00;font-weight:bold">{</span>username<span style="color:#ce5c00;font-weight:bold">}</span>
</span></span><span style="display:flex;"><span>        Port    <span style="color:#ce5c00;font-weight:bold">{</span>port<span style="color:#ce5c00;font-weight:bold">}</span>
</span></span><span style="display:flex;"><span>        proxycommand ssh -W 192.168.123.<span style="color:#204a87;font-weight:bold">$(</span><span style="color:#204a87">echo</span> %h <span style="color:#000;font-weight:bold">|</span> awk -F <span style="color:#4e9a06">&#39;bj&#39;</span> <span style="color:#4e9a06">&#39;{print $2}&#39;</span><span style="color:#204a87;font-weight:bold">)</span>:%p jump    
</span></span></code></pre></div><p>多层跳板机</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>Host jump1
</span></span><span style="display:flex;"><span>        Hostname <span style="color:#ce5c00;font-weight:bold">{</span>jump1_ip<span style="color:#ce5c00;font-weight:bold">}</span>
</span></span><span style="display:flex;"><span>        Port  <span style="color:#ce5c00;font-weight:bold">{</span>port<span style="color:#ce5c00;font-weight:bold">}</span>
</span></span><span style="display:flex;"><span>        User  <span style="color:#ce5c00;font-weight:bold">{</span>username<span style="color:#ce5c00;font-weight:bold">}</span>
</span></span><span style="display:flex;"><span>        forwardagent yes
</span></span><span style="display:flex;"><span>        identityfile ~/.ssh/id_rsa
</span></span><span style="display:flex;"><span>Host jump2
</span></span><span style="display:flex;"><span>        Hostname <span style="color:#ce5c00;font-weight:bold">{</span>jump2_ip<span style="color:#ce5c00;font-weight:bold">}</span>
</span></span><span style="display:flex;"><span>        Port <span style="color:#ce5c00;font-weight:bold">{</span>port<span style="color:#ce5c00;font-weight:bold">}</span>
</span></span><span style="display:flex;"><span>        User <span style="color:#ce5c00;font-weight:bold">{</span>username<span style="color:#ce5c00;font-weight:bold">}</span>
</span></span><span style="display:flex;"><span>        ProxyCommand ssh -q -x -W %h:%p jump1
</span></span><span style="display:flex;"><span>Host *
</span></span><span style="display:flex;"><span>        Hostname %h
</span></span><span style="display:flex;"><span>        Port  <span style="color:#ce5c00;font-weight:bold">{</span>port<span style="color:#ce5c00;font-weight:bold">}</span>
</span></span><span style="display:flex;"><span>        User  <span style="color:#ce5c00;font-weight:bold">{</span>username<span style="color:#ce5c00;font-weight:bold">}</span>
</span></span><span style="display:flex;"><span>        ProxyCommand ssh -q -x -W %h:%p jump2
</span></span></code></pre></div><h2 id="2-2-记录机器文件">2.2. 记录机器文件</h2>
<p>将关键字和IP写入文件记录，例如 <code>~/.my_hosts</code>。</p>
<p>示例：可以是IP + 环境等关键字，中间用空格隔开。</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span><span style="color:#8f5902;font-style:italic"># release</span>
</span></span><span style="display:flex;"><span>192.168.123.11 rel-node-11
</span></span><span style="display:flex;"><span>192.168.123.12 rel-node-12
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#8f5902;font-style:italic"># pre</span>
</span></span><span style="display:flex;"><span>192.168.321.13 pre-node-13
</span></span><span style="display:flex;"><span>192.168.321.14 pre-node-14
</span></span><span style="display:flex;"><span>192.168.321.15 pre-node-15
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#8f5902;font-style:italic"># dev</span>
</span></span><span style="display:flex;"><span>192.168.111.16 dev-node-16
</span></span><span style="display:flex;"><span>192.168.111.17 dev-node-17
</span></span></code></pre></div><h2 id="2-3-安装fzf">2.3. 安装fzf</h2>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span><span style="color:#8f5902;font-style:italic"># for mac</span>
</span></span><span style="display:flex;"><span>brew install fzf
</span></span></code></pre></div><h2 id="2-4-设置命令别名">2.4. 设置命令别名</h2>
<p>设置 alias 到shell rc 文件(.bashrc / .zshrc)</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span><span style="color:#204a87">alias</span> <span style="color:#000">goto</span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#4e9a06">&#34;ssh \$(cat ~/.my_hosts | fzf | awk &#39;{ printf(\&#34;%s.gw\&#34;, \$1)}&#39;)&#34;</span>
</span></span></code></pre></div><h2 id="2-5-使用">2.5. 使用</h2>
<p>使用别名命令，输入关键字搜索，点击回车进入指定机器。</p>
<p>也可以使用ssh命令登录机器别名。</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>ssh bj11
</span></span></code></pre></div><h1 id="3-ssh配置项说明">3. ssh配置项说明</h1>
<p>可以通过man查看ssh配置说明</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>man ssh_config
</span></span></code></pre></div><p>配置文件示例：</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>Host jump
</span></span><span style="display:flex;"><span>  port <span style="color:#0000cf;font-weight:bold">22</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>Host * !jump
</span></span><span style="display:flex;"><span>  StrictHostKeyChecking no
</span></span><span style="display:flex;"><span>  HostName %h
</span></span><span style="display:flex;"><span>  UserKnownHostsFile /dev/null
</span></span><span style="display:flex;"><span>  LogLevel ERROR
</span></span><span style="display:flex;"><span>  IdentityFile ~/.ssh/id_rsa
</span></span><span style="display:flex;"><span>  ProxyCommand ssh -p <span style="color:#0000cf;font-weight:bold">22</span> -F /dev/null jump -W %h:%p
</span></span><span style="display:flex;"><span>  SendEnv LANG LC_*
</span></span></code></pre></div><p>配置项说明：</p>
<ul>
<li>
<p>Host: 标识设备，<code>*</code>表示通配所有字符，<code>!</code>表示例外通配。</p>
</li>
<li>
<p>StrictHostKeyChecking no：连接时不进行公钥交互确认操作。</p>
</li>
<li>
<p>UserKnownHostsFile /dev/null：不提示确认known_hosts文件。</p>
</li>
<li>
<p>ProxyCommand：代理命令</p>
</li>
</ul>
<p>如果使用命令加参数的方式：</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>ssh -o <span style="color:#000">StrictHostKeyChecking</span><span style="color:#ce5c00;font-weight:bold">=</span>no -o <span style="color:#000">UserKnownHostsFile</span><span style="color:#ce5c00;font-weight:bold">=</span>/dev/null -o <span style="color:#000">ProxyCommand</span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#4e9a06">&#34;ssh -p 22 jump -W %h:%p&#34;</span> 
</span></span></code></pre></div>
</div>



    
	
  
    
    
	
    

<div class="td-content" style="page-break-before: always">
    
	<h1 id="pg-2fced7315a2daf4cf08293398519ee28">6 - Supervisor的使用</h1>
    
	<h1 id="1-supervisor简介">1. Supervisor简介</h1>
<p>Supervisord 是用 Python 实现的一款的进程管理工具，supervisord 要求管理的程序是非 daemon 程序，supervisord 会帮你把它转成 daemon 程序，因此如果用 supervisord 来管理进程，进程需要以非daemon的方式启动。</p>
<p>例如：管理nginx 的话，必须在 nginx 的配置文件里添加一行设置 daemon off 让 nginx 以非 daemon 方式启动。</p>
<h1 id="2-supervisor安装">2. Supervisor安装</h1>
<p>以centos系统为例，以下两种方式选择其一。</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span><span style="color:#8f5902;font-style:italic"># yum install 的方式</span>
</span></span><span style="display:flex;"><span>yum install -y supervisor
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#8f5902;font-style:italic"># easy_install的方式</span>
</span></span><span style="display:flex;"><span>yum install -y python-setuptools
</span></span><span style="display:flex;"><span>easy_install supervisor
</span></span><span style="display:flex;"><span>echo_supervisord_conf &gt;/etc/supervisord.conf
</span></span></code></pre></div><h1 id="3-supervisor的配置">3. Supervisor的配置</h1>
<h2 id="3-1-supervisord-conf的配置">3.1. supervisord.conf的配置</h2>
<p>如果使用<code>yum install -y supervisor</code>的命令安装，会生成默认配置<code>/etc/supervisord.conf</code>和目录<code>/etc/supervisord.d</code>，如果没有则自行创建。</p>
<p>在<code>/etc/supervisord.d</code>的目录下创建<code>conf</code>和<code>log</code>两个目录，<code>conf</code>用于存放管理进程的配置，<code>log</code>用于存放管理进程的日志。</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span><span style="color:#204a87">cd</span> /etc/supervisord.d
</span></span><span style="display:flex;"><span>mkdir conf log
</span></span></code></pre></div><p>修改<code>/etc/supervisord.conf</code>的<code>[include]</code>部分，即载入<code>/etc/supervisord.d/conf</code>目录下的所有配置。</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>vi /etc/supervisord.conf
</span></span><span style="display:flex;"><span>...
</span></span><span style="display:flex;"><span><span style="color:#ce5c00;font-weight:bold">[</span>include<span style="color:#ce5c00;font-weight:bold">]</span>
</span></span><span style="display:flex;"><span><span style="color:#000">files</span> <span style="color:#ce5c00;font-weight:bold">=</span> supervisord.d/conf/*.conf
</span></span><span style="display:flex;"><span>...
</span></span></code></pre></div><p>也可以修改supervisor应用日志的目录，默认日志路径为<code>/var/log/supervisor/supervisord.log</code>。</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>vi /etc/supervisord.conf
</span></span><span style="display:flex;"><span>...
</span></span><span style="display:flex;"><span><span style="color:#ce5c00;font-weight:bold">[</span>supervisord<span style="color:#ce5c00;font-weight:bold">]</span>
</span></span><span style="display:flex;"><span><span style="color:#000">logfile</span><span style="color:#ce5c00;font-weight:bold">=</span>/var/log/supervisor/supervisord.log  <span style="color:#000;font-weight:bold">;</span> <span style="color:#ce5c00;font-weight:bold">(</span>main log file<span style="color:#000;font-weight:bold">;</span>default <span style="color:#000">$CWD</span>/supervisord.log<span style="color:#ce5c00;font-weight:bold">)</span>
</span></span><span style="display:flex;"><span><span style="color:#000">logfile_maxbytes</span><span style="color:#ce5c00;font-weight:bold">=</span>50MB       <span style="color:#000;font-weight:bold">;</span> <span style="color:#ce5c00;font-weight:bold">(</span>max main logfile bytes b4 rotation<span style="color:#000;font-weight:bold">;</span>default 50MB<span style="color:#ce5c00;font-weight:bold">)</span>
</span></span><span style="display:flex;"><span><span style="color:#000">logfile_backups</span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#0000cf;font-weight:bold">10</span>          <span style="color:#000;font-weight:bold">;</span> <span style="color:#ce5c00;font-weight:bold">(</span>num of main logfile rotation backups<span style="color:#000;font-weight:bold">;</span>default 10<span style="color:#ce5c00;font-weight:bold">)</span>
</span></span><span style="display:flex;"><span><span style="color:#000">loglevel</span><span style="color:#ce5c00;font-weight:bold">=</span>info               <span style="color:#000;font-weight:bold">;</span> <span style="color:#ce5c00;font-weight:bold">(</span>log level<span style="color:#000;font-weight:bold">;</span>default info<span style="color:#000;font-weight:bold">;</span> others: debug,warn,trace<span style="color:#ce5c00;font-weight:bold">)</span>
</span></span><span style="display:flex;"><span><span style="color:#000">pidfile</span><span style="color:#ce5c00;font-weight:bold">=</span>/var/run/supervisord.pid <span style="color:#000;font-weight:bold">;</span> <span style="color:#ce5c00;font-weight:bold">(</span>supervisord pidfile<span style="color:#000;font-weight:bold">;</span>default supervisord.pid<span style="color:#ce5c00;font-weight:bold">)</span>
</span></span><span style="display:flex;"><span>...
</span></span></code></pre></div><h2 id="3-2-管理应用的配置">3.2. 管理应用的配置</h2>
<p>进入到<code>/etc/supervisord.d/conf</code>目录，创建管理应用的配置，可以创建多个应用配置。</p>
<p>例如，创建<code>confd.conf</code>配置。</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span><span style="color:#ce5c00;font-weight:bold">[</span>program:confd<span style="color:#ce5c00;font-weight:bold">]</span>
</span></span><span style="display:flex;"><span><span style="color:#000">directory</span> <span style="color:#ce5c00;font-weight:bold">=</span> /usr/local/bin <span style="color:#000;font-weight:bold">;</span> 程序的启动目录
</span></span><span style="display:flex;"><span><span style="color:#204a87">command</span> <span style="color:#ce5c00;font-weight:bold">=</span> /usr/local/bin/confd -config-file /etc/confd/confd.toml <span style="color:#000;font-weight:bold">;</span> 启动命令，与命令行启动的命令是一样的
</span></span><span style="display:flex;"><span><span style="color:#000">autostart</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#204a87">true</span>     <span style="color:#000;font-weight:bold">;</span> 在 supervisord 启动的时候也自动启动
</span></span><span style="display:flex;"><span><span style="color:#000">startsecs</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#0000cf;font-weight:bold">5</span>        <span style="color:#000;font-weight:bold">;</span> 启动 <span style="color:#0000cf;font-weight:bold">5</span> 秒后没有异常退出，就当作已经正常启动了
</span></span><span style="display:flex;"><span><span style="color:#000">autorestart</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#204a87">true</span>   <span style="color:#000;font-weight:bold">;</span> 程序异常退出后自动重启
</span></span><span style="display:flex;"><span><span style="color:#000">startretries</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#0000cf;font-weight:bold">3</span>     <span style="color:#000;font-weight:bold">;</span> 启动失败自动重试次数，默认是 <span style="color:#0000cf;font-weight:bold">3</span>
</span></span><span style="display:flex;"><span><span style="color:#000">user</span> <span style="color:#ce5c00;font-weight:bold">=</span> root          <span style="color:#000;font-weight:bold">;</span> 用哪个用户启动
</span></span><span style="display:flex;"><span><span style="color:#000">redirect_stderr</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#204a87">true</span>  <span style="color:#000;font-weight:bold">;</span> 把 stderr 重定向到 stdout，默认 <span style="color:#204a87">false</span>
</span></span><span style="display:flex;"><span><span style="color:#000">stdout_logfile_maxbytes</span> <span style="color:#ce5c00;font-weight:bold">=</span> 20MB  <span style="color:#000;font-weight:bold">;</span> stdout 日志文件大小，默认 50MB
</span></span><span style="display:flex;"><span><span style="color:#000">stdout_logfile_backups</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#0000cf;font-weight:bold">20</span>     <span style="color:#000;font-weight:bold">;</span> stdout 日志文件备份数
</span></span><span style="display:flex;"><span><span style="color:#000;font-weight:bold">;</span> stdout 日志文件，需要注意当指定目录不存在时无法正常启动，所以需要手动创建目录（supervisord 会自动创建日志文件）
</span></span><span style="display:flex;"><span><span style="color:#000">stdout_logfile</span> <span style="color:#ce5c00;font-weight:bold">=</span> /etc/supervisord.d/log/confd.log  <span style="color:#000;font-weight:bold">;</span>日志统一放在log目录下
</span></span><span style="display:flex;"><span><span style="color:#000;font-weight:bold">;</span> 可以通过 environment 来添加需要的环境变量，一种常见的用法是修改 PYTHONPATH
</span></span><span style="display:flex;"><span><span style="color:#000;font-weight:bold">;</span> <span style="color:#000">environment</span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#000">PYTHONPATH</span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#000">$PYTHONPATH</span>:/path/to/somewhere
</span></span></code></pre></div><h1 id="4-surpervisor的启动">4. Surpervisor的启动</h1>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span><span style="color:#8f5902;font-style:italic"># supervisord二进制启动</span>
</span></span><span style="display:flex;"><span>supervisord -c /etc/supervisord.conf
</span></span><span style="display:flex;"><span><span style="color:#8f5902;font-style:italic"># 检查进程</span>
</span></span><span style="display:flex;"><span>ps aux <span style="color:#000;font-weight:bold">|</span> grep supervisord
</span></span></code></pre></div><p>或者以systemd的方式管理</p>
<p>vi /etc/rc.d/init.d/supervisord</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span><span style="color:#8f5902;font-style:italic">#!/bin/sh
</span></span></span><span style="display:flex;"><span><span style="color:#8f5902;font-style:italic"></span><span style="color:#8f5902;font-style:italic">#</span>
</span></span><span style="display:flex;"><span><span style="color:#8f5902;font-style:italic"># /etc/rc.d/init.d/supervisord</span>
</span></span><span style="display:flex;"><span><span style="color:#8f5902;font-style:italic">#</span>
</span></span><span style="display:flex;"><span><span style="color:#8f5902;font-style:italic"># Supervisor is a client/server system that</span>
</span></span><span style="display:flex;"><span><span style="color:#8f5902;font-style:italic"># allows its users to monitor and control a</span>
</span></span><span style="display:flex;"><span><span style="color:#8f5902;font-style:italic"># number of processes on UNIX-like operating</span>
</span></span><span style="display:flex;"><span><span style="color:#8f5902;font-style:italic"># systems.</span>
</span></span><span style="display:flex;"><span><span style="color:#8f5902;font-style:italic">#</span>
</span></span><span style="display:flex;"><span><span style="color:#8f5902;font-style:italic"># chkconfig: - 64 36</span>
</span></span><span style="display:flex;"><span><span style="color:#8f5902;font-style:italic"># description: Supervisor Server</span>
</span></span><span style="display:flex;"><span><span style="color:#8f5902;font-style:italic"># processname: supervisord</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#8f5902;font-style:italic"># Source init functions</span>
</span></span><span style="display:flex;"><span>. /etc/rc.d/init.d/functions
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#000">prog</span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#4e9a06">&#34;supervisord&#34;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#000">prefix</span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#4e9a06">&#34;/usr&#34;</span>
</span></span><span style="display:flex;"><span><span style="color:#000">exec_prefix</span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#4e9a06">&#34;</span><span style="color:#4e9a06">${</span><span style="color:#000">prefix</span><span style="color:#4e9a06">}</span><span style="color:#4e9a06">&#34;</span>
</span></span><span style="display:flex;"><span><span style="color:#000">prog_bin</span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#4e9a06">&#34;</span><span style="color:#4e9a06">${</span><span style="color:#000">exec_prefix</span><span style="color:#4e9a06">}</span><span style="color:#4e9a06">/bin/supervisord&#34;</span>
</span></span><span style="display:flex;"><span><span style="color:#000">PIDFILE</span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#4e9a06">&#34;/var/run/</span><span style="color:#000">$prog</span><span style="color:#4e9a06">.pid&#34;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>start<span style="color:#ce5c00;font-weight:bold">()</span>
</span></span><span style="display:flex;"><span><span style="color:#ce5c00;font-weight:bold">{</span>
</span></span><span style="display:flex;"><span>       <span style="color:#204a87">echo</span> -n $<span style="color:#4e9a06">&#34;Starting </span><span style="color:#000">$prog</span><span style="color:#4e9a06">: &#34;</span>
</span></span><span style="display:flex;"><span>       daemon <span style="color:#000">$prog_bin</span> --pidfile <span style="color:#000">$PIDFILE</span> -c /etc/supervisord.conf
</span></span><span style="display:flex;"><span>       <span style="color:#ce5c00;font-weight:bold">[</span> -f <span style="color:#000">$PIDFILE</span> <span style="color:#ce5c00;font-weight:bold">]</span> <span style="color:#ce5c00;font-weight:bold">&amp;&amp;</span> success $<span style="color:#4e9a06">&#34;</span><span style="color:#000">$prog</span><span style="color:#4e9a06"> startup&#34;</span> <span style="color:#ce5c00;font-weight:bold">||</span> failure $<span style="color:#4e9a06">&#34;</span><span style="color:#000">$prog</span><span style="color:#4e9a06"> startup&#34;</span>
</span></span><span style="display:flex;"><span>       <span style="color:#204a87">echo</span>
</span></span><span style="display:flex;"><span><span style="color:#ce5c00;font-weight:bold">}</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>stop<span style="color:#ce5c00;font-weight:bold">()</span>
</span></span><span style="display:flex;"><span><span style="color:#ce5c00;font-weight:bold">{</span>
</span></span><span style="display:flex;"><span>       <span style="color:#204a87">echo</span> -n $<span style="color:#4e9a06">&#34;Shutting down </span><span style="color:#000">$prog</span><span style="color:#4e9a06">: &#34;</span>
</span></span><span style="display:flex;"><span>       <span style="color:#ce5c00;font-weight:bold">[</span> -f <span style="color:#000">$PIDFILE</span> <span style="color:#ce5c00;font-weight:bold">]</span> <span style="color:#ce5c00;font-weight:bold">&amp;&amp;</span> killproc <span style="color:#000">$prog</span> <span style="color:#ce5c00;font-weight:bold">||</span> success $<span style="color:#4e9a06">&#34;</span><span style="color:#000">$prog</span><span style="color:#4e9a06"> shutdown&#34;</span>
</span></span><span style="display:flex;"><span>       <span style="color:#204a87">echo</span>
</span></span><span style="display:flex;"><span><span style="color:#ce5c00;font-weight:bold">}</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#204a87;font-weight:bold">case</span> <span style="color:#4e9a06">&#34;</span><span style="color:#000">$1</span><span style="color:#4e9a06">&#34;</span> in
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span> start<span style="color:#ce5c00;font-weight:bold">)</span>
</span></span><span style="display:flex;"><span>   start
</span></span><span style="display:flex;"><span> <span style="color:#000;font-weight:bold">;;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span> stop<span style="color:#ce5c00;font-weight:bold">)</span>
</span></span><span style="display:flex;"><span>   stop
</span></span><span style="display:flex;"><span> <span style="color:#000;font-weight:bold">;;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span> status<span style="color:#ce5c00;font-weight:bold">)</span>
</span></span><span style="display:flex;"><span>       status <span style="color:#000">$prog</span>
</span></span><span style="display:flex;"><span> <span style="color:#000;font-weight:bold">;;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span> restart<span style="color:#ce5c00;font-weight:bold">)</span>
</span></span><span style="display:flex;"><span>   stop
</span></span><span style="display:flex;"><span>   start
</span></span><span style="display:flex;"><span> <span style="color:#000;font-weight:bold">;;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span> *<span style="color:#ce5c00;font-weight:bold">)</span>
</span></span><span style="display:flex;"><span>   <span style="color:#204a87">echo</span> <span style="color:#4e9a06">&#34;Usage: </span><span style="color:#000">$0</span><span style="color:#4e9a06"> {start|stop|restart|status}&#34;</span>
</span></span><span style="display:flex;"><span> <span style="color:#000;font-weight:bold">;;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#204a87;font-weight:bold">esac</span>
</span></span></code></pre></div><p>设置开机启动及systemd方式启动。</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>sudo chmod +x /etc/rc.d/init.d/supervisord
</span></span><span style="display:flex;"><span>sudo chkconfig --add supervisord
</span></span><span style="display:flex;"><span>sudo chkconfig supervisord on
</span></span><span style="display:flex;"><span>sudo service supervisord start
</span></span></code></pre></div><h1 id="5-supervisorctl-supervisord">5. supervisorctl&amp;supervisord</h1>
<p>Supervisord 安装完成后有两个可用的命令行 <code>supervisord</code> 和 <code>supervisorctl</code>，命令使用解释如下：</p>
<h2 id="5-1-supervisorctl">5.1. supervisorctl</h2>
<ul>
<li><code>supervisorctl stop programxxx</code>，停止某一个进程(programxxx)，programxxx 为 [program:beepkg] 里配置的值，这个示例就是 beepkg。</li>
<li><code>supervisorctl start programxxx</code>，启动某个进程。</li>
<li><code>supervisorctl restart programxxx</code>，重启某个进程。</li>
<li><code>supervisorctl status</code>，查看进程状态。</li>
<li><code>supervisorctl stop groupworker</code> ，重启所有属于名为 groupworker 这个分组的进程(start,restart 同理)。</li>
<li><code>supervisorctl stop all</code>，停止全部进程，注：start、restart、stop 都不会载入最新的配置文件。</li>
<li><code>supervisorctl reload</code>，载入最新的配置文件，停止原有进程并按新的配置启动、管理所有进程。</li>
<li><code>supervisorctl update</code>，根据最新的配置文件，启动新配置或有改动的进程，配置没有改动的进程不会受影响而重启。</li>
</ul>
<p>更多参考：</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>$ supervisorctl --help
</span></span><span style="display:flex;"><span>supervisorctl -- control applications run by supervisord from the cmd line.
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>Usage: /usr/bin/supervisorctl <span style="color:#ce5c00;font-weight:bold">[</span>options<span style="color:#ce5c00;font-weight:bold">]</span> <span style="color:#ce5c00;font-weight:bold">[</span>action <span style="color:#ce5c00;font-weight:bold">[</span>arguments<span style="color:#ce5c00;font-weight:bold">]]</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>Options:
</span></span><span style="display:flex;"><span>-c/--configuration -- configuration file path <span style="color:#ce5c00;font-weight:bold">(</span>default /etc/supervisord.conf<span style="color:#ce5c00;font-weight:bold">)</span>
</span></span><span style="display:flex;"><span>-h/--help -- print usage message and <span style="color:#204a87">exit</span>
</span></span><span style="display:flex;"><span>-i/--interactive -- start an interactive shell after executing commands
</span></span><span style="display:flex;"><span>-s/--serverurl URL -- URL on which supervisord server is listening
</span></span><span style="display:flex;"><span>     <span style="color:#ce5c00;font-weight:bold">(</span>default <span style="color:#4e9a06">&#34;http://localhost:9001&#34;</span><span style="color:#ce5c00;font-weight:bold">)</span>.
</span></span><span style="display:flex;"><span>-u/--username -- username to use <span style="color:#204a87;font-weight:bold">for</span> authentication with server
</span></span><span style="display:flex;"><span>-p/--password -- password to use <span style="color:#204a87;font-weight:bold">for</span> authentication with server
</span></span><span style="display:flex;"><span>-r/--history-file -- keep a readline <span style="color:#204a87">history</span> <span style="color:#ce5c00;font-weight:bold">(</span><span style="color:#204a87;font-weight:bold">if</span> readline is available<span style="color:#ce5c00;font-weight:bold">)</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>action <span style="color:#ce5c00;font-weight:bold">[</span>arguments<span style="color:#ce5c00;font-weight:bold">]</span> -- see below
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>Actions are commands like <span style="color:#4e9a06">&#34;tail&#34;</span> or <span style="color:#4e9a06">&#34;stop&#34;</span>.  If -i is specified or no action is
</span></span><span style="display:flex;"><span>specified on the <span style="color:#204a87">command</span> line, a <span style="color:#4e9a06">&#34;shell&#34;</span> interpreting actions typed
</span></span><span style="display:flex;"><span>interactively is started.  Use the action <span style="color:#4e9a06">&#34;help&#34;</span> to find out about available
</span></span><span style="display:flex;"><span>actions.
</span></span></code></pre></div><p>例如：</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span><span style="color:#8f5902;font-style:italic"># supervisorctl status</span>
</span></span><span style="display:flex;"><span>confd                            RUNNING   pid 31256, uptime 0:11:24
</span></span><span style="display:flex;"><span>twemproxy                        RUNNING   pid 31255, uptime 0:11:24
</span></span></code></pre></div><h2 id="5-2-supervisord">5.2. supervisord</h2>
<ul>
<li>supervisord，初始启动 Supervisord，启动、管理配置中设置的进程。</li>
</ul>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>$ supervisord --help
</span></span><span style="display:flex;"><span>supervisord -- run a <span style="color:#204a87">set</span> of applications as daemons.
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>Usage: /usr/bin/supervisord <span style="color:#ce5c00;font-weight:bold">[</span>options<span style="color:#ce5c00;font-weight:bold">]</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>Options:
</span></span><span style="display:flex;"><span>-c/--configuration FILENAME -- configuration file
</span></span><span style="display:flex;"><span>-n/--nodaemon -- run in the foreground <span style="color:#ce5c00;font-weight:bold">(</span>same as <span style="color:#4e9a06">&#39;nodaemon true&#39;</span> in config file<span style="color:#ce5c00;font-weight:bold">)</span>
</span></span><span style="display:flex;"><span>-h/--help -- print this usage message and <span style="color:#204a87">exit</span>
</span></span><span style="display:flex;"><span>-v/--version -- print supervisord version number and <span style="color:#204a87">exit</span>
</span></span><span style="display:flex;"><span>-u/--user USER -- run supervisord as this user <span style="color:#ce5c00;font-weight:bold">(</span>or numeric uid<span style="color:#ce5c00;font-weight:bold">)</span>
</span></span><span style="display:flex;"><span>-m/--umask UMASK -- use this <span style="color:#204a87">umask</span> <span style="color:#204a87;font-weight:bold">for</span> daemon subprocess <span style="color:#ce5c00;font-weight:bold">(</span>default is 022<span style="color:#ce5c00;font-weight:bold">)</span>
</span></span><span style="display:flex;"><span>-d/--directory DIRECTORY -- directory to chdir to when daemonized
</span></span><span style="display:flex;"><span>-l/--logfile FILENAME -- use FILENAME as logfile path
</span></span><span style="display:flex;"><span>-y/--logfile_maxbytes BYTES -- use BYTES to limit the max size of logfile
</span></span><span style="display:flex;"><span>-z/--logfile_backups NUM -- number of backups to keep when max bytes reached
</span></span><span style="display:flex;"><span>-e/--loglevel LEVEL -- use LEVEL as log level <span style="color:#ce5c00;font-weight:bold">(</span>debug,info,warn,error,critical<span style="color:#ce5c00;font-weight:bold">)</span>
</span></span><span style="display:flex;"><span>-j/--pidfile FILENAME -- write a pid file <span style="color:#204a87;font-weight:bold">for</span> the daemon process to FILENAME
</span></span><span style="display:flex;"><span>-i/--identifier STR -- identifier used <span style="color:#204a87;font-weight:bold">for</span> this instance of supervisord
</span></span><span style="display:flex;"><span>-q/--childlogdir DIRECTORY -- the log directory <span style="color:#204a87;font-weight:bold">for</span> child process logs
</span></span><span style="display:flex;"><span>-k/--nocleanup --  prevent the process from performing cleanup <span style="color:#ce5c00;font-weight:bold">(</span>removal of
</span></span><span style="display:flex;"><span>                   old automatic child log files<span style="color:#ce5c00;font-weight:bold">)</span> at startup.
</span></span><span style="display:flex;"><span>-a/--minfds NUM -- the minimum number of file descriptors <span style="color:#204a87;font-weight:bold">for</span> start success
</span></span><span style="display:flex;"><span>-t/--strip_ansi -- strip ansi escape codes from process output
</span></span><span style="display:flex;"><span>--minprocs NUM  -- the minimum number of processes available <span style="color:#204a87;font-weight:bold">for</span> start success
</span></span><span style="display:flex;"><span>--profile_options OPTIONS -- run supervisord under profiler and output
</span></span><span style="display:flex;"><span>                             results based on OPTIONS, which  is a comma-sep<span style="color:#4e9a06">&#39;d
</span></span></span><span style="display:flex;"><span><span style="color:#4e9a06">                             list of &#39;</span>cumulative<span style="color:#4e9a06">&#39;, &#39;</span>calls<span style="color:#4e9a06">&#39;, and/or &#39;</span>callers<span style="color:#4e9a06">&#39;,
</span></span></span><span style="display:flex;"><span><span style="color:#4e9a06">                             e.g. &#39;</span>cumulative,callers<span style="color:#a40000">&#39;</span><span style="color:#ce5c00;font-weight:bold">)</span>
</span></span></code></pre></div><h1 id="6-supervisor控制台">6. Supervisor控制台</h1>
<p>在<code>/etc/supervisord.conf</code>中修改<code>[inet_http_server] </code>的参数，具体如下：</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span><span style="color:#ce5c00;font-weight:bold">[</span>inet_http_server<span style="color:#ce5c00;font-weight:bold">]</span>         <span style="color:#000;font-weight:bold">;</span> inet <span style="color:#ce5c00;font-weight:bold">(</span>TCP<span style="color:#ce5c00;font-weight:bold">)</span> server disabled by default
</span></span><span style="display:flex;"><span><span style="color:#000">port</span><span style="color:#ce5c00;font-weight:bold">=</span>*:9001        <span style="color:#000;font-weight:bold">;</span> ip_address:port specifier, *:port <span style="color:#204a87;font-weight:bold">for</span> all iface
</span></span><span style="display:flex;"><span><span style="color:#000">username</span><span style="color:#ce5c00;font-weight:bold">=</span>root             <span style="color:#000;font-weight:bold">;</span> default is no username <span style="color:#ce5c00;font-weight:bold">(</span>open server<span style="color:#ce5c00;font-weight:bold">)</span>
</span></span><span style="display:flex;"><span><span style="color:#000">password</span><span style="color:#ce5c00;font-weight:bold">=</span>xxxx               <span style="color:#000;font-weight:bold">;</span> default is no password <span style="color:#ce5c00;font-weight:bold">(</span>open server<span style="color:#ce5c00;font-weight:bold">)</span>
</span></span></code></pre></div><p>修改后重启supervisor进程，在浏览器访问 <code>http://&lt;host-ip&gt;:9001</code>。</p>
<p>具体如下：</p>
<p><img src="http://res.cloudinary.com/dqxtn0ick/image/upload/v1528457482/article/linux/supervisor.png" alt="supervisor"></p>
<h1 id="7-supervisor-conf详细配置">7. supervisor.conf详细配置</h1>
<p>cat /etc/supervisord.conf</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span><span style="color:#000;font-weight:bold">;</span> Sample supervisor config file.
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#ce5c00;font-weight:bold">[</span>unix_http_server<span style="color:#ce5c00;font-weight:bold">]</span>
</span></span><span style="display:flex;"><span><span style="color:#000">file</span><span style="color:#ce5c00;font-weight:bold">=</span>/var/run/supervisor/supervisor.sock   <span style="color:#000;font-weight:bold">;</span> <span style="color:#ce5c00;font-weight:bold">(</span>the path to the socket file<span style="color:#ce5c00;font-weight:bold">)</span>
</span></span><span style="display:flex;"><span><span style="color:#000;font-weight:bold">;</span><span style="color:#000">chmod</span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#0000cf;font-weight:bold">0700</span>                 <span style="color:#000;font-weight:bold">;</span> sockef file mode <span style="color:#ce5c00;font-weight:bold">(</span>default 0700<span style="color:#ce5c00;font-weight:bold">)</span>
</span></span><span style="display:flex;"><span><span style="color:#000;font-weight:bold">;</span><span style="color:#000">chown</span><span style="color:#ce5c00;font-weight:bold">=</span>nobody:nogroup       <span style="color:#000;font-weight:bold">;</span> socket file uid:gid owner
</span></span><span style="display:flex;"><span><span style="color:#000;font-weight:bold">;</span><span style="color:#000">username</span><span style="color:#ce5c00;font-weight:bold">=</span>user              <span style="color:#000;font-weight:bold">;</span> <span style="color:#ce5c00;font-weight:bold">(</span>default is no username <span style="color:#ce5c00;font-weight:bold">(</span>open server<span style="color:#ce5c00;font-weight:bold">))</span>
</span></span><span style="display:flex;"><span><span style="color:#000;font-weight:bold">;</span><span style="color:#000">password</span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#0000cf;font-weight:bold">123</span>               <span style="color:#000;font-weight:bold">;</span> <span style="color:#ce5c00;font-weight:bold">(</span>default is no password <span style="color:#ce5c00;font-weight:bold">(</span>open server<span style="color:#ce5c00;font-weight:bold">))</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#000;font-weight:bold">;</span><span style="color:#ce5c00;font-weight:bold">[</span>inet_http_server<span style="color:#ce5c00;font-weight:bold">]</span>         <span style="color:#000;font-weight:bold">;</span> inet <span style="color:#ce5c00;font-weight:bold">(</span>TCP<span style="color:#ce5c00;font-weight:bold">)</span> server disabled by default
</span></span><span style="display:flex;"><span><span style="color:#000;font-weight:bold">;</span><span style="color:#000">port</span><span style="color:#ce5c00;font-weight:bold">=</span>127.0.0.1:9001        <span style="color:#000;font-weight:bold">;</span> <span style="color:#ce5c00;font-weight:bold">(</span>ip_address:port specifier, *:port <span style="color:#204a87;font-weight:bold">for</span> all iface<span style="color:#ce5c00;font-weight:bold">)</span>
</span></span><span style="display:flex;"><span><span style="color:#000;font-weight:bold">;</span><span style="color:#000">username</span><span style="color:#ce5c00;font-weight:bold">=</span>user              <span style="color:#000;font-weight:bold">;</span> <span style="color:#ce5c00;font-weight:bold">(</span>default is no username <span style="color:#ce5c00;font-weight:bold">(</span>open server<span style="color:#ce5c00;font-weight:bold">))</span>
</span></span><span style="display:flex;"><span><span style="color:#000;font-weight:bold">;</span><span style="color:#000">password</span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#0000cf;font-weight:bold">123</span>               <span style="color:#000;font-weight:bold">;</span> <span style="color:#ce5c00;font-weight:bold">(</span>default is no password <span style="color:#ce5c00;font-weight:bold">(</span>open server<span style="color:#ce5c00;font-weight:bold">))</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#ce5c00;font-weight:bold">[</span>supervisord<span style="color:#ce5c00;font-weight:bold">]</span>
</span></span><span style="display:flex;"><span><span style="color:#000">logfile</span><span style="color:#ce5c00;font-weight:bold">=</span>/var/log/supervisor/supervisord.log  <span style="color:#000;font-weight:bold">;</span> <span style="color:#ce5c00;font-weight:bold">(</span>main log file<span style="color:#000;font-weight:bold">;</span>default <span style="color:#000">$CWD</span>/supervisord.log<span style="color:#ce5c00;font-weight:bold">)</span>
</span></span><span style="display:flex;"><span><span style="color:#000">logfile_maxbytes</span><span style="color:#ce5c00;font-weight:bold">=</span>50MB       <span style="color:#000;font-weight:bold">;</span> <span style="color:#ce5c00;font-weight:bold">(</span>max main logfile bytes b4 rotation<span style="color:#000;font-weight:bold">;</span>default 50MB<span style="color:#ce5c00;font-weight:bold">)</span>
</span></span><span style="display:flex;"><span><span style="color:#000">logfile_backups</span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#0000cf;font-weight:bold">10</span>          <span style="color:#000;font-weight:bold">;</span> <span style="color:#ce5c00;font-weight:bold">(</span>num of main logfile rotation backups<span style="color:#000;font-weight:bold">;</span>default 10<span style="color:#ce5c00;font-weight:bold">)</span>
</span></span><span style="display:flex;"><span><span style="color:#000">loglevel</span><span style="color:#ce5c00;font-weight:bold">=</span>info               <span style="color:#000;font-weight:bold">;</span> <span style="color:#ce5c00;font-weight:bold">(</span>log level<span style="color:#000;font-weight:bold">;</span>default info<span style="color:#000;font-weight:bold">;</span> others: debug,warn,trace<span style="color:#ce5c00;font-weight:bold">)</span>
</span></span><span style="display:flex;"><span><span style="color:#000">pidfile</span><span style="color:#ce5c00;font-weight:bold">=</span>/var/run/supervisord.pid <span style="color:#000;font-weight:bold">;</span> <span style="color:#ce5c00;font-weight:bold">(</span>supervisord pidfile<span style="color:#000;font-weight:bold">;</span>default supervisord.pid<span style="color:#ce5c00;font-weight:bold">)</span>
</span></span><span style="display:flex;"><span><span style="color:#000">nodaemon</span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#204a87">false</span>              <span style="color:#000;font-weight:bold">;</span> <span style="color:#ce5c00;font-weight:bold">(</span>start in foreground <span style="color:#204a87;font-weight:bold">if</span> true<span style="color:#000;font-weight:bold">;</span>default <span style="color:#204a87">false</span><span style="color:#ce5c00;font-weight:bold">)</span>
</span></span><span style="display:flex;"><span><span style="color:#000">minfds</span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#0000cf;font-weight:bold">1024</span>                 <span style="color:#000;font-weight:bold">;</span> <span style="color:#ce5c00;font-weight:bold">(</span>min. avail startup file descriptors<span style="color:#000;font-weight:bold">;</span>default 1024<span style="color:#ce5c00;font-weight:bold">)</span>
</span></span><span style="display:flex;"><span><span style="color:#000">minprocs</span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#0000cf;font-weight:bold">200</span>                <span style="color:#000;font-weight:bold">;</span> <span style="color:#ce5c00;font-weight:bold">(</span>min. avail process descriptors<span style="color:#000;font-weight:bold">;</span>default 200<span style="color:#ce5c00;font-weight:bold">)</span>
</span></span><span style="display:flex;"><span><span style="color:#000;font-weight:bold">;</span><span style="color:#000">umask</span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#0000cf;font-weight:bold">022</span>                  <span style="color:#000;font-weight:bold">;</span> <span style="color:#ce5c00;font-weight:bold">(</span>process file creation umask<span style="color:#000;font-weight:bold">;</span>default 022<span style="color:#ce5c00;font-weight:bold">)</span>
</span></span><span style="display:flex;"><span><span style="color:#000;font-weight:bold">;</span><span style="color:#000">user</span><span style="color:#ce5c00;font-weight:bold">=</span>chrism                 <span style="color:#000;font-weight:bold">;</span> <span style="color:#ce5c00;font-weight:bold">(</span>default is current user, required <span style="color:#204a87;font-weight:bold">if</span> root<span style="color:#ce5c00;font-weight:bold">)</span>
</span></span><span style="display:flex;"><span><span style="color:#000;font-weight:bold">;</span><span style="color:#000">identifier</span><span style="color:#ce5c00;font-weight:bold">=</span>supervisor       <span style="color:#000;font-weight:bold">;</span> <span style="color:#ce5c00;font-weight:bold">(</span>supervisord identifier, default is <span style="color:#4e9a06">&#39;supervisor&#39;</span><span style="color:#ce5c00;font-weight:bold">)</span>
</span></span><span style="display:flex;"><span><span style="color:#000;font-weight:bold">;</span><span style="color:#000">directory</span><span style="color:#ce5c00;font-weight:bold">=</span>/tmp              <span style="color:#000;font-weight:bold">;</span> <span style="color:#ce5c00;font-weight:bold">(</span>default is not to <span style="color:#204a87">cd</span> during start<span style="color:#ce5c00;font-weight:bold">)</span>
</span></span><span style="display:flex;"><span><span style="color:#000;font-weight:bold">;</span><span style="color:#000">nocleanup</span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#204a87">true</span>              <span style="color:#000;font-weight:bold">;</span> <span style="color:#ce5c00;font-weight:bold">(</span>don<span style="color:#4e9a06">&#39;t clean up tempfiles at start;default false)
</span></span></span><span style="display:flex;"><span><span style="color:#4e9a06">;childlogdir=/tmp            ; (&#39;</span>AUTO<span style="color:#4e9a06">&#39; child log dir, default $TEMP)
</span></span></span><span style="display:flex;"><span><span style="color:#4e9a06">;environment=KEY=value       ; (key value pairs to add to environment)
</span></span></span><span style="display:flex;"><span><span style="color:#4e9a06">;strip_ansi=false            ; (strip ansi escape codes in logs; def. false)
</span></span></span><span style="display:flex;"><span><span style="color:#4e9a06">
</span></span></span><span style="display:flex;"><span><span style="color:#4e9a06">; the below section must remain in the config file for RPC
</span></span></span><span style="display:flex;"><span><span style="color:#4e9a06">; (supervisorctl/web interface) to work, additional interfaces may be
</span></span></span><span style="display:flex;"><span><span style="color:#4e9a06">; added by defining them in separate rpcinterface: sections
</span></span></span><span style="display:flex;"><span><span style="color:#4e9a06">[rpcinterface:supervisor]
</span></span></span><span style="display:flex;"><span><span style="color:#4e9a06">supervisor.rpcinterface_factory = supervisor.rpcinterface:make_main_rpcinterface
</span></span></span><span style="display:flex;"><span><span style="color:#4e9a06">
</span></span></span><span style="display:flex;"><span><span style="color:#4e9a06">[supervisorctl]
</span></span></span><span style="display:flex;"><span><span style="color:#4e9a06">serverurl=unix:///var/run/supervisor/supervisor.sock ; use a unix:// URL  for a unix socket
</span></span></span><span style="display:flex;"><span><span style="color:#4e9a06">;serverurl=http://127.0.0.1:9001 ; use an http:// url to specify an inet socket
</span></span></span><span style="display:flex;"><span><span style="color:#4e9a06">;username=chris              ; should be same as http_username if set
</span></span></span><span style="display:flex;"><span><span style="color:#4e9a06">;password=123                ; should be same as http_password if set
</span></span></span><span style="display:flex;"><span><span style="color:#4e9a06">;prompt=mysupervisor         ; cmd line prompt (default &#34;supervisor&#34;)
</span></span></span><span style="display:flex;"><span><span style="color:#4e9a06">;history_file=~/.sc_history  ; use readline history if available
</span></span></span><span style="display:flex;"><span><span style="color:#4e9a06">
</span></span></span><span style="display:flex;"><span><span style="color:#4e9a06">; The below sample program section shows all possible program subsection values,
</span></span></span><span style="display:flex;"><span><span style="color:#4e9a06">; create one or more &#39;</span>real<span style="color:#4e9a06">&#39; program: sections to be able to control them under
</span></span></span><span style="display:flex;"><span><span style="color:#4e9a06">; supervisor.
</span></span></span><span style="display:flex;"><span><span style="color:#4e9a06">
</span></span></span><span style="display:flex;"><span><span style="color:#4e9a06">;[program:theprogramname]
</span></span></span><span style="display:flex;"><span><span style="color:#4e9a06">;command=/bin/cat              ; the program (relative uses PATH, can take args)
</span></span></span><span style="display:flex;"><span><span style="color:#4e9a06">;process_name=%(program_name)s ; process_name expr (default %(program_name)s)
</span></span></span><span style="display:flex;"><span><span style="color:#4e9a06">;numprocs=1                    ; number of processes copies to start (def 1)
</span></span></span><span style="display:flex;"><span><span style="color:#4e9a06">;directory=/tmp                ; directory to cwd to before exec (def no cwd)
</span></span></span><span style="display:flex;"><span><span style="color:#4e9a06">;umask=022                     ; umask for process (default None)
</span></span></span><span style="display:flex;"><span><span style="color:#4e9a06">;priority=999                  ; the relative start priority (default 999)
</span></span></span><span style="display:flex;"><span><span style="color:#4e9a06">;autostart=true                ; start at supervisord start (default: true)
</span></span></span><span style="display:flex;"><span><span style="color:#4e9a06">;autorestart=true              ; retstart at unexpected quit (default: true)
</span></span></span><span style="display:flex;"><span><span style="color:#4e9a06">;startsecs=10                  ; number of secs prog must stay running (def. 1)
</span></span></span><span style="display:flex;"><span><span style="color:#4e9a06">;startretries=3                ; max # of serial start failures (default 3)
</span></span></span><span style="display:flex;"><span><span style="color:#4e9a06">;exitcodes=0,2                 ; &#39;</span>expected<span style="color:#4e9a06">&#39; exit codes for process (default 0,2)
</span></span></span><span style="display:flex;"><span><span style="color:#4e9a06">;stopsignal=QUIT               ; signal used to kill process (default TERM)
</span></span></span><span style="display:flex;"><span><span style="color:#4e9a06">;stopwaitsecs=10               ; max num secs to wait b4 SIGKILL (default 10)
</span></span></span><span style="display:flex;"><span><span style="color:#4e9a06">;user=chrism                   ; setuid to this UNIX account to run the program
</span></span></span><span style="display:flex;"><span><span style="color:#4e9a06">;redirect_stderr=true          ; redirect proc stderr to stdout (default false)
</span></span></span><span style="display:flex;"><span><span style="color:#4e9a06">;stdout_logfile=/a/path        ; stdout log path, NONE for none; default AUTO
</span></span></span><span style="display:flex;"><span><span style="color:#4e9a06">;stdout_logfile_maxbytes=1MB   ; max # logfile bytes b4 rotation (default 50MB)
</span></span></span><span style="display:flex;"><span><span style="color:#4e9a06">;stdout_logfile_backups=10     ; # of stdout logfile backups (default 10)
</span></span></span><span style="display:flex;"><span><span style="color:#4e9a06">;stdout_capture_maxbytes=1MB   ; number of bytes in &#39;</span>capturemode<span style="color:#4e9a06">&#39; (default 0)
</span></span></span><span style="display:flex;"><span><span style="color:#4e9a06">;stdout_events_enabled=false   ; emit events on stdout writes (default false)
</span></span></span><span style="display:flex;"><span><span style="color:#4e9a06">;stderr_logfile=/a/path        ; stderr log path, NONE for none; default AUTO
</span></span></span><span style="display:flex;"><span><span style="color:#4e9a06">;stderr_logfile_maxbytes=1MB   ; max # logfile bytes b4 rotation (default 50MB)
</span></span></span><span style="display:flex;"><span><span style="color:#4e9a06">;stderr_logfile_backups=10     ; # of stderr logfile backups (default 10)
</span></span></span><span style="display:flex;"><span><span style="color:#4e9a06">;stderr_capture_maxbytes=1MB   ; number of bytes in &#39;</span>capturemode<span style="color:#4e9a06">&#39; (default 0)
</span></span></span><span style="display:flex;"><span><span style="color:#4e9a06">;stderr_events_enabled=false   ; emit events on stderr writes (default false)
</span></span></span><span style="display:flex;"><span><span style="color:#4e9a06">;environment=A=1,B=2           ; process environment additions (def no adds)
</span></span></span><span style="display:flex;"><span><span style="color:#4e9a06">;serverurl=AUTO                ; override serverurl computation (childutils)
</span></span></span><span style="display:flex;"><span><span style="color:#4e9a06">
</span></span></span><span style="display:flex;"><span><span style="color:#4e9a06">; The below sample eventlistener section shows all possible
</span></span></span><span style="display:flex;"><span><span style="color:#4e9a06">; eventlistener subsection values, create one or more &#39;</span>real<span style="color:#4e9a06">&#39;
</span></span></span><span style="display:flex;"><span><span style="color:#4e9a06">; eventlistener: sections to be able to handle event notifications
</span></span></span><span style="display:flex;"><span><span style="color:#4e9a06">; sent by supervisor.
</span></span></span><span style="display:flex;"><span><span style="color:#4e9a06">
</span></span></span><span style="display:flex;"><span><span style="color:#4e9a06">;[eventlistener:theeventlistenername]
</span></span></span><span style="display:flex;"><span><span style="color:#4e9a06">;command=/bin/eventlistener    ; the program (relative uses PATH, can take args)
</span></span></span><span style="display:flex;"><span><span style="color:#4e9a06">;process_name=%(program_name)s ; process_name expr (default %(program_name)s)
</span></span></span><span style="display:flex;"><span><span style="color:#4e9a06">;numprocs=1                    ; number of processes copies to start (def 1)
</span></span></span><span style="display:flex;"><span><span style="color:#4e9a06">;events=EVENT                  ; event notif. types to subscribe to (req&#39;</span>d<span style="color:#ce5c00;font-weight:bold">)</span>
</span></span><span style="display:flex;"><span><span style="color:#000;font-weight:bold">;</span><span style="color:#000">buffer_size</span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#0000cf;font-weight:bold">10</span>                <span style="color:#000;font-weight:bold">;</span> event buffer queue size <span style="color:#ce5c00;font-weight:bold">(</span>default 10<span style="color:#ce5c00;font-weight:bold">)</span>
</span></span><span style="display:flex;"><span><span style="color:#000;font-weight:bold">;</span><span style="color:#000">directory</span><span style="color:#ce5c00;font-weight:bold">=</span>/tmp                <span style="color:#000;font-weight:bold">;</span> directory to cwd to before <span style="color:#204a87">exec</span> <span style="color:#ce5c00;font-weight:bold">(</span>def no cwd<span style="color:#ce5c00;font-weight:bold">)</span>
</span></span><span style="display:flex;"><span><span style="color:#000;font-weight:bold">;</span><span style="color:#000">umask</span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#0000cf;font-weight:bold">022</span>                     <span style="color:#000;font-weight:bold">;</span> <span style="color:#204a87">umask</span> <span style="color:#204a87;font-weight:bold">for</span> process <span style="color:#ce5c00;font-weight:bold">(</span>default None<span style="color:#ce5c00;font-weight:bold">)</span>
</span></span><span style="display:flex;"><span><span style="color:#000;font-weight:bold">;</span><span style="color:#000">priority</span><span style="color:#ce5c00;font-weight:bold">=</span>-1                   <span style="color:#000;font-weight:bold">;</span> the relative start priority <span style="color:#ce5c00;font-weight:bold">(</span>default -1<span style="color:#ce5c00;font-weight:bold">)</span>
</span></span><span style="display:flex;"><span><span style="color:#000;font-weight:bold">;</span><span style="color:#000">autostart</span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#204a87">true</span>                <span style="color:#000;font-weight:bold">;</span> start at supervisord start <span style="color:#ce5c00;font-weight:bold">(</span>default: <span style="color:#204a87">true</span><span style="color:#ce5c00;font-weight:bold">)</span>
</span></span><span style="display:flex;"><span><span style="color:#000;font-weight:bold">;</span><span style="color:#000">autorestart</span><span style="color:#ce5c00;font-weight:bold">=</span>unexpected        <span style="color:#000;font-weight:bold">;</span> restart at unexpected quit <span style="color:#ce5c00;font-weight:bold">(</span>default: unexpected<span style="color:#ce5c00;font-weight:bold">)</span>
</span></span><span style="display:flex;"><span><span style="color:#000;font-weight:bold">;</span><span style="color:#000">startsecs</span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#0000cf;font-weight:bold">10</span>                  <span style="color:#000;font-weight:bold">;</span> number of secs prog must stay running <span style="color:#ce5c00;font-weight:bold">(</span>def. 1<span style="color:#ce5c00;font-weight:bold">)</span>
</span></span><span style="display:flex;"><span><span style="color:#000;font-weight:bold">;</span><span style="color:#000">startretries</span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#0000cf;font-weight:bold">3</span>                <span style="color:#000;font-weight:bold">;</span> max <span style="color:#8f5902;font-style:italic"># of serial start failures (default 3)</span>
</span></span><span style="display:flex;"><span><span style="color:#000;font-weight:bold">;</span><span style="color:#000">exitcodes</span><span style="color:#ce5c00;font-weight:bold">=</span>0,2                 <span style="color:#000;font-weight:bold">;</span> <span style="color:#4e9a06">&#39;expected&#39;</span> <span style="color:#204a87">exit</span> codes <span style="color:#204a87;font-weight:bold">for</span> process <span style="color:#ce5c00;font-weight:bold">(</span>default 0,2<span style="color:#ce5c00;font-weight:bold">)</span>
</span></span><span style="display:flex;"><span><span style="color:#000;font-weight:bold">;</span><span style="color:#000">stopsignal</span><span style="color:#ce5c00;font-weight:bold">=</span>QUIT               <span style="color:#000;font-weight:bold">;</span> signal used to <span style="color:#204a87">kill</span> process <span style="color:#ce5c00;font-weight:bold">(</span>default TERM<span style="color:#ce5c00;font-weight:bold">)</span>
</span></span><span style="display:flex;"><span><span style="color:#000;font-weight:bold">;</span><span style="color:#000">stopwaitsecs</span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#0000cf;font-weight:bold">10</span>               <span style="color:#000;font-weight:bold">;</span> max num secs to <span style="color:#204a87">wait</span> b4 SIGKILL <span style="color:#ce5c00;font-weight:bold">(</span>default 10<span style="color:#ce5c00;font-weight:bold">)</span>
</span></span><span style="display:flex;"><span><span style="color:#000;font-weight:bold">;</span><span style="color:#000">user</span><span style="color:#ce5c00;font-weight:bold">=</span>chrism                   <span style="color:#000;font-weight:bold">;</span> setuid to this UNIX account to run the program
</span></span><span style="display:flex;"><span><span style="color:#000;font-weight:bold">;</span><span style="color:#000">redirect_stderr</span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#204a87">true</span>          <span style="color:#000;font-weight:bold">;</span> redirect proc stderr to stdout <span style="color:#ce5c00;font-weight:bold">(</span>default <span style="color:#204a87">false</span><span style="color:#ce5c00;font-weight:bold">)</span>
</span></span><span style="display:flex;"><span><span style="color:#000;font-weight:bold">;</span><span style="color:#000">stdout_logfile</span><span style="color:#ce5c00;font-weight:bold">=</span>/a/path        <span style="color:#000;font-weight:bold">;</span> stdout log path, NONE <span style="color:#204a87;font-weight:bold">for</span> none<span style="color:#000;font-weight:bold">;</span> default AUTO
</span></span><span style="display:flex;"><span><span style="color:#000;font-weight:bold">;</span><span style="color:#000">stdout_logfile_maxbytes</span><span style="color:#ce5c00;font-weight:bold">=</span>1MB   <span style="color:#000;font-weight:bold">;</span> max <span style="color:#8f5902;font-style:italic"># logfile bytes b4 rotation (default 50MB)</span>
</span></span><span style="display:flex;"><span><span style="color:#000;font-weight:bold">;</span><span style="color:#000">stdout_logfile_backups</span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#0000cf;font-weight:bold">10</span>     <span style="color:#000;font-weight:bold">;</span> <span style="color:#8f5902;font-style:italic"># of stdout logfile backups (default 10)</span>
</span></span><span style="display:flex;"><span><span style="color:#000;font-weight:bold">;</span><span style="color:#000">stdout_events_enabled</span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#204a87">false</span>   <span style="color:#000;font-weight:bold">;</span> emit events on stdout writes <span style="color:#ce5c00;font-weight:bold">(</span>default <span style="color:#204a87">false</span><span style="color:#ce5c00;font-weight:bold">)</span>
</span></span><span style="display:flex;"><span><span style="color:#000;font-weight:bold">;</span><span style="color:#000">stderr_logfile</span><span style="color:#ce5c00;font-weight:bold">=</span>/a/path        <span style="color:#000;font-weight:bold">;</span> stderr log path, NONE <span style="color:#204a87;font-weight:bold">for</span> none<span style="color:#000;font-weight:bold">;</span> default AUTO
</span></span><span style="display:flex;"><span><span style="color:#000;font-weight:bold">;</span><span style="color:#000">stderr_logfile_maxbytes</span><span style="color:#ce5c00;font-weight:bold">=</span>1MB   <span style="color:#000;font-weight:bold">;</span> max <span style="color:#8f5902;font-style:italic"># logfile bytes b4 rotation (default 50MB)</span>
</span></span><span style="display:flex;"><span><span style="color:#000;font-weight:bold">;</span>stderr_logfile_backups        <span style="color:#000;font-weight:bold">;</span> <span style="color:#8f5902;font-style:italic"># of stderr logfile backups (default 10)</span>
</span></span><span style="display:flex;"><span><span style="color:#000;font-weight:bold">;</span><span style="color:#000">stderr_events_enabled</span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#204a87">false</span>   <span style="color:#000;font-weight:bold">;</span> emit events on stderr writes <span style="color:#ce5c00;font-weight:bold">(</span>default <span style="color:#204a87">false</span><span style="color:#ce5c00;font-weight:bold">)</span>
</span></span><span style="display:flex;"><span><span style="color:#000;font-weight:bold">;</span><span style="color:#000">environment</span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#000">A</span><span style="color:#ce5c00;font-weight:bold">=</span>1,B<span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#0000cf;font-weight:bold">2</span>           <span style="color:#000;font-weight:bold">;</span> process environment additions
</span></span><span style="display:flex;"><span><span style="color:#000;font-weight:bold">;</span><span style="color:#000">serverurl</span><span style="color:#ce5c00;font-weight:bold">=</span>AUTO                <span style="color:#000;font-weight:bold">;</span> override serverurl computation <span style="color:#ce5c00;font-weight:bold">(</span>childutils<span style="color:#ce5c00;font-weight:bold">)</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#000;font-weight:bold">;</span> The below sample group section shows all possible group values,
</span></span><span style="display:flex;"><span><span style="color:#000;font-weight:bold">;</span> create one or more <span style="color:#4e9a06">&#39;real&#39;</span> group: sections to create <span style="color:#4e9a06">&#34;heterogeneous&#34;</span>
</span></span><span style="display:flex;"><span><span style="color:#000;font-weight:bold">;</span> process groups.
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#000;font-weight:bold">;</span><span style="color:#ce5c00;font-weight:bold">[</span>group:thegroupname<span style="color:#ce5c00;font-weight:bold">]</span>
</span></span><span style="display:flex;"><span><span style="color:#000;font-weight:bold">;</span><span style="color:#000">programs</span><span style="color:#ce5c00;font-weight:bold">=</span>progname1,progname2  <span style="color:#000;font-weight:bold">;</span> each refers to <span style="color:#4e9a06">&#39;x&#39;</span> in <span style="color:#ce5c00;font-weight:bold">[</span>program:x<span style="color:#ce5c00;font-weight:bold">]</span> definitions
</span></span><span style="display:flex;"><span><span style="color:#000;font-weight:bold">;</span><span style="color:#000">priority</span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#0000cf;font-weight:bold">999</span>                  <span style="color:#000;font-weight:bold">;</span> the relative start priority <span style="color:#ce5c00;font-weight:bold">(</span>default 999<span style="color:#ce5c00;font-weight:bold">)</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#000;font-weight:bold">;</span> The <span style="color:#ce5c00;font-weight:bold">[</span>include<span style="color:#ce5c00;font-weight:bold">]</span> section can just contain the <span style="color:#4e9a06">&#34;files&#34;</span> setting.  This
</span></span><span style="display:flex;"><span><span style="color:#000;font-weight:bold">;</span> setting can list multiple files <span style="color:#ce5c00;font-weight:bold">(</span>separated by whitespace or
</span></span><span style="display:flex;"><span><span style="color:#000;font-weight:bold">;</span> newlines<span style="color:#ce5c00;font-weight:bold">)</span>.  It can also contain wildcards.  The filenames are
</span></span><span style="display:flex;"><span><span style="color:#000;font-weight:bold">;</span> interpreted as relative to this file.  Included files *cannot*
</span></span><span style="display:flex;"><span><span style="color:#000;font-weight:bold">;</span> include files themselves.
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#ce5c00;font-weight:bold">[</span>include<span style="color:#ce5c00;font-weight:bold">]</span>
</span></span><span style="display:flex;"><span><span style="color:#000">files</span> <span style="color:#ce5c00;font-weight:bold">=</span> supervisord.d/conf/*.conf
</span></span></code></pre></div><p>参考：</p>
<p><a href="http://supervisord.org/">http://supervisord.org/</a></p>

</div>



    
	
  



          </main>
        </div>
      </div>
      
<footer class="bg-dark py-5 row d-print-none">
  <div class="container-fluid mx-sm-5">
    <div class="row">
      <div class="col-6 col-sm-4 text-xs-center order-sm-2">
        
        
        
      </div>
      <div class="col-6 col-sm-4 text-right text-xs-center order-sm-3">
        
        
        
<ul class="list-inline mb-0">
  
  <li class="list-inline-item mx-2 h3" data-toggle="tooltip" data-placement="top" title="GitHub" aria-label="GitHub">
    <a class="text-white" target="_blank" rel="noopener" href="https://github.com/huweihuang/blog.huweihuang.com" aria-label="GitHub">
      <i class="fab fa-github"></i>
    </a>
  </li>
  
</ul>

        
        
      </div>
      <div class="col-12 col-sm-4 text-center py-2 order-sm-2">
        <small class="text-white">&copy; 2025 www.huweihuang.com 保留所有权利</small>
        <small class="ml-1"><a href="https://policies.google.com/privacy" target="_blank" rel="noopener">隐私政策</a></small>
	
		<p class="mt-2"><a href="/about/">About</a></p>
	
      </div>
    </div>
  </div>
</footer>


    </div>
    <script src="https://cdn.jsdelivr.net/npm/popper.js@1.16.1/dist/umd/popper.min.js"
    integrity="sha384-9/reFTGAW83EW2RDu2S0VKaIzap3H66lZH81PoYlFhbGU+6BZp6G7niu735Sk7lN"
    crossorigin="anonymous"></script>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@4.6.1/dist/js/bootstrap.min.js"
    integrity="sha512-UR25UO94eTnCVwjbXozyeVd6ZqpaAE9naiEUBK/A+QDbfSTQFhPGj5lOR6d8tsgbBk84Ggb5A3EkjsOgPRPcKA=="
    crossorigin="anonymous"></script>





<script src='/js/tabpane-persist.js'></script>




















<script src="/js/main.min.91798a335c881f1b6b805085ba4aa22d1dbd2b0b18d105d05189fa104ddae350.js" integrity="sha256-kXmKM1yIHxtrgFCFukqiLR29KwsY0QXQUYn6EE3a41A=" crossorigin="anonymous"></script>



<script src='/js/prism.js'></script>



  </body>
</html>

<!doctype html>
<html lang="zh-cn" class="no-js">
  <head>
    <meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="generator" content="Hugo 0.101.0" />
<link rel="canonical" type="text/html" href="https://blog.huweihuang.com/linux-notes/disk/">
<link rel="alternate" type="application/rss&#43;xml" href="https://blog.huweihuang.com/linux-notes/disk/index.xml">
<meta name="robots" content="noindex, nofollow">


<link rel="shortcut icon" href="/favicons/favicon.ico" >
<link rel="apple-touch-icon" href="/favicons/apple-touch-icon-180x180.png" sizes="180x180">
<link rel="icon" type="image/png" href="/favicons/favicon-16x16.png" sizes="16x16">
<link rel="icon" type="image/png" href="/favicons/favicon-32x32.png" sizes="32x32">
<link rel="icon" type="image/png" href="/favicons/android-36x36.png" sizes="36x36">
<link rel="icon" type="image/png" href="/favicons/android-48x48.png" sizes="48x48">
<link rel="icon" type="image/png" href="/favicons/android-72x72.png" sizes="72x72">
<link rel="icon" type="image/png" href="/favicons/android-96x96.png" sizes="96x96">
<link rel="icon" type="image/png" href="/favicons/android-144x144.png" sizes="144x144">
<link rel="icon" type="image/png" href="/favicons/android-192x192.png" sizes="192x192">

<title>磁盘 | 胡伟煌</title>
<meta name="description" content="">
<meta property="og:title" content="磁盘" />
<meta property="og:description" content="Kubernetes学习笔记" />
<meta property="og:type" content="website" />
<meta property="og:url" content="https://blog.huweihuang.com/linux-notes/disk/" /><meta property="og:site_name" content="胡伟煌" />

<meta itemprop="name" content="磁盘">
<meta itemprop="description" content="Kubernetes学习笔记"><meta name="twitter:card" content="summary"/>
<meta name="twitter:title" content="磁盘"/>
<meta name="twitter:description" content="Kubernetes学习笔记"/>




<link rel="preload" href="/scss/main.min.79e3930541ca05b5395c14b2a313b798fad1dc69f9a14aefa57b62eaa9f65f14.css" as="style">
<link href="/scss/main.min.79e3930541ca05b5395c14b2a313b798fad1dc69f9a14aefa57b62eaa9f65f14.css" rel="stylesheet" integrity="">

<script
  src="https://code.jquery.com/jquery-3.6.0.min.js"
  integrity="sha384-vtXRMe3mGCbOeY7l30aIg8H9p3GdeSe4IFlP6G8JMa7o7lXvnz3GFKzPxzJdPfGK"
  crossorigin="anonymous"></script>
<script
  src="https://unpkg.com/lunr@2.3.9/lunr.min.js"
  integrity="sha384-203J0SNzyqHby3iU6hzvzltrWi/M41wOP5Gu+BiJMz5nwKykbkUx8Kp7iti0Lpli"
  crossorigin="anonymous"></script>
<link rel="stylesheet" href="/css/prism.css"/>

<script type="application/javascript">
var doNotTrack = false;
if (!doNotTrack) {
	window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)};ga.l=+new Date;
	ga('create', 'UA-114718458-1', 'auto');
	
	ga('send', 'pageview');
}
</script>
<script async src='https://www.google-analytics.com/analytics.js'></script>

  </head>
  <body class="td-section">
    <header>
      
<nav class="js-navbar-scroll navbar navbar-expand navbar-dark flex-column flex-md-row td-navbar">
        <a class="navbar-brand" href="/">
		<span class="navbar-logo"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 32 32" width="64" height="64"><path d="M15.9.476a2.14 2.14.0 00-.823.218L3.932 6.01c-.582.277-1.005.804-1.15 1.432L.054 19.373c-.13.56-.025 1.147.3 1.627q.057.087.12.168l7.7 9.574c.407.5 1.018.787 1.662.784h12.35c.646.001 1.258-.3 1.664-.793l7.696-9.576c.404-.5.555-1.16.4-1.786L29.2 7.43c-.145-.628-.57-1.155-1.15-1.432L16.923.695A2.14 2.14.0 0015.89.476z" fill="#326ce5"/><path d="M16.002 4.542c-.384.027-.675.356-.655.74v.188c.018.213.05.424.092.633a6.22 6.22.0 01.066 1.21c-.038.133-.114.253-.218.345l-.015.282c-.405.034-.807.096-1.203.186-1.666.376-3.183 1.24-4.354 2.485l-.24-.17c-.132.04-.274.025-.395-.04a6.22 6.22.0 01-.897-.81 5.55 5.55.0 00-.437-.465l-.148-.118c-.132-.106-.294-.167-.463-.175a.64.64.0 00-.531.236c-.226.317-.152.756.164.983l.138.11a5.55 5.55.0 00.552.323c.354.197.688.428.998.7a.74.74.0 01.133.384l.218.2c-1.177 1.766-1.66 3.905-1.358 6.006l-.28.08c-.073.116-.17.215-.286.288a6.22 6.22.0 01-1.194.197 5.57 5.57.0 00-.64.05l-.177.04h-.02a.67.67.0 00-.387 1.132.67.67.0 00.684.165h.013l.18-.02c.203-.06.403-.134.598-.218.375-.15.764-.265 1.162-.34.138.008.27.055.382.135l.3-.05c.65 2.017 2.016 3.726 3.84 4.803l-.122.255c.056.117.077.247.06.376-.165.382-.367.748-.603 1.092a5.58 5.58.0 00-.358.533l-.085.18a.67.67.0 00.65 1.001.67.67.0 00.553-.432l.083-.17c.076-.2.14-.404.192-.61.177-.437.273-.906.515-1.196a.54.54.0 01.286-.14l.15-.273a8.62 8.62.0 006.146.015l.133.255c.136.02.258.095.34.205.188.358.34.733.456 1.12a5.57 5.57.0 00.194.611l.083.17a.67.67.0 001.187.131.67.67.0 00.016-.701l-.087-.18a5.55 5.55.0 00-.358-.531c-.23-.332-.428-.686-.6-1.057a.52.52.0 01.068-.4 2.29 2.29.0 01-.111-.269c1.82-1.085 3.18-2.8 3.823-4.82l.284.05c.102-.093.236-.142.373-.138.397.076.786.2 1.162.34.195.09.395.166.598.23.048.013.118.024.172.037h.013a.67.67.0 00.841-.851.67.67.0 00-.544-.446l-.194-.046a5.57 5.57.0 00-.64-.05c-.404-.026-.804-.092-1.194-.197-.12-.067-.22-.167-.288-.288l-.27-.08a8.65 8.65.0 00-1.386-5.993l.236-.218c-.01-.137.035-.273.124-.378.307-.264.64-.497.99-.696a5.57 5.57.0 00.552-.323l.146-.118a.67.67.0 00-.133-1.202.67.67.0 00-.696.161l-.148.118a5.57 5.57.0 00-.437.465c-.264.302-.556.577-.873.823a.74.74.0 01-.404.044l-.253.18c-1.46-1.53-3.427-2.48-5.535-2.67.0-.1-.013-.25-.015-.297-.113-.078-.192-.197-.218-.332a6.23 6.23.0 01.076-1.207c.043-.21.073-.42.092-.633v-.2c.02-.384-.27-.713-.655-.74zm-.834 5.166-.2 3.493h-.015c-.01.216-.137.4-.332.504s-.426.073-.6-.054l-2.865-2.03a6.86 6.86.0 013.303-1.799c.234-.05.47-.088.707-.114zm1.668.0c1.505.187 2.906.863 3.99 1.924l-2.838 2.017c-.175.14-.415.168-.618.072s-.333-.3-.336-.524zm-6.72 3.227 2.62 2.338v.015c.163.142.234.363.186.574s-.21.378-.417.435v.01l-3.362.967a6.86 6.86.0 01.974-4.34zm11.753.0c.796 1.295 1.148 2.814 1.002 4.327l-3.367-.97v-.013c-.21-.057-.37-.224-.417-.435s.023-.43.186-.574l2.6-2.327zm-6.404 2.52h1.072l.655.832-.238 1.04-.963.463-.965-.463-.227-1.04zm3.434 2.838c.045-.005.1-.005.135.0l3.467.585c-.5 1.44-1.487 2.67-2.775 3.493l-1.34-3.244a.59.59.0 01.509-.819zm-5.823.015c.196.003.377.104.484.268s.124.37.047.55v.013l-1.332 3.218C11 21.54 10.032 20.325 9.517 18.9l3.437-.583c.038-.004.077-.004.116.0zm2.904 1.4a.59.59.0 01.537.308h.013l1.694 3.057-.677.2c-1.246.285-2.547.218-3.758-.194l1.7-3.057c.103-.18.293-.29.5-.295z" fill="#fff" stroke="#fff" stroke-width=".055"/></svg></span><span class="font-weight-bold">胡伟煌</span>
	</a>
	<div class="td-navbar-nav-scroll ml-md-auto" id="main_navbar">
		<ul class="navbar-nav mt-2 mt-lg-0">
			
			
			<li class="nav-item mr-4 mb-2 mb-lg-0">
				
				
				
				
				
				
				
				
				<a class="nav-link" href="/kubernetes-notes/" ><span>Kubernetes学习笔记</span></a>
			</li>
			
			<li class="nav-item mr-4 mb-2 mb-lg-0">
				
				
				
				
				
				
				
				
				<a class="nav-link" href="/k8s-source-code-analysis/" ><span>Kubernetes源码分析</span></a>
			</li>
			
			<li class="nav-item mr-4 mb-2 mb-lg-0">
				
				
				
				
				
				
				
				
				<a class="nav-link" href="/golang-notes/" ><span>Golang学习笔记</span></a>
			</li>
			
			<li class="nav-item mr-4 mb-2 mb-lg-0">
				
				
				
				
				
				
				
				
				<a class="nav-link active" href="/linux-notes/" ><span class="active">Linux学习笔记</span></a>
			</li>
			
			<li class="nav-item mr-4 mb-2 mb-lg-0">
				
				
				
				
				
				
				
				
				<a class="nav-link" href="/about/" ><span>About</span></a>
			</li>
			
			
			
		</ul>
	</div>
	<div class="navbar-nav d-none d-lg-block"><input
  type="search"
  class="form-control td-search-input"
  placeholder="&#xf002; 站内搜索…"
  aria-label="站内搜索…"
  autocomplete="off"
  
  data-offline-search-index-json-src="/offline-search-index.94b706af0121f8fad79fa39659815f4b.json"
  data-offline-search-base-href="/"
  data-offline-search-max-results="10"
>
</div>
</nav>

    </header>
    <div class="container-fluid td-outer">
      <div class="td-main">
        <div class="row flex-xl-nowrap">
          <main class="col-12 col-md-9 col-xl-8 pl-md-5" role="main">
            




<div class="td-content">
<div class="pageinfo pageinfo-primary d-print-none">
<p>
这是本节的多页打印视图。
<a href="#" onclick="print();return false;">点击此处打印</a>.
</p><p>
<a href="/linux-notes/disk/">返回本页常规视图</a>.
</p>
</div>



<h1 class="title">磁盘</h1>





    <ul>
    
  
  
  
  

  
    
    
	
<li>1: <a href="#pg-efb1da2d07097c48baf556ef4e43b997">磁盘命令</a></li>


    
  
    
    
	
<li>2: <a href="#pg-dcd309351d4b31616b979c4aad4cde28">LVM的使用</a></li>


    
  
    
    
	
<li>3: <a href="#pg-d4bbbd15228232e898b358dae27e6a1c">Raid介绍</a></li>


    
  

    </ul>


<div class="content">
      
</div>
</div>


  
  
  
  

  
  

  
    
    
	
    

<div class="td-content" style="">
    
	<h1 id="pg-efb1da2d07097c48baf556ef4e43b997">1 - 磁盘命令</h1>
    
	<h1 id="1-判断磁盘是ssd或hdd盘">1. 判断磁盘是SSD或HDD盘</h1>
<p><strong>1、没有使用raid方案</strong></p>
<p>lsblk -d -o name,rota命令，0表示SSD，1表示HDD</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span><span style="color:#8f5902;font-style:italic"># lsblk -d -o name,rota</span>
</span></span><span style="display:flex;"><span>NAME ROTA
</span></span><span style="display:flex;"><span>sda     <span style="color:#0000cf;font-weight:bold">0</span>
</span></span><span style="display:flex;"><span>sdb     <span style="color:#0000cf;font-weight:bold">1</span>
</span></span><span style="display:flex;"><span>sdc     <span style="color:#0000cf;font-weight:bold">1</span>
</span></span></code></pre></div><p><strong>2、使用raid方案</strong></p>
<p>下载工具</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>wget https://raw.githubusercontent.com/eLvErDe/hwraid/master/wrapper-scripts/megaclisas-status
</span></span></code></pre></div><p>执行检测命令</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>$ megaclisas-status
</span></span><span style="display:flex;"><span>-- Controller information --
</span></span><span style="display:flex;"><span>-- ID <span style="color:#000;font-weight:bold">|</span> H/W Model <span style="color:#000;font-weight:bold">|</span> RAM    <span style="color:#000;font-weight:bold">|</span> Temp <span style="color:#000;font-weight:bold">|</span> BBU    <span style="color:#000;font-weight:bold">|</span> Firmware
</span></span><span style="display:flex;"><span>c0    <span style="color:#000;font-weight:bold">|</span> SAS3508 <span style="color:#000;font-weight:bold">|</span> 2048MB <span style="color:#000;font-weight:bold">|</span> 55C  <span style="color:#000;font-weight:bold">|</span> Good   <span style="color:#000;font-weight:bold">|</span> FW: 50.6.3-0109
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>-- Array information --
</span></span><span style="display:flex;"><span>-- ID <span style="color:#000;font-weight:bold">|</span> Type   <span style="color:#000;font-weight:bold">|</span>    Size <span style="color:#000;font-weight:bold">|</span>  Strpsz <span style="color:#000;font-weight:bold">|</span> Flags <span style="color:#000;font-weight:bold">|</span> DskCache <span style="color:#000;font-weight:bold">|</span>   Status <span style="color:#000;font-weight:bold">|</span>  OS Path <span style="color:#000;font-weight:bold">|</span> CacheCade <span style="color:#000;font-weight:bold">|</span>InProgress
</span></span><span style="display:flex;"><span>c0u0  <span style="color:#000;font-weight:bold">|</span> RAID-1 <span style="color:#000;font-weight:bold">|</span>   1089G <span style="color:#000;font-weight:bold">|</span>  <span style="color:#0000cf;font-weight:bold">256</span> KB <span style="color:#000;font-weight:bold">|</span> RA,WB <span style="color:#000;font-weight:bold">|</span>  Default <span style="color:#000;font-weight:bold">|</span>  Optimal <span style="color:#000;font-weight:bold">|</span> /dev/sda <span style="color:#000;font-weight:bold">|</span> None      <span style="color:#000;font-weight:bold">|</span>None
</span></span><span style="display:flex;"><span>c0u1  <span style="color:#000;font-weight:bold">|</span> RAID-5 <span style="color:#000;font-weight:bold">|</span>   2616G <span style="color:#000;font-weight:bold">|</span>  <span style="color:#0000cf;font-weight:bold">256</span> KB <span style="color:#000;font-weight:bold">|</span> RA,WB <span style="color:#000;font-weight:bold">|</span>  Default <span style="color:#000;font-weight:bold">|</span>  Optimal <span style="color:#000;font-weight:bold">|</span> /dev/sdb <span style="color:#000;font-weight:bold">|</span> None      <span style="color:#000;font-weight:bold">|</span>None
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>-- Disk information --
</span></span><span style="display:flex;"><span>-- ID   <span style="color:#000;font-weight:bold">|</span> Type <span style="color:#000;font-weight:bold">|</span> Drive Model                                 <span style="color:#000;font-weight:bold">|</span> Size     <span style="color:#000;font-weight:bold">|</span> Status          <span style="color:#000;font-weight:bold">|</span> Speed    <span style="color:#000;font-weight:bold">|</span> Temp <span style="color:#000;font-weight:bold">|</span> Slot ID  <span style="color:#000;font-weight:bold">|</span> LSI ID
</span></span><span style="display:flex;"><span>c0u0p0  <span style="color:#000;font-weight:bold">|</span> HDD  <span style="color:#000;font-weight:bold">|</span> TOSHIBA AL15SEB120N 080710R0A0LJFDWG        <span style="color:#000;font-weight:bold">|</span> 1.089 TB <span style="color:#000;font-weight:bold">|</span> Online, Spun Up <span style="color:#000;font-weight:bold">|</span> 12.0Gb/s <span style="color:#000;font-weight:bold">|</span> 27C  <span style="color:#000;font-weight:bold">|</span> <span style="color:#ce5c00;font-weight:bold">[</span>134:4<span style="color:#ce5c00;font-weight:bold">]</span>  <span style="color:#000;font-weight:bold">|</span> <span style="color:#0000cf;font-weight:bold">0</span>
</span></span><span style="display:flex;"><span>c0u0p1  <span style="color:#000;font-weight:bold">|</span> HDD  <span style="color:#000;font-weight:bold">|</span> TOSHIBA AL15SEB120N 080710S0A10SFDWG        <span style="color:#000;font-weight:bold">|</span> 1.089 TB <span style="color:#000;font-weight:bold">|</span> Online, Spun Up <span style="color:#000;font-weight:bold">|</span> 12.0Gb/s <span style="color:#000;font-weight:bold">|</span> 28C  <span style="color:#000;font-weight:bold">|</span> <span style="color:#ce5c00;font-weight:bold">[</span>134:5<span style="color:#ce5c00;font-weight:bold">]</span>  <span style="color:#000;font-weight:bold">|</span> <span style="color:#0000cf;font-weight:bold">5</span>
</span></span><span style="display:flex;"><span>c0u1p0  <span style="color:#000;font-weight:bold">|</span> SSD  <span style="color:#000;font-weight:bold">|</span> HUAWEI HWE52SS3960L005N3248033GSN10L5002816 <span style="color:#000;font-weight:bold">|</span> 893.1 Gb <span style="color:#000;font-weight:bold">|</span> Online, Spun Up <span style="color:#000;font-weight:bold">|</span> 12.0Gb/s <span style="color:#000;font-weight:bold">|</span> 29C  <span style="color:#000;font-weight:bold">|</span> <span style="color:#ce5c00;font-weight:bold">[</span>134:0<span style="color:#ce5c00;font-weight:bold">]</span>  <span style="color:#000;font-weight:bold">|</span> <span style="color:#0000cf;font-weight:bold">2</span>
</span></span><span style="display:flex;"><span>c0u1p1  <span style="color:#000;font-weight:bold">|</span> SSD  <span style="color:#000;font-weight:bold">|</span> HUAWEI HWE52SS3960L005N3248033GSN10L5002799 <span style="color:#000;font-weight:bold">|</span> 893.1 Gb <span style="color:#000;font-weight:bold">|</span> Online, Spun Up <span style="color:#000;font-weight:bold">|</span> 12.0Gb/s <span style="color:#000;font-weight:bold">|</span> 30C  <span style="color:#000;font-weight:bold">|</span> <span style="color:#ce5c00;font-weight:bold">[</span>134:1<span style="color:#ce5c00;font-weight:bold">]</span>  <span style="color:#000;font-weight:bold">|</span> <span style="color:#0000cf;font-weight:bold">4</span>
</span></span><span style="display:flex;"><span>c0u1p2  <span style="color:#000;font-weight:bold">|</span> SSD  <span style="color:#000;font-weight:bold">|</span> HUAWEI HWE52SS3960L005N3248033GSN10L5002805 <span style="color:#000;font-weight:bold">|</span> 893.1 Gb <span style="color:#000;font-weight:bold">|</span> Online, Spun Up <span style="color:#000;font-weight:bold">|</span> 12.0Gb/s <span style="color:#000;font-weight:bold">|</span> 29C  <span style="color:#000;font-weight:bold">|</span> <span style="color:#ce5c00;font-weight:bold">[</span>134:2<span style="color:#ce5c00;font-weight:bold">]</span>  <span style="color:#000;font-weight:bold">|</span> <span style="color:#0000cf;font-weight:bold">1</span>
</span></span><span style="display:flex;"><span>c0u1p3  <span style="color:#000;font-weight:bold">|</span> SSD  <span style="color:#000;font-weight:bold">|</span> HUAWEI HWE52SS3960L005N3248033GSN10L5002797 <span style="color:#000;font-weight:bold">|</span> 893.1 Gb <span style="color:#000;font-weight:bold">|</span> Online, Spun Up <span style="color:#000;font-weight:bold">|</span> 12.0Gb/s <span style="color:#000;font-weight:bold">|</span> 29C  <span style="color:#000;font-weight:bold">|</span> <span style="color:#ce5c00;font-weight:bold">[</span>134:3<span style="color:#ce5c00;font-weight:bold">]</span>  <span style="color:#000;font-weight:bold">|</span> <span style="color:#0000cf;font-weight:bold">3</span>
</span></span></code></pre></div><h1 id="2-解决umount-target-is-busy挂载盘卸载不掉问题">2. 解决umount target is busy挂载盘卸载不掉问题</h1>
<p>问题描述:</p>
<p>由于有进程占用目录，因此无法umount目录，需要先将占用进程杀死，再umount目录。</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>$ umount /data
</span></span><span style="display:flex;"><span>umount: /data: target is busy.
</span></span></code></pre></div><p>查看目录占用进程：</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span><span style="color:#8f5902;font-style:italic"># fuser -mv /mnt/</span>
</span></span><span style="display:flex;"><span>                     USER        PID ACCESS COMMAND
</span></span><span style="display:flex;"><span>/mnt:                root     kernel mount /mnt
</span></span><span style="display:flex;"><span>                     root      <span style="color:#0000cf;font-weight:bold">13830</span> ..c.. bash
</span></span></code></pre></div><p>杀死目录占用进程</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span><span style="color:#8f5902;font-style:italic"># fuser -kv /mnt/</span>
</span></span><span style="display:flex;"><span>                     USER        PID ACCESS COMMAND
</span></span><span style="display:flex;"><span>/mnt:                root     kernel mount /mnt
</span></span><span style="display:flex;"><span>                     root      <span style="color:#0000cf;font-weight:bold">13830</span> ..c.. bash
</span></span><span style="display:flex;"><span><span style="color:#8f5902;font-style:italic"># 检查目录占用进程                     </span>
</span></span><span style="display:flex;"><span><span style="color:#8f5902;font-style:italic"># fuser -mv /mnt/   </span>
</span></span><span style="display:flex;"><span><span style="color:#8f5902;font-style:italic"># umount /mnt</span>
</span></span></code></pre></div><p>fuser命令参数说明</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>-k,--kill <span style="color:#204a87">kill</span> 　　processes accessing the named file
</span></span><span style="display:flex;"><span>-m,--mount 　　 show all processes using the named filesystems or block device
</span></span><span style="display:flex;"><span>-v,--verbose 　　 verbose output
</span></span></code></pre></div>
</div>



    
	
  
    
    
	
    

<div class="td-content" style="page-break-before: always">
    
	<h1 id="pg-dcd309351d4b31616b979c4aad4cde28">2 - LVM的使用</h1>
    
	<blockquote>
<p>本文由网络内容整理而成的笔记</p>
</blockquote>
<h1 id="1-lvm简介">1. LVM简介</h1>
<p>LVM是逻辑盘卷管理（Logical Volume Manager）的简称，它是Linux环境下对磁盘分区进行管理的一种机制，LVM是建立在硬盘和分区之上的一个逻辑层，来提高磁盘分区管理的灵活性。</p>
<p>优点：</p>
<ul>
<li>
<p>可以灵活分配和管理磁盘空间</p>
</li>
<li>
<p>可以对分区进行动态的扩容</p>
</li>
<li>
<p>可以增加新的磁盘到lvm中</p>
</li>
</ul>
<h1 id="2-lvm核心概念">2. LVM核心概念</h1>
<p>LVM概念图：</p>
<p><img src="https://res.cloudinary.com/dqxtn0ick/image/upload/v1646318332/article/linux/lvm/lvm-concept.png" alt=""></p>
<ul>
<li><strong>PV（Physical Volume）物理卷</strong> 磁盘分区后（还未格式化为文件系统）使用 pvcreate 命令可以将硬盘分区创建为 pv，此分区的 systemID 为8e，即为 LVM 格式的系统标识符。</li>
<li><strong>VG（Volume Group）卷组</strong> 将多个 PV 组合起来，使用 vgcreate 命令创建成卷组。卷组包含了多个 PV，相当于重新整合了多个分区后得到的硬盘。虽然 VG 整合了多个 PV，但是创建 VG 时会将所有空间根据指定 PE 大小划分为多个 PE，在 LVM 模式下的存储都是以 PE 为单元，类似于文件系统的 Block。</li>
<li><strong>PE（Physical Extend）物理存储单元</strong> PE 是 VG 中的存储单元。实际存储的数据都是在 PE 存储。</li>
<li><strong>LV（Logical Volume）逻辑卷</strong> 如果说VG是整合分区为硬盘，那么 LV 就是把这个硬盘重新的分区，只不过该分区是通过 VG 来划分的。VG 中有很多 PE 单元，可以指定将多少 PE 划分给一个 LV，也可以直接指定大小来划分。划分 LV 后就相当于划分了分区，只需要对 LV 进行格式化即可变成普通的文件系统。</li>
<li><strong>LE（Logical extent）逻辑存储单元</strong> LE 则是逻辑存储单元，即 LV 中的逻辑存储单元，和 PE 的大小一样。从 VG 中划分 LV，实际上是从 VG 中划分 VG 中的 PE，只不过划分 LV 后它不在称为 PE，而是 LE。</li>
</ul>
<h1 id="3-lvm原理">3. LVM原理</h1>
<p>LVM 之所以能够伸缩容量，实现的方法就是讲 LV 里空闲的 PE 移出，或向 LV 中添加空闲的 PE。</p>
<p><img src="https://res.cloudinary.com/dqxtn0ick/image/upload/v1646318332/article/linux/lvm/lvm-arch.png" alt=""></p>
<h1 id="4-格式化为lvm盘">4. 格式化为LVM盘</h1>
<h2 id="4-1-fdisk格式化2t以下磁盘">4.1. fdisk格式化2T以下磁盘</h2>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span><span style="color:#8f5902;font-style:italic"># 使用fdisk进行盘的格式化</span>
</span></span><span style="display:flex;"><span>fdisk /dev/vdb
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#8f5902;font-style:italic"># 以下是交互输出结果</span>
</span></span><span style="display:flex;"><span>Welcome to fdisk <span style="color:#ce5c00;font-weight:bold">(</span>util-linux 2.23.2<span style="color:#ce5c00;font-weight:bold">)</span>.
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>Changes will remain in memory only, <span style="color:#204a87;font-weight:bold">until</span> you decide to write them.
</span></span><span style="display:flex;"><span>Be careful before using the write command.
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>Device does not contain a recognized partition table
</span></span><span style="display:flex;"><span>Building a new DOS disklabel with disk identifier 0xadfbfcb4.
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>Command <span style="color:#ce5c00;font-weight:bold">(</span>m <span style="color:#204a87;font-weight:bold">for</span> <span style="color:#204a87">help</span><span style="color:#ce5c00;font-weight:bold">)</span>: n <span style="color:#8f5902;font-style:italic"># 新建分区</span>
</span></span><span style="display:flex;"><span>Partition type:
</span></span><span style="display:flex;"><span>   p   primary <span style="color:#ce5c00;font-weight:bold">(</span><span style="color:#0000cf;font-weight:bold">0</span> primary, <span style="color:#0000cf;font-weight:bold">0</span> extended, <span style="color:#0000cf;font-weight:bold">4</span> free<span style="color:#ce5c00;font-weight:bold">)</span>
</span></span><span style="display:flex;"><span>   e   extended
</span></span><span style="display:flex;"><span>Select <span style="color:#ce5c00;font-weight:bold">(</span>default p<span style="color:#ce5c00;font-weight:bold">)</span>: p  <span style="color:#8f5902;font-style:italic"># 待定主分区</span>
</span></span><span style="display:flex;"><span>Partition number <span style="color:#ce5c00;font-weight:bold">(</span>1-4, default 1<span style="color:#ce5c00;font-weight:bold">)</span>: <span style="color:#0000cf;font-weight:bold">1</span> <span style="color:#8f5902;font-style:italic"># 序号</span>
</span></span><span style="display:flex;"><span>First sector <span style="color:#ce5c00;font-weight:bold">(</span>2048-1048575999, default 2048<span style="color:#ce5c00;font-weight:bold">)</span>: <span style="color:#8f5902;font-style:italic"># 直接回车</span>
</span></span><span style="display:flex;"><span>Using default value <span style="color:#0000cf;font-weight:bold">2048</span>
</span></span><span style="display:flex;"><span>Last sector, +sectors or +size<span style="color:#ce5c00;font-weight:bold">{</span>K,M,G<span style="color:#ce5c00;font-weight:bold">}</span> <span style="color:#ce5c00;font-weight:bold">(</span>2048-1048575999, default 1048575999<span style="color:#ce5c00;font-weight:bold">)</span>: <span style="color:#8f5902;font-style:italic"># 直接回车</span>
</span></span><span style="display:flex;"><span>Using default value <span style="color:#0000cf;font-weight:bold">1048575999</span>
</span></span><span style="display:flex;"><span>Partition <span style="color:#0000cf;font-weight:bold">1</span> of <span style="color:#204a87">type</span> Linux and of size <span style="color:#0000cf;font-weight:bold">500</span> GiB is <span style="color:#204a87">set</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>Command <span style="color:#ce5c00;font-weight:bold">(</span>m <span style="color:#204a87;font-weight:bold">for</span> <span style="color:#204a87">help</span><span style="color:#ce5c00;font-weight:bold">)</span>: p <span style="color:#8f5902;font-style:italic"># 确认分区情况</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>Disk /dev/vdb: 536.9 GB, <span style="color:#0000cf;font-weight:bold">536870912000</span> bytes, <span style="color:#0000cf;font-weight:bold">1048576000</span> sectors
</span></span><span style="display:flex;"><span><span style="color:#000">Units</span> <span style="color:#ce5c00;font-weight:bold">=</span> sectors of <span style="color:#0000cf;font-weight:bold">1</span> * <span style="color:#000">512</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#0000cf;font-weight:bold">512</span> bytes
</span></span><span style="display:flex;"><span>Sector size <span style="color:#ce5c00;font-weight:bold">(</span>logical/physical<span style="color:#ce5c00;font-weight:bold">)</span>: <span style="color:#0000cf;font-weight:bold">512</span> bytes / <span style="color:#0000cf;font-weight:bold">512</span> bytes
</span></span><span style="display:flex;"><span>I/O size <span style="color:#ce5c00;font-weight:bold">(</span>minimum/optimal<span style="color:#ce5c00;font-weight:bold">)</span>: <span style="color:#0000cf;font-weight:bold">512</span> bytes / <span style="color:#0000cf;font-weight:bold">512</span> bytes
</span></span><span style="display:flex;"><span>Disk label type: dos
</span></span><span style="display:flex;"><span>Disk identifier: 0xadfbfcb4
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>   Device Boot      Start         End      Blocks   Id  System
</span></span><span style="display:flex;"><span>/dev/vdb1            <span style="color:#0000cf;font-weight:bold">2048</span>  <span style="color:#0000cf;font-weight:bold">1048575999</span>   <span style="color:#0000cf;font-weight:bold">524286976</span>   <span style="color:#0000cf;font-weight:bold">83</span>  Linux
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>Command <span style="color:#ce5c00;font-weight:bold">(</span>m <span style="color:#204a87;font-weight:bold">for</span> <span style="color:#204a87">help</span><span style="color:#ce5c00;font-weight:bold">)</span>: t <span style="color:#8f5902;font-style:italic"># 选择系统id</span>
</span></span><span style="display:flex;"><span>Selected partition <span style="color:#0000cf;font-weight:bold">1</span>
</span></span><span style="display:flex;"><span>Hex code <span style="color:#ce5c00;font-weight:bold">(</span><span style="color:#204a87">type</span> L to list all codes<span style="color:#ce5c00;font-weight:bold">)</span>: 8e <span style="color:#8f5902;font-style:italic"># 8e指定的是使用LVM</span>
</span></span><span style="display:flex;"><span>Changed <span style="color:#204a87">type</span> of partition <span style="color:#4e9a06">&#39;Linux&#39;</span> to <span style="color:#4e9a06">&#39;Linux LVM&#39;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>Command <span style="color:#ce5c00;font-weight:bold">(</span>m <span style="color:#204a87;font-weight:bold">for</span> <span style="color:#204a87">help</span><span style="color:#ce5c00;font-weight:bold">)</span>: w <span style="color:#8f5902;font-style:italic"># 保存</span>
</span></span><span style="display:flex;"><span>The partition table has been altered!
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>Calling ioctl<span style="color:#ce5c00;font-weight:bold">()</span> to re-read partition table.
</span></span><span style="display:flex;"><span>Syncing disks.
</span></span></code></pre></div><h2 id="4-2-parted格式化2t以上磁盘">4.2. parted格式化2T以上磁盘</h2>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span><span style="color:#8f5902;font-style:italic"># parted /dev/sdk</span>
</span></span><span style="display:flex;"><span>GNU Parted 3.1
</span></span><span style="display:flex;"><span>使用 /dev/sdk
</span></span><span style="display:flex;"><span>Welcome to GNU Parted! Type <span style="color:#4e9a06">&#39;help&#39;</span> to view a list of commands.
</span></span><span style="display:flex;"><span><span style="color:#ce5c00;font-weight:bold">(</span>parted<span style="color:#ce5c00;font-weight:bold">)</span> mktable
</span></span><span style="display:flex;"><span>新的磁盘标签类型？ gpt
</span></span><span style="display:flex;"><span><span style="color:#ce5c00;font-weight:bold">(</span>parted<span style="color:#ce5c00;font-weight:bold">)</span> p
</span></span><span style="display:flex;"><span>Model: ATA ST4000NM0035-1V4 <span style="color:#ce5c00;font-weight:bold">(</span>scsi<span style="color:#ce5c00;font-weight:bold">)</span>
</span></span><span style="display:flex;"><span>Disk /dev/sdk: 4001GB
</span></span><span style="display:flex;"><span>Sector size <span style="color:#ce5c00;font-weight:bold">(</span>logical/physical<span style="color:#ce5c00;font-weight:bold">)</span>: 512B/512B
</span></span><span style="display:flex;"><span>Partition Table: gpt
</span></span><span style="display:flex;"><span>Disk Flags:
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>Number  Start  End  Size  File system  Name  标志
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#ce5c00;font-weight:bold">(</span>parted<span style="color:#ce5c00;font-weight:bold">)</span> mkpart
</span></span><span style="display:flex;"><span>分区名称？  <span style="color:#ce5c00;font-weight:bold">[]</span>?
</span></span><span style="display:flex;"><span>文件系统类型？  <span style="color:#ce5c00;font-weight:bold">[</span>ext2<span style="color:#ce5c00;font-weight:bold">]</span>?
</span></span><span style="display:flex;"><span>起始点？ 0g
</span></span><span style="display:flex;"><span>结束点？ 4000G
</span></span><span style="display:flex;"><span><span style="color:#ce5c00;font-weight:bold">(</span>parted<span style="color:#ce5c00;font-weight:bold">)</span> p
</span></span><span style="display:flex;"><span>Model: ATA ST4000NM0035-1V4 <span style="color:#ce5c00;font-weight:bold">(</span>scsi<span style="color:#ce5c00;font-weight:bold">)</span>
</span></span><span style="display:flex;"><span>Disk /dev/sdk: 4001GB
</span></span><span style="display:flex;"><span>Sector size <span style="color:#ce5c00;font-weight:bold">(</span>logical/physical<span style="color:#ce5c00;font-weight:bold">)</span>: 512B/512B
</span></span><span style="display:flex;"><span>Partition Table: gpt
</span></span><span style="display:flex;"><span>Disk Flags:
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>Number  Start   End     Size    File system  Name  标志
</span></span><span style="display:flex;"><span> <span style="color:#0000cf;font-weight:bold">1</span>      1049kB  4000GB  4000GB
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#ce5c00;font-weight:bold">(</span>parted<span style="color:#ce5c00;font-weight:bold">)</span> toggle <span style="color:#0000cf;font-weight:bold">1</span> lvm
</span></span><span style="display:flex;"><span><span style="color:#ce5c00;font-weight:bold">(</span>parted<span style="color:#ce5c00;font-weight:bold">)</span> p
</span></span><span style="display:flex;"><span>Model: ATA ST4000NM0035-1V4 <span style="color:#ce5c00;font-weight:bold">(</span>scsi<span style="color:#ce5c00;font-weight:bold">)</span>
</span></span><span style="display:flex;"><span>Disk /dev/sdk: 4001GB
</span></span><span style="display:flex;"><span>Sector size <span style="color:#ce5c00;font-weight:bold">(</span>logical/physical<span style="color:#ce5c00;font-weight:bold">)</span>: 512B/512B
</span></span><span style="display:flex;"><span>Partition Table: gpt
</span></span><span style="display:flex;"><span>Disk Flags:
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>Number  Start   End     Size    File system  Name  标志
</span></span><span style="display:flex;"><span> <span style="color:#0000cf;font-weight:bold">1</span>      1049kB  4000GB  4000GB                     lvm
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#ce5c00;font-weight:bold">(</span>parted<span style="color:#ce5c00;font-weight:bold">)</span> quit
</span></span><span style="display:flex;"><span>信息: You may need to update /etc/fstab.
</span></span></code></pre></div><h1 id="5-lvm操作">5. LVM操作</h1>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span><span style="color:#8f5902;font-style:italic"># pvcreate如果提示命令不存在，则需要安装lvm2</span>
</span></span><span style="display:flex;"><span>yum install lvm2 -y
</span></span></code></pre></div><h2 id="5-1-创建物理卷-pv">5.1. 创建物理卷（PV）</h2>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span><span style="color:#8f5902;font-style:italic"># pvcreate /dev/nvme1n1p1 /dev/nvme2n1p1</span>
</span></span><span style="display:flex;"><span>  Physical volume <span style="color:#4e9a06">&#34;/dev/nvme1n1p1&#34;</span> successfully created.
</span></span><span style="display:flex;"><span>  Physical volume <span style="color:#4e9a06">&#34;/dev/nvme2n1p1&#34;</span> successfully created.
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#8f5902;font-style:italic"># 使用pvs或者 pvdisplay 查看结果</span>
</span></span><span style="display:flex;"><span><span style="color:#8f5902;font-style:italic"># pvs</span>
</span></span><span style="display:flex;"><span>  PV             VG Fmt  Attr PSize   PFree
</span></span><span style="display:flex;"><span>  /dev/nvme1n1p1    lvm2 ---  931.51g 931.51g
</span></span><span style="display:flex;"><span>  /dev/nvme2n1p1    lvm2 ---  931.51g 931.51g
</span></span></code></pre></div><h2 id="5-2-创建卷组-vg">5.2. 创建卷组（VG）</h2>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span><span style="color:#8f5902;font-style:italic"># vgcreate vgdata /dev/nvme1n1p1 /dev/nvme2n1p1</span>
</span></span><span style="display:flex;"><span>  Volume group <span style="color:#4e9a06">&#34;vgdata&#34;</span> successfully created
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#8f5902;font-style:italic"># 使用vgs 查看vg, vgdisplay的信息</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#8f5902;font-style:italic"># lsblk查看</span>
</span></span><span style="display:flex;"><span><span style="color:#8f5902;font-style:italic"># lsblk</span>
</span></span><span style="display:flex;"><span>NAME                                          MAJ:MIN RM   SIZE RO TYPE  MOUNTPOINT
</span></span><span style="display:flex;"><span>nvme0n1                                       259:0    <span style="color:#0000cf;font-weight:bold">0</span> 931.5G  <span style="color:#0000cf;font-weight:bold">0</span> disk  /pcdn_data/storage1_ssd
</span></span><span style="display:flex;"><span>nvme2n1                                       259:2    <span style="color:#0000cf;font-weight:bold">0</span> 931.5G  <span style="color:#0000cf;font-weight:bold">0</span> disk
</span></span><span style="display:flex;"><span>└─nvme2n1p1                                   259:5    <span style="color:#0000cf;font-weight:bold">0</span> 931.5G  <span style="color:#0000cf;font-weight:bold">0</span> part
</span></span><span style="display:flex;"><span>  └─vgdata-data                               251:2    <span style="color:#0000cf;font-weight:bold">0</span>   1.8T  <span style="color:#0000cf;font-weight:bold">0</span> lvm   /vgdata
</span></span><span style="display:flex;"><span>nvme1n1                                       259:1    <span style="color:#0000cf;font-weight:bold">0</span> 931.5G  <span style="color:#0000cf;font-weight:bold">0</span> disk
</span></span><span style="display:flex;"><span>└─nvme1n1p1                                   259:4    <span style="color:#0000cf;font-weight:bold">0</span> 931.5G  <span style="color:#0000cf;font-weight:bold">0</span> part
</span></span><span style="display:flex;"><span>  └─vgdata-data                               251:2    <span style="color:#0000cf;font-weight:bold">0</span>   1.8T  <span style="color:#0000cf;font-weight:bold">0</span> lvm   /vgdata
</span></span></code></pre></div><h2 id="5-3-创建逻辑卷-lv">5.3. 创建逻辑卷（LV）</h2>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span><span style="color:#8f5902;font-style:italic"># lvcreate -L 后面是大小， -n 后面是逻辑卷名称， vgdata对应上面的卷组</span>
</span></span><span style="display:flex;"><span><span style="color:#8f5902;font-style:italic"># lvcreate -L 1.8T -n data vgdata</span>
</span></span><span style="display:flex;"><span>  Rounding up size to full physical extent 1.80 TiB
</span></span><span style="display:flex;"><span>  Logical volume <span style="color:#4e9a06">&#34;data&#34;</span> created.
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#8f5902;font-style:italic"># 使用lvdisplay 查看结果</span>
</span></span></code></pre></div><h2 id="5-4-格式化文件系统及挂载">5.4. 格式化文件系统及挂载</h2>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span><span style="color:#8f5902;font-style:italic"># 查看磁盘信息</span>
</span></span><span style="display:flex;"><span><span style="color:#8f5902;font-style:italic"># fdisk -l</span>
</span></span><span style="display:flex;"><span>磁盘 /dev/mapper/vgdata-data：1979.1 GB, <span style="color:#0000cf;font-weight:bold">1979124285440</span> 字节，3865477120 个扇区
</span></span><span style="display:flex;"><span><span style="color:#000">Units</span> <span style="color:#ce5c00;font-weight:bold">=</span> 扇区 of <span style="color:#0000cf;font-weight:bold">1</span> * <span style="color:#000">512</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#0000cf;font-weight:bold">512</span> bytes
</span></span><span style="display:flex;"><span>扇区大小<span style="color:#ce5c00;font-weight:bold">(</span>逻辑/物理<span style="color:#ce5c00;font-weight:bold">)</span>：512 字节 / <span style="color:#0000cf;font-weight:bold">512</span> 字节
</span></span><span style="display:flex;"><span>I/O 大小<span style="color:#ce5c00;font-weight:bold">(</span>最小/最佳<span style="color:#ce5c00;font-weight:bold">)</span>：512 字节 / <span style="color:#0000cf;font-weight:bold">512</span> 字节
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#8f5902;font-style:italic"># 格式化成xfs, /dev/vgdata/data为上面 LV Path</span>
</span></span><span style="display:flex;"><span>mkfs.xfs /dev/vgdata/data
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#8f5902;font-style:italic"># mount</span>
</span></span><span style="display:flex;"><span>mkdir -p /data
</span></span><span style="display:flex;"><span>mount /dev/vgdata/data /data
</span></span></code></pre></div><h2 id="5-5-lvm扩容">5.5. LVM扩容</h2>
<p>LVM最大的优势就是其可伸缩性，伸缩性有更加偏重与扩容。扩容的实质是将 VG 中的空闲 PE 添加到 LV 中，所以只要 VG 中有空闲的 PE，就可以进行扩容。即使没有空闲 PE，也可以添加PV，将PV加入到VG中增加空闲PE。</p>
<p>扩容的两个关键步骤：</p>
<p>（1）使用 lvextend 或 lvresize 添加更多的 PE 或容量到 LV</p>
<p>（2）使用 resize2fs命令（xfs 使用 xfs_growfs）将 LV 增加后的容量添加到对应的文件系统中(此过程是修改文件系统而非LVM内容)</p>
<h1 id="6-lvm相关命令">6. LVM相关命令</h1>
<h2 id="6-1-管理-pv">6.1. 管理 PV</h2>
<table>
<thead>
<tr>
<th><strong>功能</strong></th>
<th><strong>命令</strong></th>
</tr>
</thead>
<tbody>
<tr>
<td>创建 PV</td>
<td>pvcreate</td>
</tr>
<tr>
<td>扫描并列出所有 PV</td>
<td>pvscan</td>
</tr>
<tr>
<td>列出 PV 属性</td>
<td>pvdisplay {name|size}</td>
</tr>
<tr>
<td>移除 PV</td>
<td>pvremove</td>
</tr>
<tr>
<td>移动 PV 中的数据</td>
<td>pvmove</td>
</tr>
</tbody>
</table>
<h2 id="6-2-管理-vg">6.2. 管理 VG</h2>
<table>
<thead>
<tr>
<th><strong>功能</strong></th>
<th><strong>命令</strong></th>
</tr>
</thead>
<tbody>
<tr>
<td>创建 VG</td>
<td>vgcreate</td>
</tr>
<tr>
<td>扫描并列出所有 VG</td>
<td>vgscan</td>
</tr>
<tr>
<td>列出 VG 属性信息</td>
<td>vgdisplay</td>
</tr>
<tr>
<td>移除（删除）VG</td>
<td>vgremove</td>
</tr>
<tr>
<td>从 VG 中移除 PV</td>
<td>vgreduce</td>
</tr>
<tr>
<td>将 PV 添加到 VG 中</td>
<td>vgextend</td>
</tr>
<tr>
<td>修改 VG 属性</td>
<td>vgchange</td>
</tr>
</tbody>
</table>
<h2 id="6-3-管理-lv">6.3. 管理 LV</h2>
<table>
<thead>
<tr>
<th><strong>功能</strong></th>
<th><strong>命令</strong></th>
</tr>
</thead>
<tbody>
<tr>
<td>创建 LV</td>
<td>lvcreate</td>
</tr>
<tr>
<td>扫描并列出所有 LV</td>
<td>lvscan</td>
</tr>
<tr>
<td>列出 LV 属性信息</td>
<td>lvdisplay</td>
</tr>
<tr>
<td>移除 LV</td>
<td>lvremove</td>
</tr>
<tr>
<td>缩小 LV 容量</td>
<td>lvreduce/lvresize</td>
</tr>
<tr>
<td>增大 LV 容量</td>
<td>lvextend/lvresize</td>
</tr>
<tr>
<td>调整 LV 容量</td>
<td>lvresize</td>
</tr>
</tbody>
</table>
<p><code>lvcreate</code>命令</p>
<p>一般用法：lvcreate [-L size(M/G) | -l PEnum] -n lv_name vg_name</p>
<p>选项：</p>
<p>-L：根据大小创建 LV，即分配多少空间给此 LV</p>
<p>-l：根据 PE 的数量来创建 LV，即分配多少个 PE 给此 LV</p>
<p>-n：指定 LV 名称</p>
<p>参考：</p>
<ul>
<li>
<p><a href="https://izsk.me/2020/09/15/System-use-lvm-manager-disks/">Linux下使用lvm将多块盘合并 | Z.S.K.'s Records</a></p>
</li>
<li>
<p><a href="https://cloud.tencent.com/developer/article/1382501">100个Linux命令(5)-LVM - 云+社区 - 腾讯云</a></p>
</li>
<li>
<p><a href="https://help.aliyun.com/document_detail/178476.html">LVM数据卷 - 容器服务 ACK - 阿里云</a></p>
</li>
</ul>

</div>



    
	
  
    
    
	
    

<div class="td-content" style="page-break-before: always">
    
	<h1 id="pg-d4bbbd15228232e898b358dae27e6a1c">3 - Raid介绍</h1>
    
	<h1 id="1-raid是什么">1. Raid是什么</h1>
<p>RAID英文全称Redundant Array of Independent Disk，翻译过来就是“独立磁盘冗余系统”。RAID是一种可提高性能或提供容错功能的磁盘子系统。</p>
<p>RAID的基本思想是将多个容量较小、速度较慢、可靠性较差的廉价磁盘，组合成一个磁盘组，从而以较低的成本获得与昂贵的大容量、高速磁盘相似的性能。</p>
<p>优势：</p>
<ul>
<li>
<p>高性能</p>
</li>
<li>
<p>可靠性可用性</p>
</li>
<li>
<p>大容量</p>
</li>
<li>
<p>可管理性</p>
</li>
</ul>
<h1 id="2-raid的基本原理">2. Raid的基本原理</h1>
<p>架构上，通过RAID控制器就将多块磁盘组合，在操作系统层我们看到的是一个或多个逻辑磁盘。</p>
<p>技术上，RAID主要采用<strong>磁盘镜像技术</strong>、<strong>条带化技术</strong>和<strong>奇偶校验技术</strong>实现高性能、可靠性、容错能力和扩展性。</p>
<ul>
<li>
<p><strong>磁盘镜像技术</strong>：将数据复制到多个磁盘，一方面可以提高可靠性，另一方面可以提高读性能。因为需要写入多个磁盘会导致写性能降低。</p>
</li>
<li>
<p><strong>数据条带技术</strong>：将数据分片保存到多个不同的磁盘，多个数据分片共同组成完整的数据。主要用于提示磁盘IO性能，当访问数据时可以同时对多个磁盘进行读取。</p>
</li>
<li>
<p><strong>数据校验技术</strong>：利益冗余数据对数据进行校验和修复。冗余数据通常采用海明码、异或操作等算法来计算获得。可以提高磁盘阵列的可靠性和容错能力。不过，数据校验需要从多处读取数据并进行计算和对比，会影响系统性能。</p>
</li>
</ul>
<h1 id="3-raid的级别">3. Raid的级别</h1>
<p>RAID级别命名方式如，RAID 0、RAID 1/RAID 5、RAID 10等。RAID每一个级别代表一种RAID组合实现方法和技术，级别之间并无高低之分。不同等级的 RAID 采用其中一个或多个技术，得到的是不同的容量、I/O性能、可靠性、可用性。在决定选择哪种RAID级别之前，需要深入理解系统需求，根据自身情况进行合理选择，综合评估可靠性、性能和成本来进行折中的选择。</p>
<table>
<thead>
<tr>
<th>Raid等级</th>
<th>Raid0</th>
<th>Raid1</th>
<th>Raid3</th>
<th>Raid5</th>
<th>Raid6</th>
<th>Raid10</th>
</tr>
</thead>
<tbody>
<tr>
<td>别名</td>
<td>条带</td>
<td>镜像</td>
<td>专用奇偶校验条带</td>
<td>分布奇偶校验条带</td>
<td>双重奇偶校验条带</td>
<td>镜像+条带</td>
</tr>
<tr>
<td>容错性</td>
<td>无</td>
<td>有</td>
<td>有</td>
<td>有</td>
<td>有</td>
<td>有</td>
</tr>
<tr>
<td>冗余类型</td>
<td>无</td>
<td>有</td>
<td>有</td>
<td>有</td>
<td>有</td>
<td>有</td>
</tr>
<tr>
<td>热备份选择</td>
<td>无</td>
<td>有</td>
<td>有</td>
<td>有</td>
<td>有</td>
<td>有</td>
</tr>
<tr>
<td>读性能</td>
<td>高</td>
<td>低</td>
<td>高</td>
<td>高</td>
<td>高</td>
<td>高</td>
</tr>
<tr>
<td>随机写性能</td>
<td>高</td>
<td>低</td>
<td>低</td>
<td>一般</td>
<td>低</td>
<td>一般</td>
</tr>
<tr>
<td>连续写性能</td>
<td>高</td>
<td>低</td>
<td>低</td>
<td>低</td>
<td>低</td>
<td>一般</td>
</tr>
<tr>
<td>需要磁盘数</td>
<td>n&gt;=1</td>
<td>2n(n&gt;=1)</td>
<td>n&gt;=3</td>
<td>n&gt;=3</td>
<td>n&gt;=4</td>
<td>2n&gt;=4</td>
</tr>
<tr>
<td>可用容量</td>
<td>全部</td>
<td>50%</td>
<td>（n-1）/n</td>
<td>（n-1）/n</td>
<td>（n-2）/n</td>
<td>50%</td>
</tr>
</tbody>
</table>
<h1 id="4-raid级别介绍">4. Raid级别介绍</h1>
<h2 id="4-1-raid0-使用较多">4.1. Raid0（使用较多）</h2>
<p>Raid0是将多块物理磁盘组合成一个大的逻辑磁盘，在读写的时候会以独立的方式对N块磁盘进行读写，因此执行效率非常高。理论上读写的性能是单块磁盘的N倍。但是单块磁盘的损坏会导致数据丢失，无法恢复。因此适用于对可靠性不高，读写性能要求高的场景中。</p>
<ul>
<li>
<p><strong>特点</strong>：RAID 0通过条带化技术，将数据分散到多个磁盘上，从而提高存储性能。它不提供数据冗余，因此没有容错能力。</p>
</li>
<li>
<p><strong>适用场景</strong>：适用于对性能要求极高，但对数据安全性要求不高的场景，如视频编辑、高性能计算等。</p>
</li>
</ul>
<p><img src="https://res.cloudinary.com/dqxtn0ick/image/upload/v1712049568/article/linux/disk/raid0.png" alt=""></p>
<h2 id="4-2-raid1-镜像">4.2. Raid1（镜像）</h2>
<p>Raid1 是磁盘阵列中单位成本最高的一种方式。因为它的原理是在往磁盘写数据的时候，将同一份数据无差别的写两份到磁盘，分别写到工作磁盘和镜像磁盘，那么它的实际空间使用率只有50%了，两块磁盘当做一块用，这是一种比较昂贵的方案。可靠性高，但是性能低。</p>
<ul>
<li>
<p><strong>特点</strong>：RAID 1通过镜像技术，将数据同时写入两个或多个相同的磁盘.中，提供数据冗余和容错能力。如果一个磁盘发生故障，另一个磁盘上的数据仍然可用。</p>
</li>
<li>
<p><strong>适用场景</strong>：适用于对数据安全性要求较高的场景，如金融机构、医疗机构等。</p>
</li>
</ul>
<p><img src="https://res.cloudinary.com/dqxtn0ick/image/upload/v1712049569/article/linux/disk/raid1.png" alt=""></p>
<h2 id="4-3-raid5-使用最多">4.3. Raid5（使用最多）</h2>
<p>Raid5是兼具Raid0和Raid1的优点，在性能和可靠性上兼具的一种方式，也是使用最多的一种方案。</p>
<p>Raid5方案是总共有N块磁盘，会将要写入的数据分成N份，并发的写入到N块磁盘中，同时还将数据的校验码信息也写入到这N块磁盘中（数据与对应的校验码信息必须得分开存储在不同的磁盘上）。一旦某一块磁盘损坏了，就可以用剩下的数据和对应的奇偶校验码信息去恢复损坏的数据。</p>
<p>RAID5的方式，最少需要三块磁盘来组建磁盘阵列，允许最多同时坏一块磁盘。如果有两块磁盘同时损坏了，那数据就无法恢复了。</p>
<ul>
<li>
<p><strong>特点</strong>：RAID 5结合了条带化和数据冗余技术。它将数据分割成块并分布在多个磁盘上，同时使用一个或多个磁盘存储冗余信息(校验块)。如果一个磁盘发生故障，系统可以使用冗余信息来重建故障磁盘上的数据。</p>
</li>
<li>
<p><strong>适用场景</strong>：适用于对数据安全性和性能都有一定要求的场景，如企业数据库、文件服务器等。</p>
</li>
</ul>
<p><img src="https://res.cloudinary.com/dqxtn0ick/image/upload/v1712049569/article/linux/disk/raid5.png" alt=""></p>
<h2 id="4-4-raid6">4.4. Raid6</h2>
<p>RAID6在RAID5的基础上再次改进，引入了双重校验的概念。RAID6除了每块磁盘上都有同级数据XOR校验区以外，还有针对每个数据块的XOR校验区，这样的话，相当于每个数据块有两个校验保护措施，因此数据的冗余性更高了。但是RAID6的这种设计也带来了很高的复杂度，虽然数据冗余性好，读取的效率也比较高，但是写数据的性能就很差。因此RAID6在实际环境中应用的比较少。</p>
<ul>
<li>
<p><strong>特点</strong>：RAID 6与RAID 5类似，但使用了两个冗余信息来提供更高的容错能力。这意味着即使两个磁盘同时发生故障，系统仍然可以使用冗余信息来重建数据。</p>
</li>
<li>
<p><strong>适用场景</strong>：适用于对数据安全性要求非常高的场景，如大型数据库、关键业务系统等。</p>
</li>
</ul>
<h2 id="4-5-raid10">4.5. Raid10</h2>
<p>RAID10其实就是RAID1与RAID0的一个合体。RAID10兼备了RAID1和RAID0的有优点。</p>
<p>首先基于RAID1模式将磁盘分为2份，当要写入数据的时候，将所有的数据在两份磁盘上同时写入，相当于写了双份数据，起到了数据保障的作用。且在每一份磁盘上又会基于RAID0技术讲数据分为N份并发的读写，这样也保障了数据的效率。RAID10模式是有一半的磁盘空间用于存储冗余数据的，浪费的很严重，因此用的也不是很多。</p>
<p><img src="https://res.cloudinary.com/dqxtn0ick/image/upload/v1712049569/article/linux/disk/raid10.png" alt=""></p>
<h1 id="5-如何查看和制作raid">5. 如何查看和制作Raid</h1>
<blockquote>
<p>todo</p>
</blockquote>
<p>参考：</p>
<ul>
<li><a href="https://www.chinastor.com/baike/raid/">https://www.chinastor.com/baike/raid/</a></li>
<li><a href="https://zhuanlan.zhihu.com/p/51170719">https://zhuanlan.zhihu.com/p/51170719</a></li>
<li><a href="https://mp.weixin.qq.com/s/xWD5p7pmzdl_YpMXY5YO4g">https://mp.weixin.qq.com/s/xWD5p7pmzdl_YpMXY5YO4g</a></li>
</ul>

</div>



    
	
  



          </main>
        </div>
      </div>
      
<footer class="bg-dark py-5 row d-print-none">
  <div class="container-fluid mx-sm-5">
    <div class="row">
      <div class="col-6 col-sm-4 text-xs-center order-sm-2">
        
        
        
      </div>
      <div class="col-6 col-sm-4 text-right text-xs-center order-sm-3">
        
        
        
<ul class="list-inline mb-0">
  
  <li class="list-inline-item mx-2 h3" data-toggle="tooltip" data-placement="top" title="GitHub" aria-label="GitHub">
    <a class="text-white" target="_blank" rel="noopener" href="https://github.com/huweihuang/blog.huweihuang.com" aria-label="GitHub">
      <i class="fab fa-github"></i>
    </a>
  </li>
  
</ul>

        
        
      </div>
      <div class="col-12 col-sm-4 text-center py-2 order-sm-2">
        <small class="text-white">&copy; 2024 www.huweihuang.com 保留所有权利</small>
        <small class="ml-1"><a href="https://policies.google.com/privacy" target="_blank" rel="noopener">隐私政策</a></small>
	
		<p class="mt-2"><a href="/about/">About</a></p>
	
      </div>
    </div>
  </div>
</footer>


    </div>
    <script src="https://cdn.jsdelivr.net/npm/popper.js@1.16.1/dist/umd/popper.min.js"
    integrity="sha384-9/reFTGAW83EW2RDu2S0VKaIzap3H66lZH81PoYlFhbGU+6BZp6G7niu735Sk7lN"
    crossorigin="anonymous"></script>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@4.6.1/dist/js/bootstrap.min.js"
    integrity="sha512-UR25UO94eTnCVwjbXozyeVd6ZqpaAE9naiEUBK/A+QDbfSTQFhPGj5lOR6d8tsgbBk84Ggb5A3EkjsOgPRPcKA=="
    crossorigin="anonymous"></script>





<script src='/js/tabpane-persist.js'></script>




















<script src="/js/main.min.91798a335c881f1b6b805085ba4aa22d1dbd2b0b18d105d05189fa104ddae350.js" integrity="sha256-kXmKM1yIHxtrgFCFukqiLR29KwsY0QXQUYn6EE3a41A=" crossorigin="anonymous"></script>



<script src='/js/prism.js'></script>



  </body>
</html>

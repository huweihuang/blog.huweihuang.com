<rss version="2.0" xmlns:atom="http://www.w3.org/2005/Atom">
  <channel>
    <title>èƒ¡ä¼Ÿç…Œ â€“ CNI</title>
    <link>https://blog.huweihuang.com/tags/cni/</link>
    <description>Recent content in CNI on èƒ¡ä¼Ÿç…Œ</description>
    <generator>Hugo -- gohugo.io</generator>
    <lastBuildDate>Sat, 16 Nov 2024 10:50:57 +0000</lastBuildDate>
    
	  <atom:link href="https://blog.huweihuang.com/tags/cni/index.xml" rel="self" type="application/rss+xml" />
    
    
      
        
      
    
    
    <item>
      <title>Kubernetes-Notes: Ciliumä»‹ç»</title>
      <link>https://blog.huweihuang.com/kubernetes-notes/network/cilium/cilium/</link>
      <pubDate>Sat, 16 Nov 2024 10:50:57 +0000</pubDate>
      
      <guid>https://blog.huweihuang.com/kubernetes-notes/network/cilium/cilium/</guid>
      <description>
        
        
        &lt;h1 id=&#34;1-ciliumç®€ä»‹&#34;&gt;1. Ciliumç®€ä»‹&lt;/h1&gt;
&lt;p&gt;Cilium æ˜¯ä¸€ä¸ªå¼€æºçš„å®¹å™¨ç½‘ç»œæ’ä»¶ï¼ˆCNIï¼‰ï¼Œä¸“ä¸º Kubernetes å’Œäº‘åŸç”Ÿç¯å¢ƒè®¾è®¡ï¼ŒåŸºäº &lt;strong&gt;eBPFï¼ˆExtended Berkeley Packet Filterï¼‰&lt;/strong&gt; å®ç°é«˜æ€§èƒ½ã€å¯æ‰©å±•çš„ç½‘ç»œå’Œå®‰å…¨åŠŸèƒ½ã€‚å®ƒæ”¯æŒå¾®æœåŠ¡é—´çš„ç»†ç²’åº¦æµé‡æ§åˆ¶ï¼Œèƒ½å¤Ÿåœ¨ L3/L4/L7 å±‚æä¾›ç½‘ç»œç­–ç•¥ï¼ŒåŒæ—¶å…·æœ‰å¼ºå¤§çš„å¯è§‚æµ‹æ€§å·¥å…·ï¼ˆå¦‚ Hubbleï¼‰ä»¥å¸®åŠ©è¿ç»´äººå‘˜ç›‘æ§å’Œä¼˜åŒ–æµé‡ã€‚&lt;/p&gt;
&lt;h2 id=&#34;1-1-æ ¸å¿ƒç‰¹æ€§&#34;&gt;1.1. æ ¸å¿ƒç‰¹æ€§&lt;/h2&gt;
&lt;ol&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;åŸºäº eBPF çš„&lt;/strong&gt;é«˜æ€§èƒ½&lt;strong&gt;æ•°æ®å¹³é¢&lt;/strong&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;eBPF&lt;/strong&gt;ï¼šCilium é€šè¿‡ eBPF åœ¨ Linux å†…æ ¸ä¸­ç›´æ¥è¿è¡Œæ•°æ®åŒ…å¤„ç†é€»è¾‘ï¼Œé¿å…äº†å†…æ ¸ä¸ç”¨æˆ·æ€çš„é¢‘ç¹åˆ‡æ¢ï¼Œå¤§å¹…æé«˜äº†æ€§èƒ½ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;é«˜æ•ˆæµé‡è½¬å‘&lt;/strong&gt;ï¼šæ”¯æŒ BPF çš„å¿«é€Ÿè·¯å¾„ä¼˜åŒ–ï¼ˆZero-Copy è½¬å‘ï¼‰ï¼Œåœ¨é«˜æµé‡ç¯å¢ƒä¸­è¡¨ç°å‡ºè‰²ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;å¤šå±‚ç½‘ç»œç­–ç•¥&lt;/strong&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;L3/L4 ç­–ç•¥&lt;/strong&gt;ï¼šåŸºäº IP å’Œç«¯å£çš„åŸºæœ¬æµé‡æ§åˆ¶ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;L7 ç­–ç•¥&lt;/strong&gt;ï¼šæ”¯æŒåº”ç”¨å±‚åè®®ï¼ˆå¦‚ HTTPã€gRPCï¼‰çš„è®¿é—®æ§åˆ¶ï¼Œå¯ä»¥æ ¹æ®è¯·æ±‚è·¯å¾„ã€æ–¹æ³•æˆ–å†…å®¹è¿‡æ»¤æµé‡ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;å¾®æœåŠ¡å‹å¥½&lt;/strong&gt;ï¼šç‰¹åˆ«é€‚åˆéœ€è¦ç»†ç²’åº¦ç½‘ç»œç­–ç•¥çš„å¾®æœåŠ¡æ¶æ„ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;å¯è§‚æµ‹æ€§&lt;/strong&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;Hubble&lt;/strong&gt;ï¼šCilium å†…ç½®çš„å¯è§‚æµ‹æ€§å¹³å°ï¼Œå¯ä»¥å®æ—¶ç›‘æ§æœåŠ¡é—´çš„ç½‘ç»œæµé‡ã€å»¶è¿Ÿå’Œé”™è¯¯ç‡ï¼Œå¸®åŠ©å¼€å‘å’Œè¿ç»´å›¢é˜Ÿå¿«é€Ÿå®šä½é—®é¢˜ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;æµé‡è·¯å¾„è¿½è¸ª&lt;/strong&gt;ï¼šæ”¯æŒæµé‡è·¯å¾„çš„å…¨é“¾è·¯è¿½è¸ªï¼Œä¾¿äºæ’æŸ¥ç½‘ç»œç“¶é¢ˆæˆ–ç­–ç•¥å†²çªã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;æ‹“å±•æ€§&lt;/strong&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;æ”¯æŒè‡ªå®šä¹‰ eBPF ç¨‹åºï¼Œç”¨æˆ·å¯ä»¥æ ¹æ®ä¸šåŠ¡éœ€æ±‚æ‰©å±•ç½‘ç»œåŠŸèƒ½ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;ä¸å…¶ä»–äº‘åŸç”Ÿå·¥å…·ï¼ˆå¦‚ Prometheusã€Grafanaã€Istioï¼‰æ— ç¼é›†æˆã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;è·¨äº‘å’Œæ··åˆäº‘æ”¯æŒ&lt;/strong&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;æ”¯æŒ Kubernetes é›†ç¾¤çš„å¤šç½‘ç»œç¯å¢ƒï¼Œä¾‹å¦‚åœ¨è·¨äº‘å’Œæ··åˆäº‘åœºæ™¯ä¸­æä¾›ç»Ÿä¸€çš„ç½‘ç»œç­–ç•¥å’Œæµé‡æ§åˆ¶ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;æœåŠ¡å‘ç°ä¸è´Ÿè½½å‡è¡¡&lt;/strong&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;å†…ç½®æœåŠ¡è´Ÿè½½å‡è¡¡&lt;/strong&gt;ï¼šæä¾›å†…æ ¸çº§çš„æµé‡è´Ÿè½½å‡è¡¡ï¼Œæ¯”ä¼ ç»Ÿçš„ kube-proxy æ€§èƒ½æ›´é«˜ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;æœåŠ¡å‘ç°æ”¯æŒ&lt;/strong&gt;ï¼šå¯ä»¥ä¸ Kubernetes çš„ Service èµ„æºååŒå·¥ä½œï¼Œè‡ªåŠ¨å®ç° Pod é—´é€šä¿¡ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ol&gt;
&lt;h2 id=&#34;1-2-é€‚ç”¨åœºæ™¯&#34;&gt;1.2. é€‚ç”¨åœºæ™¯&lt;/h2&gt;
&lt;ol&gt;
&lt;li&gt;äº‘åŸç”Ÿå¾®æœåŠ¡æ¶æ„
&lt;ul&gt;
&lt;li&gt;åœ¨éœ€è¦ä¸¥æ ¼æµé‡æ§åˆ¶å’Œä¸°å¯Œå¯è§‚æµ‹æ€§çš„ç¯å¢ƒä¸­è¡¨ç°å°¤ä¸ºå‡ºè‰²ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;è¾¹ç¼˜è®¡ç®—
&lt;ul&gt;
&lt;li&gt;ä½å»¶è¿Ÿéœ€æ±‚è¾ƒé«˜çš„åœºæ™¯ï¼Œå¦‚ CDN è¾¹ç¼˜èŠ‚ç‚¹å’Œ IoT ç¯å¢ƒã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;é«˜æµé‡é›†ç¾¤
&lt;ul&gt;
&lt;li&gt;é€‚ç”¨äºå¯¹ååé‡å’Œæ€§èƒ½è¦æ±‚æé«˜çš„ç”Ÿäº§é›†ç¾¤ï¼Œä¾‹å¦‚ç”µå•†ã€æµåª’ä½“å’Œé‡‘èæœåŠ¡ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;å¤šç§Ÿæˆ·éš”ç¦»
&lt;ul&gt;
&lt;li&gt;æ”¯æŒå¤šç§Ÿæˆ·ç½‘ç»œç¯å¢ƒä¸­çš„å¼ºéš”ç¦»éœ€æ±‚ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ol&gt;
&lt;h1 id=&#34;2-ciliuméƒ¨ç½²&#34;&gt;2. Ciliuméƒ¨ç½²&lt;/h1&gt;
&lt;h2 id=&#34;2-1-éƒ¨ç½²&#34;&gt;2.1. éƒ¨ç½²&lt;/h2&gt;
&lt;p&gt;éƒ¨ç½²æ–‡æ¡£å¯å‚è€ƒï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href=&#34;https://docs.cilium.io/en/stable/installation/k8s-install-helm/&#34;&gt;https://docs.cilium.io/en/stable/installation/k8s-install-helm/&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://docs.cilium.io/en/stable/gettingstarted/k8s-install-default/#k8s-install-quick&#34;&gt;https://docs.cilium.io/en/stable/gettingstarted/k8s-install-default/#k8s-install-quick&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;å¯ä»¥ä½¿ç”¨helmæ¥éƒ¨ç½²&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;helm repo add cilium https://helm.cilium.io/
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;helm repo update
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#8f5902;font-style:italic&#34;&gt;# éƒ¨ç½²cilium&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;kubectl create ns cilium-system &lt;span style=&#34;color:#ce5c00;font-weight:bold&#34;&gt;||&lt;/span&gt; &lt;span style=&#34;color:#204a87&#34;&gt;true&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;helm install cilium cilium/cilium --namespace cilium-system &lt;span style=&#34;color:#4e9a06&#34;&gt;\
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#4e9a06&#34;&gt;&lt;/span&gt;    --set ipam.mode&lt;span style=&#34;color:#ce5c00;font-weight:bold&#34;&gt;=&lt;/span&gt;cluster-pool &lt;span style=&#34;color:#4e9a06&#34;&gt;\
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#4e9a06&#34;&gt;&lt;/span&gt;    --set ipam.operator.clusterPoolIPv4CIDR&lt;span style=&#34;color:#ce5c00;font-weight:bold&#34;&gt;=&lt;/span&gt;&lt;span style=&#34;color:#4e9a06&#34;&gt;&amp;#34;10.244.0.0/16&amp;#34;&lt;/span&gt; &lt;span style=&#34;color:#4e9a06&#34;&gt;\
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#4e9a06&#34;&gt;&lt;/span&gt;    --set ipam.operator.clusterPoolIPv4MaskSize&lt;span style=&#34;color:#ce5c00;font-weight:bold&#34;&gt;=&lt;/span&gt;&lt;span style=&#34;color:#0000cf;font-weight:bold&#34;&gt;24&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;æˆ–è€…ä½¿ç”¨Cilium CLI éƒ¨ç½²&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#8f5902;font-style:italic&#34;&gt;# å®‰è£…cilium cli&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;curl -L --remote-name https://github.com/cilium/cilium-cli/releases/latest/download/cilium-linux-amd64.tar.gz
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;tar xzvf cilium-linux-amd64.tar.gz
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;sudo mv cilium /usr/local/bin
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#8f5902;font-style:italic&#34;&gt;# éƒ¨ç½²ciliumå¥—ä»¶&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;kubectl create ns cilium-system &lt;span style=&#34;color:#ce5c00;font-weight:bold&#34;&gt;||&lt;/span&gt; &lt;span style=&#34;color:#204a87&#34;&gt;true&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;cilium install --namespace&lt;span style=&#34;color:#ce5c00;font-weight:bold&#34;&gt;=&lt;/span&gt;cilium-system &lt;span style=&#34;color:#4e9a06&#34;&gt;\
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#4e9a06&#34;&gt;&lt;/span&gt;		--ipam&lt;span style=&#34;color:#ce5c00;font-weight:bold&#34;&gt;=&lt;/span&gt;cluster-pool &lt;span style=&#34;color:#4e9a06&#34;&gt;\
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#4e9a06&#34;&gt;&lt;/span&gt;    --cluster-pool-ipv4-cidr&lt;span style=&#34;color:#ce5c00;font-weight:bold&#34;&gt;=&lt;/span&gt;10.244.0.0/16 &lt;span style=&#34;color:#4e9a06&#34;&gt;\
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#4e9a06&#34;&gt;&lt;/span&gt;    --cluster-pool-ipv4-mask-size&lt;span style=&#34;color:#ce5c00;font-weight:bold&#34;&gt;=&lt;/span&gt;&lt;span style=&#34;color:#0000cf;font-weight:bold&#34;&gt;24&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;h2 id=&#34;2-2-éƒ¨ç½²æ£€æŸ¥&#34;&gt;2.2. éƒ¨ç½²æ£€æŸ¥&lt;/h2&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;$ cilium status --wait
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;   /Â¯Â¯&lt;span style=&#34;color:#4e9a06&#34;&gt;\
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#4e9a06&#34;&gt;&lt;/span&gt;/Â¯Â¯&lt;span style=&#34;color:#4e9a06&#34;&gt;\_&lt;/span&gt;_/Â¯Â¯&lt;span style=&#34;color:#4e9a06&#34;&gt;\ &lt;/span&gt;   Cilium:         OK
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#4e9a06&#34;&gt;\_&lt;/span&gt;_/Â¯Â¯&lt;span style=&#34;color:#4e9a06&#34;&gt;\_&lt;/span&gt;_/    Operator:       OK
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;/Â¯Â¯&lt;span style=&#34;color:#4e9a06&#34;&gt;\_&lt;/span&gt;_/Â¯Â¯&lt;span style=&#34;color:#4e9a06&#34;&gt;\ &lt;/span&gt;   Hubble:         disabled
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#4e9a06&#34;&gt;\_&lt;/span&gt;_/Â¯Â¯&lt;span style=&#34;color:#4e9a06&#34;&gt;\_&lt;/span&gt;_/    ClusterMesh:    disabled
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;   &lt;span style=&#34;color:#4e9a06&#34;&gt;\_&lt;/span&gt;_/
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;DaemonSet         cilium             Desired: 2, Ready: 2/2, Available: 2/2
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;Deployment        cilium-operator    Desired: 2, Ready: 2/2, Available: 2/2
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;Containers:       cilium-operator    Running: &lt;span style=&#34;color:#0000cf;font-weight:bold&#34;&gt;2&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;                  cilium             Running: &lt;span style=&#34;color:#0000cf;font-weight:bold&#34;&gt;2&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;Image versions    cilium             quay.io/cilium/cilium:v1.9.5: &lt;span style=&#34;color:#0000cf;font-weight:bold&#34;&gt;2&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;                  cilium-operator    quay.io/cilium/operator-generic:v1.9.5: &lt;span style=&#34;color:#0000cf;font-weight:bold&#34;&gt;2&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;ç½‘ç»œè¿é€šæ€§æµ‹è¯•&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;$ cilium connectivity &lt;span style=&#34;color:#204a87&#34;&gt;test&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;â„¹ï¸  Monitor aggregation detected, will skip some flow validation steps
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;âœ¨ &lt;span style=&#34;color:#ce5c00;font-weight:bold&#34;&gt;[&lt;/span&gt;k8s-cluster&lt;span style=&#34;color:#ce5c00;font-weight:bold&#34;&gt;]&lt;/span&gt; Creating namespace &lt;span style=&#34;color:#204a87;font-weight:bold&#34;&gt;for&lt;/span&gt; connectivity check...
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#ce5c00;font-weight:bold&#34;&gt;(&lt;/span&gt;...&lt;span style=&#34;color:#ce5c00;font-weight:bold&#34;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;---------------------------------------------------------------------------------------------------------------------
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;ğŸ“‹ Test Report
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;---------------------------------------------------------------------------------------------------------------------
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;âœ… 69/69 tests successful &lt;span style=&#34;color:#ce5c00;font-weight:bold&#34;&gt;(&lt;/span&gt;&lt;span style=&#34;color:#0000cf;font-weight:bold&#34;&gt;0&lt;/span&gt; warnings&lt;span style=&#34;color:#ce5c00;font-weight:bold&#34;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;h2 id=&#34;2-3-cilium-ipam-æ¨¡å¼&#34;&gt;2.3. Cilium IPAM æ¨¡å¼&lt;/h2&gt;
&lt;p&gt;Cilium æ”¯æŒä»¥ä¸‹ä¸¤ç§å¸¸è§çš„ IPAM æ¨¡å¼ï¼š&lt;/p&gt;
&lt;h3 id=&#34;2-3-1-cluster-pool-æ¨¡å¼&#34;&gt;2.3.1. Cluster-Pool æ¨¡å¼ï¼š&lt;/h3&gt;
&lt;ul&gt;
&lt;li&gt;ç”± Cilium è‡ªå·±ç®¡ç† Pod IP åœ°å€èŒƒå›´ã€‚&lt;/li&gt;
&lt;li&gt;å¯ä»¥åœ¨éƒ¨ç½²æ—¶æŒ‡å®š CIDR èŒƒå›´ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;é«˜çµæ´»æ€§&lt;/strong&gt;ï¼šæ”¯æŒä¸ºä¸åŒèŠ‚ç‚¹æˆ–åŒºåŸŸå®šä¹‰ç‹¬ç«‹çš„ IP åœ°å€æ± ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;åŠ¨æ€ç®¡ç†&lt;/strong&gt;ï¼šå¯ä»¥åŠ¨æ€è°ƒæ•´ IP åœ°å€æ± å¤§å°ï¼Œé€‚åº”é›†ç¾¤çš„æ‰©å±•éœ€æ±‚ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;æ— å†²çªè®¾è®¡&lt;/strong&gt;ï¼šé¿å…å› èŠ‚ç‚¹å¢åŠ æˆ–åˆ é™¤å¼•èµ·çš„ IP åœ°å€å†²çªã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;ä¼˜åŒ–æ€§èƒ½&lt;/strong&gt;ï¼šå‡å°‘å¯¹ Kubernetes æ§åˆ¶å™¨çš„ä¾èµ–ï¼Œæé«˜ç½‘ç»œæ€§èƒ½å’Œèµ„æºåˆ©ç”¨ç‡ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;ä¾èµ– Cilium Operator&lt;/strong&gt;ï¼šéœ€è¦è¿è¡Œ Cilium Operator æ¥ç®¡ç† IP åœ°å€æ± ï¼Œå¢åŠ è¿ç»´å¤æ‚æ€§ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;&lt;strong&gt;æ¨èåœºæ™¯&lt;/strong&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;å¤§å‹é›†ç¾¤ï¼ˆ&amp;gt; 500 èŠ‚ç‚¹ï¼‰æˆ–è¶…å¤§è§„æ¨¡é›†ç¾¤ã€‚&lt;/li&gt;
&lt;li&gt;éœ€è¦è·¨åŒºåŸŸæˆ–å¤šèŠ‚ç‚¹æ± çš„å¤æ‚ç½‘ç»œè§„åˆ’ã€‚&lt;/li&gt;
&lt;li&gt;éœ€è¦åŠ¨æ€æ‰©å±• Pod IP åœ°å€èŒƒå›´çš„é›†ç¾¤ã€‚&lt;/li&gt;
&lt;li&gt;é›†ç¾¤è¿è¡Œ Cilium å¹¶éœ€è¦å……åˆ†åˆ©ç”¨å…¶é«˜çº§åŠŸèƒ½ï¼ˆå¦‚ eBPF åŠ é€Ÿã€æœåŠ¡ç½‘æ ¼ç­‰ï¼‰ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;h3 id=&#34;2-3-2-kubernetes-æ¨¡å¼-é»˜è®¤æ¨¡å¼&#34;&gt;2.3.2. Kubernetes æ¨¡å¼ï¼ˆé»˜è®¤æ¨¡å¼ï¼‰ï¼š&lt;/h3&gt;
&lt;ul&gt;
&lt;li&gt;ä½¿ç”¨ Kubernetes è‡ªèº«çš„ IP åœ°å€åˆ†é…æ–¹å¼ï¼Œä¾‹å¦‚ç”± &lt;code&gt;kube-controller-manager&lt;/code&gt; é€šè¿‡ &lt;code&gt;--cluster-cidr&lt;/code&gt; è¿›è¡Œç®¡ç†ã€‚&lt;/li&gt;
&lt;li&gt;Cilium ä» Kubernetes ä¸­è·å–åˆ†é…ç»™ Pod çš„ IP åœ°å€ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;å…¼å®¹æ€§å¼º&lt;/strong&gt;ï¼šé€‚é…å¤§å¤šæ•° CNI æ’ä»¶ï¼ˆåŒ…æ‹¬ Ciliumï¼‰ï¼Œæ— éœ€é¢å¤–é…ç½®ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;çµæ´»æ€§æœ‰é™&lt;/strong&gt;ï¼šä¸æ”¯æŒç»†ç²’åº¦çš„ IP åœ°å€æ± ç®¡ç†ï¼Œæ— æ³•ä¸ºç‰¹å®šèŠ‚ç‚¹æˆ–åŒºåŸŸåˆ†é…ç‰¹å®šçš„ IP èŒƒå›´ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;&lt;strong&gt;æ¨èåœºæ™¯&lt;/strong&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;å°å‹æˆ–ä¸­å‹é›†ç¾¤ï¼ˆ&amp;lt; 500 èŠ‚ç‚¹ï¼‰ã€‚&lt;/li&gt;
&lt;li&gt;ç½‘ç»œè§„åˆ’è¾ƒä¸ºç®€å•ï¼Œæ— éœ€å¤æ‚çš„ IP åœ°å€ç®¡ç†ã€‚&lt;/li&gt;
&lt;li&gt;éœ€è¦å¿«é€Ÿéƒ¨ç½²å¹¶ä¿æŒä¸ Kubernetes é»˜è®¤è¡Œä¸ºä¸€è‡´ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;h1 id=&#34;3-ciliumæ¶æ„åŠç»„ä»¶ä»‹ç»&#34;&gt;3. Ciliumæ¶æ„åŠç»„ä»¶ä»‹ç»&lt;/h1&gt;
&lt;h2 id=&#34;3-1-æ¶æ„å›¾&#34;&gt;3.1. æ¶æ„å›¾&lt;/h2&gt;
&lt;p&gt;å‚è€ƒå®˜ç½‘ï¼š &lt;a href=&#34;https://docs.cilium.io/en/stable/overview/component-overview/&#34;&gt;https://docs.cilium.io/en/stable/overview/component-overview/&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;https://res.cloudinary.com/dqxtn0ick/image/upload/v1731811820/article/kubernetes/network/cilium/cilium-arch.webp&#34; alt=&#34;&#34;&gt;&lt;/p&gt;
&lt;h2 id=&#34;3-2-æ ¸å¿ƒç»„ä»¶&#34;&gt;3.2. æ ¸å¿ƒç»„ä»¶&lt;/h2&gt;
&lt;p&gt;&lt;strong&gt;1. Cilium Agent&lt;/strong&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;è¿è¡Œåœ¨æ¯ä¸ª Kubernetes èŠ‚ç‚¹ä¸Šï¼Œæ˜¯ Cilium çš„æ ¸å¿ƒå®ˆæŠ¤è¿›ç¨‹ã€‚&lt;/li&gt;
&lt;li&gt;åŠŸèƒ½ï¼š
&lt;ul&gt;
&lt;li&gt;ä» Kubernetes API Server è·å–èµ„æºï¼ˆå¦‚ Podã€Service å’Œç½‘ç»œç­–ç•¥ï¼‰å¹¶è½¬æ¢ä¸º eBPF ç¨‹åºã€‚&lt;/li&gt;
&lt;li&gt;åœ¨æ¯ä¸ªèŠ‚ç‚¹ä¸Šç®¡ç†å’ŒåŠ è½½ eBPF ç¨‹åºåˆ°å†…æ ¸ã€‚&lt;/li&gt;
&lt;li&gt;å®ç° L3/L4 å’Œ L7 ç½‘ç»œç­–ç•¥ï¼Œå¹¶å°†ç­–ç•¥ä¸‹å‘åˆ°æ•°æ®å¹³é¢ã€‚&lt;/li&gt;
&lt;li&gt;è´Ÿè´£æœåŠ¡å‘ç°å’Œè´Ÿè½½å‡è¡¡ï¼ˆå–ä»£ kube-proxyï¼‰ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;&lt;strong&gt;2. Cilium CLI&lt;/strong&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;å‘½ä»¤è¡Œå·¥å…·ï¼Œç”¨äºå®‰è£…ã€é…ç½®å’Œè°ƒè¯• Ciliumã€‚&lt;/li&gt;
&lt;li&gt;åŠŸèƒ½ï¼š
&lt;ul&gt;
&lt;li&gt;é…ç½® Cilium çš„ç½‘ç»œç­–ç•¥ã€‚&lt;/li&gt;
&lt;li&gt;æŸ¥çœ‹ Cilium å’Œ Hubble çš„è¿è¡ŒçŠ¶æ€ã€‚&lt;/li&gt;
&lt;li&gt;è°ƒè¯• eBPF ç¨‹åºã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;&lt;strong&gt;3. CNI Plugin&lt;/strong&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;å½“åœ¨èŠ‚ç‚¹ä¸Šè°ƒåº¦æˆ–ç»ˆæ­¢podæ—¶ï¼ŒKubernetesä¼šè°ƒç”¨CNIæ’ä»¶ï¼ˆcilium-cniï¼‰ã€‚å®ƒä¸èŠ‚ç‚¹çš„Cilium APIäº¤äº’ï¼Œè§¦å‘å¿…è¦çš„æ•°æ®è·¯å¾„é…ç½®ï¼Œä¸ºpodæä¾›ç½‘ç»œã€è´Ÿè½½å¹³è¡¡å’Œç½‘ç»œç­–ç•¥ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;&lt;strong&gt;4. Cilium Operator&lt;/strong&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;åœ¨ Kubernetes ä¸­è¿è¡Œçš„æ§åˆ¶å¹³é¢ç»„ä»¶ã€‚&lt;/li&gt;
&lt;li&gt;åŠŸèƒ½ï¼š
&lt;ul&gt;
&lt;li&gt;å¤„ç† IP åœ°å€ç®¡ç†ï¼šç®¡ç† Pod çš„ IP æ± ã€‚&lt;/li&gt;
&lt;li&gt;ç»´æŠ¤ Cilium Agent ä¸ Kubernetes çš„é›†æˆã€‚&lt;/li&gt;
&lt;li&gt;å¤„ç†èŠ‚ç‚¹é—´çš„æ‹“æ‰‘å˜åŒ–ï¼ˆå¦‚èŠ‚ç‚¹åŠ å…¥æˆ–ç¦»å¼€ï¼‰ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;h2 id=&#34;3-3-å…¶ä»–ç»„ä»¶&#34;&gt;3.3. å…¶ä»–ç»„ä»¶&lt;/h2&gt;
&lt;p&gt;&lt;strong&gt;1. eBPF ç¨‹åº&lt;/strong&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;Cilium çš„æ•°æ®å¹³é¢æ ¸å¿ƒï¼Œè¿è¡Œåœ¨ Linux å†…æ ¸ä¸­ã€‚&lt;/li&gt;
&lt;li&gt;åŠŸèƒ½ï¼š
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;è·¯ç”±å’Œè½¬å‘&lt;/strong&gt;ï¼šåœ¨èŠ‚ç‚¹é—´å¤„ç† Pod çš„ç½‘ç»œæµé‡ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;ç½‘ç»œç­–ç•¥&lt;/strong&gt;ï¼šå®ç° L3/L4 å’Œ L7 çš„è®¿é—®æ§åˆ¶ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;æœåŠ¡è´Ÿè½½å‡è¡¡&lt;/strong&gt;ï¼šæä¾›ç±»ä¼¼ kube-proxy çš„æœåŠ¡è½¬å‘åŠŸèƒ½ï¼Œä½†æ€§èƒ½æ›´é«˜ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;ç›‘æ§å’Œå¯è§‚æµ‹æ€§&lt;/strong&gt;ï¼šæ”¶é›†ç½‘ç»œæµé‡æ•°æ®ï¼Œä¾› Hubble æˆ–å…¶ä»–å·¥å…·åˆ†æã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;&lt;strong&gt;2. Hubble&lt;/strong&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;Cilium çš„å¯è§‚æµ‹æ€§å¹³å°ï¼Œç”¨äºå®æ—¶ç›‘æ§å’Œåˆ†æç½‘ç»œæµé‡ã€‚&lt;/li&gt;
&lt;li&gt;åŠŸèƒ½ï¼š
&lt;ul&gt;
&lt;li&gt;æµé‡å¯è§†åŒ–ï¼šå±•ç¤ºæœåŠ¡é—´çš„æµé‡è·¯å¾„å’Œç»Ÿè®¡ã€‚&lt;/li&gt;
&lt;li&gt;æµé‡è¿½è¸ªï¼šæ•è·å’Œè°ƒè¯•ç½‘ç»œé—®é¢˜ã€‚&lt;/li&gt;
&lt;li&gt;å»¶è¿Ÿå’Œé”™è¯¯ç‡ç›‘æ§ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;h1 id=&#34;4-cilium-çš„å·¥ä½œæµ&#34;&gt;&lt;strong&gt;4. Cilium çš„å·¥ä½œæµ&lt;/strong&gt;&lt;/h1&gt;
&lt;ol&gt;
&lt;li&gt;&lt;strong&gt;åˆå§‹åŒ–&lt;/strong&gt;ï¼š
&lt;ul&gt;
&lt;li&gt;Cilium Agent å¯åŠ¨åï¼Œä¸ Kubernetes API Server å»ºç«‹è¿æ¥ï¼Œç›‘å¬èµ„æºå˜åŒ–ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;ç­–ç•¥é…ç½®&lt;/strong&gt;ï¼š
&lt;ul&gt;
&lt;li&gt;ç”¨æˆ·å®šä¹‰çš„ &lt;code&gt;NetworkPolicy&lt;/code&gt; æˆ– &lt;code&gt;CiliumNetworkPolicy&lt;/code&gt; é€šè¿‡ Cilium Agent ä¼ é€’åˆ° eBPF ç¨‹åºã€‚&lt;/li&gt;
&lt;li&gt;eBPF ç¨‹åºåœ¨å†…æ ¸ä¸­ç›´æ¥æ‰§è¡Œæµé‡æ§åˆ¶é€»è¾‘ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;æµé‡å¤„ç†&lt;/strong&gt;ï¼š
&lt;ul&gt;
&lt;li&gt;æ•°æ®å¹³é¢é€šè¿‡ eBPF ç¨‹åºå¯¹ç½‘ç»œæµé‡è¿›è¡Œè·¯ç”±ã€ç­–ç•¥åŒ¹é…å’Œè´Ÿè½½å‡è¡¡ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;ç›‘æ§å’Œåˆ†æ&lt;/strong&gt;ï¼š
&lt;ul&gt;
&lt;li&gt;eBPF ç¨‹åºæ”¶é›†æµé‡æ•°æ®ï¼Œå‘é€åˆ° Hubbleã€‚&lt;/li&gt;
&lt;li&gt;Hubble å°†æ•°æ®å¯è§†åŒ–ï¼Œä¾›ç”¨æˆ·ç›‘æ§å’Œè°ƒè¯•ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;å‚è€ƒï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href=&#34;https://docs.cilium.io/en/stable/&#34;&gt;https://docs.cilium.io/en/stable/&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://docs.cilium.io/en/stable/overview/component-overview/&#34;&gt;https://docs.cilium.io/en/stable/overview/component-overview/&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;

      </description>
    </item>
    
    <item>
      <title>Kubernetes-Notes: Calicoä»‹ç»</title>
      <link>https://blog.huweihuang.com/kubernetes-notes/network/calico/calico-arch/</link>
      <pubDate>Sat, 26 Oct 2024 10:50:57 +0000</pubDate>
      
      <guid>https://blog.huweihuang.com/kubernetes-notes/network/calico/calico-arch/</guid>
      <description>
        
        
        &lt;h1 id=&#34;1-calicoç®€ä»‹&#34;&gt;1. Calicoç®€ä»‹&lt;/h1&gt;
&lt;p&gt;&lt;strong&gt;Calico&lt;/strong&gt; æ˜¯ä¸€ä¸ªå¼€æºçš„ç½‘ç»œå’Œç½‘ç»œå®‰å…¨è§£å†³æ–¹æ¡ˆï¼Œä¸»è¦ç”¨äº Kubernetes ç­‰å®¹å™¨ç¼–æ’ç³»ç»Ÿã€‚å®ƒé€šè¿‡æä¾›é«˜æ•ˆçš„ç½‘ç»œè¿æ¥å’Œå¼ºå¤§çš„å®‰å…¨æ§åˆ¶æ¥æ»¡è¶³å®¹å™¨åŒ–å’Œå¾®æœåŠ¡æ¶æ„çš„éœ€æ±‚ã€‚Calico ä»¥å…¶çµæ´»æ€§ã€å¯æ‰©å±•æ€§å’Œæ€§èƒ½è‘—ç§°ï¼Œæ˜¯è®¸å¤šä¼ä¸šå’Œäº‘åŸç”Ÿåº”ç”¨çš„é¦–é€‰ç½‘ç»œæ’ä»¶ã€‚&lt;/p&gt;
&lt;h2 id=&#34;1-1-ä¸»è¦åŠŸèƒ½å’Œç‰¹ç‚¹&#34;&gt;1.1. ä¸»è¦åŠŸèƒ½å’Œç‰¹ç‚¹&lt;/h2&gt;
&lt;ol&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;ç½‘ç»œæ¶æ„&lt;/strong&gt;ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;L3 è·¯ç”±æ¶æ„&lt;/strong&gt;ï¼šCalico åŸºäºç¬¬ä¸‰å±‚ï¼ˆL3ï¼‰ç½‘ç»œæ„å»ºï¼Œä¸ä¾èµ–ä¼ ç»Ÿçš„è¦†ç›–ç½‘ç»œï¼ˆoverlay networkï¼‰ï¼Œä½¿å…¶å¯ä»¥åˆ©ç”¨ IP è·¯ç”±æ¥å®ç°è·¨èŠ‚ç‚¹çš„ç›´æ¥é€šä¿¡ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;BGP æ”¯æŒ&lt;/strong&gt;ï¼šCalico ä½¿ç”¨ BGPï¼ˆè¾¹ç•Œç½‘å…³åè®®ï¼‰æ¥åˆ†å‘å’ŒåŒæ­¥è·¯ç”±ä¿¡æ¯ï¼Œä½¿å¾—å®¹å™¨å’Œ Pod èƒ½å¤Ÿè·¨èŠ‚ç‚¹ç›´æ¥é€šä¿¡ï¼Œå‡å°‘ç½‘ç»œå»¶è¿Ÿï¼Œæå‡æ€§èƒ½ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;æ”¯æŒå¤šç§åç«¯&lt;/strong&gt;ï¼šé™¤äº†é»˜è®¤çš„ IP è·¯ç”±æ¨¡å¼ï¼ŒCalico ä¹Ÿæ”¯æŒ VXLANã€IPIPã€WireGuard å’Œ eBPF åç«¯ï¼Œé€‚åº”ä¸åŒçš„ç½‘ç»œç¯å¢ƒå’Œéœ€æ±‚ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;ç½‘ç»œå®‰å…¨&lt;/strong&gt;ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;ç½‘ç»œç­–ç•¥&lt;/strong&gt;ï¼šCalico æ”¯æŒæ ‡å‡†çš„ Kubernetes NetworkPolicyï¼Œç”¨æˆ·å¯ä»¥é€šè¿‡ç­–ç•¥æ§åˆ¶ Pod ä¹‹é—´çš„é€šä¿¡æƒé™ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;GlobalNetworkPolicy&lt;/strong&gt;ï¼šCalico æä¾› GlobalNetworkPolicyï¼Œå¯ä»¥å®ç°è·¨å‘½åç©ºé—´ã€è·¨é›†ç¾¤çš„ç»Ÿä¸€ç­–ç•¥ç®¡ç†ï¼Œç”¨äºå¤šç§Ÿæˆ·éš”ç¦»æˆ–æ›´é«˜çš„å®‰å…¨æ§åˆ¶ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;æ”¯æŒ eBPF&lt;/strong&gt;ï¼šCalico åœ¨å¯ç”¨ eBPF æ¨¡å¼æ—¶ï¼Œå¯ä»¥é€šè¿‡ eBPF æä¾›æ›´é«˜æ•ˆçš„ç½‘ç»œæ•°æ®å¤„ç†ï¼Œå¹¶æ”¯æŒ L4 å±‚çš„è´Ÿè½½å‡è¡¡å’Œç½‘ç»œç­–ç•¥æ§åˆ¶ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;å¯è§‚æµ‹æ€§å’Œå¯è§†åŒ–&lt;/strong&gt;ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;Calico é›†æˆäº†å¤šç§å¯è§‚æµ‹æ€§å·¥å…·ï¼Œæ”¯æŒ Prometheus ç­‰ç›‘æ§ç³»ç»Ÿï¼Œå¹¶å¯ä»¥ç”Ÿæˆç½‘ç»œæµé‡å’Œç­–ç•¥çš„ç›‘æ§æŒ‡æ ‡ï¼Œå¸®åŠ©è¿ç»´äººå‘˜äº†è§£ç½‘ç»œçŠ¶å†µã€‚&lt;/li&gt;
&lt;li&gt;æ”¯æŒä¸ EFKï¼ˆElasticsearch, Fluentd, Kibanaï¼‰é›†æˆï¼Œä¾¿äºå¯è§†åŒ–ç½‘ç»œæµé‡å’Œç­–ç•¥ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;é«˜æ‰©å±•æ€§&lt;/strong&gt;ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;Calico å¯ä»¥åœ¨ä¸åŒçš„åŸºç¡€è®¾æ–½ä¸­è¿è¡Œï¼ŒåŒ…æ‹¬æœ¬åœ°æ•°æ®ä¸­å¿ƒå’Œäº‘å¹³å°ï¼ˆAWSã€GCPã€Azureï¼‰ï¼Œå¹¶æ”¯æŒä¸ VM åŠè£¸é‡‘å±æœåŠ¡å™¨äº’è”ã€‚&lt;/li&gt;
&lt;li&gt;ä½¿ç”¨ IP è·¯ç”±å’Œ BGPï¼Œä½¿å¾— Calico åœ¨å¤§è§„æ¨¡é›†ç¾¤ä¸­ä¹Ÿèƒ½ä¿æŒè‰¯å¥½çš„æ€§èƒ½å’Œæ‰©å±•æ€§ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ol&gt;
&lt;h2 id=&#34;1-2-é€‚ç”¨åœºæ™¯&#34;&gt;1.2. é€‚ç”¨åœºæ™¯&lt;/h2&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;å®¹å™¨åŒ–åº”ç”¨çš„ç½‘ç»œç®¡ç†&lt;/strong&gt;ï¼šé€‚ç”¨äº Kubernetes ç­‰å®¹å™¨ç¼–æ’å¹³å°ï¼Œä¸ºå®¹å™¨æä¾›é«˜æ•ˆã€å®‰å…¨çš„ç½‘ç»œè¿æ¥ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;æ··åˆäº‘å’Œå¤šé›†ç¾¤éƒ¨ç½²&lt;/strong&gt;ï¼šCalico æ”¯æŒè·¨æ•°æ®ä¸­å¿ƒå’Œäº‘ç¯å¢ƒçš„å¤šé›†ç¾¤éƒ¨ç½²ï¼Œéå¸¸é€‚åˆæ··åˆäº‘å’Œå¤šç§Ÿæˆ·ç¯å¢ƒã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;ç½‘ç»œå®‰å…¨&lt;/strong&gt;ï¼šå¯¹äºéœ€è¦ç»†ç²’åº¦çš„ç½‘ç»œå®‰å…¨ç­–ç•¥æ§åˆ¶å’Œå¤šç§Ÿæˆ·éš”ç¦»çš„åœºæ™¯ï¼ŒCalico æä¾›å¤šå±‚æ¬¡çš„å®‰å…¨æ§åˆ¶å’Œéš”ç¦»ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;h1 id=&#34;2-calicoæ¶æ„å›¾&#34;&gt;2. Calicoæ¶æ„å›¾&lt;/h1&gt;
&lt;blockquote&gt;
&lt;p&gt;æ¥è‡ªå®˜ç½‘&lt;/p&gt;
&lt;/blockquote&gt;
&lt;img src=&#34;https://res.cloudinary.com/dqxtn0ick/image/upload/v1693626884/article/calico/calico-architecture.png&#34; title=&#34;&#34; alt=&#34;&#34; width=&#34;1046&#34;&gt;
&lt;h2 id=&#34;2-1-calico-æ¶æ„æ¦‚è§ˆ&#34;&gt;2.1. Calico æ¶æ„æ¦‚è§ˆ&lt;/h2&gt;
&lt;p&gt;Calico é€šè¿‡ BGPï¼ˆè¾¹ç•Œç½‘å…³åè®®ï¼‰åœ¨ Kubernetes é›†ç¾¤èŠ‚ç‚¹ä¹‹é—´è¿›è¡Œè·¯ç”±å¹¿æ’­ï¼Œæ— éœ€ä½¿ç”¨å¤æ‚çš„éš§é“åè®®ï¼ˆå¦‚ VXLAN æˆ– GREï¼‰ï¼Œè¿™ä½¿å¾— Calico çš„ç½‘ç»œæ€§èƒ½è¾ƒé«˜ã€‚å®ƒä¸»è¦ç”±ä»¥ä¸‹ç»„ä»¶ç»„æˆï¼š&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;&lt;strong&gt;calico-node&lt;/strong&gt;ï¼šè¿™æ˜¯ Calico çš„æ ¸å¿ƒç»„ä»¶ï¼Œè¿è¡Œåœ¨æ¯ä¸ªèŠ‚ç‚¹ä¸Šï¼Œè´Ÿè´£è®¾ç½®è·¯ç”±ã€ç®¡ç† IP åœ°å€ï¼Œå¹¶é€šè¿‡ Felix å®ç°ç½‘ç»œç­–ç•¥çš„æ‰§è¡Œã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;BGP Daemon (Bird)&lt;/strong&gt;ï¼šè´Ÿè´£èŠ‚ç‚¹ä¹‹é—´çš„è·¯ç”±ä¼ æ’­ï¼Œä»¥å®ç°ä¸åŒèŠ‚ç‚¹ Pod ä¹‹é—´çš„æµé‡è·¯ç”±ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;Felix&lt;/strong&gt;ï¼šä½œä¸º Calico çš„ä¸»ä»£ç†ï¼Œè´Ÿè´£ç›‘æ§ etcd ä¸­å­˜å‚¨çš„ç½‘ç»œç­–ç•¥å¹¶å°†å…¶åº”ç”¨äºèŠ‚ç‚¹çš„ç½‘ç»œæ¥å£ï¼ŒåŒæ—¶è´Ÿè´£è®¾ç½® IP è·¯ç”±ã€ç®¡ç† ACLs ä»¥ç¡®ä¿æµé‡ç¬¦åˆç­–ç•¥ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;Typha&lt;/strong&gt;ï¼šå½“èŠ‚ç‚¹æ•°è¾ƒå¤šæ—¶ï¼Œå¯ä»¥é€šè¿‡ Typha ç»„ä»¶æ¥å‡å°‘ etcd çš„è®¿é—®è´Ÿè½½ã€‚å®ƒä¼šå°† etcd ä¸­çš„ç­–ç•¥å˜åŒ–ç¼“å­˜èµ·æ¥ï¼Œå¹¶åŒæ­¥ç»™æ¯ä¸ªèŠ‚ç‚¹çš„ Felix ä»£ç†ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;etcd&lt;/strong&gt;ï¼šCalico ä½¿ç”¨ etcd ä½œä¸ºå­˜å‚¨åç«¯ï¼Œç”¨äºå­˜å‚¨ç½‘ç»œç­–ç•¥ã€IP æ± ç­‰é…ç½®ã€‚ä¹Ÿå¯ä»¥ä½¿ç”¨ Kubernetes çš„ API Server ä½œä¸ºå­˜å‚¨åç«¯ï¼Œä¾¿äºé›†æˆã€‚&lt;/li&gt;
&lt;/ol&gt;
&lt;h2 id=&#34;2-2-calico-çš„æ ¸å¿ƒç»„ä»¶&#34;&gt;2.2. Calico çš„æ ¸å¿ƒç»„ä»¶&lt;/h2&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;calicoctl&lt;/strong&gt;ï¼šè¿™æ˜¯ Calico æä¾›çš„å‘½ä»¤è¡Œå·¥å…·ï¼Œç”¨äºé…ç½®å’Œç®¡ç† Calico çš„èµ„æºï¼Œæ¯”å¦‚ IP æ± ã€ç­–ç•¥ã€ç½‘ç»œè®¾ç½®ç­‰ã€‚å¯ä»¥é€šè¿‡è¯¥å·¥å…·æŸ¥çœ‹ã€åˆ›å»ºã€æ›´æ–°å’Œåˆ é™¤ç½‘ç»œç­–ç•¥ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;IPAM (IP Address Management)&lt;/strong&gt;ï¼šCalico è‡ªå¸¦çš„ IP åœ°å€ç®¡ç†æ¨¡å—ï¼Œå¯ä»¥ä¸ºé›†ç¾¤ä¸­çš„ Pod è‡ªåŠ¨åˆ†é… IP åœ°å€ã€‚IPAM æ”¯æŒçµæ´»çš„ IP æ± è®¾ç½®ï¼Œå¯ä»¥å¯¹ä¸åŒçš„èŠ‚ç‚¹ã€å‘½åç©ºé—´æˆ–å·¥ä½œè´Ÿè½½åˆ†é…ç‰¹å®šçš„ IP èŒƒå›´ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;h2 id=&#34;2-3-å·¥ä½œæµç¨‹&#34;&gt;2.3. å·¥ä½œæµç¨‹&lt;/h2&gt;
&lt;ul&gt;
&lt;li&gt;æ¯ä¸ªèŠ‚ç‚¹ä¸Šè¿è¡Œçš„ calico-node ç»„ä»¶ä¼šå’Œå…¶ä»–èŠ‚ç‚¹è¿›è¡Œ BGP è·¯ç”±ä¿¡æ¯äº¤æ¢ï¼Œç¡®ä¿ä¸åŒèŠ‚ç‚¹çš„ Pod å¯ä»¥äº’ç›¸é€šä¿¡ã€‚&lt;/li&gt;
&lt;li&gt;Felix ç»„ä»¶è´Ÿè´£å°†ç½‘ç»œç­–ç•¥çš„å®šä¹‰åº”ç”¨åˆ°å®é™…çš„ç½‘ç»œæ¥å£ä¸Šï¼Œä»¥ç¡®ä¿æµé‡ç¬¦åˆé¢„è®¾çš„ç­–ç•¥ã€‚&lt;/li&gt;
&lt;li&gt;Typha ç»„ä»¶åœ¨å¤§è§„æ¨¡é›†ç¾¤ä¸­å¯ä»¥æœ‰æ•ˆåœ°å‡å°‘ etcd çš„å‹åŠ›ï¼Œå¸®åŠ© Felix å¿«é€ŸåŒæ­¥ç½‘ç»œç­–ç•¥ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;h2 id=&#34;2-4-calico-ç½‘ç»œç­–ç•¥-network-policy&#34;&gt;2.4. Calico ç½‘ç»œç­–ç•¥ (Network Policy)&lt;/h2&gt;
&lt;p&gt;Calico æ”¯æŒä¸°å¯Œçš„ç½‘ç»œç­–ç•¥ï¼Œç”¨äºå®šä¹‰ä¸åŒçš„ Pod æˆ–æœåŠ¡ä¹‹é—´çš„ç½‘ç»œè®¿é—®è§„åˆ™ã€‚ç½‘ç»œç­–ç•¥çš„ä¸»è¦åŠŸèƒ½åŒ…æ‹¬ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;åŸºäºæ ‡ç­¾çš„ç­–ç•¥&lt;/strong&gt;ï¼šå¯ä»¥æ ¹æ® Pod æˆ–å‘½åç©ºé—´çš„æ ‡ç­¾æ¥æ§åˆ¶ç½‘ç»œæµé‡çš„å…è®¸å’Œæ‹’ç»ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;æ”¯æŒ Egress å’Œ Ingress ç­–ç•¥&lt;/strong&gt;ï¼šä¸ä»…å¯ä»¥æ§åˆ¶è¿›å…¥ Pod çš„æµé‡ï¼Œè¿˜å¯ä»¥æ§åˆ¶ Pod å‘å‡ºçš„æµé‡ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;çµæ´»çš„è§„åˆ™å®šä¹‰&lt;/strong&gt;ï¼šæ”¯æŒåŸºäº IP åœ°å€ã€ç«¯å£ã€åè®®çš„è§„åˆ™é…ç½®ï¼Œèƒ½å¤Ÿç²¾ç»†åœ°æ§åˆ¶ç½‘ç»œæµé‡ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;h1 id=&#34;3-calicoç»„ä»¶åŠé…ç½®&#34;&gt;3. Calicoç»„ä»¶åŠé…ç½®&lt;/h1&gt;
&lt;p&gt;calicoçš„éƒ¨ç½²å¯å‚è€ƒï¼š&lt;a href=&#34;https://github.com/huweihuang/kubeadm-scripts/blob/main/cni/install-calico.sh&#34;&gt;kubeadm-scripts/cni/install-calico.sh&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;éƒ¨ç½²å®Œæˆåå¯ä»¥åœ¨k8sé›†ç¾¤ä¸­çœ‹åˆ°ä»¥ä¸‹ç»„ä»¶ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;ä¸­æ§ç»„ä»¶ï¼šcalico-kube-controllers&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;èŠ‚ç‚¹ç»„ä»¶ï¼šcalico-node&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;calico-system   calico-kube-controllers-8945657f7-ntbxm             1/1     Running   &lt;span style=&#34;color:#0000cf;font-weight:bold&#34;&gt;0&lt;/span&gt;             421d
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;calico-system   calico-node-2df8c                                   1/1     Running   &lt;span style=&#34;color:#0000cf;font-weight:bold&#34;&gt;0&lt;/span&gt;             421d
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;calico-system   calico-node-5vq6z                                   1/1     Running   &lt;span style=&#34;color:#0000cf;font-weight:bold&#34;&gt;0&lt;/span&gt;             421d
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;calico-system   calico-node-dpnkd                                   1/1     Running   &lt;span style=&#34;color:#0000cf;font-weight:bold&#34;&gt;0&lt;/span&gt;             421d
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;calico-system   calico-node-sms2h                                   1/1     Running   &lt;span style=&#34;color:#0000cf;font-weight:bold&#34;&gt;0&lt;/span&gt;             421d
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;calico-system   calico-node-w95l2                                   1/1     Running   &lt;span style=&#34;color:#0000cf;font-weight:bold&#34;&gt;0&lt;/span&gt;             414d
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;h2 id=&#34;3-1-calico-nodeè¿›ç¨‹æ ‘&#34;&gt;3.1. calico nodeè¿›ç¨‹æ ‘&lt;/h2&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#4e9a06&#34;&gt;\_&lt;/span&gt; /usr/local/bin/runsvdir -P /etc/service/enabled
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#4e9a06&#34;&gt;\_&lt;/span&gt; runsv confd
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;|&lt;/span&gt;   &lt;span style=&#34;color:#4e9a06&#34;&gt;\_&lt;/span&gt; calico-node -confd
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#4e9a06&#34;&gt;\_&lt;/span&gt; runsv allocate-tunnel-addrs
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;|&lt;/span&gt;   &lt;span style=&#34;color:#4e9a06&#34;&gt;\_&lt;/span&gt; calico-node -allocate-tunnel-addrs
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#4e9a06&#34;&gt;\_&lt;/span&gt; runsv monitor-addresses
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;|&lt;/span&gt;   &lt;span style=&#34;color:#4e9a06&#34;&gt;\_&lt;/span&gt; calico-node -monitor-addresses
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#4e9a06&#34;&gt;\_&lt;/span&gt; runsv bird
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;|&lt;/span&gt;   &lt;span style=&#34;color:#4e9a06&#34;&gt;\_&lt;/span&gt; bird -R -s /var/run/calico/bird.ctl -d -c /etc/calico/confd/config/bird.cfg
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#4e9a06&#34;&gt;\_&lt;/span&gt; runsv felix
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;|&lt;/span&gt;   &lt;span style=&#34;color:#4e9a06&#34;&gt;\_&lt;/span&gt; calico-node -felix
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#4e9a06&#34;&gt;\_&lt;/span&gt; runsv cni
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;|&lt;/span&gt;   &lt;span style=&#34;color:#4e9a06&#34;&gt;\_&lt;/span&gt; calico-node -monitor-token
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#4e9a06&#34;&gt;\_&lt;/span&gt; runsv node-status-reporter
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;|&lt;/span&gt;   &lt;span style=&#34;color:#4e9a06&#34;&gt;\_&lt;/span&gt; calico-node -status-reporter
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#4e9a06&#34;&gt;\_&lt;/span&gt; runsv bird6
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        &lt;span style=&#34;color:#4e9a06&#34;&gt;\_&lt;/span&gt; bird6 -R -s /var/run/calico/bird6.ctl -d -c /etc/calico/confd/config/bird6.cfg
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;h2 id=&#34;3-2-calico-kube-controllersè¿›ç¨‹æ ‘&#34;&gt;3.2. calico-kube-controllersè¿›ç¨‹æ ‘&lt;/h2&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;/usr/bin/kube-controllers
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;h2 id=&#34;3-3-cni-calicoäºŒè¿›åˆ¶&#34;&gt;3.3. CNI calicoäºŒè¿›åˆ¶&lt;/h2&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#204a87&#34;&gt;cd&lt;/span&gt; /opt/cni/bin
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;|&lt;/span&gt;-- calico
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;|&lt;/span&gt;-- calico-ipam
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;|&lt;/span&gt;-- install
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;h2 id=&#34;3-4-cni-calicoé…ç½®&#34;&gt;3.4. CNI calicoé…ç½®&lt;/h2&gt;
&lt;p&gt;&lt;strong&gt;10-calico.conflist&lt;/strong&gt;&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#204a87&#34;&gt;cd&lt;/span&gt; /etc/cni/net.d
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#8f5902;font-style:italic&#34;&gt;# cat 10-calico.conflist&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#ce5c00;font-weight:bold&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  &lt;span style=&#34;color:#4e9a06&#34;&gt;&amp;#34;name&amp;#34;&lt;/span&gt;: &lt;span style=&#34;color:#4e9a06&#34;&gt;&amp;#34;k8s-pod-network&amp;#34;&lt;/span&gt;,
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  &lt;span style=&#34;color:#4e9a06&#34;&gt;&amp;#34;cniVersion&amp;#34;&lt;/span&gt;: &lt;span style=&#34;color:#4e9a06&#34;&gt;&amp;#34;0.3.1&amp;#34;&lt;/span&gt;,
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  &lt;span style=&#34;color:#4e9a06&#34;&gt;&amp;#34;plugins&amp;#34;&lt;/span&gt;: &lt;span style=&#34;color:#ce5c00;font-weight:bold&#34;&gt;[&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#ce5c00;font-weight:bold&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;      &lt;span style=&#34;color:#4e9a06&#34;&gt;&amp;#34;type&amp;#34;&lt;/span&gt;: &lt;span style=&#34;color:#4e9a06&#34;&gt;&amp;#34;calico&amp;#34;&lt;/span&gt;,
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;      &lt;span style=&#34;color:#4e9a06&#34;&gt;&amp;#34;log_level&amp;#34;&lt;/span&gt;: &lt;span style=&#34;color:#4e9a06&#34;&gt;&amp;#34;info&amp;#34;&lt;/span&gt;,
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;      &lt;span style=&#34;color:#4e9a06&#34;&gt;&amp;#34;log_file_path&amp;#34;&lt;/span&gt;: &lt;span style=&#34;color:#4e9a06&#34;&gt;&amp;#34;/var/log/calico/cni/cni.log&amp;#34;&lt;/span&gt;,
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;      &lt;span style=&#34;color:#4e9a06&#34;&gt;&amp;#34;datastore_type&amp;#34;&lt;/span&gt;: &lt;span style=&#34;color:#4e9a06&#34;&gt;&amp;#34;kubernetes&amp;#34;&lt;/span&gt;,
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;      &lt;span style=&#34;color:#4e9a06&#34;&gt;&amp;#34;nodename&amp;#34;&lt;/span&gt;: &lt;span style=&#34;color:#4e9a06&#34;&gt;&amp;#34;node1&amp;#34;&lt;/span&gt;,
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;      &lt;span style=&#34;color:#4e9a06&#34;&gt;&amp;#34;mtu&amp;#34;&lt;/span&gt;: 0,
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;      &lt;span style=&#34;color:#4e9a06&#34;&gt;&amp;#34;ipam&amp;#34;&lt;/span&gt;: &lt;span style=&#34;color:#ce5c00;font-weight:bold&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;          &lt;span style=&#34;color:#4e9a06&#34;&gt;&amp;#34;type&amp;#34;&lt;/span&gt;: &lt;span style=&#34;color:#4e9a06&#34;&gt;&amp;#34;calico-ipam&amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;      &lt;span style=&#34;color:#ce5c00;font-weight:bold&#34;&gt;}&lt;/span&gt;,
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;      &lt;span style=&#34;color:#4e9a06&#34;&gt;&amp;#34;policy&amp;#34;&lt;/span&gt;: &lt;span style=&#34;color:#ce5c00;font-weight:bold&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;          &lt;span style=&#34;color:#4e9a06&#34;&gt;&amp;#34;type&amp;#34;&lt;/span&gt;: &lt;span style=&#34;color:#4e9a06&#34;&gt;&amp;#34;k8s&amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;      &lt;span style=&#34;color:#ce5c00;font-weight:bold&#34;&gt;}&lt;/span&gt;,
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;      &lt;span style=&#34;color:#4e9a06&#34;&gt;&amp;#34;kubernetes&amp;#34;&lt;/span&gt;: &lt;span style=&#34;color:#ce5c00;font-weight:bold&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;          &lt;span style=&#34;color:#4e9a06&#34;&gt;&amp;#34;kubeconfig&amp;#34;&lt;/span&gt;: &lt;span style=&#34;color:#4e9a06&#34;&gt;&amp;#34;/etc/cni/net.d/calico-kubeconfig&amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;      &lt;span style=&#34;color:#ce5c00;font-weight:bold&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#ce5c00;font-weight:bold&#34;&gt;}&lt;/span&gt;,
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#ce5c00;font-weight:bold&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;      &lt;span style=&#34;color:#4e9a06&#34;&gt;&amp;#34;type&amp;#34;&lt;/span&gt;: &lt;span style=&#34;color:#4e9a06&#34;&gt;&amp;#34;portmap&amp;#34;&lt;/span&gt;,
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;      &lt;span style=&#34;color:#4e9a06&#34;&gt;&amp;#34;snat&amp;#34;&lt;/span&gt;: true,
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;      &lt;span style=&#34;color:#4e9a06&#34;&gt;&amp;#34;capabilities&amp;#34;&lt;/span&gt;: &lt;span style=&#34;color:#ce5c00;font-weight:bold&#34;&gt;{&lt;/span&gt;&lt;span style=&#34;color:#4e9a06&#34;&gt;&amp;#34;portMappings&amp;#34;&lt;/span&gt;: true&lt;span style=&#34;color:#ce5c00;font-weight:bold&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#ce5c00;font-weight:bold&#34;&gt;}&lt;/span&gt;,
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#ce5c00;font-weight:bold&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;      &lt;span style=&#34;color:#4e9a06&#34;&gt;&amp;#34;type&amp;#34;&lt;/span&gt;: &lt;span style=&#34;color:#4e9a06&#34;&gt;&amp;#34;bandwidth&amp;#34;&lt;/span&gt;,
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;      &lt;span style=&#34;color:#4e9a06&#34;&gt;&amp;#34;capabilities&amp;#34;&lt;/span&gt;: &lt;span style=&#34;color:#ce5c00;font-weight:bold&#34;&gt;{&lt;/span&gt;&lt;span style=&#34;color:#4e9a06&#34;&gt;&amp;#34;bandwidth&amp;#34;&lt;/span&gt;: true&lt;span style=&#34;color:#ce5c00;font-weight:bold&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#ce5c00;font-weight:bold&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  &lt;span style=&#34;color:#ce5c00;font-weight:bold&#34;&gt;]&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#ce5c00;font-weight:bold&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;&lt;strong&gt;calico-kubeconfig&lt;/strong&gt;&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#8f5902;font-style:italic&#34;&gt;# Kubeconfig file for Calico CNI plugin. Installed by calico/node.&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;apiVersion: v1
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;kind: Config
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;clusters:
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;- name: &lt;span style=&#34;color:#204a87&#34;&gt;local&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  cluster:
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    server: https://10.96.0.1:443
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    certificate-authority-data: &lt;span style=&#34;color:#4e9a06&#34;&gt;&amp;#34;xxx&amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;users:
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;- name: calico
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  user:
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    token:xxx
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;contexts:
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;- name: calico-context
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  context:
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    cluster: &lt;span style=&#34;color:#204a87&#34;&gt;local&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    user: calico
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;å‚è€ƒï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;&lt;a href=&#34;https://docs.tigera.io/calico/latest/about/&#34;&gt;https://docs.tigera.io/calico/latest/about/&lt;/a&gt;&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;a href=&#34;https://docs.tigera.io/calico/latest/reference/architecture/overview&#34;&gt;https://docs.tigera.io/calico/latest/reference/architecture/overview&lt;/a&gt;&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;a href=&#34;https://docs.tigera.io/calico/latest/getting-started/kubernetes/quickstart&#34;&gt;https://docs.tigera.io/calico/latest/getting-started/kubernetes/quickstart&lt;/a&gt;&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;a href=&#34;https://www.tigera.io/blog/live-migration-from-flannel-to-calico/&#34;&gt;Live Migration from Flannel to Calico&lt;/a&gt;&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;

      </description>
    </item>
    
    <item>
      <title>Kubernetes-Notes: CNIæ¥å£ä»‹ç»</title>
      <link>https://blog.huweihuang.com/kubernetes-notes/network/cni/cni/</link>
      <pubDate>Sat, 10 Jul 2021 10:50:57 +0000</pubDate>
      
      <guid>https://blog.huweihuang.com/kubernetes-notes/network/cni/cni/</guid>
      <description>
        
        
        &lt;h1 id=&#34;1-cni-container-network-interface&#34;&gt;1. CNIï¼ˆContainer Network Interfaceï¼‰&lt;/h1&gt;
&lt;p&gt;CNIï¼ˆContainer Network Interfaceï¼‰å³å®¹å™¨ç½‘ç»œæ¥å£ï¼Œé€šè¿‡çº¦å®šç»Ÿä¸€çš„å®¹å™¨ç½‘ç»œæ¥å£ï¼Œä»è€Œkubeletå¯ä»¥é€šè¿‡è¿™ä¸ªæ ‡å‡†çš„APIæ¥è°ƒç”¨ä¸åŒçš„ç½‘ç»œæ’ä»¶å®ç°ä¸åŒçš„ç½‘ç»œåŠŸèƒ½ã€‚&lt;/p&gt;
&lt;p&gt;kubeletå¯åŠ¨å‚æ•°--network-plugin=cniæ¥æŒ‡å®šCNIæ’ä»¶ï¼Œkubeletä»&lt;code&gt;--cni-conf-dir&lt;/code&gt; ï¼ˆé»˜è®¤æ˜¯ &lt;code&gt;/etc/cni/net.d&lt;/code&gt;ï¼‰ è¯»å–æ–‡ä»¶å¹¶ä½¿ç”¨ è¯¥æ–‡ä»¶ä¸­çš„ CNI é…ç½®æ¥è®¾ç½®å„ä¸ª Pod çš„ç½‘ç»œã€‚ CNI é…ç½®æ–‡ä»¶å¿…é¡»ä¸ &lt;a href=&#34;https://github.com/containernetworking/cni/blob/master/SPEC.md#network-configuration&#34;&gt;CNI è§„çº¦&lt;/a&gt; åŒ¹é…ï¼Œå¹¶ä¸”é…ç½®æ‰€å¼•ç”¨çš„æ‰€æœ‰æ‰€éœ€çš„ CNI æ’ä»¶éƒ½åº”å­˜åœ¨äº &lt;code&gt;--cni-bin-dir&lt;/code&gt;ï¼ˆé»˜è®¤æ˜¯ &lt;code&gt;/opt/cni/bin&lt;/code&gt;ï¼‰ä¸‹ã€‚å¦‚æœæœ‰å¤šä¸ªCNIé…ç½®æ–‡ä»¶ï¼Œkubelet å°†ä¼šä½¿ç”¨æŒ‰æ–‡ä»¶åçš„å­—å…¸é¡ºåºæ’åˆ— çš„ç¬¬ä¸€ä¸ªä½œä¸ºé…ç½®æ–‡ä»¶ã€‚&lt;/p&gt;
&lt;p&gt;CNIè§„èŒƒå®šä¹‰ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;ç½‘ç»œé…ç½®æ–‡ä»¶çš„æ ¼å¼&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;å®¹å™¨runtimeä¸CNIæ’ä»¶çš„é€šä¿¡åè®®&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;åŸºäºæä¾›çš„é…ç½®æ‰§è¡Œç½‘ç»œæ’ä»¶çš„æ­¥éª¤&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;ç½‘ç»œæ’ä»¶è°ƒç”¨å…¶ä»–åŠŸèƒ½æ’ä»¶çš„æ­¥éª¤&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;æ’ä»¶è¿”å›ç»™runtimeç»“æœçš„æ•°æ®æ ¼å¼&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;h1 id=&#34;2-cnié…ç½®æ–‡ä»¶æ ¼å¼&#34;&gt;2. CNIé…ç½®æ–‡ä»¶æ ¼å¼&lt;/h1&gt;
&lt;p&gt;CNIé…ç½®æ–‡ä»¶çš„æ ¼å¼ä¸ºJSONæ ¼å¼ï¼Œé…ç½®æ–‡ä»¶çš„é»˜è®¤è·¯å¾„ï¼š/etc/cni/net.dã€‚æ’ä»¶äºŒè¿›åˆ¶é»˜è®¤çš„è·¯å¾„ä¸ºï¼š/opt/cni/binã€‚&lt;/p&gt;
&lt;h2 id=&#34;2-1-ä¸»é…ç½®çš„å­—æ®µ&#34;&gt;2.1. ä¸»é…ç½®çš„å­—æ®µ&lt;/h2&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;&lt;code&gt;cniVersion&lt;/code&gt; (string)ï¼šCNIè§„èŒƒä½¿ç”¨çš„ç‰ˆæœ¬ï¼Œä¾‹å¦‚ç‰ˆæœ¬ä¸º0.4.0ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;code&gt;name&lt;/code&gt; (string)ï¼šç›®æ ‡ç½‘ç»œçš„åç§°ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;code&gt;disableCheck&lt;/code&gt; (boolean)ï¼šå…³é—­CHECKæ“ä½œã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;code&gt;plugins&lt;/code&gt; (list)ï¼šCNIæ’ä»¶åˆ—è¡¨åŠæ’ä»¶é…ç½®ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;h2 id=&#34;2-2-æ’ä»¶é…ç½®å­—æ®µ&#34;&gt;2.2. æ’ä»¶é…ç½®å­—æ®µ&lt;/h2&gt;
&lt;p&gt;æ ¹æ®ä¸åŒçš„æ’ä»¶ï¼Œæ’ä»¶é…ç½®æ‰€éœ€çš„å­—æ®µä¸åŒã€‚&lt;/p&gt;
&lt;p&gt;å¿…é€‰å­—æ®µï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;code&gt;type&lt;/code&gt; (string)ï¼šèŠ‚ç‚¹ä¸Šæ’ä»¶äºŒè¿›åˆ¶çš„åç§°ï¼Œæ¯”å¦‚bridgeï¼Œsriovï¼Œmacvlanç­‰ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;å¯é€‰å­—æ®µï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;&lt;code&gt;capabilities&lt;/code&gt; (dictionary)&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;code&gt;ipMasq&lt;/code&gt; (boolean)ï¼šä¸ºç›®æ ‡ç½‘ç»œé…ä¸ŠOutbound Masquerade(åœ°å€ä¼ªè£…)ï¼Œå³ï¼šç”±å®¹å™¨å†…éƒ¨é€šè¿‡ç½‘å…³å‘å¤–å‘é€æ•°æ®åŒ…æ—¶ï¼Œå¯¹æ•°æ®åŒ…çš„æºIPåœ°å€è¿›è¡Œä¿®æ”¹ã€‚&lt;/p&gt;
&lt;p&gt;å½“æˆ‘ä»¬çš„å®¹å™¨ä»¥å®¿ä¸»æœºä½œä¸ºç½‘å…³æ—¶ï¼Œè¿™ä¸ªå‚æ•°æ˜¯å¿…é¡»è¦è®¾ç½®çš„ã€‚å¦åˆ™ï¼Œä»å®¹å™¨å†…éƒ¨å‘å‡ºçš„æ•°æ®åŒ…å°±æ²¡æœ‰åŠæ³•é€šè¿‡ç½‘å…³è·¯ç”±åˆ°å…¶ä»–ç½‘æ®µã€‚å› ä¸ºå®¹å™¨å†…éƒ¨çš„IPåœ°å€æ— æ³•è¢«ç›®æ ‡ç½‘æ®µè¯†åˆ«ï¼Œæ‰€ä»¥è¿™äº›æ•°æ®åŒ…æœ€ç»ˆä¼šè¢«ä¸¢å¼ƒæ‰ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;code&gt;ipam&lt;/code&gt; (dictionary)ï¼šIPAM(IP Adderss Management)å³IPåœ°å€ç®¡ç†ï¼Œæä¾›äº†ä¸€ç³»åˆ—æ–¹æ³•ç”¨äºå¯¹IPå’Œè·¯ç”±è¿›è¡Œç®¡ç†ã€‚å®ƒå¯¹åº”çš„æ˜¯ç”±CNIæä¾›çš„ä¸€ç»„æ ‡å‡†IPAMæ’ä»¶ï¼Œæ¯”å¦‚åƒhost-localï¼Œdhcpï¼Œstaticç­‰ã€‚æ¯”å¦‚æ–‡ä¸­ç”¨åˆ°çš„bridgeæ’ä»¶ï¼Œä¼šè°ƒç”¨æˆ‘ä»¬æ‰€æŒ‡å®šçš„IPAMæ’ä»¶ï¼Œå®ç°å¯¹ç½‘ç»œè®¾å¤‡IPåœ°å€çš„åˆ†é…å’Œç®¡ç†ã€‚**å¦‚æœæ˜¯è‡ªå·±å¼€å‘çš„ipamæ’ä»¶ï¼Œåˆ™ç›¸å…³çš„å…¥å‚å¯ä»¥è‡ªå·±å®šä¹‰å’Œå®ç°ã€‚&lt;/p&gt;
&lt;p&gt;ä»¥ä¸‹ä»¥host-localä¸ºä¾‹è¯´æ˜ã€‚&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;typeï¼šæŒ‡å®šæ‰€ç”¨IPAMæ’ä»¶çš„åç§°ï¼Œåœ¨æˆ‘ä»¬çš„ä¾‹å­é‡Œï¼Œç”¨çš„æ˜¯host-localã€‚&lt;/li&gt;
&lt;li&gt;subnetï¼šä¸ºç›®æ ‡ç½‘ç»œåˆ†é…ç½‘æ®µï¼ŒåŒ…æ‹¬ç½‘ç»œIDå’Œå­ç½‘æ©ç ï¼Œä»¥CIDRå½¢å¼æ ‡è®°ã€‚åœ¨æˆ‘ä»¬çš„ä¾‹å­é‡Œä¸º&lt;code&gt;10.15.10.0/24&lt;/code&gt;ï¼Œä¹Ÿå°±æ˜¯ç›®æ ‡ç½‘æ®µä¸º&lt;code&gt;10.15.10.0&lt;/code&gt;ï¼Œå­ç½‘æ©ç ä¸º&lt;code&gt;255.255.255.0&lt;/code&gt;ã€‚&lt;/li&gt;
&lt;li&gt;routesï¼šç”¨äºæŒ‡å®šè·¯ç”±è§„åˆ™ï¼Œæ’ä»¶ä¼šä¸ºæˆ‘ä»¬åœ¨å®¹å™¨çš„è·¯ç”±è¡¨é‡Œç”Ÿæˆç›¸åº”çš„è§„åˆ™ã€‚å…¶ä¸­ï¼Œdstè¡¨ç¤ºå¸Œæœ›åˆ°è¾¾çš„ç›®æ ‡ç½‘æ®µï¼Œä»¥CIDRå½¢å¼æ ‡è®°ã€‚gwå¯¹åº”ç½‘å…³çš„IPåœ°å€ï¼Œä¹Ÿå°±æ˜¯è¦åˆ°è¾¾ç›®æ ‡ç½‘æ®µæ‰€è¦ç»è¿‡çš„â€œnext hop(ä¸‹ä¸€è·³)â€ã€‚å¦‚æœçœç•¥gwçš„è¯ï¼Œé‚£ä¹ˆæ’ä»¶ä¼šè‡ªåŠ¨å¸®æˆ‘ä»¬é€‰æ‹©é»˜è®¤ç½‘å…³ã€‚åœ¨æˆ‘ä»¬çš„ä¾‹å­é‡Œï¼Œgwé€‰æ‹©çš„æ˜¯é»˜è®¤ç½‘å…³ï¼Œè€Œdstä¸º&lt;code&gt;0.0.0.0/0&lt;/code&gt;åˆ™ä»£è¡¨â€œä»»ä½•ç½‘ç»œâ€ï¼Œè¡¨ç¤ºæ•°æ®åŒ…å°†é€šè¿‡é»˜è®¤ç½‘å…³å‘å¾€ä»»ä½•ç½‘ç»œã€‚å®é™…ä¸Šï¼Œè¿™å¯¹åº”çš„æ˜¯ä¸€æ¡é»˜è®¤è·¯ç”±è§„åˆ™ï¼Œå³ï¼šå½“æ‰€æœ‰å…¶ä»–è·¯ç”±è§„åˆ™éƒ½ä¸åŒ¹é…æ—¶ï¼Œå°†é€‰æ‹©è¯¥è·¯ç”±ã€‚&lt;/li&gt;
&lt;li&gt;rangeStartï¼šå…è®¸åˆ†é…çš„IPåœ°å€èŒƒå›´çš„èµ·å§‹å€¼&lt;/li&gt;
&lt;li&gt;rangeEndï¼šå…è®¸åˆ†é…çš„IPåœ°å€èŒƒå›´çš„ç»“æŸå€¼&lt;/li&gt;
&lt;li&gt;gatewayï¼šä¸ºç½‘å…³ï¼ˆä¹Ÿå°±æ˜¯æˆ‘ä»¬å°†è¦åœ¨å®¿ä¸»æœºä¸Šåˆ›å»ºçš„bridgeï¼‰æŒ‡å®šçš„IPåœ°å€ã€‚å¦‚æœçœç•¥çš„è¯ï¼Œé‚£ä¹ˆæ’ä»¶ä¼šè‡ªåŠ¨ä»å…è®¸åˆ†é…çš„IPåœ°å€èŒƒå›´å†…é€‰æ‹©èµ·å§‹å€¼ä½œä¸ºç½‘å…³çš„IPåœ°å€ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;code&gt;dns&lt;/code&gt; (dictionary, optional)ï¼šdnsé…ç½®&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;&lt;code&gt;nameservers&lt;/code&gt; (list of strings, optional)&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;code&gt;domain&lt;/code&gt; (string, optional)&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;code&gt;search&lt;/code&gt; (list of strings, optional)&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;code&gt;options&lt;/code&gt; (list of strings, optional)&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;h2 id=&#34;2-3-é…ç½®æ–‡ä»¶ç¤ºä¾‹&#34;&gt;2.3. é…ç½®æ–‡ä»¶ç¤ºä¾‹&lt;/h2&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-json&#34; data-lang=&#34;json&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#a40000&#34;&gt;$&lt;/span&gt; &lt;span style=&#34;color:#a40000&#34;&gt;mkdir&lt;/span&gt; &lt;span style=&#34;color:#a40000&#34;&gt;-p&lt;/span&gt; &lt;span style=&#34;color:#a40000&#34;&gt;/etc/cni/net.d&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#a40000&#34;&gt;$&lt;/span&gt; &lt;span style=&#34;color:#a40000&#34;&gt;cat&lt;/span&gt; &lt;span style=&#34;color:#a40000&#34;&gt;&amp;gt;/etc/cni/net.d/&lt;/span&gt;&lt;span style=&#34;color:#0000cf;font-weight:bold&#34;&gt;10&lt;/span&gt;&lt;span style=&#34;color:#a40000&#34;&gt;-mynet.conf&lt;/span&gt; &lt;span style=&#34;color:#a40000&#34;&gt;&amp;lt;&amp;lt;EOF&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  &lt;span style=&#34;color:#204a87;font-weight:bold&#34;&gt;&amp;#34;cniVersion&amp;#34;&lt;/span&gt;&lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;:&lt;/span&gt; &lt;span style=&#34;color:#4e9a06&#34;&gt;&amp;#34;1.0.0&amp;#34;&lt;/span&gt;&lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;,&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  &lt;span style=&#34;color:#204a87;font-weight:bold&#34;&gt;&amp;#34;name&amp;#34;&lt;/span&gt;&lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;:&lt;/span&gt; &lt;span style=&#34;color:#4e9a06&#34;&gt;&amp;#34;dbnet&amp;#34;&lt;/span&gt;&lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;,&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  &lt;span style=&#34;color:#204a87;font-weight:bold&#34;&gt;&amp;#34;plugins&amp;#34;&lt;/span&gt;&lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;:&lt;/span&gt; &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;[&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;      &lt;span style=&#34;color:#204a87;font-weight:bold&#34;&gt;&amp;#34;type&amp;#34;&lt;/span&gt;&lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;:&lt;/span&gt; &lt;span style=&#34;color:#4e9a06&#34;&gt;&amp;#34;bridge&amp;#34;&lt;/span&gt;&lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;,&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;      &lt;span style=&#34;color:#8f5902;font-style:italic&#34;&gt;// plugin specific parameters
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#8f5902;font-style:italic&#34;&gt;&lt;/span&gt;      &lt;span style=&#34;color:#204a87;font-weight:bold&#34;&gt;&amp;#34;bridge&amp;#34;&lt;/span&gt;&lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;:&lt;/span&gt; &lt;span style=&#34;color:#4e9a06&#34;&gt;&amp;#34;cni0&amp;#34;&lt;/span&gt;&lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;,&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;      &lt;span style=&#34;color:#204a87;font-weight:bold&#34;&gt;&amp;#34;keyA&amp;#34;&lt;/span&gt;&lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;:&lt;/span&gt; &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;[&lt;/span&gt;&lt;span style=&#34;color:#4e9a06&#34;&gt;&amp;#34;some more&amp;#34;&lt;/span&gt;&lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;,&lt;/span&gt; &lt;span style=&#34;color:#4e9a06&#34;&gt;&amp;#34;plugin specific&amp;#34;&lt;/span&gt;&lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;,&lt;/span&gt; &lt;span style=&#34;color:#4e9a06&#34;&gt;&amp;#34;configuration&amp;#34;&lt;/span&gt;&lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;],&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;      &lt;span style=&#34;color:#204a87;font-weight:bold&#34;&gt;&amp;#34;ipam&amp;#34;&lt;/span&gt;&lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;:&lt;/span&gt; &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        &lt;span style=&#34;color:#204a87;font-weight:bold&#34;&gt;&amp;#34;type&amp;#34;&lt;/span&gt;&lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;:&lt;/span&gt; &lt;span style=&#34;color:#4e9a06&#34;&gt;&amp;#34;host-local&amp;#34;&lt;/span&gt;&lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;,&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        &lt;span style=&#34;color:#8f5902;font-style:italic&#34;&gt;// ipam specific
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#8f5902;font-style:italic&#34;&gt;&lt;/span&gt;        &lt;span style=&#34;color:#204a87;font-weight:bold&#34;&gt;&amp;#34;subnet&amp;#34;&lt;/span&gt;&lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;:&lt;/span&gt; &lt;span style=&#34;color:#4e9a06&#34;&gt;&amp;#34;10.1.0.0/16&amp;#34;&lt;/span&gt;&lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;,&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        &lt;span style=&#34;color:#204a87;font-weight:bold&#34;&gt;&amp;#34;gateway&amp;#34;&lt;/span&gt;&lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;:&lt;/span&gt; &lt;span style=&#34;color:#4e9a06&#34;&gt;&amp;#34;10.1.0.1&amp;#34;&lt;/span&gt;&lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;,&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        &lt;span style=&#34;color:#204a87;font-weight:bold&#34;&gt;&amp;#34;routes&amp;#34;&lt;/span&gt;&lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;:&lt;/span&gt; &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;[&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;            &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;{&lt;/span&gt;&lt;span style=&#34;color:#204a87;font-weight:bold&#34;&gt;&amp;#34;dst&amp;#34;&lt;/span&gt;&lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;:&lt;/span&gt; &lt;span style=&#34;color:#4e9a06&#34;&gt;&amp;#34;0.0.0.0/0&amp;#34;&lt;/span&gt;&lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;]&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;      &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;},&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;      &lt;span style=&#34;color:#204a87;font-weight:bold&#34;&gt;&amp;#34;dns&amp;#34;&lt;/span&gt;&lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;:&lt;/span&gt; &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        &lt;span style=&#34;color:#204a87;font-weight:bold&#34;&gt;&amp;#34;nameservers&amp;#34;&lt;/span&gt;&lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;:&lt;/span&gt; &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;[&lt;/span&gt; &lt;span style=&#34;color:#4e9a06&#34;&gt;&amp;#34;10.1.0.1&amp;#34;&lt;/span&gt; &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;]&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;      &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;},&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;      &lt;span style=&#34;color:#204a87;font-weight:bold&#34;&gt;&amp;#34;type&amp;#34;&lt;/span&gt;&lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;:&lt;/span&gt; &lt;span style=&#34;color:#4e9a06&#34;&gt;&amp;#34;tuning&amp;#34;&lt;/span&gt;&lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;,&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;      &lt;span style=&#34;color:#204a87;font-weight:bold&#34;&gt;&amp;#34;capabilities&amp;#34;&lt;/span&gt;&lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;:&lt;/span&gt; &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        &lt;span style=&#34;color:#204a87;font-weight:bold&#34;&gt;&amp;#34;mac&amp;#34;&lt;/span&gt;&lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;:&lt;/span&gt; &lt;span style=&#34;color:#204a87;font-weight:bold&#34;&gt;true&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;      &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;},&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;      &lt;span style=&#34;color:#204a87;font-weight:bold&#34;&gt;&amp;#34;sysctl&amp;#34;&lt;/span&gt;&lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;:&lt;/span&gt; &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        &lt;span style=&#34;color:#204a87;font-weight:bold&#34;&gt;&amp;#34;net.core.somaxconn&amp;#34;&lt;/span&gt;&lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;:&lt;/span&gt; &lt;span style=&#34;color:#4e9a06&#34;&gt;&amp;#34;500&amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;      &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;},&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        &lt;span style=&#34;color:#204a87;font-weight:bold&#34;&gt;&amp;#34;type&amp;#34;&lt;/span&gt;&lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;:&lt;/span&gt; &lt;span style=&#34;color:#4e9a06&#34;&gt;&amp;#34;portmap&amp;#34;&lt;/span&gt;&lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;,&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        &lt;span style=&#34;color:#204a87;font-weight:bold&#34;&gt;&amp;#34;capabilities&amp;#34;&lt;/span&gt;&lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;:&lt;/span&gt; &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;{&lt;/span&gt;&lt;span style=&#34;color:#204a87;font-weight:bold&#34;&gt;&amp;#34;portMappings&amp;#34;&lt;/span&gt;&lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;:&lt;/span&gt; &lt;span style=&#34;color:#204a87;font-weight:bold&#34;&gt;true&lt;/span&gt;&lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;]&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;h1 id=&#34;3-cniæ’ä»¶&#34;&gt;3. CNIæ’ä»¶&lt;/h1&gt;
&lt;h2 id=&#34;3-1-å®‰è£…æ’ä»¶&#34;&gt;3.1. å®‰è£…æ’ä»¶&lt;/h2&gt;
&lt;p&gt;å®‰è£…CNIäºŒè¿›åˆ¶æ’ä»¶ï¼Œæ’ä»¶ä¸‹è½½åœ°ï¼šhttps://github.com/containernetworking/plugins/releases&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#8f5902;font-style:italic&#34;&gt;# ä¸‹è½½äºŒè¿›åˆ¶&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;wget https://github.com/containernetworking/plugins/releases/download/v1.1.0/cni-plugins-linux-amd64-v1.1.0.tgz
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#8f5902;font-style:italic&#34;&gt;# è§£å‹æ–‡ä»¶&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;tar -zvxf cni-plugins-linux-amd64-v1.1.0.tgz -C /opt/cni/bin/
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#8f5902;font-style:italic&#34;&gt;# æŸ¥çœ‹è§£å‹æ–‡ä»¶&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#8f5902;font-style:italic&#34;&gt;# ll -h&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;æ€»ç”¨é‡ 63M
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;-rwxr-xr-x &lt;span style=&#34;color:#0000cf;font-weight:bold&#34;&gt;1&lt;/span&gt; root root 3.7M 2æœˆ  &lt;span style=&#34;color:#0000cf;font-weight:bold&#34;&gt;24&lt;/span&gt; 01:01 bandwidth
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;-rwxr-xr-x &lt;span style=&#34;color:#0000cf;font-weight:bold&#34;&gt;1&lt;/span&gt; root root 4.1M 2æœˆ  &lt;span style=&#34;color:#0000cf;font-weight:bold&#34;&gt;24&lt;/span&gt; 01:01 bridge
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;-rwxr-xr-x &lt;span style=&#34;color:#0000cf;font-weight:bold&#34;&gt;1&lt;/span&gt; root root 9.3M 2æœˆ  &lt;span style=&#34;color:#0000cf;font-weight:bold&#34;&gt;24&lt;/span&gt; 01:01 dhcp
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;-rwxr-xr-x &lt;span style=&#34;color:#0000cf;font-weight:bold&#34;&gt;1&lt;/span&gt; root root 4.2M 2æœˆ  &lt;span style=&#34;color:#0000cf;font-weight:bold&#34;&gt;24&lt;/span&gt; 01:01 firewall
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;-rwxr-xr-x &lt;span style=&#34;color:#0000cf;font-weight:bold&#34;&gt;1&lt;/span&gt; root root 3.7M 2æœˆ  &lt;span style=&#34;color:#0000cf;font-weight:bold&#34;&gt;24&lt;/span&gt; 01:01 host-device
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;-rwxr-xr-x &lt;span style=&#34;color:#0000cf;font-weight:bold&#34;&gt;1&lt;/span&gt; root root 3.1M 2æœˆ  &lt;span style=&#34;color:#0000cf;font-weight:bold&#34;&gt;24&lt;/span&gt; 01:01 host-local
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;-rwxr-xr-x &lt;span style=&#34;color:#0000cf;font-weight:bold&#34;&gt;1&lt;/span&gt; root root 3.8M 2æœˆ  &lt;span style=&#34;color:#0000cf;font-weight:bold&#34;&gt;24&lt;/span&gt; 01:01 ipvlan
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;-rwxr-xr-x &lt;span style=&#34;color:#0000cf;font-weight:bold&#34;&gt;1&lt;/span&gt; root root 3.2M 2æœˆ  &lt;span style=&#34;color:#0000cf;font-weight:bold&#34;&gt;24&lt;/span&gt; 01:01 loopback
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;-rwxr-xr-x &lt;span style=&#34;color:#0000cf;font-weight:bold&#34;&gt;1&lt;/span&gt; root root 3.8M 2æœˆ  &lt;span style=&#34;color:#0000cf;font-weight:bold&#34;&gt;24&lt;/span&gt; 01:01 macvlan
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;-rwxr-xr-x &lt;span style=&#34;color:#0000cf;font-weight:bold&#34;&gt;1&lt;/span&gt; root root 3.6M 2æœˆ  &lt;span style=&#34;color:#0000cf;font-weight:bold&#34;&gt;24&lt;/span&gt; 01:01 portmap
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;-rwxr-xr-x &lt;span style=&#34;color:#0000cf;font-weight:bold&#34;&gt;1&lt;/span&gt; root root 4.0M 2æœˆ  &lt;span style=&#34;color:#0000cf;font-weight:bold&#34;&gt;24&lt;/span&gt; 01:01 ptp
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;-rwxr-xr-x &lt;span style=&#34;color:#0000cf;font-weight:bold&#34;&gt;1&lt;/span&gt; root root 3.4M 2æœˆ  &lt;span style=&#34;color:#0000cf;font-weight:bold&#34;&gt;24&lt;/span&gt; 01:01 sbr
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;-rwxr-xr-x &lt;span style=&#34;color:#0000cf;font-weight:bold&#34;&gt;1&lt;/span&gt; root root 2.7M 2æœˆ  &lt;span style=&#34;color:#0000cf;font-weight:bold&#34;&gt;24&lt;/span&gt; 01:01 static
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;-rwxr-xr-x &lt;span style=&#34;color:#0000cf;font-weight:bold&#34;&gt;1&lt;/span&gt; root root 3.3M 2æœˆ  &lt;span style=&#34;color:#0000cf;font-weight:bold&#34;&gt;24&lt;/span&gt; 01:01 tuning
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;-rwxr-xr-x &lt;span style=&#34;color:#0000cf;font-weight:bold&#34;&gt;1&lt;/span&gt; root root 3.8M 2æœˆ  &lt;span style=&#34;color:#0000cf;font-weight:bold&#34;&gt;24&lt;/span&gt; 01:01 vlan
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;-rwxr-xr-x &lt;span style=&#34;color:#0000cf;font-weight:bold&#34;&gt;1&lt;/span&gt; root root 3.4M 2æœˆ  &lt;span style=&#34;color:#0000cf;font-weight:bold&#34;&gt;24&lt;/span&gt; 01:01 vrf
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;h2 id=&#34;3-2-æ’ä»¶åˆ†ç±»&#34;&gt;3.2. æ’ä»¶åˆ†ç±»&lt;/h2&gt;
&lt;p&gt;å‚è€ƒï¼šhttps://www.cni.dev/plugins/current/&lt;/p&gt;
&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th&gt;åˆ†ç±»&lt;/th&gt;
&lt;th&gt;æ’ä»¶&lt;/th&gt;
&lt;th&gt;è¯´æ˜&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td&gt;main&lt;/td&gt;
&lt;td&gt;bridge&lt;/td&gt;
&lt;td&gt;Creates a bridge, adds the host and the container to it&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;/td&gt;
&lt;td&gt;ipvlan&lt;/td&gt;
&lt;td&gt;Adds an ipvlan interface in the container&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;/td&gt;
&lt;td&gt;&lt;strong&gt;macvlan&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;Creates a new MAC address, forwards all traffic to that to the container&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;/td&gt;
&lt;td&gt;ptp&lt;/td&gt;
&lt;td&gt;Creates a veth pair&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;/td&gt;
&lt;td&gt;&lt;a href=&#34;https://www.cni.dev/plugins/current/main/host-device/&#34;&gt;host-device&lt;/a&gt;&lt;/td&gt;
&lt;td&gt;Moves an already-existing device into a container&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;/td&gt;
&lt;td&gt;vlan&lt;/td&gt;
&lt;td&gt;Creates a vlan interface off a master&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;IPAM&lt;/td&gt;
&lt;td&gt;dhcp&lt;/td&gt;
&lt;td&gt;Runs a daemon on the host to make DHCP requests on behalf of a container&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;/td&gt;
&lt;td&gt;host-local&lt;/td&gt;
&lt;td&gt;Maintains a local database of allocated IPs&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;/td&gt;
&lt;td&gt;static&lt;/td&gt;
&lt;td&gt;Allocates static IPv4/IPv6 addresses to containers&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;meta&lt;/td&gt;
&lt;td&gt;tuning&lt;/td&gt;
&lt;td&gt;Changes sysctl parameters of an existing interface&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;/td&gt;
&lt;td&gt;portmap&lt;/td&gt;
&lt;td&gt;An iptables-based portmapping plugin. Maps ports from the hostâ€™s address space to the container&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;/td&gt;
&lt;td&gt;&lt;strong&gt;bandwidth&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;Allows bandwidth-limiting through use of traffic control tbf (ingress/egress)&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;/td&gt;
&lt;td&gt;sbr&lt;/td&gt;
&lt;td&gt;A plugin that configures source based routing for an interface (from which it is chained)&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;/td&gt;
&lt;td&gt;firewall&lt;/td&gt;
&lt;td&gt;A firewall plugin which uses iptables or firewalld to add rules to allow traffic to/from the container&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;h1 id=&#34;4-cniæ’ä»¶æ¥å£&#34;&gt;4. CNIæ’ä»¶æ¥å£&lt;/h1&gt;
&lt;p&gt;å…·ä½“å¯å‚è€ƒï¼šhttps://github.com/containernetworking/cni/blob/master/SPEC.md#cni-operations&lt;/p&gt;
&lt;p&gt;CNIå®šä¹‰çš„æ¥å£æ“ä½œæœ‰ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;code&gt;ADD&lt;/code&gt;ï¼šæ·»åŠ å®¹å™¨ç½‘ç»œï¼Œåœ¨å®¹å™¨å¯åŠ¨æ—¶è°ƒç”¨ã€‚&lt;/li&gt;
&lt;li&gt;&lt;code&gt;DEL&lt;/code&gt;ï¼šåˆ é™¤å®¹å™¨ç½‘ç»œï¼Œåœ¨å®¹å™¨åˆ é™¤æ—¶è°ƒç”¨ã€‚&lt;/li&gt;
&lt;li&gt;&lt;code&gt;CHECK&lt;/code&gt;ï¼šæ£€æŸ¥å®¹å™¨ç½‘ç»œæ˜¯å¦æ­£å¸¸ã€‚&lt;/li&gt;
&lt;li&gt;&lt;code&gt;VERSION&lt;/code&gt;ï¼šæ˜¾ç¤ºæ’ä»¶ç‰ˆæœ¬ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;è¿™äº›æ“ä½œé€šè¿‡&lt;code&gt;CNI_COMMAND&lt;/code&gt;ç¯å¢ƒå˜é‡æ¥ä¼ é€’ç»™CNIæ’ä»¶äºŒè¿›åˆ¶ã€‚&lt;/p&gt;
&lt;p&gt;å…¶ä¸­ç¯å¢ƒå˜é‡åŒ…æ‹¬ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;&lt;code&gt;CNI_COMMAND&lt;/code&gt;ï¼šå‘½ä»¤æ“ä½œï¼ŒåŒ…æ‹¬ &lt;code&gt;ADD&lt;/code&gt;, &lt;code&gt;DEL&lt;/code&gt;, &lt;code&gt;CHECK&lt;/code&gt;, or &lt;code&gt;VERSION&lt;/code&gt;ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;code&gt;CNI_CONTAINERID&lt;/code&gt;:å®¹å™¨çš„IDï¼Œæœ‰runtimeåˆ†é…ï¼Œä¸ä¸ºç©ºã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;code&gt;CNI_NETNS&lt;/code&gt;:å®¹å™¨çš„ç½‘ç»œå‘½åç©ºé—´ï¼Œå‘½åç©ºé—´è·¯å¾„ï¼Œä¾‹å¦‚ï¼š/run/netns/[nsname]&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;code&gt;CNI_IFNAME&lt;/code&gt;:å®¹å™¨å†…çš„ç½‘å¡åç§°ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;code&gt;CNI_ARGS&lt;/code&gt;:å…¶ä»–å‚æ•°ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;code&gt;CNI_PATH&lt;/code&gt;:CNIæ’ä»¶äºŒè¿›åˆ¶çš„è·¯å¾„ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;h2 id=&#34;4-1-addæ¥å£-æ·»åŠ å®¹å™¨ç½‘ç»œ&#34;&gt;4.1. ADDæ¥å£ï¼šæ·»åŠ å®¹å™¨ç½‘ç»œ&lt;/h2&gt;
&lt;p&gt;åœ¨å®¹å™¨çš„ç½‘ç»œå‘½åç©ºé—´&lt;code&gt;CNI_NETNS&lt;/code&gt;ä¸­åˆ›å»º&lt;code&gt;CNI_IFNAME&lt;/code&gt;ç½‘å¡è®¾å¤‡ï¼Œæˆ–è€…è°ƒæ•´ç½‘å¡é…ç½®ã€‚&lt;/p&gt;
&lt;p&gt;å¿…é€‰å‚æ•°ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;code&gt;CNI_COMMAND&lt;/code&gt;&lt;/li&gt;
&lt;li&gt;&lt;code&gt;CNI_CONTAINERID&lt;/code&gt;&lt;/li&gt;
&lt;li&gt;&lt;code&gt;CNI_NETNS&lt;/code&gt;&lt;/li&gt;
&lt;li&gt;&lt;code&gt;CNI_IFNAME&lt;/code&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;å¯é€‰å‚æ•°ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;code&gt;CNI_ARGS&lt;/code&gt;&lt;/li&gt;
&lt;li&gt;&lt;code&gt;CNI_PATH&lt;/code&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;h2 id=&#34;4-2-delæ¥å£-åˆ é™¤å®¹å™¨ç½‘ç»œ&#34;&gt;4.2. DELæ¥å£ï¼šåˆ é™¤å®¹å™¨ç½‘ç»œ&lt;/h2&gt;
&lt;p&gt;åˆ é™¤å®¹å™¨ç½‘ç»œå‘½åç©ºé—´&lt;code&gt;CNI_NETNS&lt;/code&gt;ä¸­çš„å®¹å™¨ç½‘å¡&lt;code&gt;CNI_IFNAME&lt;/code&gt;ï¼Œæˆ–è€…æ’¤é”€ADDä¿®æ”¹æ“ä½œã€‚&lt;/p&gt;
&lt;p&gt;å¿…é€‰å‚æ•°ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;code&gt;CNI_COMMAND&lt;/code&gt;&lt;/li&gt;
&lt;li&gt;&lt;code&gt;CNI_CONTAINERID&lt;/code&gt;&lt;/li&gt;
&lt;li&gt;&lt;code&gt;CNI_IFNAME&lt;/code&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;å¯é€‰å‚æ•°ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;code&gt;CNI_NETNS&lt;/code&gt;&lt;/li&gt;
&lt;li&gt;&lt;code&gt;CNI_ARGS&lt;/code&gt;&lt;/li&gt;
&lt;li&gt;&lt;code&gt;CNI_PATH&lt;/code&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;h2 id=&#34;4-3-checkæ¥å£-æ£€æŸ¥å®¹å™¨ç½‘ç»œ&#34;&gt;4.3. CHECKæ¥å£ï¼šæ£€æŸ¥å®¹å™¨ç½‘ç»œ&lt;/h2&gt;
&lt;h2 id=&#34;4-4-versionæ¥å£-è¾“å‡ºcniçš„ç‰ˆæœ¬&#34;&gt;4.4. VERSIONæ¥å£ï¼šè¾“å‡ºCNIçš„ç‰ˆæœ¬&lt;/h2&gt;
&lt;p&gt;å‚è€ƒï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href=&#34;https://www.cni.dev/docs/spec/&#34;&gt;https://www.cni.dev/docs/spec/&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://github.com/containernetworking/cni&#34;&gt;https://github.com/containernetworking/cni&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://github.com/containernetworking/cni/blob/spec-v0.4.0/SPEC.md&#34;&gt;https://github.com/containernetworking/cni/blob/spec-v0.4.0/SPEC.md&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://kubernetes.io/zh/docs/concepts/extend-kubernetes/compute-storage-net/network-plugins/&#34;&gt;https://kubernetes.io/zh/docs/concepts/extend-kubernetes/compute-storage-net/network-plugins/&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://github.com/containernetworking/plugins/tree/master/plugins&#34;&gt;https://github.com/containernetworking/plugins/tree/master/plugins&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://www.cni.dev/plugins/current/&#34;&gt;https://www.cni.dev/plugins/current/&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://cloud.tencent.com/developer/news/600713&#34;&gt;https://cloud.tencent.com/developer/news/600713&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://morningspace.github.io/tech/k8s-net-cni/#%E9%85%8D%E7%BD%AEcni%E6%8F%92%E4%BB%B6&#34;&gt;é…ç½®CNIæ’ä»¶&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;

      </description>
    </item>
    
    <item>
      <title>Kubernetes-Notes: Flannelä»‹ç»</title>
      <link>https://blog.huweihuang.com/kubernetes-notes/network/flannel/flannel-introduction/</link>
      <pubDate>Sat, 08 Jul 2017 10:50:57 +0000</pubDate>
      
      <guid>https://blog.huweihuang.com/kubernetes-notes/network/flannel/flannel-introduction/</guid>
      <description>
        
        
        &lt;h1 id=&#34;1-flannelæ˜¯ä»€ä¹ˆ-what&#34;&gt;1. flannelæ˜¯ä»€ä¹ˆï¼ˆwhatï¼‰&lt;/h1&gt;
&lt;h2 id=&#34;1-1-æ¦‚è¿°&#34;&gt;1.1. æ¦‚è¿°&lt;/h2&gt;
&lt;p&gt;Flannelæ˜¯CoreOSå›¢é˜Ÿé’ˆå¯¹Kubernetesè®¾è®¡çš„ä¸€ä¸ªç½‘ç»œè§„åˆ’æœåŠ¡ï¼Œç®€å•æ¥è¯´ï¼Œå®ƒçš„åŠŸèƒ½æ˜¯è®©é›†ç¾¤ä¸­çš„ä¸åŒèŠ‚ç‚¹ä¸»æœºåˆ›å»ºçš„Dockerå®¹å™¨éƒ½å…·æœ‰å…¨é›†ç¾¤å”¯ä¸€çš„è™šæ‹ŸIPåœ°å€ã€‚
Flannelå®˜ç½‘ï¼šhttps://github.com/coreos/flannel&lt;/p&gt;
&lt;h2 id=&#34;1-2-è¡¥å……çŸ¥è¯†ç‚¹&#34;&gt;1.2. è¡¥å……çŸ¥è¯†ç‚¹&lt;/h2&gt;
&lt;h2 id=&#34;1-è¦†ç›–ç½‘ç»œ-overlay-network&#34;&gt;&lt;strong&gt;1ã€è¦†ç›–ç½‘ç»œ[overlay network]&lt;/strong&gt;&lt;/h2&gt;
&lt;p&gt;è¿è¡Œåœ¨ä¸€ä¸ªç½‘ä¸Šçš„ç½‘ï¼ˆåº”ç”¨å±‚ç½‘ç»œï¼‰ï¼Œå¹¶ä¸ä¾é ipåœ°å€æ¥ä¼ é€’æ¶ˆæ¯ï¼Œè€Œæ˜¯é‡‡ç”¨ä¸€ç§æ˜ å°„æœºåˆ¶ï¼ŒæŠŠipåœ°å€å’Œidentifiersåšæ˜ å°„æ¥èµ„æºå®šä½ã€‚&lt;/p&gt;
&lt;h2 id=&#34;2-è·¯ç”±&#34;&gt;&lt;strong&gt;2ã€è·¯ç”±&lt;/strong&gt;&lt;/h2&gt;
&lt;p&gt;äº’è”ç½‘æ˜¯ç”±è·¯ç”±å™¨è¿æ¥çš„ç½‘ç»œç»„åˆè€Œæˆï¼Œè·¯ç”±å™¨æŒ‰ç…§è·¯ç”±è¡¨ã€è·¯ç”±åè®®ç­‰æœºåˆ¶å®ç°å¯¹æ•°æ®åŒ…æ­£ç¡®åœ°è½¬å‘ï¼Œä»è€Œåˆ°è¾¾ç›®æ ‡ä¸»æœºã€‚è·¯ç”±å™¨æ ¹æ®æ•°æ®åŒ…ä¸­ç›®æ ‡ä¸»æœºçš„IPåœ°å€å’Œè·¯ç”±æ§åˆ¶è¡¨æ¯”è¾ƒå¾—å‡ºä¸‹ä¸€ä¸ªæ¥æ”¶æ•°æ®çš„è·¯ç”±å™¨ã€‚&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;1ï¼‰é™æ€è·¯ç”±ï¼šäº‹å…ˆè®¾ç½®å¥½è·¯ç”±å™¨å’Œä¸»æœºä¸­çš„è·¯ç”±è¡¨ä¿¡æ¯ã€‚&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;https://res.cloudinary.com/dqxtn0ick/image/upload/v1510578569/article/flannel/static-route.png&#34; alt=&#34;é™æ€è·¯ç”±&#34;&gt;&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;2ï¼‰åŠ¨æ€è·¯ç”±ï¼šè®©è·¯ç”±åè®®åœ¨è¿è¡Œä¸­è‡ªåŠ¨ä¿®æ”¹å¹¶è®¾ç½®è·¯ç”±è¡¨ä¿¡æ¯ã€‚&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;https://res.cloudinary.com/dqxtn0ick/image/upload/v1510578568/article/flannel/dynamic-route.png&#34; alt=&#34;åŠ¨æ€è·¯ç”±&#34;&gt;&lt;/p&gt;
&lt;h1 id=&#34;2-ä¸ºä»€ä¹ˆä½¿ç”¨flannel-why&#34;&gt;2. ä¸ºä»€ä¹ˆä½¿ç”¨flannelï¼ˆwhyï¼‰&lt;/h1&gt;
&lt;p&gt;åœ¨é»˜è®¤çš„Dockeré…ç½®ä¸­ï¼Œæ¯ä¸ªèŠ‚ç‚¹ä¸Šçš„DockeræœåŠ¡ä¼šåˆ†åˆ«è´Ÿè´£æ‰€åœ¨èŠ‚ç‚¹å®¹å™¨çš„IPåˆ†é…ã€‚è¿™æ ·å¯¼è‡´çš„ä¸€ä¸ªé—®é¢˜æ˜¯ï¼Œä¸åŒèŠ‚ç‚¹ä¸Šå®¹å™¨å¯èƒ½è·å¾—ç›¸åŒçš„å†…å¤–IPåœ°å€ã€‚&lt;/p&gt;
&lt;p&gt;Flannelçš„è®¾è®¡ç›®çš„å°±æ˜¯ä¸ºé›†ç¾¤ä¸­çš„æ‰€æœ‰èŠ‚ç‚¹é‡æ–°è§„åˆ’IPåœ°å€çš„ä½¿ç”¨è§„åˆ™ï¼Œä»è€Œä½¿å¾—ä¸åŒèŠ‚ç‚¹ä¸Šçš„å®¹å™¨èƒ½å¤Ÿè·å¾—â€œåŒå±ä¸€ä¸ªå†…ç½‘â€ä¸”â€ä¸é‡å¤çš„â€IPåœ°å€ï¼Œå¹¶è®©å±äºä¸åŒèŠ‚ç‚¹ä¸Šçš„å®¹å™¨èƒ½å¤Ÿç›´æ¥é€šè¿‡å†…ç½‘IPé€šä¿¡ã€‚&lt;/p&gt;
&lt;h1 id=&#34;3-å¦‚ä½•å®ç°flannel-how&#34;&gt;3. å¦‚ä½•å®ç°flannelï¼ˆhowï¼‰&lt;/h1&gt;
&lt;p&gt;Flannelå®è´¨ä¸Šæ˜¯ä¸€ç§â€œè¦†ç›–ç½‘ç»œ(overlay network)â€ï¼Œä¹Ÿå°±æ˜¯å°†TCPæ•°æ®åŒ…è£…åœ¨å¦ä¸€ç§ç½‘ç»œåŒ…é‡Œé¢è¿›è¡Œè·¯ç”±è½¬å‘å’Œé€šä¿¡ï¼Œç›®å‰å·²ç»æ”¯æŒUDPã€VxLANã€AWS VPCå’ŒGCEè·¯ç”±ç­‰æ•°æ®è½¬å‘æ–¹å¼ï¼Œé»˜è®¤çš„èŠ‚ç‚¹é—´æ•°æ®é€šä¿¡æ–¹å¼æ˜¯UDPè½¬å‘ã€‚&lt;/p&gt;
&lt;h2 id=&#34;3-1-flannelåŸç†å›¾&#34;&gt;3.1. flannelåŸç†å›¾&lt;/h2&gt;
&lt;p&gt;&lt;img src=&#34;https://res.cloudinary.com/dqxtn0ick/image/upload/v1510578568/article/flannel/flannel.png&#34; alt=&#34;flannel&#34;&gt;&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;æ•°æ®ä»æºå®¹å™¨ä¸­å‘å‡ºåï¼Œç»ç”±æ‰€åœ¨ä¸»æœºçš„docker0è™šæ‹Ÿç½‘å¡è½¬å‘åˆ°flannel0è™šæ‹Ÿç½‘å¡ï¼Œè¿™æ˜¯ä¸ªP2Pçš„è™šæ‹Ÿç½‘å¡ï¼ŒflanneldæœåŠ¡ç›‘å¬åœ¨ç½‘å¡çš„å¦å¤–ä¸€ç«¯ã€‚&lt;/li&gt;
&lt;li&gt;Flannelé€šè¿‡EtcdæœåŠ¡ç»´æŠ¤äº†ä¸€å¼ èŠ‚ç‚¹é—´çš„è·¯ç”±è¡¨ã€‚&lt;/li&gt;
&lt;li&gt;æºä¸»æœºçš„flanneldæœåŠ¡å°†åŸæœ¬çš„æ•°æ®å†…å®¹UDPå°è£…åæ ¹æ®è‡ªå·±çš„è·¯ç”±è¡¨æŠ•é€’ç»™ç›®çš„èŠ‚ç‚¹çš„flanneldæœåŠ¡ï¼Œæ•°æ®åˆ°è¾¾ä»¥åè¢«è§£åŒ…ï¼Œç„¶åç›´ æ¥è¿›å…¥ç›®çš„èŠ‚ç‚¹çš„flannel0è™šæ‹Ÿç½‘å¡ï¼Œç„¶åè¢«è½¬å‘åˆ°ç›®çš„ä¸»æœºçš„docker0è™šæ‹Ÿç½‘å¡ï¼Œæœ€åå°±åƒæœ¬æœºå®¹å™¨é€šä¿¡ä¸€ä¸‹çš„æœ‰docker0è·¯ç”±åˆ°è¾¾ç›®æ ‡å®¹ å™¨ã€‚&lt;/li&gt;
&lt;/ol&gt;
&lt;h2 id=&#34;3-2-å®ç°è¯´æ˜&#34;&gt;3.2. å®ç°è¯´æ˜&lt;/h2&gt;
&lt;h2 id=&#34;1-udpå°è£…&#34;&gt;&lt;strong&gt;1ã€UDPå°è£…&lt;/strong&gt;&lt;/h2&gt;
&lt;p&gt;åŸå§‹æ•°æ®æ˜¯åœ¨èµ·å§‹èŠ‚ç‚¹çš„FlannelæœåŠ¡ä¸Šè¿›è¡ŒUDPå°è£…çš„ï¼ŒæŠ•é€’åˆ°ç›®çš„èŠ‚ç‚¹åå°±è¢«å¦ä¸€ç«¯çš„FlannelæœåŠ¡è¿˜åŸæˆäº†åŸå§‹çš„æ•°æ®åŒ…ï¼Œä¸¤è¾¹çš„DockeræœåŠ¡éƒ½æ„Ÿè§‰ä¸åˆ°è¿™ä¸ªè¿‡ç¨‹çš„å­˜åœ¨ã€‚ UDPçš„æ•°æ®å†…å®¹éƒ¨åˆ†å…¶å®æ˜¯å¦ä¸€ä¸ªICMPï¼ˆä¹Ÿå°±æ˜¯pingå‘½ä»¤ï¼‰çš„æ•°æ®åŒ…ã€‚&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;https://res.cloudinary.com/dqxtn0ick/image/upload/v1510578569/article/flannel/udp.png&#34; alt=&#34;UDPå°è£…&#34;&gt;&lt;/p&gt;
&lt;h2 id=&#34;2-ä¸ºdockeråˆ†é…ä¸åŒçš„ipæ®µ&#34;&gt;&lt;strong&gt;2ã€ä¸ºdockeråˆ†é…ä¸åŒçš„IPæ®µ&lt;/strong&gt;&lt;/h2&gt;
&lt;p&gt;Flannelé€šè¿‡Etcdåˆ†é…äº†æ¯ä¸ªèŠ‚ç‚¹å¯ç”¨çš„IPåœ°å€æ®µåï¼Œå·å·çš„ä¿®æ”¹äº†Dockerçš„å¯åŠ¨å‚æ•°ã€‚&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;https://res.cloudinary.com/dqxtn0ick/image/upload/v1510578568/article/flannel/docker-init-args.png&#34; alt=&#34;dockerå¯åŠ¨å‚æ•°&#34;&gt;&lt;/p&gt;
&lt;p&gt;æ³¨æ„å…¶ä¸­çš„â€œ--bip=172.17.18.1/24â€è¿™ä¸ªå‚æ•°ï¼Œå®ƒé™åˆ¶äº†æ‰€åœ¨èŠ‚ç‚¹å®¹å™¨è·å¾—çš„IPèŒƒå›´ã€‚&lt;/p&gt;
&lt;p&gt;è¿™ä¸ªIPèŒƒå›´æ˜¯ç”±Flannelè‡ªåŠ¨åˆ†é…çš„ï¼Œç”±Flannelé€šè¿‡ä¿å­˜åœ¨EtcdæœåŠ¡ä¸­çš„è®°å½•ç¡®ä¿å®ƒä»¬ä¸ä¼šé‡å¤ã€‚&lt;/p&gt;
&lt;h2 id=&#34;3-è·¯ç”±è§„åˆ™&#34;&gt;&lt;strong&gt;3ã€è·¯ç”±è§„åˆ™&lt;/strong&gt;&lt;/h2&gt;
&lt;p&gt;1ï¼‰æ•°æ®å‘é€èŠ‚ç‚¹çš„è·¯ç”±è¡¨&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;https://res.cloudinary.com/dqxtn0ick/image/upload/v1510578568/article/flannel/DataSendRouteTable.png&#34; alt=&#34;æ•°æ®å‘é€èŠ‚ç‚¹è·¯ç”±è¡¨&#34;&gt;&lt;/p&gt;
&lt;p&gt;2ï¼‰æ•°æ®æ¥æ”¶èŠ‚ç‚¹çš„è·¯ç”±è¡¨&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;https://res.cloudinary.com/dqxtn0ick/image/upload/v1510578568/article/flannel/DataReceiveRouteTable.png&#34; alt=&#34;æ•°æ®æ¥æ”¶èŠ‚ç‚¹è·¯ç”±è¡¨&#34;&gt;&lt;/p&gt;
&lt;p&gt;ä¾‹å¦‚ç°åœ¨æœ‰ä¸€ä¸ªæ•°æ®åŒ…è¦ä»IPä¸º172.17.18.2çš„å®¹å™¨å‘åˆ°IPä¸º172.17.46.2çš„å®¹å™¨ã€‚æ ¹æ®æ•°æ®å‘é€èŠ‚ç‚¹çš„è·¯ç”±è¡¨ï¼Œå®ƒåªä¸ 172.17.0.0/16åŒ¹é…è¿™æ¡è®°å½•åŒ¹é…ï¼Œå› æ­¤æ•°æ®ä»docker0å‡ºæ¥ä»¥åå°±è¢«æŠ•é€’åˆ°äº†flannel0ã€‚åŒç†åœ¨ç›®æ ‡èŠ‚ç‚¹ï¼Œç”±äºæŠ•é€’çš„åœ°å€æ˜¯ä¸€ä¸ªå®¹ å™¨ï¼Œå› æ­¤ç›®çš„åœ°å€ä¸€å®šä¼šè½åœ¨docker0å¯¹äºçš„172.17.46.0/24è¿™ä¸ªè®°å½•ä¸Šï¼Œè‡ªç„¶çš„è¢«æŠ•é€’åˆ°äº†docker0ç½‘å¡ã€‚&lt;/p&gt;
&lt;h2 id=&#34;3-3-flannelçš„å®‰è£…ä¸é…ç½®&#34;&gt;3.3. flannelçš„å®‰è£…ä¸é…ç½®&lt;/h2&gt;
&lt;h2 id=&#34;1-å®‰è£…&#34;&gt;&lt;strong&gt;1ã€å®‰è£…&lt;/strong&gt;&lt;/h2&gt;
&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;wget http://&amp;lt;å®˜ç½‘&amp;gt;/flannel/flannel-0.2.0-10.el7.x86_64.rpm
yum localinstall -y flannel-0.2.0-10.el7.x86_64.rpm
&lt;/code&gt;&lt;/pre&gt;&lt;h2 id=&#34;2-é…ç½®&#34;&gt;&lt;strong&gt;2ã€é…ç½®&lt;/strong&gt;&lt;/h2&gt;
&lt;p&gt;vi /etc/sysconfig/flanneld&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#8f5902;font-style:italic&#34;&gt;# Flanneld configuration options&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt; 
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#8f5902;font-style:italic&#34;&gt;# etcd url location. Point this to the server where etcd runs&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#000&#34;&gt;FLANNEL_ETCD&lt;/span&gt;&lt;span style=&#34;color:#ce5c00;font-weight:bold&#34;&gt;=&lt;/span&gt;&lt;span style=&#34;color:#4e9a06&#34;&gt;&amp;#34;http://127.0.0.1:4001&amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#8f5902;font-style:italic&#34;&gt;# etcd config key. This is the configuration key that flannel queries&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#8f5902;font-style:italic&#34;&gt;# For address range assignment&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#000&#34;&gt;FLANNEL_ETCD_KEY&lt;/span&gt;&lt;span style=&#34;color:#ce5c00;font-weight:bold&#34;&gt;=&lt;/span&gt;&lt;span style=&#34;color:#4e9a06&#34;&gt;&amp;#34;/xxx/flannel/product/network&amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#8f5902;font-style:italic&#34;&gt;# Any additional options that you want to pass&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#000&#34;&gt;FLANNEL_OPTIONS&lt;/span&gt;&lt;span style=&#34;color:#ce5c00;font-weight:bold&#34;&gt;=&lt;/span&gt;&lt;span style=&#34;color:#4e9a06&#34;&gt;&amp;#34; -iface=eth0&amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;h2 id=&#34;3-åˆå§‹åŒ–flannelçš„etcdé…ç½®&#34;&gt;&lt;strong&gt;3ã€åˆå§‹åŒ–flannelçš„etcdé…ç½®&lt;/strong&gt;&lt;/h2&gt;
&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;etcdctl set /xxx/flannel/network/config &amp;#39;{
   &amp;#34;Network&amp;#34;: &amp;#34;10.0.0.0/16&amp;#34;,
   &amp;#34;Backend&amp;#34;: {
       &amp;#34;Type&amp;#34;: &amp;#34;vxlan&amp;#34;
   }
}&amp;#39;
&lt;/code&gt;&lt;/pre&gt;
      </description>
    </item>
    
    <item>
      <title>Kubernetes-Notes: CNIæ’ä»¶é€‰å‹</title>
      <link>https://blog.huweihuang.com/kubernetes-notes/network/cni/cni-plugin-comparison/</link>
      <pubDate>Sat, 16 Nov 2024 10:50:57 +0000</pubDate>
      
      <guid>https://blog.huweihuang.com/kubernetes-notes/network/cni/cni-plugin-comparison/</guid>
      <description>
        
        
        &lt;p&gt;æœ¬æ–‡ä¸»è¦æè¿°å¸¸ç”¨çš„CNIæ’ä»¶çš„é€‰å‹ï¼Œä¸»è¦åŒ…æ‹¬ciliumï¼Œcalicoï¼Œflannelä¸‰ç§æ’ä»¶çš„å¯¹æ¯”ã€‚&lt;/p&gt;
&lt;h1 id=&#34;1-æŠ€æœ¯ç‰¹ç‚¹å¯¹æ¯”&#34;&gt;1. æŠ€æœ¯ç‰¹ç‚¹å¯¹æ¯”&lt;/h1&gt;
&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th&gt;ç‰¹æ€§&lt;/th&gt;
&lt;th&gt;&lt;strong&gt;Cilium&lt;/strong&gt;&lt;/th&gt;
&lt;th&gt;&lt;strong&gt;Calico&lt;/strong&gt;&lt;/th&gt;
&lt;th&gt;&lt;strong&gt;Flannel&lt;/strong&gt;&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td&gt;æ•°æ®é¢æŠ€æœ¯&lt;/td&gt;
&lt;td&gt;eBPF åŠ é€Ÿ&lt;/td&gt;
&lt;td&gt;åŸºäº iptablesï¼ˆæ”¯æŒ eBPFï¼‰&lt;/td&gt;
&lt;td&gt;vxlanã€host-gwã€ipip ç­‰éš§é“æŠ€æœ¯&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;è½¬å‘æ•ˆç‡&lt;/td&gt;
&lt;td&gt;é«˜ï¼ˆå†…æ ¸çº§åŠ é€Ÿï¼Œç›´é€šæµé‡ï¼‰&lt;/td&gt;
&lt;td&gt;é«˜ï¼ˆæ”¯æŒåŸç”Ÿè·¯ç”±ï¼‰&lt;/td&gt;
&lt;td&gt;ä¸­ï¼ˆéš§é“æŠ€æœ¯å¢åŠ å¼€é”€ï¼‰&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;å¯æ‰©å±•æ€§&lt;/td&gt;
&lt;td&gt;ä¼˜ï¼ˆæ”¯æŒé«˜çº§ L7 ç­–ç•¥ï¼‰&lt;/td&gt;
&lt;td&gt;ä¼˜ï¼ˆæ”¯æŒåŸç”Ÿè·¯ç”±å’Œç®€å•ç½‘ç»œç­–ç•¥ï¼‰&lt;/td&gt;
&lt;td&gt;è¾ƒä½ï¼ˆä»¥ L3 ç½‘ç»œä¸ºä¸»ï¼‰&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;å»¶è¿Ÿ&lt;/td&gt;
&lt;td&gt;ä½ï¼ˆæ— éœ€é¢å¤–éš§é“æˆ–è§„åˆ™ï¼‰&lt;/td&gt;
&lt;td&gt;ä½ï¼ˆæ— éš§é“æˆ– eBPF æ¨¡å¼ï¼‰&lt;/td&gt;
&lt;td&gt;è¾ƒé«˜ï¼ˆéš§é“å°è£…å¢åŠ å»¶è¿Ÿï¼‰&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;ååé‡&lt;/td&gt;
&lt;td&gt;é«˜ï¼ˆeBPF é«˜æ•ˆè½¬å‘ï¼‰&lt;/td&gt;
&lt;td&gt;ä¸­ï¼ˆä¾èµ– iptables æˆ– eBPFï¼‰&lt;/td&gt;
&lt;td&gt;è¾ƒä½ï¼ˆéš§é“å¼€é”€æ˜¾è‘—ï¼‰&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;h1 id=&#34;2-æ€§èƒ½æŒ‡æ ‡å¯¹æ¯”&#34;&gt;2. æ€§èƒ½æŒ‡æ ‡å¯¹æ¯”&lt;/h1&gt;
&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th&gt;æ€§èƒ½æŒ‡æ ‡&lt;/th&gt;
&lt;th&gt;&lt;strong&gt;Cilium&lt;/strong&gt;&lt;/th&gt;
&lt;th&gt;&lt;strong&gt;Calico&lt;/strong&gt;&lt;/th&gt;
&lt;th&gt;&lt;strong&gt;Flannel&lt;/strong&gt;&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;ååé‡&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;é«˜ï¼ˆeBPF é«˜æ•ˆè½¬å‘ï¼‰&lt;/td&gt;
&lt;td&gt;ä¸­-é«˜ï¼ˆå–å†³äºæ¨¡å¼ï¼‰&lt;/td&gt;
&lt;td&gt;è¾ƒä½ï¼ˆéš§é“å°è£…æŸè€—è¾ƒå¤§ï¼‰&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;å»¶è¿Ÿ&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;ä½ï¼ˆç›´æ¥è·¯ç”±æ¨¡å¼æœ€ä½³ï¼‰&lt;/td&gt;
&lt;td&gt;è¾ƒä½ï¼ˆééš§é“æ¨¡å¼è¡¨ç°è‰¯å¥½ï¼‰&lt;/td&gt;
&lt;td&gt;è¾ƒé«˜ï¼ˆéš§é“å¢åŠ å»¶è¿Ÿï¼‰&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;CPUä½¿ç”¨&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;è¾ƒé«˜ï¼ˆeBPF å’Œå¯è§‚æµ‹æ€§åŠŸèƒ½ï¼‰&lt;/td&gt;
&lt;td&gt;ä¸­ï¼ˆiptables/eBPF å¼€é”€ï¼‰&lt;/td&gt;
&lt;td&gt;ä½ï¼ˆç®€å•æ¶æ„ï¼‰&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;å†…å­˜ä½¿ç”¨&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;è¾ƒé«˜ï¼ˆåŠŸèƒ½ä¸°å¯Œï¼‰&lt;/td&gt;
&lt;td&gt;ä¸­&lt;/td&gt;
&lt;td&gt;ä½&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;h1 id=&#34;3-æµ‹è¯•æ•°æ®ç¤ºä¾‹&#34;&gt;3. æµ‹è¯•æ•°æ®ç¤ºä¾‹&lt;/h1&gt;
&lt;p&gt;ä»¥ä¸‹æ˜¯æ ¹æ®å…¸å‹æµ‹è¯•åœºæ™¯æ€»ç»“çš„æŒ‡æ ‡ï¼ˆå•ä½ä¸ºååé‡ Mbps å’Œå»¶è¿Ÿ msï¼‰ï¼š&lt;/p&gt;
&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th&gt;æµ‹è¯•åœºæ™¯&lt;/th&gt;
&lt;th&gt;&lt;strong&gt;Cilium&lt;/strong&gt;&lt;/th&gt;
&lt;th&gt;&lt;strong&gt;Calico&lt;/strong&gt;&lt;/th&gt;
&lt;th&gt;&lt;strong&gt;Flannel&lt;/strong&gt;&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;ååé‡ (å•èŠ‚ç‚¹)&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;~9,000 Mbps&lt;/td&gt;
&lt;td&gt;~8,500 Mbps&lt;/td&gt;
&lt;td&gt;~6,000 Mbps&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;ååé‡ (è·¨èŠ‚ç‚¹)&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;~8,000 Mbps&lt;/td&gt;
&lt;td&gt;~7,500 Mbps&lt;/td&gt;
&lt;td&gt;~5,000 Mbps&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;å»¶è¿Ÿ (å•èŠ‚ç‚¹)&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;~0.2 ms&lt;/td&gt;
&lt;td&gt;~0.3 ms&lt;/td&gt;
&lt;td&gt;~1.0 ms&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;å»¶è¿Ÿ (è·¨èŠ‚ç‚¹)&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;~0.4 ms&lt;/td&gt;
&lt;td&gt;~0.5 ms&lt;/td&gt;
&lt;td&gt;~2.0 ms&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;p&gt;2020å¹´æµ‹è¯•æ•°æ®ï¼š&lt;/p&gt;
&lt;p&gt;æ•°æ®æ¥æºï¼š&lt;a href=&#34;https://itnext.io/benchmark-results-of-kubernetes-network-plugins-cni-over-10gbit-s-network-updated-august-2020-6e1b757b9e49&#34;&gt;Benchmark results of Kubernetes network plugins (CNI) over 10Gbit/s network (Updated: August 2020)&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;https://res.cloudinary.com/dqxtn0ick/image/upload/v1731839739/article/kubernetes/network/cni/cni-comparison.webp&#34; alt=&#34;&#34;&gt;&lt;/p&gt;
&lt;p&gt;[2024å¹´]å•ä½å¸¦å®½æ¶ˆè€—çš„CPUå’Œå†…å­˜æ•°æ®ï¼š&lt;/p&gt;
&lt;p&gt;æ•°æ®æ¥æºï¼š&lt;a href=&#34;https://itnext.io/benchmark-results-of-kubernetes-network-plugins-cni-over-40gbit-s-network-2024-156f085a5e4e#89d8-90c23c8caeb4-reply&#34;&gt;Benchmark results of Kubernetes network plugins (CNI) over 40Gbit/s network -2024&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;https://res.cloudinary.com/dqxtn0ick/image/upload/v1731839992/article/kubernetes/network/cni/Resource-efficiency-per-CNI.webp&#34; alt=&#34;&#34;&gt;&lt;/p&gt;
&lt;p&gt;ä»¥ä¸Šå¯ä»¥çœ‹å‡ºciliumå•ä½æ¶ˆè€—çš„CPUå’Œå†…å­˜ç›¸æ¯”äºflannelé«˜ã€‚&lt;/p&gt;
&lt;h1 id=&#34;4-ç½‘ç»œæ€§èƒ½åˆ†æ&#34;&gt;4. ç½‘ç»œæ€§èƒ½åˆ†æ&lt;/h1&gt;
&lt;h2 id=&#34;4-1-cilium&#34;&gt;4.1. Cilium&lt;/h2&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;ååé‡&lt;/strong&gt;ï¼šåŸºäº eBPF çš„æ•°æ®é¢æŠ€æœ¯ï¼Œå¯ç›´æ¥åœ¨ Linux å†…æ ¸ä¸­é«˜æ•ˆè½¬å‘æµé‡ï¼Œå‡å°‘ä¸Šä¸‹æ–‡åˆ‡æ¢ã€‚ä½¿ç”¨ç›´è¿è·¯ç”±æ¨¡å¼ï¼ˆ&lt;code&gt;--tunnel=disabled&lt;/code&gt;ï¼‰æ—¶ï¼Œè¿›ä¸€æ­¥å‡å°‘å°è£…å¼€é”€ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;å»¶è¿Ÿ&lt;/strong&gt;ï¼šæ”¯æŒ Sidecar-less çš„æœåŠ¡ç½‘æ ¼æ¶æ„ï¼Œèƒ½å¤Ÿé™ä½æœåŠ¡é—´é€šä¿¡å»¶è¿Ÿã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;èµ„æºæ¶ˆè€—&lt;/strong&gt;ï¼šç”±äºå…¶é«˜çº§åŠŸèƒ½ï¼ˆå¦‚ Hubble å¯è§‚æµ‹æ€§å’Œ L7 ç­–ç•¥ï¼‰ï¼Œåœ¨ CPU å’Œå†…å­˜ä½¿ç”¨ä¸Šé«˜äºå…¶ä»–æ’ä»¶ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;h2 id=&#34;4-2-calico&#34;&gt;4.2. Calico&lt;/h2&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;ååé‡&lt;/strong&gt;ï¼šééš§é“æ¨¡å¼ä¸‹ï¼ŒåŸºäº BGP çš„åŸç”Ÿè·¯ç”±æ€§èƒ½æ¥è¿‘è£¸æœºæ°´å¹³ï¼›å¯ç”¨ eBPF æ¨¡å¼æ—¶ï¼Œæ€§èƒ½è¿›ä¸€æ­¥æå‡ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;å»¶è¿Ÿ&lt;/strong&gt;ï¼šè¡¨ç°è‰¯å¥½ï¼Œä½†åœ¨å¤æ‚ç½‘ç»œç­–ç•¥ä¸‹å¯èƒ½å¢åŠ å»¶è¿Ÿã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;èµ„æºæ¶ˆè€—&lt;/strong&gt;ï¼šèµ„æºä½¿ç”¨é€‚ä¸­ï¼Œé€‚åˆå¤§å¤šæ•°ç”Ÿäº§ç¯å¢ƒã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;h2 id=&#34;4-3-flannel&#34;&gt;4.3. Flannel&lt;/h2&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;ååé‡&lt;/strong&gt;ï¼šç”±äºé‡‡ç”¨ VXLANã€IPIP ç­‰éš§é“å°è£…æ–¹å¼ï¼Œå…¶æ€§èƒ½é€šå¸¸ä¸å¦‚ Cilium å’Œ Calicoã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;å»¶è¿Ÿ&lt;/strong&gt;ï¼šå°è£…å’Œè§£å°è£…çš„é¢å¤–æ“ä½œå¯¼è‡´å»¶è¿Ÿå¢åŠ ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;èµ„æºæ¶ˆè€—&lt;/strong&gt;ï¼šæ¶æ„ç®€å•ï¼Œèµ„æºä½¿ç”¨æœ€ä½ï¼Œé€‚åˆèµ„æºæœ‰é™çš„å°å‹é›†ç¾¤ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;h1 id=&#34;5-ä¸šåŠ¡åœºæ™¯é€‰å‹&#34;&gt;5. ä¸šåŠ¡åœºæ™¯é€‰å‹&lt;/h1&gt;
&lt;p&gt;&lt;strong&gt;1. Ciliumï¼šé€‚åˆé«˜æ€§èƒ½ä¸å®‰å…¨éœ€æ±‚çš„åœºæ™¯&lt;/strong&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;é€‚ç”¨åœºæ™¯ï¼š
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;å¾®æœåŠ¡æ¶æ„&lt;/strong&gt;ï¼šCilium çš„ eBPF æŠ€æœ¯æ”¯æŒ L7 æ•°æ®åŒ…è¿‡æ»¤ã€æœåŠ¡å¯è§‚æµ‹æ€§å’Œæ—  Sidecar æœåŠ¡ç½‘æ ¼ï¼Œéå¸¸é€‚åˆå¤æ‚å¾®æœåŠ¡ç¯å¢ƒã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;è¾¹ç¼˜è®¡ç®—&lt;/strong&gt;ï¼šåœ¨è¾¹ç¼˜èŠ‚ç‚¹ä¸Šï¼Œéœ€è¦ä½å»¶è¿Ÿå’Œé«˜ååé‡ï¼ŒCilium çš„ç›´è¿è·¯ç”±æ¨¡å¼ï¼ˆ&lt;code&gt;--tunnel=disabled&lt;/code&gt;ï¼‰éå¸¸é«˜æ•ˆã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;å¤šäº‘å’Œæ··åˆäº‘&lt;/strong&gt;ï¼šæ”¯æŒå¤šç§é«˜çº§ç½‘ç»œåŠŸèƒ½ï¼Œå¦‚ç½‘ç»œç­–ç•¥çš„çµæ´»é…ç½®å’Œé€æ˜çš„åŠ å¯†ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;å±€é™æ€§ï¼š
&lt;ul&gt;
&lt;li&gt;éƒ¨ç½²å¤æ‚åº¦ç›¸å¯¹è¾ƒé«˜ï¼Œå¯¹ Linux å†…æ ¸ç‰ˆæœ¬æœ‰è¦æ±‚ï¼ˆæ¨è 5.3+ï¼‰ã€‚&lt;/li&gt;
&lt;li&gt;èµ„æºæ¶ˆè€—æ¯” Flannel é«˜ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;&lt;strong&gt;2. Calicoï¼šé€‚åˆå¤§è§„æ¨¡ã€çµæ´»ç­–ç•¥çš„ä¼ä¸šé›†ç¾¤&lt;/strong&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;é€‚ç”¨åœºæ™¯ï¼š
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;å¤§è§„æ¨¡ Kubernetes é›†ç¾¤&lt;/strong&gt;ï¼šåŸºäº BGP çš„ç½‘ç»œè·¯ç”±èƒ½å¤Ÿé«˜æ•ˆæ‰©å±•ï¼Œé€‚åˆå…¬æœ‰äº‘å’Œä¼ä¸šçº§å¤§è§„æ¨¡é›†ç¾¤ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;æ³¨é‡å®‰å…¨ç­–ç•¥&lt;/strong&gt;ï¼šæ”¯æŒä¸°å¯Œçš„ç½‘ç»œå®‰å…¨ç­–ç•¥ï¼Œå¹¶æä¾›å¯¹æ¥ eBPF çš„èƒ½åŠ›ï¼Œå…¼é¡¾æ€§èƒ½å’Œç­–ç•¥çµæ´»æ€§ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;æ··åˆéƒ¨ç½²&lt;/strong&gt;ï¼šCalico å¯ä»¥åœ¨é Kubernetes å·¥ä½œè´Ÿè½½ä¸­å®ç°ä¸€è‡´çš„ç½‘ç»œç­–ç•¥ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;å±€é™æ€§ï¼š
&lt;ul&gt;
&lt;li&gt;é»˜è®¤åŸºäº iptables çš„å®ç°åœ¨é«˜è´Ÿè½½ä¸‹æ€§èƒ½å¯èƒ½ä¸å¦‚ Cilium çš„ eBPF æ•°æ®é¢ã€‚&lt;/li&gt;
&lt;li&gt;ç½‘ç»œç­–ç•¥å¤æ‚åº¦è¾ƒé«˜æ—¶ï¼Œå¯èƒ½å¢åŠ è¿ç»´å·¥ä½œé‡ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;&lt;strong&gt;3. Flannelï¼šé€‚åˆè½»é‡çº§å’Œèµ„æºæœ‰é™çš„é›†ç¾¤&lt;/strong&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;é€‚ç”¨åœºæ™¯ï¼š
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;å°å‹é›†ç¾¤&lt;/strong&gt;ï¼šFlannel æ¶æ„ç®€å•ï¼Œèµ„æºä½¿ç”¨å°‘ï¼Œé€‚åˆè½»é‡åŒ–çš„ Kubernetes éƒ¨ç½²ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;æµ‹è¯•ç¯å¢ƒ&lt;/strong&gt;ï¼šæ€§èƒ½éœ€æ±‚è¾ƒä½çš„å¼€å‘å’Œæµ‹è¯•ç¯å¢ƒä¸­ï¼Œå¯ä»¥å¿«é€Ÿæ­å»ºå’Œè¿è¡Œã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;è¾¹ç¼˜è®¡ç®—ï¼ˆéé«˜æ€§èƒ½ï¼‰&lt;/strong&gt;ï¼šå¯¹ç½‘ç»œæ€§èƒ½è¦æ±‚è¾ƒä½çš„å°å‹è¾¹ç¼˜èŠ‚ç‚¹å¯ä»¥ä½¿ç”¨ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;å±€é™æ€§ï¼š
&lt;ul&gt;
&lt;li&gt;åœ¨ååé‡å’Œå»¶è¿Ÿä¸Šä¸å¦‚ Cilium å’Œ Calicoï¼Œå°¤å…¶æ˜¯éœ€è¦å¤§é‡éš§é“å°è£…æ—¶ã€‚&lt;/li&gt;
&lt;li&gt;ç¼ºä¹é«˜çº§ç½‘ç»œåŠŸèƒ½ï¼Œä¾‹å¦‚å¤æ‚çš„ç½‘ç»œç­–ç•¥å’Œè§‚æµ‹èƒ½åŠ›ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;&lt;strong&gt;4. æ¨èé€‰æ‹©æ€»ç»“&lt;/strong&gt;&lt;/p&gt;
&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th&gt;åœºæ™¯ç±»å‹&lt;/th&gt;
&lt;th&gt;æ¨èæ’ä»¶&lt;/th&gt;
&lt;th&gt;åŸå› &lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;é«˜æ€§èƒ½å¾®æœåŠ¡æ¶æ„&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;&lt;strong&gt;Cilium&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;æä¾› eBPF æŠ€æœ¯ï¼Œæ”¯æŒå¤æ‚ç­–ç•¥å’Œä½å»¶è¿Ÿç½‘ç»œ&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;å¤§è§„æ¨¡ä¼ä¸šé›†ç¾¤&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;&lt;strong&gt;Calico&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;ç¨³å®šã€çµæ´»ï¼Œé€‚åˆå¤šæ ·åŒ–å’Œå¤§è§„æ¨¡ Kubernetes éƒ¨ç½²&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;èµ„æºå—é™ç¯å¢ƒ&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;&lt;strong&gt;Flannel&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;ç®€å•æ˜“ç”¨ï¼Œèµ„æºæ¶ˆè€—ä½&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;è¾¹ç¼˜è®¡ç®—&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;&lt;strong&gt;Cilium/Flannel&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;Cilium é€‚åˆé«˜æ€§èƒ½éœ€æ±‚ï¼ŒFlannel é€‚åˆè½»é‡çº§èŠ‚ç‚¹&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;æ··åˆäº‘/å¤šäº‘&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;&lt;strong&gt;Cilium/Calico&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;Cilium æ”¯æŒé€æ˜åŠ å¯†å’Œç°ä»£æ¶æ„ï¼ŒCalico æä¾›çµæ´»ç½‘ç»œç­–ç•¥æ”¯æŒ&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;p&gt;å‚è€ƒï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href=&#34;https://docs.cilium.io/en/latest/operations/performance/benchmark/&#34;&gt;https://docs.cilium.io/en/latest/operations/performance/benchmark/&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://cilium.io/blog/2018/12/03/cni-performance/&#34;&gt;https://cilium.io/blog/2018/12/03/cni-performance/&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://cilium.io/blog/2021/05/11/cni-benchmark/&#34;&gt;https://cilium.io/blog/2021/05/11/cni-benchmark/&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://itnext.io/benchmark-results-of-kubernetes-network-plugins-cni-over-40gbit-s-network-2024-156f085a5e4e#89d8-90c23c8caeb4-reply&#34;&gt;Benchmark results of Kubernetes network plugins (CNI) over 40Gbit/s network -2024&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://itnext.io/benchmark-results-of-kubernetes-network-plugins-cni-over-10gbit-s-network-updated-august-2020-6e1b757b9e49&#34;&gt;Benchmark results of Kubernetes network plugins (CNI) over 10Gbit/s network (Updated: August 2020)&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;

      </description>
    </item>
    
    <item>
      <title>Kubernetes-Notes: Macvlanä»‹ç»</title>
      <link>https://blog.huweihuang.com/kubernetes-notes/network/cni/macvlan/</link>
      <pubDate>Sat, 10 Jul 2021 10:50:57 +0000</pubDate>
      
      <guid>https://blog.huweihuang.com/kubernetes-notes/network/cni/macvlan/</guid>
      <description>
        
        
        &lt;h1 id=&#34;1-ç®€ä»‹&#34;&gt;1. ç®€ä»‹&lt;/h1&gt;
&lt;p&gt;macvlanå¯ä»¥çœ‹åšæ˜¯ç‰©ç†æ¥å£ethï¼ˆçˆ¶æ¥å£ï¼‰çš„å­æ¥å£ï¼Œæ¯ä¸ªmacvlanéƒ½æ‹¥æœ‰ç‹¬ç«‹çš„macåœ°å€ï¼Œå¯ä»¥è¢«ç»‘å®šIPä½œä¸ºæ­£å¸¸çš„ç½‘å¡æ¥å£ä½¿ç”¨ã€‚é€šè¿‡è¿™ä¸ªç‰¹æ€§ï¼Œå¯ä»¥å®ç°åœ¨ä¸€ä¸ªç‰©ç†ç½‘ç»œè®¾å¤‡ç»‘å®šå¤šä¸ªIPï¼Œæ¯ä¸ªIPæ‹¥æœ‰ç‹¬ç«‹çš„macåœ°å€ã€‚è¯¥ç‰¹æ€§ç»å¸¸è¢«åº”ç”¨åœ¨å®¹å™¨è™šæ‹ŸåŒ–ä¸­ï¼ˆå®¹å™¨å¯ä»¥é…ç½®macvlançš„ç½‘ç»œï¼Œå°†macvlan interfaceç§»åŠ¨åˆ°å®¹å™¨çš„namespaceä¸­ï¼‰ã€‚&lt;/p&gt;
&lt;p&gt;ç¤ºæ„å›¾ï¼š&lt;/p&gt;
&lt;img src=&#34;https://res.cloudinary.com/dqxtn0ick/image/upload/v1595764512/article/kubernetes/macvlan/macvlan.jpg&#34;&gt;
&lt;h1 id=&#34;2-å››ç§å·¥ä½œæ¨¡å¼&#34;&gt;2. å››ç§å·¥ä½œæ¨¡å¼&lt;/h1&gt;
&lt;h2 id=&#34;2-1-vepa-virtual-ethernet-port-aggregator&#34;&gt;2.1. VEPA (Virtual Ethernet Port Aggregator)&lt;/h2&gt;
&lt;img src=&#34;https://res.cloudinary.com/dqxtn0ick/image/upload/v1595764512/article/kubernetes/macvlan/macvlan_vepa.jpg&#34;&gt;
&lt;p&gt;VEPAä¸ºé»˜è®¤çš„å·¥ä½œæ¨¡å¼ï¼Œè¯¥æ¨¡å¼ä¸‹ï¼Œæ‰€æœ‰macvlanå‘å‡ºçš„æµé‡éƒ½ä¼šç»è¿‡çˆ¶æ¥å£ï¼Œä¸ç®¡ç›®çš„åœ°æ˜¯å¦ä¸è¯¥macvlanå…±ç”¨ä¸€ä¸ªçˆ¶æ¥å£ã€‚&lt;/p&gt;
&lt;h2 id=&#34;2-2-bridge-mode&#34;&gt;2.2. Bridge mode&lt;/h2&gt;
&lt;img src=&#34;https://res.cloudinary.com/dqxtn0ick/image/upload/v1595764512/article/kubernetes/macvlan/macvlan_bridge.jpg&#34;&gt;
&lt;p&gt;è¯¥bridgeæ¨¡å¼ç±»ä¼¼äºä¼ ç»Ÿçš„ç½‘æ¡¥æ¨¡å¼ï¼Œæ‹¥æœ‰ç›¸åŒçˆ¶æ¥å£çš„macvlanå¯ä»¥ç›´æ¥è¿›è¡Œé€šä¿¡ï¼Œä¸éœ€è¦å°†æ•°æ®å‘ç»™çˆ¶æ¥å£è½¬å‘ã€‚è¯¥æ¨¡å¼ä¸‹ä¸éœ€è¦äº¤æ¢æœºæ”¯æŒhairpinæ¨¡å¼ï¼Œæ€§èƒ½æ¯”VEPAæ¨¡å¼å¥½ã€‚å¦å¤–ç›¸å¯¹äºä¼ ç»Ÿçš„ç½‘æ¡¥æ¨¡å¼ï¼Œè¯¥æ¨¡å¼ä¸éœ€è¦å­¦ä¹ macåœ°å€ï¼Œä¸éœ€è¦STPï¼Œä½¿å¾—å…¶æ€§èƒ½æ¯”ä¼ ç»Ÿçš„ç½‘æ¡¥æ€§èƒ½å¥½å¾—å¤šã€‚ä½†æ˜¯å¦‚æœçˆ¶æ¥å£downæ‰ï¼Œåˆ™æ‰€æœ‰å­æ¥å£ä¹Ÿä¼šdownï¼ŒåŒæ—¶æ— æ³•é€šä¿¡ã€‚&lt;/p&gt;
&lt;h2 id=&#34;2-3-private-mode&#34;&gt;2.3. Private mode&lt;/h2&gt;
&lt;img src=&#34;https://res.cloudinary.com/dqxtn0ick/image/upload/v1595764512/article/kubernetes/macvlan/macvlan_private.jpg&#34;&gt;
&lt;p&gt;è¯¥æ¨¡å¼æ˜¯VEPAæ¨¡å¼çš„å¢å¼ºç‰ˆï¼Œ&lt;/p&gt;
&lt;h2 id=&#34;2-4-passthru-mode&#34;&gt;2.4. Passthru mode&lt;/h2&gt;
&lt;img src=&#34;https://res.cloudinary.com/dqxtn0ick/image/upload/v1595764512/article/kubernetes/macvlan/macvlan_passthru.jpg&#34;&gt;
&lt;p&gt;.Â &lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;å¾…å®Œå–„&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;å‚è€ƒï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href=&#34;https://backreference.org/2014/03/20/some-notes-on-macvlanmacvtap/&#34;&gt;https://backreference.org/2014/03/20/some-notes-on-macvlanmacvtap/&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://github.com/containernetworking/plugins/tree/master/plugins/main/macvlan&#34;&gt;https://github.com/containernetworking/plugins/tree/master/plugins/main/macvlan&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://github.com/containernetworking/plugins/blob/master/plugins/main/macvlan/macvlan.go&#34;&gt;https://github.com/containernetworking/plugins/blob/master/plugins/main/macvlan/macvlan.go&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;http://wikibon.org/wiki/v/Edge_Virtual_Bridging&#34;&gt;http://wikibon.org/wiki/v/Edge_Virtual_Bridging&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://juejin.im/post/5ca183ad6fb9a05e5343a7e8&#34;&gt;Linux è™šæ‹Ÿç½‘å¡æŠ€æœ¯ï¼šMacvlan&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;http://hicu.be/bridge-vs-macvlan&#34;&gt;http://hicu.be/bridge-vs-macvlan&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;http://hicu.be/docker-networking-macvlan-bridge-mode-configuration&#34;&gt;http://hicu.be/docker-networking-macvlan-bridge-mode-configuration&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;

      </description>
    </item>
    
  </channel>
</rss>

<!doctype html>
<html lang="zh-cn" class="no-js">
  <head>
    <meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="generator" content="Hugo 0.101.0" />
<link rel="canonical" type="text/html" href="https://blog.huweihuang.com/golang-notes/web/beego/">
<link rel="alternate" type="application/rss&#43;xml" href="https://blog.huweihuang.com/golang-notes/web/beego/index.xml">
<meta name="robots" content="noindex, nofollow">


<link rel="shortcut icon" href="/favicons/favicon.ico" >
<link rel="apple-touch-icon" href="/favicons/apple-touch-icon-180x180.png" sizes="180x180">
<link rel="icon" type="image/png" href="/favicons/favicon-16x16.png" sizes="16x16">
<link rel="icon" type="image/png" href="/favicons/favicon-32x32.png" sizes="32x32">
<link rel="icon" type="image/png" href="/favicons/android-36x36.png" sizes="36x36">
<link rel="icon" type="image/png" href="/favicons/android-48x48.png" sizes="48x48">
<link rel="icon" type="image/png" href="/favicons/android-72x72.png" sizes="72x72">
<link rel="icon" type="image/png" href="/favicons/android-96x96.png" sizes="96x96">
<link rel="icon" type="image/png" href="/favicons/android-144x144.png" sizes="144x144">
<link rel="icon" type="image/png" href="/favicons/android-192x192.png" sizes="192x192">

<title>Beego Web框架 | 胡伟煌</title>
<meta name="description" content="">
<meta property="og:title" content="Beego Web框架" />
<meta property="og:description" content="Kubernetes学习笔记" />
<meta property="og:type" content="website" />
<meta property="og:url" content="https://blog.huweihuang.com/golang-notes/web/beego/" /><meta property="og:site_name" content="胡伟煌" />

<meta itemprop="name" content="Beego Web框架">
<meta itemprop="description" content="Kubernetes学习笔记"><meta name="twitter:card" content="summary"/>
<meta name="twitter:title" content="Beego Web框架"/>
<meta name="twitter:description" content="Kubernetes学习笔记"/>




<link rel="preload" href="/scss/main.min.79e3930541ca05b5395c14b2a313b798fad1dc69f9a14aefa57b62eaa9f65f14.css" as="style">
<link href="/scss/main.min.79e3930541ca05b5395c14b2a313b798fad1dc69f9a14aefa57b62eaa9f65f14.css" rel="stylesheet" integrity="">

<script
  src="https://code.jquery.com/jquery-3.6.0.min.js"
  integrity="sha384-vtXRMe3mGCbOeY7l30aIg8H9p3GdeSe4IFlP6G8JMa7o7lXvnz3GFKzPxzJdPfGK"
  crossorigin="anonymous"></script>
<script
  src="https://unpkg.com/lunr@2.3.9/lunr.min.js"
  integrity="sha384-203J0SNzyqHby3iU6hzvzltrWi/M41wOP5Gu+BiJMz5nwKykbkUx8Kp7iti0Lpli"
  crossorigin="anonymous"></script>
<link rel="stylesheet" href="/css/prism.css"/>

<script type="application/javascript">
var doNotTrack = false;
if (!doNotTrack) {
	window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)};ga.l=+new Date;
	ga('create', 'UA-114718458-1', 'auto');
	
	ga('send', 'pageview');
}
</script>
<script async src='https://www.google-analytics.com/analytics.js'></script>

  </head>
  <body class="td-section">
    <header>
      
<nav class="js-navbar-scroll navbar navbar-expand navbar-dark flex-column flex-md-row td-navbar">
        <a class="navbar-brand" href="/">
		<span class="navbar-logo"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 32 32" width="64" height="64"><path d="M15.9.476a2.14 2.14.0 00-.823.218L3.932 6.01c-.582.277-1.005.804-1.15 1.432L.054 19.373c-.13.56-.025 1.147.3 1.627q.057.087.12.168l7.7 9.574c.407.5 1.018.787 1.662.784h12.35c.646.001 1.258-.3 1.664-.793l7.696-9.576c.404-.5.555-1.16.4-1.786L29.2 7.43c-.145-.628-.57-1.155-1.15-1.432L16.923.695A2.14 2.14.0 0015.89.476z" fill="#326ce5"/><path d="M16.002 4.542c-.384.027-.675.356-.655.74v.188c.018.213.05.424.092.633a6.22 6.22.0 01.066 1.21c-.038.133-.114.253-.218.345l-.015.282c-.405.034-.807.096-1.203.186-1.666.376-3.183 1.24-4.354 2.485l-.24-.17c-.132.04-.274.025-.395-.04a6.22 6.22.0 01-.897-.81 5.55 5.55.0 00-.437-.465l-.148-.118c-.132-.106-.294-.167-.463-.175a.64.64.0 00-.531.236c-.226.317-.152.756.164.983l.138.11a5.55 5.55.0 00.552.323c.354.197.688.428.998.7a.74.74.0 01.133.384l.218.2c-1.177 1.766-1.66 3.905-1.358 6.006l-.28.08c-.073.116-.17.215-.286.288a6.22 6.22.0 01-1.194.197 5.57 5.57.0 00-.64.05l-.177.04h-.02a.67.67.0 00-.387 1.132.67.67.0 00.684.165h.013l.18-.02c.203-.06.403-.134.598-.218.375-.15.764-.265 1.162-.34.138.008.27.055.382.135l.3-.05c.65 2.017 2.016 3.726 3.84 4.803l-.122.255c.056.117.077.247.06.376-.165.382-.367.748-.603 1.092a5.58 5.58.0 00-.358.533l-.085.18a.67.67.0 00.65 1.001.67.67.0 00.553-.432l.083-.17c.076-.2.14-.404.192-.61.177-.437.273-.906.515-1.196a.54.54.0 01.286-.14l.15-.273a8.62 8.62.0 006.146.015l.133.255c.136.02.258.095.34.205.188.358.34.733.456 1.12a5.57 5.57.0 00.194.611l.083.17a.67.67.0 001.187.131.67.67.0 00.016-.701l-.087-.18a5.55 5.55.0 00-.358-.531c-.23-.332-.428-.686-.6-1.057a.52.52.0 01.068-.4 2.29 2.29.0 01-.111-.269c1.82-1.085 3.18-2.8 3.823-4.82l.284.05c.102-.093.236-.142.373-.138.397.076.786.2 1.162.34.195.09.395.166.598.23.048.013.118.024.172.037h.013a.67.67.0 00.841-.851.67.67.0 00-.544-.446l-.194-.046a5.57 5.57.0 00-.64-.05c-.404-.026-.804-.092-1.194-.197-.12-.067-.22-.167-.288-.288l-.27-.08a8.65 8.65.0 00-1.386-5.993l.236-.218c-.01-.137.035-.273.124-.378.307-.264.64-.497.99-.696a5.57 5.57.0 00.552-.323l.146-.118a.67.67.0 00-.133-1.202.67.67.0 00-.696.161l-.148.118a5.57 5.57.0 00-.437.465c-.264.302-.556.577-.873.823a.74.74.0 01-.404.044l-.253.18c-1.46-1.53-3.427-2.48-5.535-2.67.0-.1-.013-.25-.015-.297-.113-.078-.192-.197-.218-.332a6.23 6.23.0 01.076-1.207c.043-.21.073-.42.092-.633v-.2c.02-.384-.27-.713-.655-.74zm-.834 5.166-.2 3.493h-.015c-.01.216-.137.4-.332.504s-.426.073-.6-.054l-2.865-2.03a6.86 6.86.0 013.303-1.799c.234-.05.47-.088.707-.114zm1.668.0c1.505.187 2.906.863 3.99 1.924l-2.838 2.017c-.175.14-.415.168-.618.072s-.333-.3-.336-.524zm-6.72 3.227 2.62 2.338v.015c.163.142.234.363.186.574s-.21.378-.417.435v.01l-3.362.967a6.86 6.86.0 01.974-4.34zm11.753.0c.796 1.295 1.148 2.814 1.002 4.327l-3.367-.97v-.013c-.21-.057-.37-.224-.417-.435s.023-.43.186-.574l2.6-2.327zm-6.404 2.52h1.072l.655.832-.238 1.04-.963.463-.965-.463-.227-1.04zm3.434 2.838c.045-.005.1-.005.135.0l3.467.585c-.5 1.44-1.487 2.67-2.775 3.493l-1.34-3.244a.59.59.0 01.509-.819zm-5.823.015c.196.003.377.104.484.268s.124.37.047.55v.013l-1.332 3.218C11 21.54 10.032 20.325 9.517 18.9l3.437-.583c.038-.004.077-.004.116.0zm2.904 1.4a.59.59.0 01.537.308h.013l1.694 3.057-.677.2c-1.246.285-2.547.218-3.758-.194l1.7-3.057c.103-.18.293-.29.5-.295z" fill="#fff" stroke="#fff" stroke-width=".055"/></svg></span><span class="font-weight-bold">胡伟煌</span>
	</a>
	<div class="td-navbar-nav-scroll ml-md-auto" id="main_navbar">
		<ul class="navbar-nav mt-2 mt-lg-0">
			
			
			<li class="nav-item mr-4 mb-2 mb-lg-0">
				
				
				
				
				
				
				
				
				<a class="nav-link" href="/kubernetes-notes/" ><span>Kubernetes学习笔记</span></a>
			</li>
			
			<li class="nav-item mr-4 mb-2 mb-lg-0">
				
				
				
				
				
				
				
				
				<a class="nav-link" href="/k8s-source-code-analysis/" ><span>Kubernetes源码分析</span></a>
			</li>
			
			<li class="nav-item mr-4 mb-2 mb-lg-0">
				
				
				
				
				
				
				
				
				<a class="nav-link active" href="/golang-notes/" ><span class="active">Golang学习笔记</span></a>
			</li>
			
			<li class="nav-item mr-4 mb-2 mb-lg-0">
				
				
				
				
				
				
				
				
				<a class="nav-link" href="/linux-notes/" ><span>Linux学习笔记</span></a>
			</li>
			
			<li class="nav-item mr-4 mb-2 mb-lg-0">
				
				
				
				
				
				
				
				
				<a class="nav-link" href="/about/" ><span>About</span></a>
			</li>
			
			
			
		</ul>
	</div>
	<div class="navbar-nav d-none d-lg-block"><input
  type="search"
  class="form-control td-search-input"
  placeholder="&#xf002; 站内搜索…"
  aria-label="站内搜索…"
  autocomplete="off"
  
  data-offline-search-index-json-src="/offline-search-index.ee4775ec6dbe1616475a73bf70d4a385.json"
  data-offline-search-base-href="/"
  data-offline-search-max-results="10"
>
</div>
</nav>

    </header>
    <div class="container-fluid td-outer">
      <div class="td-main">
        <div class="row flex-xl-nowrap">
          <main class="col-12 col-md-9 col-xl-8 pl-md-5" role="main">
            




<div class="td-content">
<div class="pageinfo pageinfo-primary d-print-none">
<p>
这是本节的多页打印视图。
<a href="#" onclick="print();return false;">点击此处打印</a>.
</p><p>
<a href="/golang-notes/web/beego/">返回本页常规视图</a>.
</p>
</div>



<h1 class="title">Beego Web框架</h1>





    <ul>
    
  
  
  
  

  
    
    
	
<li>1: <a href="#pg-d920f3d65e431a30e0dcb5ea3fbd7f6d">Beego 介绍</a></li>


    
  
    
    
	
<li>2: <a href="#pg-c1d1f70754730e7cb2300c05042bcfa0">Bee 工具使用</a></li>


    
  
    
    
	
<li>3: <a href="#pg-7fe6fb93e4540d87e90213d922b39705">Beego 项目逻辑</a></li>


    
  
    
    
	
<li>4: <a href="#pg-63a7ba74df98839246bc414fa2028a24">Beego 日志处理</a></li>


    
  

    </ul>


<div class="content">
      
</div>
</div>


  
  
  
  

  
  

  
    
    
	
    

<div class="td-content" style="">
    
	<h1 id="pg-d920f3d65e431a30e0dcb5ea3fbd7f6d">1 - Beego 介绍</h1>
    
	<h1 id="1-beego的使用">1. beego的使用</h1>
<h2 id="1-1-beego的安装">1.1. beego的安装</h2>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-go" data-lang="go"><span style="display:flex;"><span><span style="color:#204a87;font-weight:bold">go</span> <span style="color:#000">get</span> <span style="color:#000">github</span><span style="color:#000;font-weight:bold">.</span><span style="color:#000">com</span><span style="color:#ce5c00;font-weight:bold">/</span><span style="color:#000">astaxie</span><span style="color:#ce5c00;font-weight:bold">/</span><span style="color:#000">beego</span>
</span></span></code></pre></div><h2 id="1-2-beego的升级">1.2. beego的升级</h2>
<p>1、直接升级</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-go" data-lang="go"><span style="display:flex;"><span><span style="color:#204a87;font-weight:bold">go</span> <span style="color:#000">get</span> <span style="color:#ce5c00;font-weight:bold">-</span><span style="color:#000">u</span> <span style="color:#000">github</span><span style="color:#000;font-weight:bold">.</span><span style="color:#000">com</span><span style="color:#ce5c00;font-weight:bold">/</span><span style="color:#000">astaxie</span><span style="color:#ce5c00;font-weight:bold">/</span><span style="color:#000">beego</span>
</span></span></code></pre></div><p>2、源码下载升级</p>
<p>用户访问 <code>https://github.com/astaxie/beego</code> ,下载源码，然后覆盖到 <code>$GOPATH/src/github.com/astaxie/beego</code> 目录，然后通过本地执行安装就可以升级了：</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-go" data-lang="go"><span style="display:flex;"><span><span style="color:#204a87;font-weight:bold">go</span> <span style="color:#000">install</span>  <span style="color:#000">github</span><span style="color:#000;font-weight:bold">.</span><span style="color:#000">com</span><span style="color:#ce5c00;font-weight:bold">/</span><span style="color:#000">astaxie</span><span style="color:#ce5c00;font-weight:bold">/</span><span style="color:#000">beego</span>
</span></span></code></pre></div><h1 id="2-beego的架构">2. beego的架构</h1>
<p>beego 是一个快速开发 Go 应用的 HTTP 框架，他可以用来快速开发 API、Web 及后端服务等各种应用，是一个 RESTful 的框架。</p>
<h2 id="2-1-beego架构图">2.1. beego架构图</h2>
<p><img src="https://res.cloudinary.com/dqxtn0ick/image/upload/v1510578706/article/golang/beego/architecture.png" alt="architecture"></p>
<p>beego 是基于八大独立的模块构建的，是一个高度解耦的框架。</p>
<p>可以使用 cache 模块来做你的缓存逻辑；使用日志模块来记录你的操作信息；使用 config 模块来解析你各种格式的文件。</p>
<h2 id="2-2-beego执行逻辑">2.2. beego执行逻辑</h2>
<p><img src="https://res.cloudinary.com/dqxtn0ick/image/upload/v1510578706/article/golang/beego/flow.png" alt="flow"></p>
<p>参考：</p>
<ul>
<li><a href="https://beego.me/docs/intro/">https://beego.me/docs/intro/</a></li>
<li><a href="https://beego.me/docs/install/">https://beego.me/docs/install/</a></li>
</ul>

</div>



    
	
  
    
    
	
    

<div class="td-content" style="page-break-before: always">
    
	<h1 id="pg-c1d1f70754730e7cb2300c05042bcfa0">2 - Bee 工具使用</h1>
    
	<h1 id="1-bee工具">1. bee工具</h1>
<p>bee工具用来进行beego项目的创建、热编译、开发、测试、和部署。</p>
<p>安装:</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-go" data-lang="go"><span style="display:flex;"><span><span style="color:#204a87;font-weight:bold">go</span> <span style="color:#000">get</span> <span style="color:#000">github</span><span style="color:#000;font-weight:bold">.</span><span style="color:#000">com</span><span style="color:#ce5c00;font-weight:bold">/</span><span style="color:#000">beego</span><span style="color:#ce5c00;font-weight:bold">/</span><span style="color:#000">bee</span>
</span></span></code></pre></div><p>配置：</p>
<p>安装完之后，<code>bee</code>可执行文件默认存放在<code>$GOPATH/bin</code>里面，所以要把<code>$GOPATH/bin</code>添加到环境变量中。</p>
<h1 id="2-bee命令">2. bee命令</h1>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>Bee is a tool <span style="color:#204a87;font-weight:bold">for</span> managing beego framework.
</span></span><span style="display:flex;"><span> 
</span></span><span style="display:flex;"><span>Usage:
</span></span><span style="display:flex;"><span> 
</span></span><span style="display:flex;"><span>    bee <span style="color:#204a87">command</span> <span style="color:#ce5c00;font-weight:bold">[</span>arguments<span style="color:#ce5c00;font-weight:bold">]</span>
</span></span><span style="display:flex;"><span> 
</span></span><span style="display:flex;"><span>The commands are:
</span></span><span style="display:flex;"><span> 
</span></span><span style="display:flex;"><span>    new         create an application base on beego framework
</span></span><span style="display:flex;"><span>    run         run the app which can hot compile
</span></span><span style="display:flex;"><span>    pack        compress an beego project
</span></span><span style="display:flex;"><span>    api         create an api application base on beego framework
</span></span><span style="display:flex;"><span>    bale        packs non-Go files to Go <span style="color:#204a87">source</span> files
</span></span><span style="display:flex;"><span>    version     show the bee <span style="color:#000;font-weight:bold">&amp;</span> beego version
</span></span><span style="display:flex;"><span>    generate    <span style="color:#204a87">source</span> code generator
</span></span><span style="display:flex;"><span>    migrate     run database migrations
</span></span></code></pre></div><p>说明：</p>
<h2 id="2-1-new">2.1. new</h2>
<p>在 <code>$GOPATH/src</code>的目录下执行<code>bee new &lt;appname&gt;</code>，会在当前目录下生成以下文件：</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-go" data-lang="go"><span style="display:flex;"><span><span style="color:#000">myproject</span>
</span></span><span style="display:flex;"><span><span style="color:#a40000">├──</span> <span style="color:#000">conf</span>
</span></span><span style="display:flex;"><span><span style="color:#a40000">│</span>   <span style="color:#a40000">└──</span> <span style="color:#000">app</span><span style="color:#000;font-weight:bold">.</span><span style="color:#000">conf</span>
</span></span><span style="display:flex;"><span><span style="color:#a40000">├──</span> <span style="color:#000">controllers</span>
</span></span><span style="display:flex;"><span><span style="color:#a40000">│</span>   <span style="color:#a40000">└──</span> <span style="color:#204a87;font-weight:bold">default</span><span style="color:#000;font-weight:bold">.</span><span style="color:#204a87;font-weight:bold">go</span>
</span></span><span style="display:flex;"><span><span style="color:#a40000">├──</span> <span style="color:#000">main</span><span style="color:#000;font-weight:bold">.</span><span style="color:#204a87;font-weight:bold">go</span>
</span></span><span style="display:flex;"><span><span style="color:#a40000">├──</span> <span style="color:#000">models</span>
</span></span><span style="display:flex;"><span><span style="color:#a40000">├──</span> <span style="color:#000">routers</span>
</span></span><span style="display:flex;"><span><span style="color:#a40000">│</span>   <span style="color:#a40000">└──</span> <span style="color:#000">router</span><span style="color:#000;font-weight:bold">.</span><span style="color:#204a87;font-weight:bold">go</span>
</span></span><span style="display:flex;"><span><span style="color:#a40000">├──</span> <span style="color:#000">static</span>
</span></span><span style="display:flex;"><span><span style="color:#a40000">│</span>   <span style="color:#a40000">├──</span> <span style="color:#000">css</span>
</span></span><span style="display:flex;"><span><span style="color:#a40000">│</span>   <span style="color:#a40000">├──</span> <span style="color:#000">img</span>
</span></span><span style="display:flex;"><span><span style="color:#a40000">│</span>   <span style="color:#a40000">└──</span> <span style="color:#000">js</span>
</span></span><span style="display:flex;"><span><span style="color:#a40000">├──</span> <span style="color:#000">tests</span>
</span></span><span style="display:flex;"><span><span style="color:#a40000">│</span>   <span style="color:#a40000">└──</span> <span style="color:#000">default_test</span><span style="color:#000;font-weight:bold">.</span><span style="color:#204a87;font-weight:bold">go</span>
</span></span><span style="display:flex;"><span><span style="color:#a40000">└──</span> <span style="color:#000">views</span>
</span></span><span style="display:flex;"><span>    <span style="color:#a40000">└──</span> <span style="color:#000">index</span><span style="color:#000;font-weight:bold">.</span><span style="color:#000">tpl</span>
</span></span></code></pre></div><h2 id="2-2-run">2.2. run</h2>
<p>必须在<code>$GOPATH/src/appname</code>下执行bee run，默认监听8080端口：<code>http://localhost:8080/。</code></p>
<h2 id="2-3-api">2.3. api</h2>
<p><code>api</code> 命令就是用来创建 API 应用，生成以下文件：和 Web 项目相比，少了 static 和 views 目录，多了一个 test 模块，用来做单元测试。</p>
<pre tabindex="0"><code>apiproject
├── conf
│   └── app.conf
├── controllers
│   └── object.go
│   └── user.go
├── docs
│   └── doc.go
├── main.go
├── models
│   └── object.go
│   └── user.go
├── routers
│   └── router.go
└── tests
    └── default_test.go
</code></pre><h2 id="2-4-pack">2.4. pack</h2>
<p><code>pack</code> 目录用来发布应用的时候打包，会把项目打包成 zip 包(<code>apiproject.tar.gz</code>)，这样我们部署的时候直接把打包之后的项目上传，解压就可以部署了：</p>
<h2 id="2-5-generate">2.5. generate</h2>
<p>用来自动化的生成代码的，包含了从数据库一键生成model，还包含了scaffold。</p>
<h2 id="2-6-migrate">2.6. migrate</h2>
<p>这个命令是应用的数据库迁移命令，主要是用来每次应用升级，降级的SQL管理。</p>
<p>参考：</p>
<ul>
<li><a href="https://beego.me/docs/install/bee.md">https://beego.me/docs/install/bee.md</a></li>
</ul>

</div>



    
	
  
    
    
	
    

<div class="td-content" style="page-break-before: always">
    
	<h1 id="pg-7fe6fb93e4540d87e90213d922b39705">3 - Beego 项目逻辑</h1>
    
	<h1 id="beego项目逻辑">beego项目逻辑</h1>
<h1 id="1-路由设置">1. 路由设置</h1>
<h2 id="1-1-beego-router">1.1. beego.Router</h2>
<p>入口文件main.go</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-go" data-lang="go"><span style="display:flex;"><span><span style="color:#204a87;font-weight:bold">package</span> <span style="color:#000">main</span>
</span></span><span style="display:flex;"><span> 
</span></span><span style="display:flex;"><span><span style="color:#204a87;font-weight:bold">import</span> <span style="color:#000;font-weight:bold">(</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000">_</span> <span style="color:#4e9a06">&#34;quickstart/routers&#34;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#4e9a06">&#34;github.com/astaxie/beego&#34;</span>
</span></span><span style="display:flex;"><span><span style="color:#000;font-weight:bold">)</span>
</span></span><span style="display:flex;"><span> 
</span></span><span style="display:flex;"><span><span style="color:#204a87;font-weight:bold">func</span> <span style="color:#000">main</span><span style="color:#000;font-weight:bold">()</span> <span style="color:#000;font-weight:bold">{</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000">beego</span><span style="color:#000;font-weight:bold">.</span><span style="color:#000">Run</span><span style="color:#000;font-weight:bold">()</span>
</span></span><span style="display:flex;"><span><span style="color:#000;font-weight:bold">}</span>
</span></span></code></pre></div><p>go中导入包中init函数的执行逻辑</p>
<p><img src="https://res.cloudinary.com/dqxtn0ick/image/upload/v1510578706/article/golang/beego/init.png" alt="init"></p>
<p><code>_ &quot;quickstart/routers&quot;</code>,包只引入执行了里面的init函数</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-go" data-lang="go"><span style="display:flex;"><span><span style="color:#204a87;font-weight:bold">package</span> <span style="color:#000">routers</span>
</span></span><span style="display:flex;"><span> 
</span></span><span style="display:flex;"><span><span style="color:#204a87;font-weight:bold">import</span> <span style="color:#000;font-weight:bold">(</span>
</span></span><span style="display:flex;"><span>    <span style="color:#4e9a06">&#34;quickstart/controllers&#34;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#4e9a06">&#34;github.com/astaxie/beego&#34;</span>
</span></span><span style="display:flex;"><span><span style="color:#000;font-weight:bold">)</span>
</span></span><span style="display:flex;"><span> 
</span></span><span style="display:flex;"><span><span style="color:#204a87;font-weight:bold">func</span> <span style="color:#000">init</span><span style="color:#000;font-weight:bold">()</span> <span style="color:#000;font-weight:bold">{</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000">beego</span><span style="color:#000;font-weight:bold">.</span><span style="color:#000">Router</span><span style="color:#000;font-weight:bold">(</span><span style="color:#4e9a06">&#34;/&#34;</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#ce5c00;font-weight:bold">&amp;</span><span style="color:#000">controllers</span><span style="color:#000;font-weight:bold">.</span><span style="color:#000">MainController</span><span style="color:#000;font-weight:bold">{})</span>
</span></span><span style="display:flex;"><span><span style="color:#000;font-weight:bold">}</span>
</span></span></code></pre></div><p>路由包里执行了路由注册<code>beego.Router</code>, 这个函数的功能是映射URL到controller，第一个参数是URL(用户请求的地址)，这里是 <code>/</code>，也就是访问的不带任何参数的URL，第二个参数是对应的 Controller，就是把请求分发到那个控制器来执行相应的逻辑。</p>
<h2 id="1-2-beego-run">1.2. beego.Run</h2>
<ul>
<li>
<p>解析配置文件</p>
<p>beego 会自动解析在 conf 目录下面的配置文件 <code>app.conf</code>，通过修改配置文件相关的属性，我们可以定义：开启的端口，是否开启 session，应用名称等信息。</p>
</li>
<li>
<p>执行用户的hookfunc</p>
<p>beego会执行用户注册的hookfunc，默认的已经存在了注册mime，用户可以通过函数<code>AddAPPStartHook</code>注册自己的启动函数。</p>
</li>
<li>
<p>是否开启 session</p>
<p>会根据上面配置文件的分析之后判断是否开启 session，如果开启的话就初始化全局的 session。</p>
</li>
<li>
<p>是否编译模板</p>
<p>beego 会在启动的时候根据配置把 views 目录下的所有模板进行预编译，然后存在 map 里面，这样可以有效的提高模板运行的效率，无需进行多次编译。</p>
</li>
<li>
<p>是否开启文档功能</p>
<p>根据EnableDocs配置判断是否开启内置的文档路由功能</p>
</li>
<li>
<p>是否启动管理模块</p>
<p>beego 目前做了一个很酷的模块，应用内监控模块，会在 8088 端口做一个内部监听，我们可以通过这个端口查询到 QPS、CPU、内存、GC、goroutine、thread 等统计信息。</p>
</li>
<li>
<p>监听服务端口</p>
<p>这是最后一步也就是我们看到的访问 8080 看到的网页端口，内部其实调用了 <code>ListenAndServe</code>，充分利用了 goroutine 的优势，一旦 run 起来之后，我们的服务就监听在两个端口了，一个服务端口 8080 作为对外服务，另一个 8088 端口实行对内监控。</p>
</li>
</ul>
<h1 id="2-controller-逻辑">2. controller 逻辑</h1>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-go" data-lang="go"><span style="display:flex;"><span><span style="color:#204a87;font-weight:bold">package</span> <span style="color:#000">controllers</span>
</span></span><span style="display:flex;"><span> 
</span></span><span style="display:flex;"><span><span style="color:#204a87;font-weight:bold">import</span> <span style="color:#000;font-weight:bold">(</span>
</span></span><span style="display:flex;"><span>        <span style="color:#4e9a06">&#34;github.com/astaxie/beego&#34;</span>
</span></span><span style="display:flex;"><span><span style="color:#000;font-weight:bold">)</span>
</span></span><span style="display:flex;"><span> 
</span></span><span style="display:flex;"><span><span style="color:#204a87;font-weight:bold">type</span> <span style="color:#000">MainController</span> <span style="color:#204a87;font-weight:bold">struct</span> <span style="color:#000;font-weight:bold">{</span>
</span></span><span style="display:flex;"><span>        <span style="color:#000">beego</span><span style="color:#000;font-weight:bold">.</span><span style="color:#000">Controller</span>
</span></span><span style="display:flex;"><span><span style="color:#000;font-weight:bold">}</span>
</span></span><span style="display:flex;"><span> 
</span></span><span style="display:flex;"><span><span style="color:#204a87;font-weight:bold">func</span> <span style="color:#000;font-weight:bold">(</span><span style="color:#000">this</span> <span style="color:#ce5c00;font-weight:bold">*</span><span style="color:#000">MainController</span><span style="color:#000;font-weight:bold">)</span> <span style="color:#000">Get</span><span style="color:#000;font-weight:bold">()</span> <span style="color:#000;font-weight:bold">{</span>
</span></span><span style="display:flex;"><span>        <span style="color:#000">this</span><span style="color:#000;font-weight:bold">.</span><span style="color:#000">Data</span><span style="color:#000;font-weight:bold">[</span><span style="color:#4e9a06">&#34;Website&#34;</span><span style="color:#000;font-weight:bold">]</span> <span style="color:#000;font-weight:bold">=</span> <span style="color:#4e9a06">&#34;beego.me&#34;</span>
</span></span><span style="display:flex;"><span>        <span style="color:#000">this</span><span style="color:#000;font-weight:bold">.</span><span style="color:#000">Data</span><span style="color:#000;font-weight:bold">[</span><span style="color:#4e9a06">&#34;Email&#34;</span><span style="color:#000;font-weight:bold">]</span> <span style="color:#000;font-weight:bold">=</span> <span style="color:#4e9a06">&#34;astaxie@gmail.com&#34;</span>
</span></span><span style="display:flex;"><span>        <span style="color:#000">this</span><span style="color:#000;font-weight:bold">.</span><span style="color:#000">TplName</span> <span style="color:#000;font-weight:bold">=</span> <span style="color:#4e9a06">&#34;index.tpl&#34;</span>
</span></span><span style="display:flex;"><span><span style="color:#000;font-weight:bold">}</span>
</span></span></code></pre></div><p>1、声明了一个控制器 <code>MainController</code>，这个控制器里面内嵌了 <code>beego.Controller</code>，即Go 的嵌入方式，也就是 <code>MainController</code> 自动拥有了所有 <code>beego.Controller</code> 的方法。而 <code>beego.Controller</code> 拥有很多方法，其中包括 <code>Init</code>、<code>Prepare</code>、<code>Post</code>、<code>Get</code>、<code>Delete</code>、<code>Head</code>等方法。可以通过重写的方式来实现这些方法，以上例子重写了 <code>Get</code> 方法。</p>
<p>2、beego 是一个 RESTful 的框架，请求默认是执行对应 <code>req.Method</code> 的方法。例如浏览器的是 <code>GET</code> 请求，那么默认就会执行 <code>MainController</code> 下的 <code>Get</code> 方法。（用户可以改变这个行为，通过注册自定义的函数名）。</p>
<p>3、获取数据，赋值到 <code>this.Data</code> 中，这是一个用来存储输出数据的 map。</p>
<p>4、渲染模板，<code>this.TplName</code> 就是需要渲染的模板，这里指定了 <code>index.tpl</code>，如果用户不设置该参数，那么默认会去到模板目录的 <code>Controller/&lt;方法名&gt;.tpl</code> 查找，例如上面的方法会去 <code>maincontroller/get.tpl</code>(文件、文件夹必须小写)。用户设置了模板之后系统会自动的调用 <code>Render</code> 函数（这个函数是在 beego.Controller 中实现的），所以无需用户自己来调用渲染。</p>
<p>5、如果不使用模板可以直接输出：</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-go" data-lang="go"><span style="display:flex;"><span><span style="color:#204a87;font-weight:bold">func</span> <span style="color:#000;font-weight:bold">(</span><span style="color:#000">this</span> <span style="color:#ce5c00;font-weight:bold">*</span><span style="color:#000">MainController</span><span style="color:#000;font-weight:bold">)</span> <span style="color:#000">Get</span><span style="color:#000;font-weight:bold">()</span> <span style="color:#000;font-weight:bold">{</span>
</span></span><span style="display:flex;"><span>        <span style="color:#000">this</span><span style="color:#000;font-weight:bold">.</span><span style="color:#000">Ctx</span><span style="color:#000;font-weight:bold">.</span><span style="color:#000">WriteString</span><span style="color:#000;font-weight:bold">(</span><span style="color:#4e9a06">&#34;hello&#34;</span><span style="color:#000;font-weight:bold">)</span>
</span></span><span style="display:flex;"><span><span style="color:#000;font-weight:bold">}</span>
</span></span></code></pre></div><h1 id="3-model逻辑">3. model逻辑</h1>
<p>model一般用来处理数据库操作，如果逻辑中存在可以复用的部分就可以抽象成一个model。</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-go" data-lang="go"><span style="display:flex;"><span><span style="color:#204a87;font-weight:bold">package</span> <span style="color:#000">models</span>
</span></span><span style="display:flex;"><span> 
</span></span><span style="display:flex;"><span><span style="color:#204a87;font-weight:bold">import</span> <span style="color:#000;font-weight:bold">(</span>
</span></span><span style="display:flex;"><span>    <span style="color:#4e9a06">&#34;loggo/utils&#34;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#4e9a06">&#34;path/filepath&#34;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#4e9a06">&#34;strconv&#34;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#4e9a06">&#34;strings&#34;</span>
</span></span><span style="display:flex;"><span><span style="color:#000;font-weight:bold">)</span>
</span></span><span style="display:flex;"><span> 
</span></span><span style="display:flex;"><span><span style="color:#204a87;font-weight:bold">var</span> <span style="color:#000;font-weight:bold">(</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000">NotPV</span> <span style="color:#000;font-weight:bold">[]</span><span style="color:#204a87;font-weight:bold">string</span> <span style="color:#000;font-weight:bold">=</span> <span style="color:#000;font-weight:bold">[]</span><span style="color:#204a87;font-weight:bold">string</span><span style="color:#000;font-weight:bold">{</span><span style="color:#4e9a06">&#34;css&#34;</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#4e9a06">&#34;js&#34;</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#4e9a06">&#34;class&#34;</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#4e9a06">&#34;gif&#34;</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#4e9a06">&#34;jpg&#34;</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#4e9a06">&#34;jpeg&#34;</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#4e9a06">&#34;png&#34;</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#4e9a06">&#34;bmp&#34;</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#4e9a06">&#34;ico&#34;</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#4e9a06">&#34;rss&#34;</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#4e9a06">&#34;xml&#34;</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#4e9a06">&#34;swf&#34;</span><span style="color:#000;font-weight:bold">}</span>
</span></span><span style="display:flex;"><span><span style="color:#000;font-weight:bold">)</span>
</span></span><span style="display:flex;"><span> 
</span></span><span style="display:flex;"><span><span style="color:#204a87;font-weight:bold">const</span> <span style="color:#000">big</span> <span style="color:#000;font-weight:bold">=</span> <span style="color:#0000cf;font-weight:bold">0xFFFFFF</span>
</span></span><span style="display:flex;"><span> 
</span></span><span style="display:flex;"><span><span style="color:#204a87;font-weight:bold">func</span> <span style="color:#000">LogPV</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">urls</span> <span style="color:#204a87;font-weight:bold">string</span><span style="color:#000;font-weight:bold">)</span> <span style="color:#204a87;font-weight:bold">bool</span> <span style="color:#000;font-weight:bold">{</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000">ext</span> <span style="color:#ce5c00;font-weight:bold">:=</span> <span style="color:#000">filepath</span><span style="color:#000;font-weight:bold">.</span><span style="color:#000">Ext</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">urls</span><span style="color:#000;font-weight:bold">)</span>
</span></span><span style="display:flex;"><span>    <span style="color:#204a87;font-weight:bold">if</span> <span style="color:#000">ext</span> <span style="color:#ce5c00;font-weight:bold">==</span> <span style="color:#4e9a06">&#34;&#34;</span> <span style="color:#000;font-weight:bold">{</span>
</span></span><span style="display:flex;"><span>        <span style="color:#204a87;font-weight:bold">return</span> <span style="color:#204a87;font-weight:bold">true</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000;font-weight:bold">}</span>
</span></span><span style="display:flex;"><span>    <span style="color:#204a87;font-weight:bold">for</span> <span style="color:#000">_</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#000">v</span> <span style="color:#ce5c00;font-weight:bold">:=</span> <span style="color:#204a87;font-weight:bold">range</span> <span style="color:#000">NotPV</span> <span style="color:#000;font-weight:bold">{</span>
</span></span><span style="display:flex;"><span>        <span style="color:#204a87;font-weight:bold">if</span> <span style="color:#000">v</span> <span style="color:#ce5c00;font-weight:bold">==</span> <span style="color:#000">strings</span><span style="color:#000;font-weight:bold">.</span><span style="color:#000">ToLower</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">ext</span><span style="color:#000;font-weight:bold">)</span> <span style="color:#000;font-weight:bold">{</span>
</span></span><span style="display:flex;"><span>            <span style="color:#204a87;font-weight:bold">return</span> <span style="color:#204a87;font-weight:bold">false</span>
</span></span><span style="display:flex;"><span>        <span style="color:#000;font-weight:bold">}</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000;font-weight:bold">}</span>
</span></span><span style="display:flex;"><span>    <span style="color:#204a87;font-weight:bold">return</span> <span style="color:#204a87;font-weight:bold">true</span>
</span></span><span style="display:flex;"><span><span style="color:#000;font-weight:bold">}</span>
</span></span></code></pre></div><h1 id="4-view逻辑">4. view逻辑</h1>
<p><code>Controller中的this.TplName = &quot;index.tpl&quot;</code>，设置显示的模板文件，默认支持 <code>tpl</code> 和 <code>html</code> 的后缀名，如果想设置其他后缀你可以调用 <code>beego.AddTemplateExt</code> 接口设置。beego 采用了 Go 语言默认的模板引擎，和 Go 的模板语法一样。</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-html" data-lang="html"><span style="display:flex;"><span><span style="color:#8f5902;font-style:italic">&lt;!DOCTYPE html&gt;</span>
</span></span><span style="display:flex;"><span> 
</span></span><span style="display:flex;"><span><span style="color:#000;font-weight:bold">&lt;</span><span style="color:#204a87;font-weight:bold">html</span><span style="color:#000;font-weight:bold">&gt;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000;font-weight:bold">&lt;</span><span style="color:#204a87;font-weight:bold">head</span><span style="color:#000;font-weight:bold">&gt;</span>
</span></span><span style="display:flex;"><span>        <span style="color:#000;font-weight:bold">&lt;</span><span style="color:#204a87;font-weight:bold">title</span><span style="color:#000;font-weight:bold">&gt;</span>Beego<span style="color:#000;font-weight:bold">&lt;/</span><span style="color:#204a87;font-weight:bold">title</span><span style="color:#000;font-weight:bold">&gt;</span>
</span></span><span style="display:flex;"><span>        <span style="color:#000;font-weight:bold">&lt;</span><span style="color:#204a87;font-weight:bold">meta</span> <span style="color:#c4a000">http-equiv</span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#4e9a06">&#34;Content-Type&#34;</span> <span style="color:#c4a000">content</span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#4e9a06">&#34;text/html; charset=utf-8&#34;</span><span style="color:#000;font-weight:bold">&gt;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000;font-weight:bold">&lt;/</span><span style="color:#204a87;font-weight:bold">head</span><span style="color:#000;font-weight:bold">&gt;</span>
</span></span><span style="display:flex;"><span>     
</span></span><span style="display:flex;"><span>    <span style="color:#000;font-weight:bold">&lt;</span><span style="color:#204a87;font-weight:bold">body</span><span style="color:#000;font-weight:bold">&gt;</span>
</span></span><span style="display:flex;"><span>        <span style="color:#000;font-weight:bold">&lt;</span><span style="color:#204a87;font-weight:bold">header</span> <span style="color:#c4a000">class</span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#4e9a06">&#34;hero-unit&#34;</span> <span style="color:#c4a000">style</span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#4e9a06">&#34;background-color:#A9F16C&#34;</span><span style="color:#000;font-weight:bold">&gt;</span>
</span></span><span style="display:flex;"><span>            <span style="color:#000;font-weight:bold">&lt;</span><span style="color:#204a87;font-weight:bold">div</span> <span style="color:#c4a000">class</span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#4e9a06">&#34;container&#34;</span><span style="color:#000;font-weight:bold">&gt;</span>
</span></span><span style="display:flex;"><span>            <span style="color:#000;font-weight:bold">&lt;</span><span style="color:#204a87;font-weight:bold">div</span> <span style="color:#c4a000">class</span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#4e9a06">&#34;row&#34;</span><span style="color:#000;font-weight:bold">&gt;</span>
</span></span><span style="display:flex;"><span>              <span style="color:#000;font-weight:bold">&lt;</span><span style="color:#204a87;font-weight:bold">div</span> <span style="color:#c4a000">class</span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#4e9a06">&#34;hero-text&#34;</span><span style="color:#000;font-weight:bold">&gt;</span>
</span></span><span style="display:flex;"><span>                <span style="color:#000;font-weight:bold">&lt;</span><span style="color:#204a87;font-weight:bold">h1</span><span style="color:#000;font-weight:bold">&gt;</span>Welcome to Beego!<span style="color:#000;font-weight:bold">&lt;/</span><span style="color:#204a87;font-weight:bold">h1</span><span style="color:#000;font-weight:bold">&gt;</span>
</span></span><span style="display:flex;"><span>                <span style="color:#000;font-weight:bold">&lt;</span><span style="color:#204a87;font-weight:bold">p</span> <span style="color:#c4a000">class</span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#4e9a06">&#34;description&#34;</span><span style="color:#000;font-weight:bold">&gt;</span>
</span></span><span style="display:flex;"><span>                    Beego is a simple <span style="color:#a40000">&amp;</span> powerful Go web framework which is inspired by tornado and sinatra.
</span></span><span style="display:flex;"><span>                <span style="color:#000;font-weight:bold">&lt;</span><span style="color:#204a87;font-weight:bold">br</span> <span style="color:#000;font-weight:bold">/&gt;</span>
</span></span><span style="display:flex;"><span>                    Official website: <span style="color:#000;font-weight:bold">&lt;</span><span style="color:#204a87;font-weight:bold">a</span> <span style="color:#c4a000">href</span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#4e9a06">&#34;http://{{.Website}}&#34;</span><span style="color:#000;font-weight:bold">&gt;</span>{{.Website}}<span style="color:#000;font-weight:bold">&lt;/</span><span style="color:#204a87;font-weight:bold">a</span><span style="color:#000;font-weight:bold">&gt;</span>
</span></span><span style="display:flex;"><span>                <span style="color:#000;font-weight:bold">&lt;</span><span style="color:#204a87;font-weight:bold">br</span> <span style="color:#000;font-weight:bold">/&gt;</span>
</span></span><span style="display:flex;"><span>                    Contact me: {{.Email}}
</span></span><span style="display:flex;"><span>                <span style="color:#000;font-weight:bold">&lt;/</span><span style="color:#204a87;font-weight:bold">p</span><span style="color:#000;font-weight:bold">&gt;</span>
</span></span><span style="display:flex;"><span>              <span style="color:#000;font-weight:bold">&lt;/</span><span style="color:#204a87;font-weight:bold">div</span><span style="color:#000;font-weight:bold">&gt;</span>
</span></span><span style="display:flex;"><span>            <span style="color:#000;font-weight:bold">&lt;/</span><span style="color:#204a87;font-weight:bold">div</span><span style="color:#000;font-weight:bold">&gt;</span>
</span></span><span style="display:flex;"><span>            <span style="color:#000;font-weight:bold">&lt;/</span><span style="color:#204a87;font-weight:bold">div</span><span style="color:#000;font-weight:bold">&gt;</span>
</span></span><span style="display:flex;"><span>        <span style="color:#000;font-weight:bold">&lt;/</span><span style="color:#204a87;font-weight:bold">header</span><span style="color:#000;font-weight:bold">&gt;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000;font-weight:bold">&lt;/</span><span style="color:#204a87;font-weight:bold">body</span><span style="color:#000;font-weight:bold">&gt;</span>
</span></span><span style="display:flex;"><span><span style="color:#000;font-weight:bold">&lt;/</span><span style="color:#204a87;font-weight:bold">html</span><span style="color:#000;font-weight:bold">&gt;</span>
</span></span></code></pre></div><p>Controller 里面把数据赋值给了 data（map 类型），然后在模板中就直接通过 key 访问 <code>.Website</code> 和 <code>.Email</code> 。这样就做到了数据的输出。</p>
<h1 id="5-静态文件">5. 静态文件</h1>
<p>网页往往包含了很多的静态文件，包括图片、JS、CSS 等</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>├── static
</span></span><span style="display:flex;"><span>    │   ├── css
</span></span><span style="display:flex;"><span>    │   ├── img
</span></span><span style="display:flex;"><span>    │   └── js
</span></span></code></pre></div><p>beego 默认注册了 static 目录为静态处理的目录，注册样式：URL 前缀和映射的目录（在/main.go文件中beego.Run()之前加入）：</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-go" data-lang="go"><span style="display:flex;"><span><span style="color:#000">StaticDir</span><span style="color:#000;font-weight:bold">[</span><span style="color:#4e9a06">&#34;/static&#34;</span><span style="color:#000;font-weight:bold">]</span> <span style="color:#000;font-weight:bold">=</span> <span style="color:#4e9a06">&#34;static&#34;</span>
</span></span></code></pre></div><p>用户可以设置多个静态文件处理目录，例如你有多个文件下载目录 download1、download2，你可以这样映射（在/main.go文件中beego.Run()之前加入）：</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-go" data-lang="go"><span style="display:flex;"><span><span style="color:#000">beego</span><span style="color:#000;font-weight:bold">.</span><span style="color:#000">SetStaticPath</span><span style="color:#000;font-weight:bold">(</span><span style="color:#4e9a06">&#34;/down1&#34;</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#4e9a06">&#34;download1&#34;</span><span style="color:#000;font-weight:bold">)</span> <span style="color:#000">beego</span><span style="color:#000;font-weight:bold">.</span><span style="color:#000">SetStaticPath</span><span style="color:#000;font-weight:bold">(</span><span style="color:#4e9a06">&#34;/down2&#34;</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#4e9a06">&#34;download2&#34;</span><span style="color:#000;font-weight:bold">)</span>
</span></span></code></pre></div><p>这样用户访问 URL <code>http://localhost:8080/down1/123.txt</code> 则会请求 download1 目录下的 123.txt 文件。</p>
<p>参考：</p>
<ul>
<li><a href="https://beego.me/docs/quickstart/router.md">https://beego.me/docs/quickstart/router.md</a></li>
<li><a href="https://beego.me/docs/quickstart/controller.md">https://beego.me/docs/quickstart/controller.md</a></li>
<li><a href="https://beego.me/docs/quickstart/model.md">https://beego.me/docs/quickstart/model.md</a></li>
<li><a href="https://beego.me/docs/quickstart/view.md">https://beego.me/docs/quickstart/view.md</a></li>
<li><a href="https://beego.me/docs/quickstart/static.md">https://beego.me/docs/quickstart/static.md</a></li>
</ul>

</div>



    
	
  
    
    
	
    

<div class="td-content" style="page-break-before: always">
    
	<h1 id="pg-63a7ba74df98839246bc414fa2028a24">4 - Beego 日志处理</h1>
    
	<h1 id="1-使用入门">1. 使用入门</h1>
<p>beego 的日志处理是基于 logs 模块搭建的，内置了一个变量 <code>BeeLogger</code>，默认已经是 <code>logs.BeeLogger</code> 类型，初始化了 console，也就是默认输出到 <code>console。</code></p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-go" data-lang="go"><span style="display:flex;"><span><span style="color:#000">beego</span><span style="color:#000;font-weight:bold">.</span><span style="color:#000">Emergency</span><span style="color:#000;font-weight:bold">(</span><span style="color:#4e9a06">&#34;this is emergency&#34;</span><span style="color:#000;font-weight:bold">)</span>
</span></span><span style="display:flex;"><span><span style="color:#000">beego</span><span style="color:#000;font-weight:bold">.</span><span style="color:#000">Alert</span><span style="color:#000;font-weight:bold">(</span><span style="color:#4e9a06">&#34;this is alert&#34;</span><span style="color:#000;font-weight:bold">)</span>
</span></span><span style="display:flex;"><span><span style="color:#000">beego</span><span style="color:#000;font-weight:bold">.</span><span style="color:#000">Critical</span><span style="color:#000;font-weight:bold">(</span><span style="color:#4e9a06">&#34;this is critical&#34;</span><span style="color:#000;font-weight:bold">)</span>
</span></span><span style="display:flex;"><span><span style="color:#000">beego</span><span style="color:#000;font-weight:bold">.</span><span style="color:#000">Error</span><span style="color:#000;font-weight:bold">(</span><span style="color:#4e9a06">&#34;this is error&#34;</span><span style="color:#000;font-weight:bold">)</span>
</span></span><span style="display:flex;"><span><span style="color:#000">beego</span><span style="color:#000;font-weight:bold">.</span><span style="color:#000">Warning</span><span style="color:#000;font-weight:bold">(</span><span style="color:#4e9a06">&#34;this is warning&#34;</span><span style="color:#000;font-weight:bold">)</span>
</span></span><span style="display:flex;"><span><span style="color:#000">beego</span><span style="color:#000;font-weight:bold">.</span><span style="color:#000">Notice</span><span style="color:#000;font-weight:bold">(</span><span style="color:#4e9a06">&#34;this is notice&#34;</span><span style="color:#000;font-weight:bold">)</span>
</span></span><span style="display:flex;"><span><span style="color:#000">beego</span><span style="color:#000;font-weight:bold">.</span><span style="color:#000">Informational</span><span style="color:#000;font-weight:bold">(</span><span style="color:#4e9a06">&#34;this is informational&#34;</span><span style="color:#000;font-weight:bold">)</span>
</span></span><span style="display:flex;"><span><span style="color:#000">beego</span><span style="color:#000;font-weight:bold">.</span><span style="color:#000">Debug</span><span style="color:#000;font-weight:bold">(</span><span style="color:#4e9a06">&#34;this is debug&#34;</span><span style="color:#000;font-weight:bold">)</span>
</span></span></code></pre></div><h1 id="2-设置输出">2. 设置输出</h1>
<p>我们的程序往往期望把信息输出到 log 中，现在设置输出到文件很方便，如下所示：</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-go" data-lang="go"><span style="display:flex;"><span><span style="color:#000">beego</span><span style="color:#000;font-weight:bold">.</span><span style="color:#000">SetLogger</span><span style="color:#000;font-weight:bold">(</span><span style="color:#4e9a06">&#34;file&#34;</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#4e9a06">`{&#34;filename&#34;:&#34;logs/test.log&#34;}`</span><span style="color:#000;font-weight:bold">)</span>
</span></span></code></pre></div><p>这个默认情况就会同时输出到两个地方，一个 console，一个 file，如果只想输出到文件，就需要调用删除操作：</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-go" data-lang="go"><span style="display:flex;"><span><span style="color:#000">beego</span><span style="color:#000;font-weight:bold">.</span><span style="color:#000">BeeLogger</span><span style="color:#000;font-weight:bold">.</span><span style="color:#000">DelLogger</span><span style="color:#000;font-weight:bold">(</span><span style="color:#4e9a06">&#34;console&#34;</span><span style="color:#000;font-weight:bold">)</span>
</span></span></code></pre></div><h1 id="3-设置级别">3. 设置级别</h1>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-go" data-lang="go"><span style="display:flex;"><span><span style="color:#000">LevelEmergency</span>
</span></span><span style="display:flex;"><span><span style="color:#000">LevelAlert</span>
</span></span><span style="display:flex;"><span><span style="color:#000">LevelCritical</span>
</span></span><span style="display:flex;"><span><span style="color:#000">LevelError</span>
</span></span><span style="display:flex;"><span><span style="color:#000">LevelWarning</span>
</span></span><span style="display:flex;"><span><span style="color:#000">LevelNotice</span>
</span></span><span style="display:flex;"><span><span style="color:#000">LevelInformational</span>
</span></span><span style="display:flex;"><span><span style="color:#000">LevelDebug</span>
</span></span></code></pre></div><p>级别依次降低，默认全部打印，但是一般我们在部署环境，可以通过设置级别设置日志级别：</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-go" data-lang="go"><span style="display:flex;"><span><span style="color:#000">beego</span><span style="color:#000;font-weight:bold">.</span><span style="color:#000">SetLevel</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">beego</span><span style="color:#000;font-weight:bold">.</span><span style="color:#000">LevelInformational</span><span style="color:#000;font-weight:bold">)</span>
</span></span></code></pre></div><h1 id="4-输出文件名和行号">4. 输出文件名和行号</h1>
<p>日志默认不输出调用的文件名和文件行号,如果你期望输出调用的文件名和文件行号,可以如下设置</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-go" data-lang="go"><span style="display:flex;"><span><span style="color:#000">beego</span><span style="color:#000;font-weight:bold">.</span><span style="color:#000">SetLogFuncCall</span><span style="color:#000;font-weight:bold">(</span><span style="color:#204a87;font-weight:bold">true</span><span style="color:#000;font-weight:bold">)</span>
</span></span></code></pre></div><p>开启传入参数 true, 关闭传入参数 false, 默认是关闭的。</p>
<h1 id="5-beego-logs模块的使用">5. beego/logs模块的使用</h1>
<p>是一个用来处理日志的库，目前支持的引擎有 file、console、net、smtp，可以通过如下方式进行安装：</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-go" data-lang="go"><span style="display:flex;"><span><span style="color:#204a87;font-weight:bold">go</span> <span style="color:#000">get</span> <span style="color:#000">github</span><span style="color:#000;font-weight:bold">.</span><span style="color:#000">com</span><span style="color:#ce5c00;font-weight:bold">/</span><span style="color:#000">astaxie</span><span style="color:#ce5c00;font-weight:bold">/</span><span style="color:#000">beego</span><span style="color:#ce5c00;font-weight:bold">/</span><span style="color:#000">logs</span>
</span></span></code></pre></div><h2 id="5-1-通用方式">5.1. 通用方式</h2>
<p>首先引入包：</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-go" data-lang="go"><span style="display:flex;"><span><span style="color:#204a87;font-weight:bold">import</span> <span style="color:#000;font-weight:bold">(</span> <span style="color:#4e9a06">&#34;github.com/astaxie/beego/logs&#34;</span> <span style="color:#000;font-weight:bold">)</span>
</span></span></code></pre></div><p>然后添加输出引擎（log 支持同时输出到多个引擎），这里我们以 console 为例，第一个参数是引擎名（包括：console、file、conn、smtp、es、multifile）</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-go" data-lang="go"><span style="display:flex;"><span><span style="color:#000">logs</span><span style="color:#000;font-weight:bold">.</span><span style="color:#000">SetLogger</span><span style="color:#000;font-weight:bold">(</span><span style="color:#4e9a06">&#34;console&#34;</span><span style="color:#000;font-weight:bold">)</span>
</span></span></code></pre></div><p>添加输出引擎也支持第二个参数,用来表示配置信息，详细的配置请看下面介绍：</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-go" data-lang="go"><span style="display:flex;"><span><span style="color:#000">logs</span><span style="color:#000;font-weight:bold">.</span><span style="color:#000">SetLogger</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">logs</span><span style="color:#000;font-weight:bold">.</span><span style="color:#000">AdapterFile</span><span style="color:#000;font-weight:bold">,</span><span style="color:#4e9a06">`{&#34;filename&#34;:&#34;project.log&#34;,&#34;level&#34;:7,&#34;maxlines&#34;:0,&#34;maxsize&#34;:0,&#34;daily&#34;:true,&#34;maxdays&#34;:10}`</span><span style="color:#000;font-weight:bold">)</span>
</span></span></code></pre></div><p>示例：</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-go" data-lang="go"><span style="display:flex;"><span><span style="color:#204a87;font-weight:bold">package</span> <span style="color:#000">main</span>
</span></span><span style="display:flex;"><span> 
</span></span><span style="display:flex;"><span><span style="color:#204a87;font-weight:bold">import</span> <span style="color:#000;font-weight:bold">(</span>
</span></span><span style="display:flex;"><span>    <span style="color:#4e9a06">&#34;github.com/astaxie/beego/logs&#34;</span>
</span></span><span style="display:flex;"><span><span style="color:#000;font-weight:bold">)</span>
</span></span><span style="display:flex;"><span> 
</span></span><span style="display:flex;"><span><span style="color:#204a87;font-weight:bold">func</span> <span style="color:#000">main</span><span style="color:#000;font-weight:bold">()</span> <span style="color:#000;font-weight:bold">{</span>
</span></span><span style="display:flex;"><span>    <span style="color:#8f5902;font-style:italic">//an official log.Logger
</span></span></span><span style="display:flex;"><span><span style="color:#8f5902;font-style:italic"></span>    <span style="color:#000">l</span> <span style="color:#ce5c00;font-weight:bold">:=</span> <span style="color:#000">logs</span><span style="color:#000;font-weight:bold">.</span><span style="color:#000">GetLogger</span><span style="color:#000;font-weight:bold">()</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000">l</span><span style="color:#000;font-weight:bold">.</span><span style="color:#000">Println</span><span style="color:#000;font-weight:bold">(</span><span style="color:#4e9a06">&#34;this is a message of http&#34;</span><span style="color:#000;font-weight:bold">)</span>
</span></span><span style="display:flex;"><span>    <span style="color:#8f5902;font-style:italic">//an official log.Logger with prefix ORM
</span></span></span><span style="display:flex;"><span><span style="color:#8f5902;font-style:italic"></span>    <span style="color:#000">logs</span><span style="color:#000;font-weight:bold">.</span><span style="color:#000">GetLogger</span><span style="color:#000;font-weight:bold">(</span><span style="color:#4e9a06">&#34;ORM&#34;</span><span style="color:#000;font-weight:bold">).</span><span style="color:#000">Println</span><span style="color:#000;font-weight:bold">(</span><span style="color:#4e9a06">&#34;this is a message of orm&#34;</span><span style="color:#000;font-weight:bold">)</span>
</span></span><span style="display:flex;"><span> 
</span></span><span style="display:flex;"><span>    <span style="color:#000">logs</span><span style="color:#000;font-weight:bold">.</span><span style="color:#000">Debug</span><span style="color:#000;font-weight:bold">(</span><span style="color:#4e9a06">&#34;my book is bought in the year of &#34;</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#0000cf;font-weight:bold">2016</span><span style="color:#000;font-weight:bold">)</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000">logs</span><span style="color:#000;font-weight:bold">.</span><span style="color:#000">Info</span><span style="color:#000;font-weight:bold">(</span><span style="color:#4e9a06">&#34;this %s cat is %v years old&#34;</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#4e9a06">&#34;yellow&#34;</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#0000cf;font-weight:bold">3</span><span style="color:#000;font-weight:bold">)</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000">logs</span><span style="color:#000;font-weight:bold">.</span><span style="color:#000">Warn</span><span style="color:#000;font-weight:bold">(</span><span style="color:#4e9a06">&#34;json is a type of kv like&#34;</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#204a87;font-weight:bold">map</span><span style="color:#000;font-weight:bold">[</span><span style="color:#204a87;font-weight:bold">string</span><span style="color:#000;font-weight:bold">]</span><span style="color:#204a87;font-weight:bold">int</span><span style="color:#000;font-weight:bold">{</span><span style="color:#4e9a06">&#34;key&#34;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#0000cf;font-weight:bold">2016</span><span style="color:#000;font-weight:bold">})</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000">logs</span><span style="color:#000;font-weight:bold">.</span><span style="color:#000">Error</span><span style="color:#000;font-weight:bold">(</span><span style="color:#0000cf;font-weight:bold">1024</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#4e9a06">&#34;is a very&#34;</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#4e9a06">&#34;good game&#34;</span><span style="color:#000;font-weight:bold">)</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000">logs</span><span style="color:#000;font-weight:bold">.</span><span style="color:#000">Critical</span><span style="color:#000;font-weight:bold">(</span><span style="color:#4e9a06">&#34;oh,crash&#34;</span><span style="color:#000;font-weight:bold">)</span>
</span></span><span style="display:flex;"><span><span style="color:#000;font-weight:bold">}</span>
</span></span></code></pre></div><h2 id="5-2-输出文件名和行号">5.2. 输出文件名和行号</h2>
<p>日志默认不输出调用的文件名和文件行号,如果你期望输出调用的文件名和文件行号,可以如下设置</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-go" data-lang="go"><span style="display:flex;"><span><span style="color:#000">logs</span><span style="color:#000;font-weight:bold">.</span><span style="color:#000">EnableFuncCallDepth</span><span style="color:#000;font-weight:bold">(</span><span style="color:#204a87;font-weight:bold">true</span><span style="color:#000;font-weight:bold">)</span>
</span></span></code></pre></div><p>开启传入参数 true,关闭传入参数 false,默认是关闭的.</p>
<p>如果你的应用自己封装了调用 log 包,那么需要设置 SetLogFuncCallDepth,默认是 2,也就是直接调用的层级,如果你封装了多层,那么需要根据自己的需求进行调整.</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-go" data-lang="go"><span style="display:flex;"><span><span style="color:#000">logs</span><span style="color:#000;font-weight:bold">.</span><span style="color:#000">SetLogFuncCallDepth</span><span style="color:#000;font-weight:bold">(</span><span style="color:#0000cf;font-weight:bold">3</span><span style="color:#000;font-weight:bold">)</span>
</span></span></code></pre></div><h2 id="5-3-异步输出日志">5.3. 异步输出日志</h2>
<p>为了提升性能, 可以设置异步输出:</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-go" data-lang="go"><span style="display:flex;"><span><span style="color:#000">logs</span><span style="color:#000;font-weight:bold">.</span><span style="color:#000">Async</span><span style="color:#000;font-weight:bold">()</span>
</span></span></code></pre></div><p>异步输出允许设置缓冲 chan 的大小</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-go" data-lang="go"><span style="display:flex;"><span><span style="color:#000">logs</span><span style="color:#000;font-weight:bold">.</span><span style="color:#000">Async</span><span style="color:#000;font-weight:bold">(</span><span style="color:#0000cf;font-weight:bold">1e3</span><span style="color:#000;font-weight:bold">)</span>
</span></span></code></pre></div><h2 id="5-4-引擎配置">5.4. 引擎配置</h2>
<ul>
<li>
<p>console</p>
<p>可以设置输出的级别，或者不设置保持默认，默认输出到 <code>os.Stdout</code>：</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-go" data-lang="go"><span style="display:flex;"><span><span style="color:#000">logs</span><span style="color:#000;font-weight:bold">.</span><span style="color:#000">SetLogger</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">logs</span><span style="color:#000;font-weight:bold">.</span><span style="color:#000">AdapterConsole</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#4e9a06">`{&#34;level&#34;:1}`</span><span style="color:#000;font-weight:bold">)</span>
</span></span></code></pre></div></li>
<li>
<p>file</p>
<p>设置的例子如下所示：</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-go" data-lang="go"><span style="display:flex;"><span><span style="color:#000">logs</span><span style="color:#000;font-weight:bold">.</span><span style="color:#000">SetLogger</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">logs</span><span style="color:#000;font-weight:bold">.</span><span style="color:#000">AdapterFile</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#4e9a06">`{&#34;filename&#34;:&#34;test.log&#34;}`</span><span style="color:#000;font-weight:bold">)</span>
</span></span></code></pre></div><p>主要的参数如下说明：</p>
<ul>
<li>filename 保存的文件名</li>
<li>maxlines 每个文件保存的最大行数，默认值 1000000</li>
<li>maxsize 每个文件保存的最大尺寸，默认值是 1 &lt;&lt; 28, //256 MB</li>
<li>daily 是否按照每天 logrotate，默认是 true</li>
<li>maxdays 文件最多保存多少天，默认保存 7 天</li>
<li>rotate 是否开启 logrotate，默认是 true</li>
<li>level 日志保存的时候的级别，默认是 Trace 级别</li>
<li>perm 日志文件权限</li>
</ul>
</li>
<li>
<p>multifile</p>
<p>设置的例子如下所示：</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-go" data-lang="go"><span style="display:flex;"><span><span style="color:#000">logs</span><span style="color:#000;font-weight:bold">.</span><span style="color:#000">SetLogger</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">logs</span><span style="color:#000;font-weight:bold">.</span><span style="color:#000">AdapterMultiFile</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#4e9a06">``</span><span style="color:#000;font-weight:bold">{</span><span style="color:#4e9a06">&#34;filename&#34;</span><span style="color:#000;font-weight:bold">:</span><span style="color:#4e9a06">&#34;test.log&#34;</span><span style="color:#000;font-weight:bold">,</span><span style="color:#4e9a06">&#34;separate&#34;</span><span style="color:#000;font-weight:bold">:[</span><span style="color:#4e9a06">&#34;emergency&#34;</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#4e9a06">&#34;alert&#34;</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#4e9a06">&#34;critical&#34;</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#4e9a06">&#34;error&#34;</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#4e9a06">&#34;warning&#34;</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#4e9a06">&#34;notice&#34;</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#4e9a06">&#34;info&#34;</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#4e9a06">&#34;debug&#34;</span><span style="color:#000;font-weight:bold">]}</span><span style="color:#4e9a06">``</span><span style="color:#000;font-weight:bold">)</span>
</span></span></code></pre></div><p>主要的参数如下说明(除 separate 外,均与file相同)：</p>
<ul>
<li>filename 保存的文件名</li>
<li>maxlines 每个文件保存的最大行数，默认值 1000000</li>
<li>maxsize 每个文件保存的最大尺寸，默认值是 1 &lt;&lt; 28, //256 MB</li>
<li>daily 是否按照每天 logrotate，默认是 true</li>
<li>maxdays 文件最多保存多少天，默认保存 7 天</li>
<li>rotate 是否开启 logrotate，默认是 true</li>
<li>level 日志保存的时候的级别，默认是 Trace 级别</li>
<li>perm 日志文件权限</li>
<li>separate 需要单独写入文件的日志级别,设置后命名类似 test.error.log</li>
</ul>
</li>
<li>
<p>conn</p>
<p>网络输出，设置的例子如下所示：</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-go" data-lang="go"><span style="display:flex;"><span><span style="color:#000">logs</span><span style="color:#000;font-weight:bold">.</span><span style="color:#000">SetLogger</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">logs</span><span style="color:#000;font-weight:bold">.</span><span style="color:#000">AdapterConn</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#4e9a06">`{&#34;net&#34;:&#34;tcp&#34;,&#34;addr&#34;:&#34;:7020&#34;}`</span><span style="color:#000;font-weight:bold">)</span>
</span></span></code></pre></div><p>主要的参数说明如下：</p>
<ul>
<li>reconnectOnMsg 是否每次链接都重新打开链接，默认是 false</li>
<li>reconnect 是否自动重新链接地址，默认是 false</li>
<li>net 发开网络链接的方式，可以使用 tcp、unix、udp 等</li>
<li>addr 网络链接的地址</li>
<li>level 日志保存的时候的级别，默认是 Trace 级别</li>
</ul>
</li>
<li>
<p>smtp</p>
<p>邮件发送，设置的例子如下所示：</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-go" data-lang="go"><span style="display:flex;"><span><span style="color:#000">logs</span><span style="color:#000;font-weight:bold">.</span><span style="color:#000">SetLogger</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">logs</span><span style="color:#000;font-weight:bold">.</span><span style="color:#000">AdapterMail</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#4e9a06">`{&#34;username&#34;:&#34;beegotest@gmail.com&#34;,&#34;password&#34;:&#34;xxxxxxxx&#34;,&#34;host&#34;:&#34;smtp.gmail.com:587&#34;,&#34;sendTos&#34;:[&#34;xiemengjun@gmail.com&#34;]}`</span><span style="color:#000;font-weight:bold">)</span>
</span></span></code></pre></div><p>主要的参数说明如下：</p>
<ul>
<li>username smtp 验证的用户名</li>
<li>password smtp 验证密码</li>
<li>host 发送的邮箱地址</li>
<li>sendTos 邮件需要发送的人，支持多个</li>
<li>subject 发送邮件的标题，默认是 <code>Diagnostic message from server</code></li>
<li>level 日志发送的级别，默认是 Trace 级别</li>
</ul>
</li>
<li>
<p>ElasticSearch</p>
<p>输出到 ElasticSearch:</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-go" data-lang="go"><span style="display:flex;"><span><span style="color:#000">logs</span><span style="color:#000;font-weight:bold">.</span><span style="color:#000">SetLogger</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">logs</span><span style="color:#000;font-weight:bold">.</span><span style="color:#000">AdapterEs</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#4e9a06">`{&#34;dsn&#34;:&#34;http://localhost:9200/&#34;,&#34;level&#34;:1}`</span>
</span></span></code></pre></div></li>
</ul>
<p>参考文章：</p>
<ul>
<li><a href="https://beego.me/docs/mvc/controller/logs.md">https://beego.me/docs/mvc/controller/logs.md</a></li>
<li><a href="https://beego.me/docs/module/logs.md">https://beego.me/docs/module/logs.md</a></li>
</ul>

</div>



    
	
  



          </main>
        </div>
      </div>
      
<footer class="bg-dark py-5 row d-print-none">
  <div class="container-fluid mx-sm-5">
    <div class="row">
      <div class="col-6 col-sm-4 text-xs-center order-sm-2">
        
        
        
<ul class="list-inline mb-0">
  
  <li class="list-inline-item mx-2 h3" data-toggle="tooltip" data-placement="top" title="User mailing list" aria-label="User mailing list">
    <a class="text-white" target="_blank" rel="noopener" href="https://example.org/mail" aria-label="User mailing list">
      <i class="fa fa-envelope"></i>
    </a>
  </li>
  
  <li class="list-inline-item mx-2 h3" data-toggle="tooltip" data-placement="top" title="Twitter" aria-label="Twitter">
    <a class="text-white" target="_blank" rel="noopener" href="https://example.org/twitter" aria-label="Twitter">
      <i class="fab fa-twitter"></i>
    </a>
  </li>
  
  <li class="list-inline-item mx-2 h3" data-toggle="tooltip" data-placement="top" title="Stack Overflow" aria-label="Stack Overflow">
    <a class="text-white" target="_blank" rel="noopener" href="https://example.org/stack" aria-label="Stack Overflow">
      <i class="fab fa-stack-overflow"></i>
    </a>
  </li>
  
</ul>

        
        
      </div>
      <div class="col-6 col-sm-4 text-right text-xs-center order-sm-3">
        
        
        
<ul class="list-inline mb-0">
  
  <li class="list-inline-item mx-2 h3" data-toggle="tooltip" data-placement="top" title="GitHub" aria-label="GitHub">
    <a class="text-white" target="_blank" rel="noopener" href="https://github.com/huweihuang/blog.huweihuang.com" aria-label="GitHub">
      <i class="fab fa-github"></i>
    </a>
  </li>
  
  <li class="list-inline-item mx-2 h3" data-toggle="tooltip" data-placement="top" title="Slack" aria-label="Slack">
    <a class="text-white" target="_blank" rel="noopener" href="https://example.org/slack" aria-label="Slack">
      <i class="fab fa-slack"></i>
    </a>
  </li>
  
  <li class="list-inline-item mx-2 h3" data-toggle="tooltip" data-placement="top" title="Developer mailing list" aria-label="Developer mailing list">
    <a class="text-white" target="_blank" rel="noopener" href="https://example.org/mail" aria-label="Developer mailing list">
      <i class="fa fa-envelope"></i>
    </a>
  </li>
  
</ul>

        
        
      </div>
      <div class="col-12 col-sm-4 text-center py-2 order-sm-2">
        <small class="text-white">&copy; 2023 www.huweihuang.com 保留所有权利</small>
        <small class="ml-1"><a href="https://policies.google.com/privacy" target="_blank" rel="noopener">隐私政策</a></small>
	
		<p class="mt-2"><a href="/about/">About</a></p>
	
      </div>
    </div>
  </div>
</footer>


    </div>
    <script src="https://cdn.jsdelivr.net/npm/popper.js@1.16.1/dist/umd/popper.min.js"
    integrity="sha384-9/reFTGAW83EW2RDu2S0VKaIzap3H66lZH81PoYlFhbGU+6BZp6G7niu735Sk7lN"
    crossorigin="anonymous"></script>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@4.6.1/dist/js/bootstrap.min.js"
    integrity="sha512-UR25UO94eTnCVwjbXozyeVd6ZqpaAE9naiEUBK/A+QDbfSTQFhPGj5lOR6d8tsgbBk84Ggb5A3EkjsOgPRPcKA=="
    crossorigin="anonymous"></script>





<script src='/js/tabpane-persist.js'></script>




















<script src="/js/main.min.91798a335c881f1b6b805085ba4aa22d1dbd2b0b18d105d05189fa104ddae350.js" integrity="sha256-kXmKM1yIHxtrgFCFukqiLR29KwsY0QXQUYn6EE3a41A=" crossorigin="anonymous"></script>



<script src='/js/prism.js'></script>



  </body>
</html>

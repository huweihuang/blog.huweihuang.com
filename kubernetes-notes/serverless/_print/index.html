<!doctype html>
<html lang="zh-cn" class="no-js">
  <head>
    <meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="generator" content="Hugo 0.101.0" />
<link rel="canonical" type="text/html" href="https://blog.huweihuang.com/kubernetes-notes/serverless/">
<link rel="alternate" type="application/rss&#43;xml" href="https://blog.huweihuang.com/kubernetes-notes/serverless/index.xml">
<meta name="robots" content="noindex, nofollow">


<link rel="shortcut icon" href="/favicons/favicon.ico" >
<link rel="apple-touch-icon" href="/favicons/apple-touch-icon-180x180.png" sizes="180x180">
<link rel="icon" type="image/png" href="/favicons/favicon-16x16.png" sizes="16x16">
<link rel="icon" type="image/png" href="/favicons/favicon-32x32.png" sizes="32x32">
<link rel="icon" type="image/png" href="/favicons/android-36x36.png" sizes="36x36">
<link rel="icon" type="image/png" href="/favicons/android-48x48.png" sizes="48x48">
<link rel="icon" type="image/png" href="/favicons/android-72x72.png" sizes="72x72">
<link rel="icon" type="image/png" href="/favicons/android-96x96.png" sizes="96x96">
<link rel="icon" type="image/png" href="/favicons/android-144x144.png" sizes="144x144">
<link rel="icon" type="image/png" href="/favicons/android-192x192.png" sizes="192x192">

<title>Serverless | 胡伟煌</title>
<meta name="description" content="">
<meta property="og:title" content="Serverless" />
<meta property="og:description" content="Kubernetes学习笔记" />
<meta property="og:type" content="website" />
<meta property="og:url" content="https://blog.huweihuang.com/kubernetes-notes/serverless/" /><meta property="og:site_name" content="胡伟煌" />

<meta itemprop="name" content="Serverless">
<meta itemprop="description" content="Kubernetes学习笔记"><meta name="twitter:card" content="summary"/>
<meta name="twitter:title" content="Serverless"/>
<meta name="twitter:description" content="Kubernetes学习笔记"/>




<link rel="preload" href="/scss/main.min.79e3930541ca05b5395c14b2a313b798fad1dc69f9a14aefa57b62eaa9f65f14.css" as="style">
<link href="/scss/main.min.79e3930541ca05b5395c14b2a313b798fad1dc69f9a14aefa57b62eaa9f65f14.css" rel="stylesheet" integrity="">

<script
  src="https://code.jquery.com/jquery-3.6.0.min.js"
  integrity="sha384-vtXRMe3mGCbOeY7l30aIg8H9p3GdeSe4IFlP6G8JMa7o7lXvnz3GFKzPxzJdPfGK"
  crossorigin="anonymous"></script>
<script
  src="https://unpkg.com/lunr@2.3.9/lunr.min.js"
  integrity="sha384-203J0SNzyqHby3iU6hzvzltrWi/M41wOP5Gu+BiJMz5nwKykbkUx8Kp7iti0Lpli"
  crossorigin="anonymous"></script>
<link rel="stylesheet" href="/css/prism.css"/>

<script type="application/javascript">
var doNotTrack = false;
if (!doNotTrack) {
	window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)};ga.l=+new Date;
	ga('create', 'UA-114718458-1', 'auto');
	
	ga('send', 'pageview');
}
</script>
<script async src='https://www.google-analytics.com/analytics.js'></script>

  </head>
  <body class="td-section">
    <header>
      
<nav class="js-navbar-scroll navbar navbar-expand navbar-dark flex-column flex-md-row td-navbar">
        <a class="navbar-brand" href="/">
		<span class="navbar-logo"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 32 32" width="64" height="64"><path d="M15.9.476a2.14 2.14.0 00-.823.218L3.932 6.01c-.582.277-1.005.804-1.15 1.432L.054 19.373c-.13.56-.025 1.147.3 1.627q.057.087.12.168l7.7 9.574c.407.5 1.018.787 1.662.784h12.35c.646.001 1.258-.3 1.664-.793l7.696-9.576c.404-.5.555-1.16.4-1.786L29.2 7.43c-.145-.628-.57-1.155-1.15-1.432L16.923.695A2.14 2.14.0 0015.89.476z" fill="#326ce5"/><path d="M16.002 4.542c-.384.027-.675.356-.655.74v.188c.018.213.05.424.092.633a6.22 6.22.0 01.066 1.21c-.038.133-.114.253-.218.345l-.015.282c-.405.034-.807.096-1.203.186-1.666.376-3.183 1.24-4.354 2.485l-.24-.17c-.132.04-.274.025-.395-.04a6.22 6.22.0 01-.897-.81 5.55 5.55.0 00-.437-.465l-.148-.118c-.132-.106-.294-.167-.463-.175a.64.64.0 00-.531.236c-.226.317-.152.756.164.983l.138.11a5.55 5.55.0 00.552.323c.354.197.688.428.998.7a.74.74.0 01.133.384l.218.2c-1.177 1.766-1.66 3.905-1.358 6.006l-.28.08c-.073.116-.17.215-.286.288a6.22 6.22.0 01-1.194.197 5.57 5.57.0 00-.64.05l-.177.04h-.02a.67.67.0 00-.387 1.132.67.67.0 00.684.165h.013l.18-.02c.203-.06.403-.134.598-.218.375-.15.764-.265 1.162-.34.138.008.27.055.382.135l.3-.05c.65 2.017 2.016 3.726 3.84 4.803l-.122.255c.056.117.077.247.06.376-.165.382-.367.748-.603 1.092a5.58 5.58.0 00-.358.533l-.085.18a.67.67.0 00.65 1.001.67.67.0 00.553-.432l.083-.17c.076-.2.14-.404.192-.61.177-.437.273-.906.515-1.196a.54.54.0 01.286-.14l.15-.273a8.62 8.62.0 006.146.015l.133.255c.136.02.258.095.34.205.188.358.34.733.456 1.12a5.57 5.57.0 00.194.611l.083.17a.67.67.0 001.187.131.67.67.0 00.016-.701l-.087-.18a5.55 5.55.0 00-.358-.531c-.23-.332-.428-.686-.6-1.057a.52.52.0 01.068-.4 2.29 2.29.0 01-.111-.269c1.82-1.085 3.18-2.8 3.823-4.82l.284.05c.102-.093.236-.142.373-.138.397.076.786.2 1.162.34.195.09.395.166.598.23.048.013.118.024.172.037h.013a.67.67.0 00.841-.851.67.67.0 00-.544-.446l-.194-.046a5.57 5.57.0 00-.64-.05c-.404-.026-.804-.092-1.194-.197-.12-.067-.22-.167-.288-.288l-.27-.08a8.65 8.65.0 00-1.386-5.993l.236-.218c-.01-.137.035-.273.124-.378.307-.264.64-.497.99-.696a5.57 5.57.0 00.552-.323l.146-.118a.67.67.0 00-.133-1.202.67.67.0 00-.696.161l-.148.118a5.57 5.57.0 00-.437.465c-.264.302-.556.577-.873.823a.74.74.0 01-.404.044l-.253.18c-1.46-1.53-3.427-2.48-5.535-2.67.0-.1-.013-.25-.015-.297-.113-.078-.192-.197-.218-.332a6.23 6.23.0 01.076-1.207c.043-.21.073-.42.092-.633v-.2c.02-.384-.27-.713-.655-.74zm-.834 5.166-.2 3.493h-.015c-.01.216-.137.4-.332.504s-.426.073-.6-.054l-2.865-2.03a6.86 6.86.0 013.303-1.799c.234-.05.47-.088.707-.114zm1.668.0c1.505.187 2.906.863 3.99 1.924l-2.838 2.017c-.175.14-.415.168-.618.072s-.333-.3-.336-.524zm-6.72 3.227 2.62 2.338v.015c.163.142.234.363.186.574s-.21.378-.417.435v.01l-3.362.967a6.86 6.86.0 01.974-4.34zm11.753.0c.796 1.295 1.148 2.814 1.002 4.327l-3.367-.97v-.013c-.21-.057-.37-.224-.417-.435s.023-.43.186-.574l2.6-2.327zm-6.404 2.52h1.072l.655.832-.238 1.04-.963.463-.965-.463-.227-1.04zm3.434 2.838c.045-.005.1-.005.135.0l3.467.585c-.5 1.44-1.487 2.67-2.775 3.493l-1.34-3.244a.59.59.0 01.509-.819zm-5.823.015c.196.003.377.104.484.268s.124.37.047.55v.013l-1.332 3.218C11 21.54 10.032 20.325 9.517 18.9l3.437-.583c.038-.004.077-.004.116.0zm2.904 1.4a.59.59.0 01.537.308h.013l1.694 3.057-.677.2c-1.246.285-2.547.218-3.758-.194l1.7-3.057c.103-.18.293-.29.5-.295z" fill="#fff" stroke="#fff" stroke-width=".055"/></svg></span><span class="font-weight-bold">胡伟煌</span>
	</a>
	<div class="td-navbar-nav-scroll ml-md-auto" id="main_navbar">
		<ul class="navbar-nav mt-2 mt-lg-0">
			
			
			<li class="nav-item mr-4 mb-2 mb-lg-0">
				
				
				
				
				
				
				
				
				<a class="nav-link active" href="/kubernetes-notes/" ><span class="active">Kubernetes学习笔记</span></a>
			</li>
			
			<li class="nav-item mr-4 mb-2 mb-lg-0">
				
				
				
				
				
				
				
				
				<a class="nav-link" href="/k8s-source-code-analysis/" ><span>Kubernetes源码分析</span></a>
			</li>
			
			<li class="nav-item mr-4 mb-2 mb-lg-0">
				
				
				
				
				
				
				
				
				<a class="nav-link" href="/golang-notes/" ><span>Golang学习笔记</span></a>
			</li>
			
			<li class="nav-item mr-4 mb-2 mb-lg-0">
				
				
				
				
				
				
				
				
				<a class="nav-link" href="/linux-notes/" ><span>Linux学习笔记</span></a>
			</li>
			
			<li class="nav-item mr-4 mb-2 mb-lg-0">
				
				
				
				
				
				
				
				
				<a class="nav-link" href="/about/" ><span>About</span></a>
			</li>
			
			
			
		</ul>
	</div>
	<div class="navbar-nav d-none d-lg-block"><input
  type="search"
  class="form-control td-search-input"
  placeholder="&#xf002; 站内搜索…"
  aria-label="站内搜索…"
  autocomplete="off"
  
  data-offline-search-index-json-src="/offline-search-index.52a94a2394c2f2f38099b11db5f6cd81.json"
  data-offline-search-base-href="/"
  data-offline-search-max-results="10"
>
</div>
</nav>

    </header>
    <div class="container-fluid td-outer">
      <div class="td-main">
        <div class="row flex-xl-nowrap">
          <main class="col-12 col-md-9 col-xl-8 pl-md-5" role="main">
            




<div class="td-content">
<div class="pageinfo pageinfo-primary d-print-none">
<p>
这是本节的多页打印视图。
<a href="#" onclick="print();return false;">点击此处打印</a>.
</p><p>
<a href="/kubernetes-notes/serverless/">返回本页常规视图</a>.
</p>
</div>



<h1 class="title">Serverless</h1>





    <ul>
    
  
  
  
  

  
    
    
	
<li>1: <a href="#pg-7f7f9808ac123b136633ea222724adab">IaC</a></li>


    
    <ul>
        
  
  
  
  

  
    
    
	
<li>1.1: <a href="#pg-46685ef45663498ab635a9ab162c785a">Terraform的使用</a></li>


    
  

    </ul>
    
  
    
    
	
<li>2: <a href="#pg-e44de3d390def178636536ce707a8319">knative介绍</a></li>


    
  

    </ul>


<div class="content">
      
</div>
</div>


  
  
  
  

  
  

  
    
    
	
    

<div class="td-content" style="">
    
	<h1 id="pg-7f7f9808ac123b136633ea222724adab">1 - IaC</h1>
    
	
</div>



    
      
  
  
  
  

  
  

  
    
    
	
    

<div class="td-content" style="">
    
	<h1 id="pg-46685ef45663498ab635a9ab162c785a">1.1 - Terraform的使用</h1>
    
	<h1 id="1-安装terraform">1. 安装terraform</h1>
<p>mac</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>brew tap hashicorp/tap
</span></span><span style="display:flex;"><span>brew install hashicorp/tap/terraform
</span></span></code></pre></div><p>linux: centos</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>sudo yum install -y yum-utils
</span></span><span style="display:flex;"><span>sudo yum-config-manager --add-repo https://rpm.releases.hashicorp.com/RHEL/hashicorp.repo
</span></span><span style="display:flex;"><span>sudo yum -y install terraform
</span></span></code></pre></div><h1 id="2-terraform命令">2. terraform命令</h1>
<p>编写terraform的部署文本，常用命令：</p>
<ol>
<li>
<p>terraform init：项目初始化</p>
</li>
<li>
<p>terraform plan：预览</p>
</li>
<li>
<p>terraform apply：部署</p>
</li>
<li>
<p>terraform destroy：销毁</p>
</li>
</ol>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>terraform --help
</span></span><span style="display:flex;"><span>Usage: terraform <span style="color:#ce5c00;font-weight:bold">[</span>global options<span style="color:#ce5c00;font-weight:bold">]</span> &lt;subcommand&gt; <span style="color:#ce5c00;font-weight:bold">[</span>args<span style="color:#ce5c00;font-weight:bold">]</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>The available commands <span style="color:#204a87;font-weight:bold">for</span> execution are listed below.
</span></span><span style="display:flex;"><span>The primary workflow commands are given first, followed by
</span></span><span style="display:flex;"><span>less common or more advanced commands.
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>Main commands:
</span></span><span style="display:flex;"><span>  init          Prepare your working directory <span style="color:#204a87;font-weight:bold">for</span> other commands
</span></span><span style="display:flex;"><span>  validate      Check whether the configuration is valid
</span></span><span style="display:flex;"><span>  plan          Show changes required by the current configuration
</span></span><span style="display:flex;"><span>  apply         Create or update infrastructure
</span></span><span style="display:flex;"><span>  destroy       Destroy previously-created infrastructure
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>All other commands:
</span></span><span style="display:flex;"><span>  console       Try Terraform expressions at an interactive <span style="color:#204a87">command</span> prompt
</span></span><span style="display:flex;"><span>  fmt           Reformat your configuration in the standard style
</span></span><span style="display:flex;"><span>  force-unlock  Release a stuck lock on the current workspace
</span></span><span style="display:flex;"><span>  get           Install or upgrade remote Terraform modules
</span></span><span style="display:flex;"><span>  graph         Generate a Graphviz graph of the steps in an operation
</span></span><span style="display:flex;"><span>  import        Associate existing infrastructure with a Terraform resource
</span></span><span style="display:flex;"><span>  login         Obtain and save credentials <span style="color:#204a87;font-weight:bold">for</span> a remote host
</span></span><span style="display:flex;"><span>  <span style="color:#204a87">logout</span>        Remove locally-stored credentials <span style="color:#204a87;font-weight:bold">for</span> a remote host
</span></span><span style="display:flex;"><span>  metadata      Metadata related commands
</span></span><span style="display:flex;"><span>  modules       Show all declared modules in a working directory
</span></span><span style="display:flex;"><span>  output        Show output values from your root module
</span></span><span style="display:flex;"><span>  providers     Show the providers required <span style="color:#204a87;font-weight:bold">for</span> this configuration
</span></span><span style="display:flex;"><span>  refresh       Update the state to match remote systems
</span></span><span style="display:flex;"><span>  show          Show the current state or a saved plan
</span></span><span style="display:flex;"><span>  stacks        Manage HCP Terraform stack operations
</span></span><span style="display:flex;"><span>  state         Advanced state management
</span></span><span style="display:flex;"><span>  taint         Mark a resource instance as not fully functional
</span></span><span style="display:flex;"><span>  <span style="color:#204a87">test</span>          Execute integration tests <span style="color:#204a87;font-weight:bold">for</span> Terraform modules
</span></span><span style="display:flex;"><span>  untaint       Remove the <span style="color:#4e9a06">&#39;tainted&#39;</span> state from a resource instance
</span></span><span style="display:flex;"><span>  version       Show the current Terraform version
</span></span><span style="display:flex;"><span>  workspace     Workspace management
</span></span></code></pre></div><h1 id="3-通过terraform部署k8s应用">3. 通过terraform部署k8s应用</h1>
<h2 id="3-1-创建部署文件">3.1. 创建部署文件</h2>
<p>创建应用目录，并在本地创建<code>main.tf</code>文件。</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>terraform <span style="color:#ce5c00;font-weight:bold">{</span>
</span></span><span style="display:flex;"><span>  required_providers <span style="color:#ce5c00;font-weight:bold">{</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000">kubernetes</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#ce5c00;font-weight:bold">{</span>
</span></span><span style="display:flex;"><span>      <span style="color:#204a87">source</span>  <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#4e9a06">&#34;hashicorp/kubernetes&#34;</span>
</span></span><span style="display:flex;"><span>      <span style="color:#000">version</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#4e9a06">&#34;&gt;= 2.0.0&#34;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#ce5c00;font-weight:bold">}</span>
</span></span><span style="display:flex;"><span>  <span style="color:#ce5c00;font-weight:bold">}</span>
</span></span><span style="display:flex;"><span><span style="color:#ce5c00;font-weight:bold">}</span>
</span></span><span style="display:flex;"><span>provider <span style="color:#4e9a06">&#34;kubernetes&#34;</span> <span style="color:#ce5c00;font-weight:bold">{</span>
</span></span><span style="display:flex;"><span>  <span style="color:#000">config_path</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#4e9a06">&#34;~/.kube/config&#34;</span>
</span></span><span style="display:flex;"><span><span style="color:#ce5c00;font-weight:bold">}</span>
</span></span><span style="display:flex;"><span>resource <span style="color:#4e9a06">&#34;kubernetes_namespace&#34;</span> <span style="color:#4e9a06">&#34;test&#34;</span> <span style="color:#ce5c00;font-weight:bold">{</span>
</span></span><span style="display:flex;"><span>  metadata <span style="color:#ce5c00;font-weight:bold">{</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000">name</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#4e9a06">&#34;nginx&#34;</span>
</span></span><span style="display:flex;"><span>  <span style="color:#ce5c00;font-weight:bold">}</span>
</span></span><span style="display:flex;"><span><span style="color:#ce5c00;font-weight:bold">}</span>
</span></span><span style="display:flex;"><span>resource <span style="color:#4e9a06">&#34;kubernetes_deployment&#34;</span> <span style="color:#4e9a06">&#34;test&#34;</span> <span style="color:#ce5c00;font-weight:bold">{</span>
</span></span><span style="display:flex;"><span>  metadata <span style="color:#ce5c00;font-weight:bold">{</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000">name</span>      <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#4e9a06">&#34;nginx&#34;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000">namespace</span> <span style="color:#ce5c00;font-weight:bold">=</span> kubernetes_namespace.test.metadata.0.name
</span></span><span style="display:flex;"><span>  <span style="color:#ce5c00;font-weight:bold">}</span>
</span></span><span style="display:flex;"><span>  spec <span style="color:#ce5c00;font-weight:bold">{</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000">replicas</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#0000cf;font-weight:bold">2</span>
</span></span><span style="display:flex;"><span>    selector <span style="color:#ce5c00;font-weight:bold">{</span>
</span></span><span style="display:flex;"><span>      <span style="color:#000">match_labels</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#ce5c00;font-weight:bold">{</span>
</span></span><span style="display:flex;"><span>        <span style="color:#000">app</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#4e9a06">&#34;MyTestApp&#34;</span>
</span></span><span style="display:flex;"><span>      <span style="color:#ce5c00;font-weight:bold">}</span>
</span></span><span style="display:flex;"><span>    <span style="color:#ce5c00;font-weight:bold">}</span>
</span></span><span style="display:flex;"><span>    template <span style="color:#ce5c00;font-weight:bold">{</span>
</span></span><span style="display:flex;"><span>      metadata <span style="color:#ce5c00;font-weight:bold">{</span>
</span></span><span style="display:flex;"><span>        <span style="color:#000">labels</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#ce5c00;font-weight:bold">{</span>
</span></span><span style="display:flex;"><span>          <span style="color:#000">app</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#4e9a06">&#34;MyTestApp&#34;</span>
</span></span><span style="display:flex;"><span>        <span style="color:#ce5c00;font-weight:bold">}</span>
</span></span><span style="display:flex;"><span>      <span style="color:#ce5c00;font-weight:bold">}</span>
</span></span><span style="display:flex;"><span>      spec <span style="color:#ce5c00;font-weight:bold">{</span>
</span></span><span style="display:flex;"><span>        container <span style="color:#ce5c00;font-weight:bold">{</span>
</span></span><span style="display:flex;"><span>          <span style="color:#000">image</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#4e9a06">&#34;nginx&#34;</span>
</span></span><span style="display:flex;"><span>          <span style="color:#000">name</span>  <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#4e9a06">&#34;nginx-container&#34;</span>
</span></span><span style="display:flex;"><span>          port <span style="color:#ce5c00;font-weight:bold">{</span>
</span></span><span style="display:flex;"><span>            <span style="color:#000">container_port</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#0000cf;font-weight:bold">80</span>
</span></span><span style="display:flex;"><span>          <span style="color:#ce5c00;font-weight:bold">}</span>
</span></span><span style="display:flex;"><span>        <span style="color:#ce5c00;font-weight:bold">}</span>
</span></span><span style="display:flex;"><span>      <span style="color:#ce5c00;font-weight:bold">}</span>
</span></span><span style="display:flex;"><span>    <span style="color:#ce5c00;font-weight:bold">}</span>
</span></span><span style="display:flex;"><span>  <span style="color:#ce5c00;font-weight:bold">}</span>
</span></span><span style="display:flex;"><span><span style="color:#ce5c00;font-weight:bold">}</span>
</span></span><span style="display:flex;"><span>resource <span style="color:#4e9a06">&#34;kubernetes_service&#34;</span> <span style="color:#4e9a06">&#34;test&#34;</span> <span style="color:#ce5c00;font-weight:bold">{</span>
</span></span><span style="display:flex;"><span>  metadata <span style="color:#ce5c00;font-weight:bold">{</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000">name</span>      <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#4e9a06">&#34;nginx&#34;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000">namespace</span> <span style="color:#ce5c00;font-weight:bold">=</span> kubernetes_namespace.test.metadata.0.name
</span></span><span style="display:flex;"><span>  <span style="color:#ce5c00;font-weight:bold">}</span>
</span></span><span style="display:flex;"><span>  spec <span style="color:#ce5c00;font-weight:bold">{</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000">selector</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#ce5c00;font-weight:bold">{</span>
</span></span><span style="display:flex;"><span>      <span style="color:#000">app</span> <span style="color:#ce5c00;font-weight:bold">=</span> kubernetes_deployment.test.spec.0.template.0.metadata.0.labels.app
</span></span><span style="display:flex;"><span>    <span style="color:#ce5c00;font-weight:bold">}</span>
</span></span><span style="display:flex;"><span>    <span style="color:#204a87">type</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#4e9a06">&#34;NodePort&#34;</span>
</span></span><span style="display:flex;"><span>    port <span style="color:#ce5c00;font-weight:bold">{</span>
</span></span><span style="display:flex;"><span>      <span style="color:#000">node_port</span>   <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#0000cf;font-weight:bold">30201</span>
</span></span><span style="display:flex;"><span>      <span style="color:#000">port</span>        <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#0000cf;font-weight:bold">80</span>
</span></span><span style="display:flex;"><span>      <span style="color:#000">target_port</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#0000cf;font-weight:bold">80</span>
</span></span><span style="display:flex;"><span>    <span style="color:#ce5c00;font-weight:bold">}</span>
</span></span><span style="display:flex;"><span>  <span style="color:#ce5c00;font-weight:bold">}</span>
</span></span><span style="display:flex;"><span><span style="color:#ce5c00;font-weight:bold">}</span>
</span></span></code></pre></div><h2 id="3-2-执行部署命令">3.2. 执行部署命令</h2>
<ul>
<li><strong>terraform init</strong></li>
</ul>
<p>初始化terraform provider数据。会在本地的<code>.terraform</code>目录下生成provider相关的二进制文件。</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>.terraform
</span></span><span style="display:flex;"><span>└── providers
</span></span><span style="display:flex;"><span>    └── registry.terraform.io
</span></span><span style="display:flex;"><span>        └── hashicorp
</span></span><span style="display:flex;"><span>            └── kubernetes
</span></span><span style="display:flex;"><span>                └── 2.38.0
</span></span><span style="display:flex;"><span>                    └── linux_amd64
</span></span><span style="display:flex;"><span>                        ├── LICENSE.txt
</span></span><span style="display:flex;"><span>                        └── terraform-provider-kubernetes_v2.38.0_x5
</span></span></code></pre></div><ul>
<li><strong>terraform plan</strong></li>
</ul>
<p>部署之前预览<code>diff</code>数据。</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span><span style="color:#8f5902;font-style:italic"># terraform plan</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>Terraform used the selected providers to generate the following execution plan. Resource actions are indicated with the following symbols:
</span></span><span style="display:flex;"><span>  + create
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>Terraform will perform the following actions:
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  <span style="color:#8f5902;font-style:italic"># kubernetes_deployment.test will be created</span>
</span></span><span style="display:flex;"><span>  + resource <span style="color:#4e9a06">&#34;kubernetes_deployment&#34;</span> <span style="color:#4e9a06">&#34;test&#34;</span> <span style="color:#ce5c00;font-weight:bold">{</span>
</span></span><span style="display:flex;"><span>      + <span style="color:#000">id</span>               <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#ce5c00;font-weight:bold">(</span>known after apply<span style="color:#ce5c00;font-weight:bold">)</span>
</span></span><span style="display:flex;"><span>      + <span style="color:#000">wait_for_rollout</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#204a87">true</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>      + metadata <span style="color:#ce5c00;font-weight:bold">{</span>
</span></span><span style="display:flex;"><span>          + <span style="color:#000">generation</span>       <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#ce5c00;font-weight:bold">(</span>known after apply<span style="color:#ce5c00;font-weight:bold">)</span>
</span></span><span style="display:flex;"><span>          + <span style="color:#000">name</span>             <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#4e9a06">&#34;nginx&#34;</span>
</span></span><span style="display:flex;"><span>          + <span style="color:#000">namespace</span>        <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#4e9a06">&#34;nginx&#34;</span>
</span></span><span style="display:flex;"><span>          + <span style="color:#000">resource_version</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#ce5c00;font-weight:bold">(</span>known after apply<span style="color:#ce5c00;font-weight:bold">)</span>
</span></span><span style="display:flex;"><span>          + <span style="color:#000">uid</span>              <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#ce5c00;font-weight:bold">(</span>known after apply<span style="color:#ce5c00;font-weight:bold">)</span>
</span></span><span style="display:flex;"><span>        <span style="color:#ce5c00;font-weight:bold">}</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>      + spec <span style="color:#ce5c00;font-weight:bold">{</span>
</span></span><span style="display:flex;"><span>          + <span style="color:#000">min_ready_seconds</span>         <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#0000cf;font-weight:bold">0</span>
</span></span><span style="display:flex;"><span>          + <span style="color:#000">paused</span>                    <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#204a87">false</span>
</span></span><span style="display:flex;"><span>          + <span style="color:#000">progress_deadline_seconds</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#0000cf;font-weight:bold">600</span>
</span></span><span style="display:flex;"><span>          + <span style="color:#000">replicas</span>                  <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#4e9a06">&#34;2&#34;</span>
</span></span><span style="display:flex;"><span>          + <span style="color:#000">revision_history_limit</span>    <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#0000cf;font-weight:bold">10</span>
</span></span><span style="display:flex;"><span>....
</span></span><span style="display:flex;"><span>Plan: <span style="color:#0000cf;font-weight:bold">3</span> to add, <span style="color:#0000cf;font-weight:bold">0</span> to change, <span style="color:#0000cf;font-weight:bold">0</span> to destroy.
</span></span><span style="display:flex;"><span>──────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────
</span></span><span style="display:flex;"><span>Note: You didn<span style="color:#4e9a06">&#39;t use the -out option to save this plan, so Terraform can&#39;</span>t guarantee to take exactly these actions <span style="color:#204a87;font-weight:bold">if</span> you run <span style="color:#4e9a06">&#34;terraform apply&#34;</span> now.
</span></span></code></pre></div><ul>
<li><strong>terraform apply</strong></li>
</ul>
<p>执行部署的操作。</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span><span style="color:#8f5902;font-style:italic"># terraform apply</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>Terraform used the selected providers to generate the following execution plan. Resource actions are indicated with the following symbols:
</span></span><span style="display:flex;"><span>  + create
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>Terraform will perform the following actions:
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  <span style="color:#8f5902;font-style:italic"># kubernetes_deployment.test will be created</span>
</span></span><span style="display:flex;"><span>  + resource <span style="color:#4e9a06">&#34;kubernetes_deployment&#34;</span> <span style="color:#4e9a06">&#34;test&#34;</span> <span style="color:#ce5c00;font-weight:bold">{</span>
</span></span><span style="display:flex;"><span>      + <span style="color:#000">id</span>               <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#ce5c00;font-weight:bold">(</span>known after apply<span style="color:#ce5c00;font-weight:bold">)</span>
</span></span><span style="display:flex;"><span>      + <span style="color:#000">wait_for_rollout</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#204a87">true</span>
</span></span><span style="display:flex;"><span>...
</span></span><span style="display:flex;"><span>Plan: <span style="color:#0000cf;font-weight:bold">3</span> to add, <span style="color:#0000cf;font-weight:bold">0</span> to change, <span style="color:#0000cf;font-weight:bold">0</span> to destroy.
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>Do you want to perform these actions?
</span></span><span style="display:flex;"><span>  Terraform will perform the actions described above.
</span></span><span style="display:flex;"><span>  Only <span style="color:#4e9a06">&#39;yes&#39;</span> will be accepted to approve.
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  Enter a value: yes
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>kubernetes_namespace.test: Creating...
</span></span><span style="display:flex;"><span>kubernetes_namespace.test: Creation <span style="color:#204a87">complete</span> after 0s <span style="color:#ce5c00;font-weight:bold">[</span><span style="color:#000">id</span><span style="color:#ce5c00;font-weight:bold">=</span>nginx<span style="color:#ce5c00;font-weight:bold">]</span>
</span></span><span style="display:flex;"><span>kubernetes_deployment.test: Creating...
</span></span><span style="display:flex;"><span>kubernetes_deployment.test: Creation <span style="color:#204a87">complete</span> after 4s <span style="color:#ce5c00;font-weight:bold">[</span><span style="color:#000">id</span><span style="color:#ce5c00;font-weight:bold">=</span>nginx/nginx<span style="color:#ce5c00;font-weight:bold">]</span>
</span></span><span style="display:flex;"><span>kubernetes_service.test: Creating...
</span></span><span style="display:flex;"><span>kubernetes_service.test: Creation <span style="color:#204a87">complete</span> after 0s <span style="color:#ce5c00;font-weight:bold">[</span><span style="color:#000">id</span><span style="color:#ce5c00;font-weight:bold">=</span>nginx/nginx<span style="color:#ce5c00;font-weight:bold">]</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>Apply complete! Resources: <span style="color:#0000cf;font-weight:bold">3</span> added, <span style="color:#0000cf;font-weight:bold">0</span> changed, <span style="color:#0000cf;font-weight:bold">0</span> destroyed.
</span></span></code></pre></div><p><strong>查看部署结果</strong></p>
<p>terraform共创建了三个资源，即对应k8s的三个对象：namespace，deployment，service。</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span><span style="color:#8f5902;font-style:italic"># kubectl get all -n nginx</span>
</span></span><span style="display:flex;"><span>NAME                        READY   STATUS    RESTARTS   AGE
</span></span><span style="display:flex;"><span>pod/nginx-658c56bc8-djhrx   1/1     Running   <span style="color:#0000cf;font-weight:bold">0</span>          30m
</span></span><span style="display:flex;"><span>pod/nginx-658c56bc8-mh67k   1/1     Running   <span style="color:#0000cf;font-weight:bold">0</span>          30m
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>NAME            TYPE       CLUSTER-IP     EXTERNAL-IP   PORT<span style="color:#ce5c00;font-weight:bold">(</span>S<span style="color:#ce5c00;font-weight:bold">)</span>        AGE
</span></span><span style="display:flex;"><span>service/nginx   NodePort   10.96.65.155   &lt;none&gt;        80:30201/TCP   30m
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>NAME                    READY   UP-TO-DATE   AVAILABLE   AGE
</span></span><span style="display:flex;"><span>deployment.apps/nginx   2/2     <span style="color:#0000cf;font-weight:bold">2</span>            <span style="color:#0000cf;font-weight:bold">2</span>           30m
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>NAME                              DESIRED   CURRENT   READY   AGE
</span></span><span style="display:flex;"><span>replicaset.apps/nginx-658c56bc8   <span style="color:#0000cf;font-weight:bold">2</span>         <span style="color:#0000cf;font-weight:bold">2</span>         <span style="color:#0000cf;font-weight:bold">2</span>       30m
</span></span></code></pre></div><p>部署后会生成terraform.tfstate本地状态记录文件。</p>
<ul>
<li>terraform destroy</li>
</ul>
<p>如果需要清理数据，则可以使用destroy命令清理。</p>
<h1 id="4-总结">4. 总结</h1>
<p>本文以k8s平台为例展示了terraform的基本使用步骤，相比于kubectl和helm的k8s部署工具，terraform无根本区别。</p>
<ul>
<li>
<p><strong>terraform的优势在于以IaC（基础设施即代码）和GitOps的思想把将基础设施相关的运维部署操作以<code>声明式</code>的方式记录在代码中，通过Git去管理期望的最终状态和版本迭代</strong>。</p>
</li>
<li>
<p>同时terraform可以对接绝大部分的基础设施，例如MySQL，Redis等，可以对接各个不同的部署平台和系统，例如阿里云，aws等，也可以针对公司内部的平台，单独写内部平台对接的provider，<strong>从而实现一套工具管理所有的基础设施</strong>。</p>
</li>
</ul>
<p>参考：</p>
<ul>
<li>
<p><a href="https://developer.hashicorp.com/terraform/install">https://developer.hashicorp.com/terraform/install</a></p>
</li>
<li>
<p><a href="https://registry.terraform.io/providers/hashicorp/kubernetes/latest/docs/guides/getting-started.html">terraform部署k8s服务</a></p>
</li>
</ul>

</div>



    
	
  

    
	
  
    
    
	
    

<div class="td-content" style="page-break-before: always">
    
	<h1 id="pg-e44de3d390def178636536ce707a8319">2 - knative介绍</h1>
    
	<h1 id="1-knative简介">1. knative简介</h1>
<p>knative是一个将serverless的能力扩展到k8s中的开源项目。serverless让开发者无需关注容器、镜像、运维等事项，集中精力于开发代码本身，即将代码通过免运维的形式交付给serverless平台。代码会在设定的条件下运行，并自动实现扩缩容。</p>
<h1 id="2-knative的组件">2. knative的组件</h1>
<p>knative主要包含三个部分：</p>
<ul>
<li>
<p><strong>build</strong>: 将代码转换为容器，主要包括</p>
<ul>
<li>将源代码从git仓库拉取下来，安装相关的依赖</li>
<li>构建容器镜像</li>
<li>将容器镜像推送到镜像仓库</li>
</ul>
</li>
<li>
<p><strong>Serving</strong>：创建一个可伸缩的部署。</p>
<ul>
<li>配置定义了服务的状态，包括版本管理，每次修改都创建一个新版本部署，并保留旧版本。</li>
<li>灵活的路由控制，可以控制百分比的路由到新版本和旧版本服务。</li>
<li>自动弹性伸缩，可以快速创建上千个实例或快速调整实例数为0。</li>
</ul>
</li>
<li>
<p><strong>Eventing</strong>：事件触发，通过定义各种事件使用knative自动来完成这些任务，而无需手动编写脚本。</p>
</li>
</ul>
<h1 id="3-部署knative">3. 部署knative</h1>
<p>部署knative主要是部署Serving和Eventing两个组件，可以单独部署也可以同时部署。</p>
<h2 id="3-1-部署serving">3.1. 部署Serving</h2>
<ol>
<li>
<p>部署CRD</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>kubectl apply -f https://github.com/knative/serving/releases/download/knative-v1.10.1/serving-crds.yaml
</span></span></code></pre></div></li>
<li>
<p>部署Serving</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>kubectl apply -f https://github.com/knative/serving/releases/download/knative-v1.10.1/serving-core.yaml
</span></span></code></pre></div></li>
<li>
<p>部署HPA autoscaling（可选）</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>kubectl apply -f https://github.com/knative/serving/releases/download/knative-v1.10.1/serving-hpa.yaml
</span></span></code></pre></div></li>
</ol>
<p>查看部署结果</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span><span style="color:#8f5902;font-style:italic"># kgdep -n knative-serving</span>
</span></span><span style="display:flex;"><span>NAME                                    READY   UP-TO-DATE   AVAILABLE   AGE
</span></span><span style="display:flex;"><span>deployment.apps/activator               1/1     <span style="color:#0000cf;font-weight:bold">1</span>            <span style="color:#0000cf;font-weight:bold">1</span>           107s
</span></span><span style="display:flex;"><span>deployment.apps/autoscaler              1/1     <span style="color:#0000cf;font-weight:bold">1</span>            <span style="color:#0000cf;font-weight:bold">1</span>           107s
</span></span><span style="display:flex;"><span>deployment.apps/autoscaler-hpa          1/1     <span style="color:#0000cf;font-weight:bold">1</span>            <span style="color:#0000cf;font-weight:bold">1</span>           107s
</span></span><span style="display:flex;"><span>deployment.apps/controller              1/1     <span style="color:#0000cf;font-weight:bold">1</span>            <span style="color:#0000cf;font-weight:bold">1</span>           107s
</span></span><span style="display:flex;"><span>deployment.apps/domain-mapping          1/1     <span style="color:#0000cf;font-weight:bold">1</span>            <span style="color:#0000cf;font-weight:bold">1</span>           107s
</span></span><span style="display:flex;"><span>deployment.apps/domainmapping-webhook   1/1     <span style="color:#0000cf;font-weight:bold">1</span>            <span style="color:#0000cf;font-weight:bold">1</span>           107s
</span></span><span style="display:flex;"><span>deployment.apps/webhook                 1/1     <span style="color:#0000cf;font-weight:bold">1</span>            <span style="color:#0000cf;font-weight:bold">1</span>           107s
</span></span></code></pre></div><h2 id="3-2-部署eventing">3.2. 部署Eventing</h2>
<ol>
<li>
<p>部署CRD</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>kubectl apply -f https://github.com/knative/eventing/releases/download/knative-v1.10.0/eventing-crds.yaml
</span></span></code></pre></div></li>
<li>
<p>部署Eventing</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>kubectl apply -f https://github.com/knative/eventing/releases/download/knative-v1.10.0/eventing-core.yaml
</span></span></code></pre></div></li>
</ol>
<p>查看部署结果</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span><span style="color:#8f5902;font-style:italic"># kgdep -n knative-eventing</span>
</span></span><span style="display:flex;"><span>NAME                    READY   UP-TO-DATE   AVAILABLE   AGE
</span></span><span style="display:flex;"><span>eventing-controller     1/1     <span style="color:#0000cf;font-weight:bold">1</span>            <span style="color:#0000cf;font-weight:bold">1</span>           2m13s
</span></span><span style="display:flex;"><span>eventing-webhook        1/1     <span style="color:#0000cf;font-weight:bold">1</span>            <span style="color:#0000cf;font-weight:bold">1</span>           2m13s
</span></span><span style="display:flex;"><span>pingsource-mt-adapter   0/0     <span style="color:#0000cf;font-weight:bold">0</span>            <span style="color:#0000cf;font-weight:bold">0</span>           2m13s
</span></span></code></pre></div><h1 id="4-部署knative客户端">4. 部署knative客户端</h1>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span> wget https://github.com/knative/client/releases/download/knative-v1.10.0/kn-linux-amd64
</span></span><span style="display:flex;"><span> chmod +x kn-linux-amd64
</span></span><span style="display:flex;"><span> mv kn-linux-amd64 /usr/bin/kn
</span></span></code></pre></div><p>kn命令：</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>kn
</span></span><span style="display:flex;"><span>kn is the <span style="color:#204a87">command</span> line interface <span style="color:#204a87;font-weight:bold">for</span> managing Knative Serving and Eventing resources
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>Find more information about Knative at: https://knative.dev
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>Serving Commands:
</span></span><span style="display:flex;"><span>  service      Manage Knative services
</span></span><span style="display:flex;"><span>  revision     Manage service revisions
</span></span><span style="display:flex;"><span>  route        List and describe service routes
</span></span><span style="display:flex;"><span>  domain       Manage domain mappings
</span></span><span style="display:flex;"><span>  container    Manage service<span style="color:#a40000">&#39;</span>s containers <span style="color:#ce5c00;font-weight:bold">(</span>experimental<span style="color:#ce5c00;font-weight:bold">)</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>Eventing Commands:
</span></span><span style="display:flex;"><span>  <span style="color:#204a87">source</span>       Manage event sources
</span></span><span style="display:flex;"><span>  broker       Manage message brokers
</span></span><span style="display:flex;"><span>  trigger      Manage event triggers
</span></span><span style="display:flex;"><span>  channel      Manage event channels
</span></span><span style="display:flex;"><span>  subscription Manage event subscriptions
</span></span><span style="display:flex;"><span>  eventtype    Manage eventtypes
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>Other Commands:
</span></span><span style="display:flex;"><span>  plugin       Manage kn plugins
</span></span><span style="display:flex;"><span>  secret       Manage secrets
</span></span><span style="display:flex;"><span>  completion   Output shell completion code
</span></span><span style="display:flex;"><span>  version      Show the version of this client
</span></span></code></pre></div><h1 id="5-创建示例服务">5. 创建示例服务</h1>
<p>以下通过yaml的方式演示。</p>
<blockquote>
<p>vi hello.yaml</p>
</blockquote>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-yaml" data-lang="yaml"><span style="display:flex;"><span><span style="color:#204a87;font-weight:bold">apiVersion</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">serving.knative.dev/v1</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline"></span><span style="color:#204a87;font-weight:bold">kind</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">Service</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline"></span><span style="color:#204a87;font-weight:bold">metadata</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">  </span><span style="color:#204a87;font-weight:bold">name</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">hello</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline"></span><span style="color:#204a87;font-weight:bold">spec</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">  </span><span style="color:#204a87;font-weight:bold">template</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">    </span><span style="color:#204a87;font-weight:bold">spec</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">      </span><span style="color:#204a87;font-weight:bold">containers</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">        </span>- <span style="color:#204a87;font-weight:bold">image</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">ghcr.io/knative/helloworld-go:latest</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">          </span><span style="color:#204a87;font-weight:bold">ports</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">            </span>- <span style="color:#204a87;font-weight:bold">containerPort</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#0000cf;font-weight:bold">8080</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">          </span><span style="color:#204a87;font-weight:bold">env</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">            </span>- <span style="color:#204a87;font-weight:bold">name</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">TARGET</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">              </span><span style="color:#204a87;font-weight:bold">value</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#4e9a06">&#34;World&#34;</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span></code></pre></div><p>创建文件</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>kubectl apply -f hello.yaml
</span></span></code></pre></div><p>查看服务</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span><span style="color:#8f5902;font-style:italic"># kubectl get ksvc</span>
</span></span><span style="display:flex;"><span>NAME    URL                                      LATESTCREATED   LATESTREADY   READY     REASON
</span></span><span style="display:flex;"><span>hello   http://hello.default.svc.cluster.local   hello-00001     hello-00001   Unknown   IngressNotConfigured
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#8f5902;font-style:italic"># kubectl get po</span>
</span></span><span style="display:flex;"><span>NAME                                     READY   STATUS    RESTARTS   AGE
</span></span><span style="display:flex;"><span>hello-00001-deployment-6469df75c-qpp5v   2/2     Running   <span style="color:#0000cf;font-weight:bold">0</span>          15m
</span></span></code></pre></div><p>参考：</p>
<ul>
<li><a href="https://www.ibm.com/topics/knative">https://www.ibm.com/topics/knative</a></li>
<li><a href="https://knative.dev/docs/concepts/">https://knative.dev/docs/concepts/</a></li>
<li><a href="https://knative.dev/docs/serving/">https://knative.dev/docs/serving/</a></li>
</ul>

</div>



    
	
  



          </main>
        </div>
      </div>
      
<footer class="bg-dark py-5 row d-print-none">
  <div class="container-fluid mx-sm-5">
    <div class="row">
      <div class="col-6 col-sm-4 text-xs-center order-sm-2">
        
        
        
      </div>
      <div class="col-6 col-sm-4 text-right text-xs-center order-sm-3">
        
        
        
<ul class="list-inline mb-0">
  
  <li class="list-inline-item mx-2 h3" data-toggle="tooltip" data-placement="top" title="GitHub" aria-label="GitHub">
    <a class="text-white" target="_blank" rel="noopener" href="https://github.com/huweihuang/blog.huweihuang.com" aria-label="GitHub">
      <i class="fab fa-github"></i>
    </a>
  </li>
  
</ul>

        
        
      </div>
      <div class="col-12 col-sm-4 text-center py-2 order-sm-2">
        <small class="text-white">&copy; 2025 www.huweihuang.com 保留所有权利</small>
        <small class="ml-1"><a href="https://policies.google.com/privacy" target="_blank" rel="noopener">隐私政策</a></small>
	
		<p class="mt-2"><a href="/about/">About</a></p>
	
      </div>
    </div>
  </div>
</footer>


    </div>
    <script src="https://cdn.jsdelivr.net/npm/popper.js@1.16.1/dist/umd/popper.min.js"
    integrity="sha384-9/reFTGAW83EW2RDu2S0VKaIzap3H66lZH81PoYlFhbGU+6BZp6G7niu735Sk7lN"
    crossorigin="anonymous"></script>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@4.6.1/dist/js/bootstrap.min.js"
    integrity="sha512-UR25UO94eTnCVwjbXozyeVd6ZqpaAE9naiEUBK/A+QDbfSTQFhPGj5lOR6d8tsgbBk84Ggb5A3EkjsOgPRPcKA=="
    crossorigin="anonymous"></script>





<script src='/js/tabpane-persist.js'></script>




















<script src="/js/main.min.91798a335c881f1b6b805085ba4aa22d1dbd2b0b18d105d05189fa104ddae350.js" integrity="sha256-kXmKM1yIHxtrgFCFukqiLR29KwsY0QXQUYn6EE3a41A=" crossorigin="anonymous"></script>



<script src='/js/prism.js'></script>



  </body>
</html>

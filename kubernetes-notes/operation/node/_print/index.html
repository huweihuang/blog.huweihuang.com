<!doctype html>
<html lang="zh-cn" class="no-js">
  <head>
    <meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="generator" content="Hugo 0.101.0" />
<link rel="canonical" type="text/html" href="https://blog.huweihuang.com/kubernetes-notes/operation/node/">
<link rel="alternate" type="application/rss&#43;xml" href="https://blog.huweihuang.com/kubernetes-notes/operation/node/index.xml">
<meta name="robots" content="noindex, nofollow">


<link rel="shortcut icon" href="/favicons/favicon.ico" >
<link rel="apple-touch-icon" href="/favicons/apple-touch-icon-180x180.png" sizes="180x180">
<link rel="icon" type="image/png" href="/favicons/favicon-16x16.png" sizes="16x16">
<link rel="icon" type="image/png" href="/favicons/favicon-32x32.png" sizes="32x32">
<link rel="icon" type="image/png" href="/favicons/android-36x36.png" sizes="36x36">
<link rel="icon" type="image/png" href="/favicons/android-48x48.png" sizes="48x48">
<link rel="icon" type="image/png" href="/favicons/android-72x72.png" sizes="72x72">
<link rel="icon" type="image/png" href="/favicons/android-96x96.png" sizes="96x96">
<link rel="icon" type="image/png" href="/favicons/android-144x144.png" sizes="144x144">
<link rel="icon" type="image/png" href="/favicons/android-192x192.png" sizes="192x192">

<title>节点迁移 | 胡伟煌</title>
<meta name="description" content="">
<meta property="og:title" content="节点迁移" />
<meta property="og:description" content="Kubernetes学习笔记" />
<meta property="og:type" content="website" />
<meta property="og:url" content="https://blog.huweihuang.com/kubernetes-notes/operation/node/" /><meta property="og:site_name" content="胡伟煌" />

<meta itemprop="name" content="节点迁移">
<meta itemprop="description" content="Kubernetes学习笔记"><meta name="twitter:card" content="summary"/>
<meta name="twitter:title" content="节点迁移"/>
<meta name="twitter:description" content="Kubernetes学习笔记"/>




<link rel="preload" href="/scss/main.min.79e3930541ca05b5395c14b2a313b798fad1dc69f9a14aefa57b62eaa9f65f14.css" as="style">
<link href="/scss/main.min.79e3930541ca05b5395c14b2a313b798fad1dc69f9a14aefa57b62eaa9f65f14.css" rel="stylesheet" integrity="">

<script
  src="https://code.jquery.com/jquery-3.6.0.min.js"
  integrity="sha384-vtXRMe3mGCbOeY7l30aIg8H9p3GdeSe4IFlP6G8JMa7o7lXvnz3GFKzPxzJdPfGK"
  crossorigin="anonymous"></script>
<script
  src="https://unpkg.com/lunr@2.3.9/lunr.min.js"
  integrity="sha384-203J0SNzyqHby3iU6hzvzltrWi/M41wOP5Gu+BiJMz5nwKykbkUx8Kp7iti0Lpli"
  crossorigin="anonymous"></script>
<link rel="stylesheet" href="/css/prism.css"/>

<script type="application/javascript">
var doNotTrack = false;
if (!doNotTrack) {
	window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)};ga.l=+new Date;
	ga('create', 'UA-114718458-1', 'auto');
	
	ga('send', 'pageview');
}
</script>
<script async src='https://www.google-analytics.com/analytics.js'></script>

  </head>
  <body class="td-section">
    <header>
      
<nav class="js-navbar-scroll navbar navbar-expand navbar-dark flex-column flex-md-row td-navbar">
        <a class="navbar-brand" href="/">
		<span class="navbar-logo"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 32 32" width="64" height="64"><path d="M15.9.476a2.14 2.14.0 00-.823.218L3.932 6.01c-.582.277-1.005.804-1.15 1.432L.054 19.373c-.13.56-.025 1.147.3 1.627q.057.087.12.168l7.7 9.574c.407.5 1.018.787 1.662.784h12.35c.646.001 1.258-.3 1.664-.793l7.696-9.576c.404-.5.555-1.16.4-1.786L29.2 7.43c-.145-.628-.57-1.155-1.15-1.432L16.923.695A2.14 2.14.0 0015.89.476z" fill="#326ce5"/><path d="M16.002 4.542c-.384.027-.675.356-.655.74v.188c.018.213.05.424.092.633a6.22 6.22.0 01.066 1.21c-.038.133-.114.253-.218.345l-.015.282c-.405.034-.807.096-1.203.186-1.666.376-3.183 1.24-4.354 2.485l-.24-.17c-.132.04-.274.025-.395-.04a6.22 6.22.0 01-.897-.81 5.55 5.55.0 00-.437-.465l-.148-.118c-.132-.106-.294-.167-.463-.175a.64.64.0 00-.531.236c-.226.317-.152.756.164.983l.138.11a5.55 5.55.0 00.552.323c.354.197.688.428.998.7a.74.74.0 01.133.384l.218.2c-1.177 1.766-1.66 3.905-1.358 6.006l-.28.08c-.073.116-.17.215-.286.288a6.22 6.22.0 01-1.194.197 5.57 5.57.0 00-.64.05l-.177.04h-.02a.67.67.0 00-.387 1.132.67.67.0 00.684.165h.013l.18-.02c.203-.06.403-.134.598-.218.375-.15.764-.265 1.162-.34.138.008.27.055.382.135l.3-.05c.65 2.017 2.016 3.726 3.84 4.803l-.122.255c.056.117.077.247.06.376-.165.382-.367.748-.603 1.092a5.58 5.58.0 00-.358.533l-.085.18a.67.67.0 00.65 1.001.67.67.0 00.553-.432l.083-.17c.076-.2.14-.404.192-.61.177-.437.273-.906.515-1.196a.54.54.0 01.286-.14l.15-.273a8.62 8.62.0 006.146.015l.133.255c.136.02.258.095.34.205.188.358.34.733.456 1.12a5.57 5.57.0 00.194.611l.083.17a.67.67.0 001.187.131.67.67.0 00.016-.701l-.087-.18a5.55 5.55.0 00-.358-.531c-.23-.332-.428-.686-.6-1.057a.52.52.0 01.068-.4 2.29 2.29.0 01-.111-.269c1.82-1.085 3.18-2.8 3.823-4.82l.284.05c.102-.093.236-.142.373-.138.397.076.786.2 1.162.34.195.09.395.166.598.23.048.013.118.024.172.037h.013a.67.67.0 00.841-.851.67.67.0 00-.544-.446l-.194-.046a5.57 5.57.0 00-.64-.05c-.404-.026-.804-.092-1.194-.197-.12-.067-.22-.167-.288-.288l-.27-.08a8.65 8.65.0 00-1.386-5.993l.236-.218c-.01-.137.035-.273.124-.378.307-.264.64-.497.99-.696a5.57 5.57.0 00.552-.323l.146-.118a.67.67.0 00-.133-1.202.67.67.0 00-.696.161l-.148.118a5.57 5.57.0 00-.437.465c-.264.302-.556.577-.873.823a.74.74.0 01-.404.044l-.253.18c-1.46-1.53-3.427-2.48-5.535-2.67.0-.1-.013-.25-.015-.297-.113-.078-.192-.197-.218-.332a6.23 6.23.0 01.076-1.207c.043-.21.073-.42.092-.633v-.2c.02-.384-.27-.713-.655-.74zm-.834 5.166-.2 3.493h-.015c-.01.216-.137.4-.332.504s-.426.073-.6-.054l-2.865-2.03a6.86 6.86.0 013.303-1.799c.234-.05.47-.088.707-.114zm1.668.0c1.505.187 2.906.863 3.99 1.924l-2.838 2.017c-.175.14-.415.168-.618.072s-.333-.3-.336-.524zm-6.72 3.227 2.62 2.338v.015c.163.142.234.363.186.574s-.21.378-.417.435v.01l-3.362.967a6.86 6.86.0 01.974-4.34zm11.753.0c.796 1.295 1.148 2.814 1.002 4.327l-3.367-.97v-.013c-.21-.057-.37-.224-.417-.435s.023-.43.186-.574l2.6-2.327zm-6.404 2.52h1.072l.655.832-.238 1.04-.963.463-.965-.463-.227-1.04zm3.434 2.838c.045-.005.1-.005.135.0l3.467.585c-.5 1.44-1.487 2.67-2.775 3.493l-1.34-3.244a.59.59.0 01.509-.819zm-5.823.015c.196.003.377.104.484.268s.124.37.047.55v.013l-1.332 3.218C11 21.54 10.032 20.325 9.517 18.9l3.437-.583c.038-.004.077-.004.116.0zm2.904 1.4a.59.59.0 01.537.308h.013l1.694 3.057-.677.2c-1.246.285-2.547.218-3.758-.194l1.7-3.057c.103-.18.293-.29.5-.295z" fill="#fff" stroke="#fff" stroke-width=".055"/></svg></span><span class="font-weight-bold">胡伟煌</span>
	</a>
	<div class="td-navbar-nav-scroll ml-md-auto" id="main_navbar">
		<ul class="navbar-nav mt-2 mt-lg-0">
			
			
			<li class="nav-item mr-4 mb-2 mb-lg-0">
				
				
				
				
				
				
				
				
				<a class="nav-link active" href="/kubernetes-notes/" ><span class="active">Kubernetes学习笔记</span></a>
			</li>
			
			<li class="nav-item mr-4 mb-2 mb-lg-0">
				
				
				
				
				
				
				
				
				<a class="nav-link" href="/k8s-source-code-analysis/" ><span>Kubernetes源码分析</span></a>
			</li>
			
			<li class="nav-item mr-4 mb-2 mb-lg-0">
				
				
				
				
				
				
				
				
				<a class="nav-link" href="/golang-notes/" ><span>Golang学习笔记</span></a>
			</li>
			
			<li class="nav-item mr-4 mb-2 mb-lg-0">
				
				
				
				
				
				
				
				
				<a class="nav-link" href="/linux-notes/" ><span>Linux学习笔记</span></a>
			</li>
			
			<li class="nav-item mr-4 mb-2 mb-lg-0">
				
				
				
				
				
				
				
				
				<a class="nav-link" href="/about/" ><span>About</span></a>
			</li>
			
			
			
		</ul>
	</div>
	<div class="navbar-nav d-none d-lg-block"><input
  type="search"
  class="form-control td-search-input"
  placeholder="&#xf002; 站内搜索…"
  aria-label="站内搜索…"
  autocomplete="off"
  
  data-offline-search-index-json-src="/offline-search-index.80f7be66b8edc629c786d20dc8ccd095.json"
  data-offline-search-base-href="/"
  data-offline-search-max-results="10"
>
</div>
</nav>

    </header>
    <div class="container-fluid td-outer">
      <div class="td-main">
        <div class="row flex-xl-nowrap">
          <main class="col-12 col-md-9 col-xl-8 pl-md-5" role="main">
            




<div class="td-content">
<div class="pageinfo pageinfo-primary d-print-none">
<p>
这是本节的多页打印视图。
<a href="#" onclick="print();return false;">点击此处打印</a>.
</p><p>
<a href="/kubernetes-notes/operation/node/">返回本页常规视图</a>.
</p>
</div>



<h1 class="title">节点迁移</h1>





    <ul>
    
  
  
  
  

  
    
    
	
<li>1: <a href="#pg-ebf0ed02e505f9821b61779a584ab361">指定节点调度与隔离</a></li>


    
  
    
    
	
<li>2: <a href="#pg-35b75b0abb0e69e39b5c84c9866abbdb">安全迁移节点</a></li>


    
  

    </ul>


<div class="content">
      
</div>
</div>


  
  
  
  

  
  

  
    
    
	
    

<div class="td-content" style="">
    
	<h1 id="pg-ebf0ed02e505f9821b61779a584ab361">1 - 指定节点调度与隔离</h1>
    
	<h1 id="1-nodeselector">1. NodeSelector</h1>
<h2 id="1-1-概念">1.1. 概念</h2>
<p>如果需要<code>限制Pod到指定的Node</code>上运行，则可以给Node打标签并给Pod配置NodeSelector。</p>
<h2 id="1-2-使用方式">1.2. 使用方式</h2>
<h3 id="1-2-1-给node打标签">1.2.1. 给Node打标签</h3>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span><span style="color:#8f5902;font-style:italic"># get node的name</span>
</span></span><span style="display:flex;"><span>kubectl get nodes
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#8f5902;font-style:italic"># 设置Label</span>
</span></span><span style="display:flex;"><span>kubectl label nodes &lt;node-name&gt; &lt;label-key&gt;<span style="color:#ce5c00;font-weight:bold">=</span>&lt;label-value&gt;
</span></span><span style="display:flex;"><span><span style="color:#8f5902;font-style:italic"># 例如</span>
</span></span><span style="display:flex;"><span>kubectl label nodes node-1 <span style="color:#000">disktype</span><span style="color:#ce5c00;font-weight:bold">=</span>ssd
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#8f5902;font-style:italic"># 查看Node的Label</span>
</span></span><span style="display:flex;"><span>kubectl get nodes --show-labels
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#8f5902;font-style:italic"># 删除Node的label</span>
</span></span><span style="display:flex;"><span>kubectl label node &lt;node-name&gt; &lt;label-key&gt;-
</span></span></code></pre></div><h3 id="1-2-2-给pod设置nodeselector">1.2.2. 给Pod设置NodeSelector</h3>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-yaml" data-lang="yaml"><span style="display:flex;"><span><span style="color:#204a87;font-weight:bold">apiVersion</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">v1</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline"></span><span style="color:#204a87;font-weight:bold">kind</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">Pod</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline"></span><span style="color:#204a87;font-weight:bold">metadata</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">  </span><span style="color:#204a87;font-weight:bold">name</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">nginx</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">  </span><span style="color:#204a87;font-weight:bold">labels</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">    </span><span style="color:#204a87;font-weight:bold">env</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">test</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline"></span><span style="color:#204a87;font-weight:bold">spec</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">  </span><span style="color:#204a87;font-weight:bold">containers</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">  </span>- <span style="color:#204a87;font-weight:bold">name</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">nginx</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">    </span><span style="color:#204a87;font-weight:bold">image</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">nginx</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">    </span><span style="color:#204a87;font-weight:bold">imagePullPolicy</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">IfNotPresent</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">  </span><span style="color:#204a87;font-weight:bold">nodeSelector</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">    </span><span style="color:#204a87;font-weight:bold">disktype</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">ssd   </span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#8f5902;font-style:italic"># 对应Node的Label</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span></code></pre></div><h2 id="1-3-亲和性-affinity-和反亲和性-anti-affinity">1.3. 亲和性（Affinity）和反亲和性（Anti-affinity）</h2>
<blockquote>
<p>待补充</p>
</blockquote>
<h1 id="2-taint-和-toleration">2. Taint 和 Toleration</h1>
<h2 id="2-1-概念">2.1. 概念</h2>
<p><code>nodeSelector</code>可以通过<code>打标签</code>的形式让Pod被调度到指定的Node上，<code>Taint </code>则相反，它使节点能够排斥一类特定的Pod，除非Pod被指定了<code>toleration</code>的标签。（<code>taint</code>即污点，Node被打上污点；只有容忍[toleration]这些污点的Pod才可能被调度到该Node）。</p>
<h2 id="2-2-使用方式">2.2. 使用方式</h2>
<h3 id="2-2-1-kubectl-taint">2.2.1. kubectl taint</h3>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span><span style="color:#8f5902;font-style:italic"># 给节点增加一个taint，它的key是&lt;key&gt;，value是&lt;value&gt;，effect是NoSchedule。</span>
</span></span><span style="display:flex;"><span>kubectl taint nodes &lt;node_name&gt; &lt;key&gt;<span style="color:#ce5c00;font-weight:bold">=</span>&lt;value&gt;:NoSchedule
</span></span></code></pre></div><p>只有拥有和这个<code>taint</code>相匹配的<code>toleration</code>的pod才能够被分配到 <code>node_name</code> 这个节点。</p>
<p>例如，在 <code>PodSpec</code> 中定义 pod 的 toleration：</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-yaml" data-lang="yaml"><span style="display:flex;"><span><span style="color:#204a87;font-weight:bold">tolerations</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline"></span>- <span style="color:#204a87;font-weight:bold">key</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#4e9a06">&#34;key&#34;</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">  </span><span style="color:#204a87;font-weight:bold">operator</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#4e9a06">&#34;Equal&#34;</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">  </span><span style="color:#204a87;font-weight:bold">value</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#4e9a06">&#34;value&#34;</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">  </span><span style="color:#204a87;font-weight:bold">effect</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#4e9a06">&#34;NoSchedule&#34;</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span></code></pre></div><div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-yaml" data-lang="yaml"><span style="display:flex;"><span><span style="color:#204a87;font-weight:bold">tolerations</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline"></span>- <span style="color:#204a87;font-weight:bold">key</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#4e9a06">&#34;key&#34;</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">  </span><span style="color:#204a87;font-weight:bold">operator</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#4e9a06">&#34;Exists&#34;</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">  </span><span style="color:#204a87;font-weight:bold">effect</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#4e9a06">&#34;NoSchedule&#34;</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span></code></pre></div><h3 id="2-2-2-匹配规则">2.2.2. 匹配规则：</h3>
<p>一个 toleration 和一个 taint 相“匹配”是指它们有一样的 key 和 effect ，并且：</p>
<ul>
<li>如果 <code>operator</code> 是 <code>Exists</code> （此时 toleration 不能指定 <code>value</code>）</li>
<li>如果 <code>operator</code> 是 <code>Equal</code> ，则它们的 <code>value</code> 应该相等</li>
</ul>
<p><strong>特殊情况：</strong></p>
<ul>
<li>
<p>如果一个 toleration 的 <code>key</code> 为空且 operator 为 <code>Exists</code> ，表示这个 toleration 与任意的 key 、 value 和 effect 都匹配，即这个 toleration 能容忍任意 taint。</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-yaml" data-lang="yaml"><span style="display:flex;"><span><span style="color:#204a87;font-weight:bold">tolerations</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline"></span>- <span style="color:#204a87;font-weight:bold">operator</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#4e9a06">&#34;Exists&#34;</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span></code></pre></div></li>
<li>
<p>如果一个 toleration 的 <code>effect</code> 为空，则 <code>key</code> 值与之相同的相匹配 taint 的 <code>effect</code> 可以是任意值。</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-yaml" data-lang="yaml"><span style="display:flex;"><span><span style="color:#204a87;font-weight:bold">tolerations</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline"></span>- <span style="color:#204a87;font-weight:bold">key</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#4e9a06">&#34;key&#34;</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">  </span><span style="color:#204a87;font-weight:bold">operator</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#4e9a06">&#34;Exists&#34;</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span></code></pre></div></li>
</ul>
<p>一个节点可以设置多个taint，一个pod也可以设置多个toleration。Kubernetes 处理多个 taint 和 toleration 的过程就像一个过滤器：从一个节点的所有 taint 开始遍历，过滤掉那些 pod 中存在与之相匹配的 toleration 的 taint。余下未被过滤的 taint 的 effect 值决定了 pod 是否会被分配到该节点，特别是以下情况：</p>
<ul>
<li>如果未被过滤的 taint 中存在一个以上 effect 值为 <code>NoSchedule</code> 的 taint，则 Kubernetes 不会将 pod 分配到该节点。</li>
<li>如果未被过滤的 taint 中不存在 effect 值为 <code>NoSchedule</code> 的 taint，但是存在 effect 值为 <code>PreferNoSchedule</code> 的 taint，则 Kubernetes 会<em>尝试</em>将 pod 分配到该节点。</li>
<li>如果未被过滤的 taint 中存在一个以上 effect 值为 <code>NoExecute</code> 的 taint，则 Kubernetes 不会将 pod 分配到该节点（如果 pod 还未在节点上运行），或者将 pod 从该节点驱逐（如果 pod 已经在节点上运行）。</li>
</ul>
<h2 id="2-2-3-effect的类型">2.2.3. effect的类型</h2>
<ul>
<li>
<p><code>NoSchedule</code>：只有拥有和这个 taint 相匹配的 toleration 的 pod 才能够被分配到这个节点。</p>
</li>
<li>
<p><code>PreferNoSchedule</code>：系统会<em>尽量</em>避免将 pod 调度到存在其不能容忍 taint 的节点上，但这不是强制的。</p>
</li>
<li>
<p><code>NoExecute</code> ：任何不能忍受这个 taint 的 pod 都会马上被驱逐，任何可以忍受这个 taint 的 pod 都不会被驱逐。Pod可指定属性 <code>tolerationSeconds</code> 的值，表示pod 还能继续在节点上运行的时间。</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-yaml" data-lang="yaml"><span style="display:flex;"><span><span style="color:#204a87;font-weight:bold">tolerations</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline"></span>- <span style="color:#204a87;font-weight:bold">key</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#4e9a06">&#34;key1&#34;</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">  </span><span style="color:#204a87;font-weight:bold">operator</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#4e9a06">&#34;Equal&#34;</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">  </span><span style="color:#204a87;font-weight:bold">value</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#4e9a06">&#34;value1&#34;</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">  </span><span style="color:#204a87;font-weight:bold">effect</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#4e9a06">&#34;NoExecute&#34;</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">  </span><span style="color:#204a87;font-weight:bold">tolerationSeconds</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#0000cf;font-weight:bold">3600</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span></code></pre></div></li>
</ul>
<h2 id="2-3-使用场景">2.3. 使用场景</h2>
<h3 id="2-3-1-专用节点">2.3.1. 专用节点</h3>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>kubectl taint nodes &lt;nodename&gt; <span style="color:#000">dedicated</span><span style="color:#ce5c00;font-weight:bold">=</span>&lt;groupName&gt;:NoSchedule
</span></span></code></pre></div><p>先给Node添加taint，然后给Pod添加相对应的 toleration，则该Pod可调度到taint的Node，也可调度到其他节点。</p>
<p>如果想<strong>让Pod只调度某些节点且某些节点只接受对应的Pod</strong>，则需要在Node上添加<code>Label</code>（例如：<code>dedicated=groupName</code>），同时给Pod的<code>nodeSelector</code>添加对应的<code>Label</code>。</p>
<h3 id="2-3-2-特殊硬件节点">2.3.2. 特殊硬件节点</h3>
<p>如果某些节点配置了特殊硬件（例如CPU），希望不使用这些特殊硬件的Pod不被调度该Node，以便保留必要资源。即可给Node设置<code>taint</code>和<code>label</code>，同时给Pod设置<code>toleration</code>和<code>label</code>来使得这些Node专门被指定Pod使用。</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span><span style="color:#8f5902;font-style:italic"># kubectl taint</span>
</span></span><span style="display:flex;"><span>kubectl taint nodes nodename <span style="color:#000">special</span><span style="color:#ce5c00;font-weight:bold">=</span>true:NoSchedule 
</span></span><span style="display:flex;"><span><span style="color:#8f5902;font-style:italic"># 或者</span>
</span></span><span style="display:flex;"><span>kubectl taint nodes nodename <span style="color:#000">special</span><span style="color:#ce5c00;font-weight:bold">=</span>true:PreferNoSchedule
</span></span></code></pre></div><h3 id="2-3-3-基于taint驱逐">2.3.3. 基于taint驱逐</h3>
<p>effect 值 <code>NoExecute</code> ，它会影响已经在节点上运行的 pod，即根据策略对Pod进行驱逐。</p>
<ul>
<li>如果 pod 不能忍受effect 值为 <code>NoExecute</code> 的 taint，那么 pod 将马上被驱逐</li>
<li>如果 pod 能够忍受effect 值为 <code>NoExecute</code> 的 taint，但是在 toleration 定义中没有指定 <code>tolerationSeconds</code>，则 pod 还会一直在这个节点上运行。</li>
<li>如果 pod 能够忍受effect 值为 <code>NoExecute</code> 的 taint，而且指定了 <code>tolerationSeconds</code>，则 pod 还能在这个节点上继续运行这个指定的时间长度。</li>
</ul>
<p>参考：</p>
<ul>
<li>
<p><a href="https://kubernetes.io/docs/concepts/configuration/assign-pod-node/">https://kubernetes.io/docs/concepts/configuration/assign-pod-node/</a></p>
</li>
<li>
<p><a href="https://kubernetes.io/docs/concepts/configuration/taint-and-toleration/">https://kubernetes.io/docs/concepts/configuration/taint-and-toleration/</a></p>
</li>
</ul>

</div>



    
	
  
    
    
	
    

<div class="td-content" style="page-break-before: always">
    
	<h1 id="pg-35b75b0abb0e69e39b5c84c9866abbdb">2 - 安全迁移节点</h1>
    
	<h1 id="1-迁移pod">1. 迁移Pod</h1>
<h2 id="1-1-设置节点是否可调度">1.1. 设置节点是否可调度</h2>
<p>确定需要迁移和被迁移的节点，将不允许被迁移的节点设置为不可调度。</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span><span style="color:#8f5902;font-style:italic"># 查看节点</span>
</span></span><span style="display:flex;"><span>kubectl get nodes
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#8f5902;font-style:italic"># 设置节点为不可调度</span>
</span></span><span style="display:flex;"><span>kubectl cordon &lt;NodeName&gt;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#8f5902;font-style:italic"># 设置节点为可调度</span>
</span></span><span style="display:flex;"><span>kubectl uncordon &lt;NodeName&gt;
</span></span></code></pre></div><h2 id="1-2-执行kubectl-drain命令">1.2. 执行kubectl drain命令</h2>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span><span style="color:#8f5902;font-style:italic"># 驱逐节点的所有pod</span>
</span></span><span style="display:flex;"><span>kubectl drain &lt;NodeName&gt; --force --ignore-daemonsets
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#8f5902;font-style:italic"># 驱逐指定节点的pod</span>
</span></span><span style="display:flex;"><span>kubectl drain  &lt;NodeName&gt; --ignore-daemonsets	--pod-selector<span style="color:#ce5c00;font-weight:bold">=</span>pod-template-hash<span style="color:#ce5c00;font-weight:bold">=</span>88964949c
</span></span></code></pre></div><p>示例：</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>$ kubectl drain bjzw-prek8sredis-99-40 --force --ignore-daemonsets
</span></span><span style="display:flex;"><span>node <span style="color:#4e9a06">&#34;bjzw-prek8sredis-99-40&#34;</span> already cordoned
</span></span><span style="display:flex;"><span>WARNING: Deleting pods not managed by ReplicationController, ReplicaSet, Job, DaemonSet or StatefulSet: kube-proxy-bjzw-prek8sredis-99-40<span style="color:#000;font-weight:bold">;</span> Ignoring DaemonSet-managed pods: calicoopsmonitor-mfpqs, arachnia-agent-j56n8
</span></span><span style="display:flex;"><span>pod <span style="color:#4e9a06">&#34;pre-test-pro2-r-0-redis-2-8-19-1&#34;</span> evicted
</span></span><span style="display:flex;"><span>pod <span style="color:#4e9a06">&#34;pre-test-hwh1-r-8-redis-2-8-19-2&#34;</span> evicted
</span></span><span style="display:flex;"><span>pod <span style="color:#4e9a06">&#34;pre-eos-hdfs-vector-eos-hdfs-redis-2-8-19-0&#34;</span> evicted
</span></span></code></pre></div><h2 id="1-3-特别说明">1.3. 特别说明</h2>
<p>对于statefulset创建的Pod，kubectl drain的说明如下：</p>
<p>kubectl drain操作会将相应节点上的旧Pod删除，并在可调度节点上面起一个对应的Pod。当旧Pod没有被正常删除的情况下，新Pod不会起来。例如：旧Pod一直处于<code>Terminating</code>状态。</p>
<p>对应的解决方式是通过重启相应节点的kubelet，或者强制删除该Pod。</p>
<p>示例：</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span><span style="color:#8f5902;font-style:italic"># 重启发生`Terminating`节点的kubelet</span>
</span></span><span style="display:flex;"><span>systemctl restart kubelet
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#8f5902;font-style:italic"># 强制删除`Terminating`状态的Pod</span>
</span></span><span style="display:flex;"><span>kubectl delete pod &lt;PodName&gt; --namespace<span style="color:#ce5c00;font-weight:bold">=</span>&lt;Namespace&gt; --force --grace-period<span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#0000cf;font-weight:bold">0</span>
</span></span></code></pre></div><h1 id="2-kubectl-drain-流程图">2. kubectl drain 流程图</h1>
<img src="https://res.cloudinary.com/dqxtn0ick/image/upload/v1537259779/article/kubernetes/operation/kubectl-drain.svg" width="100%">
<h1 id="3-troubleshooting">3. TroubleShooting</h1>
<p>1、存在不是通过<code>ReplicationController</code>, <code>ReplicaSet</code>, <code>Job</code>, <code>DaemonSet</code> 或者<code> StatefulSet</code>创建的Pod（即静态pod，通过文件方式创建的），所以需要设置强制执行的参数<code>--force</code>。</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>$ kubectl drain bjzw-prek8sredis-99-40
</span></span><span style="display:flex;"><span>node <span style="color:#4e9a06">&#34;bjzw-prek8sredis-99-40&#34;</span> already cordoned
</span></span><span style="display:flex;"><span>error: unable to drain node <span style="color:#4e9a06">&#34;bjzw-prek8sredis-99-40&#34;</span>, aborting command...
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>There are pending nodes to be drained:
</span></span><span style="display:flex;"><span> bjzw-prek8sredis-99-40
</span></span><span style="display:flex;"><span>error: DaemonSet-managed pods <span style="color:#ce5c00;font-weight:bold">(</span>use --ignore-daemonsets to ignore<span style="color:#ce5c00;font-weight:bold">)</span>: calicoopsmonitor-mfpqs, arachnia-agent-j56n8<span style="color:#000;font-weight:bold">;</span> pods not managed by ReplicationController, ReplicaSet, Job, DaemonSet or StatefulSet <span style="color:#ce5c00;font-weight:bold">(</span>use --force to override<span style="color:#ce5c00;font-weight:bold">)</span>: kube-proxy-bjzw-prek8sredis-99-40
</span></span></code></pre></div><p>2、存在DaemonSet方式管理的Pod，需要设置<code>--ignore-daemonsets</code>参数忽略报错。</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>$ kubectl drain bjzw-prek8sredis-99-40 --force
</span></span><span style="display:flex;"><span>node <span style="color:#4e9a06">&#34;bjzw-prek8sredis-99-40&#34;</span> already cordoned
</span></span><span style="display:flex;"><span>error: unable to drain node <span style="color:#4e9a06">&#34;bjzw-prek8sredis-99-40&#34;</span>, aborting command...
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>There are pending nodes to be drained:
</span></span><span style="display:flex;"><span> bjzw-prek8sredis-99-40
</span></span><span style="display:flex;"><span>error: DaemonSet-managed pods <span style="color:#ce5c00;font-weight:bold">(</span>use --ignore-daemonsets to ignore<span style="color:#ce5c00;font-weight:bold">)</span>: calicoopsmonitor-mfpqs, arachnia-agent-j56n8
</span></span></code></pre></div><h1 id="4-kubectl-drain">4. kubectl drain</h1>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>$ kubectl drain --help
</span></span><span style="display:flex;"><span>Drain node in preparation <span style="color:#204a87;font-weight:bold">for</span> maintenance.
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span> The given node will be marked unschedulable to prevent new pods from arriving. <span style="color:#4e9a06">&#39;drain&#39;</span> evicts the pods <span style="color:#204a87;font-weight:bold">if</span> the API
</span></span><span style="display:flex;"><span>server supports https://kubernetes.io/docs/concepts/workloads/pods/disruptions/ . Otherwise, it will use normal DELETE
</span></span><span style="display:flex;"><span>to delete the pods. The <span style="color:#4e9a06">&#39;drain&#39;</span> evicts or deletes all pods except mirror pods <span style="color:#ce5c00;font-weight:bold">(</span>which cannot be deleted through the API
</span></span><span style="display:flex;"><span>server<span style="color:#ce5c00;font-weight:bold">)</span>.  If there are daemon set-managed pods, drain will not proceed without --ignore-daemonsets, and regardless it
</span></span><span style="display:flex;"><span>will not delete any daemon set-managed pods, because those pods would be immediately replaced by the daemon <span style="color:#204a87">set</span>
</span></span><span style="display:flex;"><span>controller, which ignores unschedulable markings.  If there are any pods that are neither mirror pods nor managed by a
</span></span><span style="display:flex;"><span>replication controller, replica set, daemon set, stateful set, or job, <span style="color:#204a87;font-weight:bold">then</span> drain will not delete any pods unless you
</span></span><span style="display:flex;"><span>use --force.  --force will also allow deletion to proceed <span style="color:#204a87;font-weight:bold">if</span> the managing resource of one or more pods is missing.
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span> <span style="color:#4e9a06">&#39;drain&#39;</span> waits <span style="color:#204a87;font-weight:bold">for</span> graceful termination. You should not operate on the machine <span style="color:#204a87;font-weight:bold">until</span> the <span style="color:#204a87">command</span> completes.
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span> When you are ready to put the node back into service, use kubectl uncordon, which will make the node schedulable again.
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span> https://kubernetes.io/images/docs/kubectl_drain.svg
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>Examples:
</span></span><span style="display:flex;"><span>  <span style="color:#8f5902;font-style:italic"># Drain node &#34;foo&#34;, even if there are pods not managed by a replication controller, replica set, job, daemon set or</span>
</span></span><span style="display:flex;"><span>stateful <span style="color:#204a87">set</span> on it
</span></span><span style="display:flex;"><span>  kubectl drain foo --force
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  <span style="color:#8f5902;font-style:italic"># As above, but abort if there are pods not managed by a replication controller, replica set, job, daemon set or</span>
</span></span><span style="display:flex;"><span>stateful set, and use a grace period of <span style="color:#0000cf;font-weight:bold">15</span> minutes
</span></span><span style="display:flex;"><span>  kubectl drain foo --grace-period<span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#0000cf;font-weight:bold">900</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>Options:
</span></span><span style="display:flex;"><span>      --chunk-size<span style="color:#ce5c00;font-weight:bold">=</span>500: Return large lists in chunks rather than all at once. Pass <span style="color:#0000cf;font-weight:bold">0</span> to disable. This flag is beta and
</span></span><span style="display:flex;"><span>may change in the future.
</span></span><span style="display:flex;"><span>      --delete-emptydir-data<span style="color:#ce5c00;font-weight:bold">=</span>false: Continue even <span style="color:#204a87;font-weight:bold">if</span> there are pods using emptyDir <span style="color:#ce5c00;font-weight:bold">(</span><span style="color:#204a87">local</span> data that will be deleted when
</span></span><span style="display:flex;"><span>the node is drained<span style="color:#ce5c00;font-weight:bold">)</span>.
</span></span><span style="display:flex;"><span>      --disable-eviction<span style="color:#ce5c00;font-weight:bold">=</span>false: Force drain to use delete, even <span style="color:#204a87;font-weight:bold">if</span> eviction is supported. This will bypass checking
</span></span><span style="display:flex;"><span>PodDisruptionBudgets, use with caution.
</span></span><span style="display:flex;"><span>      --dry-run<span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#4e9a06">&#39;none&#39;</span>: Must be <span style="color:#4e9a06">&#34;none&#34;</span>, <span style="color:#4e9a06">&#34;server&#34;</span>, or <span style="color:#4e9a06">&#34;client&#34;</span>. If client strategy, only print the object that would be
</span></span><span style="display:flex;"><span>sent, without sending it. If server strategy, submit server-side request without persisting the resource.
</span></span><span style="display:flex;"><span>      --force<span style="color:#ce5c00;font-weight:bold">=</span>false: Continue even <span style="color:#204a87;font-weight:bold">if</span> there are pods not managed by a ReplicationController, ReplicaSet, Job, DaemonSet
</span></span><span style="display:flex;"><span>or StatefulSet.
</span></span><span style="display:flex;"><span>      --grace-period<span style="color:#ce5c00;font-weight:bold">=</span>-1: Period of <span style="color:#204a87">time</span> in seconds given to each pod to terminate gracefully. If negative, the default
</span></span><span style="display:flex;"><span>value specified in the pod will be used.
</span></span><span style="display:flex;"><span>      --ignore-daemonsets<span style="color:#ce5c00;font-weight:bold">=</span>false: Ignore DaemonSet-managed pods.
</span></span><span style="display:flex;"><span>      --ignore-errors<span style="color:#ce5c00;font-weight:bold">=</span>false: Ignore errors occurred between drain nodes in group.
</span></span><span style="display:flex;"><span>      --pod-selector<span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#4e9a06">&#39;&#39;</span>: Label selector to filter pods on the node
</span></span><span style="display:flex;"><span>  -l, --selector<span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#4e9a06">&#39;&#39;</span>: Selector <span style="color:#ce5c00;font-weight:bold">(</span>label query<span style="color:#ce5c00;font-weight:bold">)</span> to filter on
</span></span><span style="display:flex;"><span>      --skip-wait-for-delete-timeout<span style="color:#ce5c00;font-weight:bold">=</span>0: If pod DeletionTimestamp older than N seconds, skip waiting <span style="color:#204a87;font-weight:bold">for</span> the pod.
</span></span><span style="display:flex;"><span>Seconds must be greater than <span style="color:#0000cf;font-weight:bold">0</span> to skip.
</span></span><span style="display:flex;"><span>      --timeout<span style="color:#ce5c00;font-weight:bold">=</span>0s: The length of <span style="color:#204a87">time</span> to <span style="color:#204a87">wait</span> before giving up, zero means infinite
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>Usage:
</span></span><span style="display:flex;"><span>  kubectl drain NODE <span style="color:#ce5c00;font-weight:bold">[</span>options<span style="color:#ce5c00;font-weight:bold">]</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>Use <span style="color:#4e9a06">&#34;kubectl options&#34;</span> <span style="color:#204a87;font-weight:bold">for</span> a list of global command-line options <span style="color:#ce5c00;font-weight:bold">(</span>applies to all commands<span style="color:#ce5c00;font-weight:bold">)</span>.
</span></span></code></pre></div><p>参考文档：</p>
<ul>
<li><a href="https://kubernetes.io/docs/tasks/administer-cluster/safely-drain-node/">https://kubernetes.io/docs/tasks/administer-cluster/safely-drain-node/</a></li>
<li><a href="https://kubernetes.io/docs/tasks/run-application/configure-pdb/">https://kubernetes.io/docs/tasks/run-application/configure-pdb/</a></li>
<li><a href="https://kubernetes.io/docs/reference/generated/kubectl/kubectl-commands#drain">https://kubernetes.io/docs/reference/generated/kubectl/kubectl-commands#drain</a></li>
</ul>

</div>



    
	
  



          </main>
        </div>
      </div>
      
<footer class="bg-dark py-5 row d-print-none">
  <div class="container-fluid mx-sm-5">
    <div class="row">
      <div class="col-6 col-sm-4 text-xs-center order-sm-2">
        
        
        
      </div>
      <div class="col-6 col-sm-4 text-right text-xs-center order-sm-3">
        
        
        
<ul class="list-inline mb-0">
  
  <li class="list-inline-item mx-2 h3" data-toggle="tooltip" data-placement="top" title="GitHub" aria-label="GitHub">
    <a class="text-white" target="_blank" rel="noopener" href="https://github.com/huweihuang/blog.huweihuang.com" aria-label="GitHub">
      <i class="fab fa-github"></i>
    </a>
  </li>
  
</ul>

        
        
      </div>
      <div class="col-12 col-sm-4 text-center py-2 order-sm-2">
        <small class="text-white">&copy; 2024 www.huweihuang.com 保留所有权利</small>
        <small class="ml-1"><a href="https://policies.google.com/privacy" target="_blank" rel="noopener">隐私政策</a></small>
	
		<p class="mt-2"><a href="/about/">About</a></p>
	
      </div>
    </div>
  </div>
</footer>


    </div>
    <script src="https://cdn.jsdelivr.net/npm/popper.js@1.16.1/dist/umd/popper.min.js"
    integrity="sha384-9/reFTGAW83EW2RDu2S0VKaIzap3H66lZH81PoYlFhbGU+6BZp6G7niu735Sk7lN"
    crossorigin="anonymous"></script>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@4.6.1/dist/js/bootstrap.min.js"
    integrity="sha512-UR25UO94eTnCVwjbXozyeVd6ZqpaAE9naiEUBK/A+QDbfSTQFhPGj5lOR6d8tsgbBk84Ggb5A3EkjsOgPRPcKA=="
    crossorigin="anonymous"></script>





<script src='/js/tabpane-persist.js'></script>




















<script src="/js/main.min.91798a335c881f1b6b805085ba4aa22d1dbd2b0b18d105d05189fa104ddae350.js" integrity="sha256-kXmKM1yIHxtrgFCFukqiLR29KwsY0QXQUYn6EE3a41A=" crossorigin="anonymous"></script>



<script src='/js/prism.js'></script>



  </body>
</html>

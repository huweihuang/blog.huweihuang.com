<rss version="2.0" xmlns:atom="http://www.w3.org/2005/Atom">
  <channel>
    <title>èƒ¡ä¼Ÿç…Œ â€“ Cilium</title>
    <link>https://blog.huweihuang.com/kubernetes-notes/network/cilium/</link>
    <description>Recent content in Cilium on èƒ¡ä¼Ÿç…Œ</description>
    <generator>Hugo -- gohugo.io</generator>
    
	  <atom:link href="https://blog.huweihuang.com/kubernetes-notes/network/cilium/index.xml" rel="self" type="application/rss+xml" />
    
    
      
        
      
    
    
    <item>
      <title>Kubernetes-Notes: Ciliumä»‹ç»</title>
      <link>https://blog.huweihuang.com/kubernetes-notes/network/cilium/cilium/</link>
      <pubDate>Sat, 16 Nov 2024 10:50:57 +0000</pubDate>
      
      <guid>https://blog.huweihuang.com/kubernetes-notes/network/cilium/cilium/</guid>
      <description>
        
        
        &lt;h1 id=&#34;1-ciliumç®€ä»‹&#34;&gt;1. Ciliumç®€ä»‹&lt;/h1&gt;
&lt;p&gt;Cilium æ˜¯ä¸€ä¸ªå¼€æºçš„å®¹å™¨ç½‘ç»œæ’ä»¶ï¼ˆCNIï¼‰ï¼Œä¸“ä¸º Kubernetes å’Œäº‘åŸç”Ÿç¯å¢ƒè®¾è®¡ï¼ŒåŸºäº &lt;strong&gt;eBPFï¼ˆExtended Berkeley Packet Filterï¼‰&lt;/strong&gt; å®ç°é«˜æ€§èƒ½ã€å¯æ‰©å±•çš„ç½‘ç»œå’Œå®‰å…¨åŠŸèƒ½ã€‚å®ƒæ”¯æŒå¾®æœåŠ¡é—´çš„ç»†ç²’åº¦æµé‡æ§åˆ¶ï¼Œèƒ½å¤Ÿåœ¨ L3/L4/L7 å±‚æä¾›ç½‘ç»œç­–ç•¥ï¼ŒåŒæ—¶å…·æœ‰å¼ºå¤§çš„å¯è§‚æµ‹æ€§å·¥å…·ï¼ˆå¦‚ Hubbleï¼‰ä»¥å¸®åŠ©è¿ç»´äººå‘˜ç›‘æ§å’Œä¼˜åŒ–æµé‡ã€‚&lt;/p&gt;
&lt;h2 id=&#34;1-1-æ ¸å¿ƒç‰¹æ€§&#34;&gt;1.1. æ ¸å¿ƒç‰¹æ€§&lt;/h2&gt;
&lt;ol&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;åŸºäº eBPF çš„&lt;/strong&gt;é«˜æ€§èƒ½&lt;strong&gt;æ•°æ®å¹³é¢&lt;/strong&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;eBPF&lt;/strong&gt;ï¼šCilium é€šè¿‡ eBPF åœ¨ Linux å†…æ ¸ä¸­ç›´æ¥è¿è¡Œæ•°æ®åŒ…å¤„ç†é€»è¾‘ï¼Œé¿å…äº†å†…æ ¸ä¸ç”¨æˆ·æ€çš„é¢‘ç¹åˆ‡æ¢ï¼Œå¤§å¹…æé«˜äº†æ€§èƒ½ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;é«˜æ•ˆæµé‡è½¬å‘&lt;/strong&gt;ï¼šæ”¯æŒ BPF çš„å¿«é€Ÿè·¯å¾„ä¼˜åŒ–ï¼ˆZero-Copy è½¬å‘ï¼‰ï¼Œåœ¨é«˜æµé‡ç¯å¢ƒä¸­è¡¨ç°å‡ºè‰²ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;å¤šå±‚ç½‘ç»œç­–ç•¥&lt;/strong&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;L3/L4 ç­–ç•¥&lt;/strong&gt;ï¼šåŸºäº IP å’Œç«¯å£çš„åŸºæœ¬æµé‡æ§åˆ¶ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;L7 ç­–ç•¥&lt;/strong&gt;ï¼šæ”¯æŒåº”ç”¨å±‚åè®®ï¼ˆå¦‚ HTTPã€gRPCï¼‰çš„è®¿é—®æ§åˆ¶ï¼Œå¯ä»¥æ ¹æ®è¯·æ±‚è·¯å¾„ã€æ–¹æ³•æˆ–å†…å®¹è¿‡æ»¤æµé‡ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;å¾®æœåŠ¡å‹å¥½&lt;/strong&gt;ï¼šç‰¹åˆ«é€‚åˆéœ€è¦ç»†ç²’åº¦ç½‘ç»œç­–ç•¥çš„å¾®æœåŠ¡æ¶æ„ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;å¯è§‚æµ‹æ€§&lt;/strong&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;Hubble&lt;/strong&gt;ï¼šCilium å†…ç½®çš„å¯è§‚æµ‹æ€§å¹³å°ï¼Œå¯ä»¥å®æ—¶ç›‘æ§æœåŠ¡é—´çš„ç½‘ç»œæµé‡ã€å»¶è¿Ÿå’Œé”™è¯¯ç‡ï¼Œå¸®åŠ©å¼€å‘å’Œè¿ç»´å›¢é˜Ÿå¿«é€Ÿå®šä½é—®é¢˜ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;æµé‡è·¯å¾„è¿½è¸ª&lt;/strong&gt;ï¼šæ”¯æŒæµé‡è·¯å¾„çš„å…¨é“¾è·¯è¿½è¸ªï¼Œä¾¿äºæ’æŸ¥ç½‘ç»œç“¶é¢ˆæˆ–ç­–ç•¥å†²çªã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;æ‹“å±•æ€§&lt;/strong&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;æ”¯æŒè‡ªå®šä¹‰ eBPF ç¨‹åºï¼Œç”¨æˆ·å¯ä»¥æ ¹æ®ä¸šåŠ¡éœ€æ±‚æ‰©å±•ç½‘ç»œåŠŸèƒ½ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;ä¸å…¶ä»–äº‘åŸç”Ÿå·¥å…·ï¼ˆå¦‚ Prometheusã€Grafanaã€Istioï¼‰æ— ç¼é›†æˆã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;è·¨äº‘å’Œæ··åˆäº‘æ”¯æŒ&lt;/strong&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;æ”¯æŒ Kubernetes é›†ç¾¤çš„å¤šç½‘ç»œç¯å¢ƒï¼Œä¾‹å¦‚åœ¨è·¨äº‘å’Œæ··åˆäº‘åœºæ™¯ä¸­æä¾›ç»Ÿä¸€çš„ç½‘ç»œç­–ç•¥å’Œæµé‡æ§åˆ¶ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;æœåŠ¡å‘ç°ä¸è´Ÿè½½å‡è¡¡&lt;/strong&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;å†…ç½®æœåŠ¡è´Ÿè½½å‡è¡¡&lt;/strong&gt;ï¼šæä¾›å†…æ ¸çº§çš„æµé‡è´Ÿè½½å‡è¡¡ï¼Œæ¯”ä¼ ç»Ÿçš„ kube-proxy æ€§èƒ½æ›´é«˜ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;æœåŠ¡å‘ç°æ”¯æŒ&lt;/strong&gt;ï¼šå¯ä»¥ä¸ Kubernetes çš„ Service èµ„æºååŒå·¥ä½œï¼Œè‡ªåŠ¨å®ç° Pod é—´é€šä¿¡ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ol&gt;
&lt;h2 id=&#34;1-2-é€‚ç”¨åœºæ™¯&#34;&gt;1.2. é€‚ç”¨åœºæ™¯&lt;/h2&gt;
&lt;ol&gt;
&lt;li&gt;äº‘åŸç”Ÿå¾®æœåŠ¡æ¶æ„
&lt;ul&gt;
&lt;li&gt;åœ¨éœ€è¦ä¸¥æ ¼æµé‡æ§åˆ¶å’Œä¸°å¯Œå¯è§‚æµ‹æ€§çš„ç¯å¢ƒä¸­è¡¨ç°å°¤ä¸ºå‡ºè‰²ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;è¾¹ç¼˜è®¡ç®—
&lt;ul&gt;
&lt;li&gt;ä½å»¶è¿Ÿéœ€æ±‚è¾ƒé«˜çš„åœºæ™¯ï¼Œå¦‚ CDN è¾¹ç¼˜èŠ‚ç‚¹å’Œ IoT ç¯å¢ƒã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;é«˜æµé‡é›†ç¾¤
&lt;ul&gt;
&lt;li&gt;é€‚ç”¨äºå¯¹ååé‡å’Œæ€§èƒ½è¦æ±‚æé«˜çš„ç”Ÿäº§é›†ç¾¤ï¼Œä¾‹å¦‚ç”µå•†ã€æµåª’ä½“å’Œé‡‘èæœåŠ¡ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;å¤šç§Ÿæˆ·éš”ç¦»
&lt;ul&gt;
&lt;li&gt;æ”¯æŒå¤šç§Ÿæˆ·ç½‘ç»œç¯å¢ƒä¸­çš„å¼ºéš”ç¦»éœ€æ±‚ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ol&gt;
&lt;h1 id=&#34;2-ciliuméƒ¨ç½²&#34;&gt;2. Ciliuméƒ¨ç½²&lt;/h1&gt;
&lt;h2 id=&#34;2-1-éƒ¨ç½²&#34;&gt;2.1. éƒ¨ç½²&lt;/h2&gt;
&lt;p&gt;éƒ¨ç½²æ–‡æ¡£å¯å‚è€ƒï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href=&#34;https://docs.cilium.io/en/stable/installation/k8s-install-helm/&#34;&gt;https://docs.cilium.io/en/stable/installation/k8s-install-helm/&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://docs.cilium.io/en/stable/gettingstarted/k8s-install-default/#k8s-install-quick&#34;&gt;https://docs.cilium.io/en/stable/gettingstarted/k8s-install-default/#k8s-install-quick&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;å¯ä»¥ä½¿ç”¨helmæ¥éƒ¨ç½²&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;helm repo add cilium https://helm.cilium.io/
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;helm repo update
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#8f5902;font-style:italic&#34;&gt;# éƒ¨ç½²cilium&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;kubectl create ns cilium-system &lt;span style=&#34;color:#ce5c00;font-weight:bold&#34;&gt;||&lt;/span&gt; &lt;span style=&#34;color:#204a87&#34;&gt;true&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;helm install cilium cilium/cilium --namespace cilium-system &lt;span style=&#34;color:#4e9a06&#34;&gt;\
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#4e9a06&#34;&gt;&lt;/span&gt;    --set ipam.mode&lt;span style=&#34;color:#ce5c00;font-weight:bold&#34;&gt;=&lt;/span&gt;cluster-pool &lt;span style=&#34;color:#4e9a06&#34;&gt;\
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#4e9a06&#34;&gt;&lt;/span&gt;    --set ipam.operator.clusterPoolIPv4CIDR&lt;span style=&#34;color:#ce5c00;font-weight:bold&#34;&gt;=&lt;/span&gt;&lt;span style=&#34;color:#4e9a06&#34;&gt;&amp;#34;10.244.0.0/16&amp;#34;&lt;/span&gt; &lt;span style=&#34;color:#4e9a06&#34;&gt;\
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#4e9a06&#34;&gt;&lt;/span&gt;    --set ipam.operator.clusterPoolIPv4MaskSize&lt;span style=&#34;color:#ce5c00;font-weight:bold&#34;&gt;=&lt;/span&gt;&lt;span style=&#34;color:#0000cf;font-weight:bold&#34;&gt;24&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;æˆ–è€…ä½¿ç”¨Cilium CLI éƒ¨ç½²&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#8f5902;font-style:italic&#34;&gt;# å®‰è£…cilium cli&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;curl -L --remote-name https://github.com/cilium/cilium-cli/releases/latest/download/cilium-linux-amd64.tar.gz
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;tar xzvf cilium-linux-amd64.tar.gz
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;sudo mv cilium /usr/local/bin
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#8f5902;font-style:italic&#34;&gt;# éƒ¨ç½²ciliumå¥—ä»¶&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;kubectl create ns cilium-system &lt;span style=&#34;color:#ce5c00;font-weight:bold&#34;&gt;||&lt;/span&gt; &lt;span style=&#34;color:#204a87&#34;&gt;true&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;cilium install --namespace&lt;span style=&#34;color:#ce5c00;font-weight:bold&#34;&gt;=&lt;/span&gt;cilium-system &lt;span style=&#34;color:#4e9a06&#34;&gt;\
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#4e9a06&#34;&gt;&lt;/span&gt;		--ipam&lt;span style=&#34;color:#ce5c00;font-weight:bold&#34;&gt;=&lt;/span&gt;cluster-pool &lt;span style=&#34;color:#4e9a06&#34;&gt;\
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#4e9a06&#34;&gt;&lt;/span&gt;    --cluster-pool-ipv4-cidr&lt;span style=&#34;color:#ce5c00;font-weight:bold&#34;&gt;=&lt;/span&gt;10.244.0.0/16 &lt;span style=&#34;color:#4e9a06&#34;&gt;\
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#4e9a06&#34;&gt;&lt;/span&gt;    --cluster-pool-ipv4-mask-size&lt;span style=&#34;color:#ce5c00;font-weight:bold&#34;&gt;=&lt;/span&gt;&lt;span style=&#34;color:#0000cf;font-weight:bold&#34;&gt;24&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;h2 id=&#34;2-2-éƒ¨ç½²æ£€æŸ¥&#34;&gt;2.2. éƒ¨ç½²æ£€æŸ¥&lt;/h2&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;$ cilium status --wait
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;   /Â¯Â¯&lt;span style=&#34;color:#4e9a06&#34;&gt;\
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#4e9a06&#34;&gt;&lt;/span&gt;/Â¯Â¯&lt;span style=&#34;color:#4e9a06&#34;&gt;\_&lt;/span&gt;_/Â¯Â¯&lt;span style=&#34;color:#4e9a06&#34;&gt;\ &lt;/span&gt;   Cilium:         OK
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#4e9a06&#34;&gt;\_&lt;/span&gt;_/Â¯Â¯&lt;span style=&#34;color:#4e9a06&#34;&gt;\_&lt;/span&gt;_/    Operator:       OK
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;/Â¯Â¯&lt;span style=&#34;color:#4e9a06&#34;&gt;\_&lt;/span&gt;_/Â¯Â¯&lt;span style=&#34;color:#4e9a06&#34;&gt;\ &lt;/span&gt;   Hubble:         disabled
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#4e9a06&#34;&gt;\_&lt;/span&gt;_/Â¯Â¯&lt;span style=&#34;color:#4e9a06&#34;&gt;\_&lt;/span&gt;_/    ClusterMesh:    disabled
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;   &lt;span style=&#34;color:#4e9a06&#34;&gt;\_&lt;/span&gt;_/
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;DaemonSet         cilium             Desired: 2, Ready: 2/2, Available: 2/2
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;Deployment        cilium-operator    Desired: 2, Ready: 2/2, Available: 2/2
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;Containers:       cilium-operator    Running: &lt;span style=&#34;color:#0000cf;font-weight:bold&#34;&gt;2&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;                  cilium             Running: &lt;span style=&#34;color:#0000cf;font-weight:bold&#34;&gt;2&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;Image versions    cilium             quay.io/cilium/cilium:v1.9.5: &lt;span style=&#34;color:#0000cf;font-weight:bold&#34;&gt;2&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;                  cilium-operator    quay.io/cilium/operator-generic:v1.9.5: &lt;span style=&#34;color:#0000cf;font-weight:bold&#34;&gt;2&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;ç½‘ç»œè¿é€šæ€§æµ‹è¯•&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;$ cilium connectivity &lt;span style=&#34;color:#204a87&#34;&gt;test&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;â„¹ï¸  Monitor aggregation detected, will skip some flow validation steps
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;âœ¨ &lt;span style=&#34;color:#ce5c00;font-weight:bold&#34;&gt;[&lt;/span&gt;k8s-cluster&lt;span style=&#34;color:#ce5c00;font-weight:bold&#34;&gt;]&lt;/span&gt; Creating namespace &lt;span style=&#34;color:#204a87;font-weight:bold&#34;&gt;for&lt;/span&gt; connectivity check...
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#ce5c00;font-weight:bold&#34;&gt;(&lt;/span&gt;...&lt;span style=&#34;color:#ce5c00;font-weight:bold&#34;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;---------------------------------------------------------------------------------------------------------------------
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;ğŸ“‹ Test Report
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;---------------------------------------------------------------------------------------------------------------------
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;âœ… 69/69 tests successful &lt;span style=&#34;color:#ce5c00;font-weight:bold&#34;&gt;(&lt;/span&gt;&lt;span style=&#34;color:#0000cf;font-weight:bold&#34;&gt;0&lt;/span&gt; warnings&lt;span style=&#34;color:#ce5c00;font-weight:bold&#34;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;h2 id=&#34;2-3-cilium-ipam-æ¨¡å¼&#34;&gt;2.3. Cilium IPAM æ¨¡å¼&lt;/h2&gt;
&lt;p&gt;Cilium æ”¯æŒä»¥ä¸‹ä¸¤ç§å¸¸è§çš„ IPAM æ¨¡å¼ï¼š&lt;/p&gt;
&lt;h3 id=&#34;2-3-1-cluster-pool-æ¨¡å¼&#34;&gt;2.3.1. Cluster-Pool æ¨¡å¼ï¼š&lt;/h3&gt;
&lt;ul&gt;
&lt;li&gt;ç”± Cilium è‡ªå·±ç®¡ç† Pod IP åœ°å€èŒƒå›´ã€‚&lt;/li&gt;
&lt;li&gt;å¯ä»¥åœ¨éƒ¨ç½²æ—¶æŒ‡å®š CIDR èŒƒå›´ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;é«˜çµæ´»æ€§&lt;/strong&gt;ï¼šæ”¯æŒä¸ºä¸åŒèŠ‚ç‚¹æˆ–åŒºåŸŸå®šä¹‰ç‹¬ç«‹çš„ IP åœ°å€æ± ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;åŠ¨æ€ç®¡ç†&lt;/strong&gt;ï¼šå¯ä»¥åŠ¨æ€è°ƒæ•´ IP åœ°å€æ± å¤§å°ï¼Œé€‚åº”é›†ç¾¤çš„æ‰©å±•éœ€æ±‚ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;æ— å†²çªè®¾è®¡&lt;/strong&gt;ï¼šé¿å…å› èŠ‚ç‚¹å¢åŠ æˆ–åˆ é™¤å¼•èµ·çš„ IP åœ°å€å†²çªã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;ä¼˜åŒ–æ€§èƒ½&lt;/strong&gt;ï¼šå‡å°‘å¯¹ Kubernetes æ§åˆ¶å™¨çš„ä¾èµ–ï¼Œæé«˜ç½‘ç»œæ€§èƒ½å’Œèµ„æºåˆ©ç”¨ç‡ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;ä¾èµ– Cilium Operator&lt;/strong&gt;ï¼šéœ€è¦è¿è¡Œ Cilium Operator æ¥ç®¡ç† IP åœ°å€æ± ï¼Œå¢åŠ è¿ç»´å¤æ‚æ€§ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;&lt;strong&gt;æ¨èåœºæ™¯&lt;/strong&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;å¤§å‹é›†ç¾¤ï¼ˆ&amp;gt; 500 èŠ‚ç‚¹ï¼‰æˆ–è¶…å¤§è§„æ¨¡é›†ç¾¤ã€‚&lt;/li&gt;
&lt;li&gt;éœ€è¦è·¨åŒºåŸŸæˆ–å¤šèŠ‚ç‚¹æ± çš„å¤æ‚ç½‘ç»œè§„åˆ’ã€‚&lt;/li&gt;
&lt;li&gt;éœ€è¦åŠ¨æ€æ‰©å±• Pod IP åœ°å€èŒƒå›´çš„é›†ç¾¤ã€‚&lt;/li&gt;
&lt;li&gt;é›†ç¾¤è¿è¡Œ Cilium å¹¶éœ€è¦å……åˆ†åˆ©ç”¨å…¶é«˜çº§åŠŸèƒ½ï¼ˆå¦‚ eBPF åŠ é€Ÿã€æœåŠ¡ç½‘æ ¼ç­‰ï¼‰ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;h3 id=&#34;2-3-2-kubernetes-æ¨¡å¼-é»˜è®¤æ¨¡å¼&#34;&gt;2.3.2. Kubernetes æ¨¡å¼ï¼ˆé»˜è®¤æ¨¡å¼ï¼‰ï¼š&lt;/h3&gt;
&lt;ul&gt;
&lt;li&gt;ä½¿ç”¨ Kubernetes è‡ªèº«çš„ IP åœ°å€åˆ†é…æ–¹å¼ï¼Œä¾‹å¦‚ç”± &lt;code&gt;kube-controller-manager&lt;/code&gt; é€šè¿‡ &lt;code&gt;--cluster-cidr&lt;/code&gt; è¿›è¡Œç®¡ç†ã€‚&lt;/li&gt;
&lt;li&gt;Cilium ä» Kubernetes ä¸­è·å–åˆ†é…ç»™ Pod çš„ IP åœ°å€ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;å…¼å®¹æ€§å¼º&lt;/strong&gt;ï¼šé€‚é…å¤§å¤šæ•° CNI æ’ä»¶ï¼ˆåŒ…æ‹¬ Ciliumï¼‰ï¼Œæ— éœ€é¢å¤–é…ç½®ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;çµæ´»æ€§æœ‰é™&lt;/strong&gt;ï¼šä¸æ”¯æŒç»†ç²’åº¦çš„ IP åœ°å€æ± ç®¡ç†ï¼Œæ— æ³•ä¸ºç‰¹å®šèŠ‚ç‚¹æˆ–åŒºåŸŸåˆ†é…ç‰¹å®šçš„ IP èŒƒå›´ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;&lt;strong&gt;æ¨èåœºæ™¯&lt;/strong&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;å°å‹æˆ–ä¸­å‹é›†ç¾¤ï¼ˆ&amp;lt; 500 èŠ‚ç‚¹ï¼‰ã€‚&lt;/li&gt;
&lt;li&gt;ç½‘ç»œè§„åˆ’è¾ƒä¸ºç®€å•ï¼Œæ— éœ€å¤æ‚çš„ IP åœ°å€ç®¡ç†ã€‚&lt;/li&gt;
&lt;li&gt;éœ€è¦å¿«é€Ÿéƒ¨ç½²å¹¶ä¿æŒä¸ Kubernetes é»˜è®¤è¡Œä¸ºä¸€è‡´ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;h1 id=&#34;3-ciliumæ¶æ„åŠç»„ä»¶ä»‹ç»&#34;&gt;3. Ciliumæ¶æ„åŠç»„ä»¶ä»‹ç»&lt;/h1&gt;
&lt;h2 id=&#34;3-1-æ¶æ„å›¾&#34;&gt;3.1. æ¶æ„å›¾&lt;/h2&gt;
&lt;p&gt;å‚è€ƒå®˜ç½‘ï¼š &lt;a href=&#34;https://docs.cilium.io/en/stable/overview/component-overview/&#34;&gt;https://docs.cilium.io/en/stable/overview/component-overview/&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;https://res.cloudinary.com/dqxtn0ick/image/upload/v1731811820/article/kubernetes/network/cilium/cilium-arch.webp&#34; alt=&#34;&#34;&gt;&lt;/p&gt;
&lt;h2 id=&#34;3-2-æ ¸å¿ƒç»„ä»¶&#34;&gt;3.2. æ ¸å¿ƒç»„ä»¶&lt;/h2&gt;
&lt;p&gt;&lt;strong&gt;1. Cilium Agent&lt;/strong&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;è¿è¡Œåœ¨æ¯ä¸ª Kubernetes èŠ‚ç‚¹ä¸Šï¼Œæ˜¯ Cilium çš„æ ¸å¿ƒå®ˆæŠ¤è¿›ç¨‹ã€‚&lt;/li&gt;
&lt;li&gt;åŠŸèƒ½ï¼š
&lt;ul&gt;
&lt;li&gt;ä» Kubernetes API Server è·å–èµ„æºï¼ˆå¦‚ Podã€Service å’Œç½‘ç»œç­–ç•¥ï¼‰å¹¶è½¬æ¢ä¸º eBPF ç¨‹åºã€‚&lt;/li&gt;
&lt;li&gt;åœ¨æ¯ä¸ªèŠ‚ç‚¹ä¸Šç®¡ç†å’ŒåŠ è½½ eBPF ç¨‹åºåˆ°å†…æ ¸ã€‚&lt;/li&gt;
&lt;li&gt;å®ç° L3/L4 å’Œ L7 ç½‘ç»œç­–ç•¥ï¼Œå¹¶å°†ç­–ç•¥ä¸‹å‘åˆ°æ•°æ®å¹³é¢ã€‚&lt;/li&gt;
&lt;li&gt;è´Ÿè´£æœåŠ¡å‘ç°å’Œè´Ÿè½½å‡è¡¡ï¼ˆå–ä»£ kube-proxyï¼‰ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;&lt;strong&gt;2. Cilium CLI&lt;/strong&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;å‘½ä»¤è¡Œå·¥å…·ï¼Œç”¨äºå®‰è£…ã€é…ç½®å’Œè°ƒè¯• Ciliumã€‚&lt;/li&gt;
&lt;li&gt;åŠŸèƒ½ï¼š
&lt;ul&gt;
&lt;li&gt;é…ç½® Cilium çš„ç½‘ç»œç­–ç•¥ã€‚&lt;/li&gt;
&lt;li&gt;æŸ¥çœ‹ Cilium å’Œ Hubble çš„è¿è¡ŒçŠ¶æ€ã€‚&lt;/li&gt;
&lt;li&gt;è°ƒè¯• eBPF ç¨‹åºã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;&lt;strong&gt;3. CNI Plugin&lt;/strong&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;å½“åœ¨èŠ‚ç‚¹ä¸Šè°ƒåº¦æˆ–ç»ˆæ­¢podæ—¶ï¼ŒKubernetesä¼šè°ƒç”¨CNIæ’ä»¶ï¼ˆcilium-cniï¼‰ã€‚å®ƒä¸èŠ‚ç‚¹çš„Cilium APIäº¤äº’ï¼Œè§¦å‘å¿…è¦çš„æ•°æ®è·¯å¾„é…ç½®ï¼Œä¸ºpodæä¾›ç½‘ç»œã€è´Ÿè½½å¹³è¡¡å’Œç½‘ç»œç­–ç•¥ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;&lt;strong&gt;4. Cilium Operator&lt;/strong&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;åœ¨ Kubernetes ä¸­è¿è¡Œçš„æ§åˆ¶å¹³é¢ç»„ä»¶ã€‚&lt;/li&gt;
&lt;li&gt;åŠŸèƒ½ï¼š
&lt;ul&gt;
&lt;li&gt;å¤„ç† IP åœ°å€ç®¡ç†ï¼šç®¡ç† Pod çš„ IP æ± ã€‚&lt;/li&gt;
&lt;li&gt;ç»´æŠ¤ Cilium Agent ä¸ Kubernetes çš„é›†æˆã€‚&lt;/li&gt;
&lt;li&gt;å¤„ç†èŠ‚ç‚¹é—´çš„æ‹“æ‰‘å˜åŒ–ï¼ˆå¦‚èŠ‚ç‚¹åŠ å…¥æˆ–ç¦»å¼€ï¼‰ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;h2 id=&#34;3-3-å…¶ä»–ç»„ä»¶&#34;&gt;3.3. å…¶ä»–ç»„ä»¶&lt;/h2&gt;
&lt;p&gt;&lt;strong&gt;1. eBPF ç¨‹åº&lt;/strong&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;Cilium çš„æ•°æ®å¹³é¢æ ¸å¿ƒï¼Œè¿è¡Œåœ¨ Linux å†…æ ¸ä¸­ã€‚&lt;/li&gt;
&lt;li&gt;åŠŸèƒ½ï¼š
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;è·¯ç”±å’Œè½¬å‘&lt;/strong&gt;ï¼šåœ¨èŠ‚ç‚¹é—´å¤„ç† Pod çš„ç½‘ç»œæµé‡ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;ç½‘ç»œç­–ç•¥&lt;/strong&gt;ï¼šå®ç° L3/L4 å’Œ L7 çš„è®¿é—®æ§åˆ¶ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;æœåŠ¡è´Ÿè½½å‡è¡¡&lt;/strong&gt;ï¼šæä¾›ç±»ä¼¼ kube-proxy çš„æœåŠ¡è½¬å‘åŠŸèƒ½ï¼Œä½†æ€§èƒ½æ›´é«˜ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;ç›‘æ§å’Œå¯è§‚æµ‹æ€§&lt;/strong&gt;ï¼šæ”¶é›†ç½‘ç»œæµé‡æ•°æ®ï¼Œä¾› Hubble æˆ–å…¶ä»–å·¥å…·åˆ†æã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;&lt;strong&gt;2. Hubble&lt;/strong&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;Cilium çš„å¯è§‚æµ‹æ€§å¹³å°ï¼Œç”¨äºå®æ—¶ç›‘æ§å’Œåˆ†æç½‘ç»œæµé‡ã€‚&lt;/li&gt;
&lt;li&gt;åŠŸèƒ½ï¼š
&lt;ul&gt;
&lt;li&gt;æµé‡å¯è§†åŒ–ï¼šå±•ç¤ºæœåŠ¡é—´çš„æµé‡è·¯å¾„å’Œç»Ÿè®¡ã€‚&lt;/li&gt;
&lt;li&gt;æµé‡è¿½è¸ªï¼šæ•è·å’Œè°ƒè¯•ç½‘ç»œé—®é¢˜ã€‚&lt;/li&gt;
&lt;li&gt;å»¶è¿Ÿå’Œé”™è¯¯ç‡ç›‘æ§ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;h1 id=&#34;4-cilium-çš„å·¥ä½œæµ&#34;&gt;&lt;strong&gt;4. Cilium çš„å·¥ä½œæµ&lt;/strong&gt;&lt;/h1&gt;
&lt;ol&gt;
&lt;li&gt;&lt;strong&gt;åˆå§‹åŒ–&lt;/strong&gt;ï¼š
&lt;ul&gt;
&lt;li&gt;Cilium Agent å¯åŠ¨åï¼Œä¸ Kubernetes API Server å»ºç«‹è¿æ¥ï¼Œç›‘å¬èµ„æºå˜åŒ–ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;ç­–ç•¥é…ç½®&lt;/strong&gt;ï¼š
&lt;ul&gt;
&lt;li&gt;ç”¨æˆ·å®šä¹‰çš„ &lt;code&gt;NetworkPolicy&lt;/code&gt; æˆ– &lt;code&gt;CiliumNetworkPolicy&lt;/code&gt; é€šè¿‡ Cilium Agent ä¼ é€’åˆ° eBPF ç¨‹åºã€‚&lt;/li&gt;
&lt;li&gt;eBPF ç¨‹åºåœ¨å†…æ ¸ä¸­ç›´æ¥æ‰§è¡Œæµé‡æ§åˆ¶é€»è¾‘ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;æµé‡å¤„ç†&lt;/strong&gt;ï¼š
&lt;ul&gt;
&lt;li&gt;æ•°æ®å¹³é¢é€šè¿‡ eBPF ç¨‹åºå¯¹ç½‘ç»œæµé‡è¿›è¡Œè·¯ç”±ã€ç­–ç•¥åŒ¹é…å’Œè´Ÿè½½å‡è¡¡ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;ç›‘æ§å’Œåˆ†æ&lt;/strong&gt;ï¼š
&lt;ul&gt;
&lt;li&gt;eBPF ç¨‹åºæ”¶é›†æµé‡æ•°æ®ï¼Œå‘é€åˆ° Hubbleã€‚&lt;/li&gt;
&lt;li&gt;Hubble å°†æ•°æ®å¯è§†åŒ–ï¼Œä¾›ç”¨æˆ·ç›‘æ§å’Œè°ƒè¯•ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;å‚è€ƒï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href=&#34;https://docs.cilium.io/en/stable/&#34;&gt;https://docs.cilium.io/en/stable/&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://docs.cilium.io/en/stable/overview/component-overview/&#34;&gt;https://docs.cilium.io/en/stable/overview/component-overview/&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;

      </description>
    </item>
    
  </channel>
</rss>
